<html>
<head>
<title>记一次代码审计到申请CVE到过程</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
记一次代码审计到申请CVE到过程
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                                    学员-素念
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-11-05</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><p data-mpa-powered-by="yiban.io"><strong>0x00起因</strong></p><p><strong><br  /></strong></p><p>这篇文章主要是分享一下我随手提交的一个PHP低质量cve，之所以想写一下的原因是因为这段日子在我渗透技术库群中有一个朋友说到自己双非一本，但是正式工在等保横行的苏州只有4.5k，想挖cve挖不到，打ctf成绩也不是很好。</p><p><img data-ratio="0.4050632911392405" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/1_1oH9HocKhgibNH4ncFCZ6rpb2c2DmQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsCKm4QIGBUAianJ5xx09vIWicxoF1oH9HocKhgibNH4ncFCZ6rpb2c2DmQ/640?wx_fmt=png'" data-type="png" data-w="474" data-backw="474" data-backh="192" style="width: 100%;height: auto;"  /></p><p>我想表达的并不是他能力不够，我相信一本的学生整体学习能力是很强的。他可能只是入门晚，缺人指点。缺一个像咱HACK学习呀公众号这种学习指南。</p><p>说了这么多，大家可能觉得是废话，但是半路出家没人指点的痛苦我相信各位自学的朋友肯定都深有体会，包括我也是。这里就简单写一下我为申请cve做的一些努力和总结的方法，方便大家学习。</p><p><br  /></p><p><strong>0x01 学习思路</strong></p><p>凡是自学，百度肯定是少不了的，参考他人的学习方法吸收经验亦是进步。这些是我常用的“搜索引擎”：www.baidu.com、google、www.freebuf.com、xz.aliyun.com、4hou.com、www.t00ls.net、www.secquan.org、forum.90sec.com等等</p><p><br  /></p><p>通过这些搜索PHP代码审计，你会发现五花八门的教程。有质量优的，质量差的。质量优的不懂代码审计的你看不来，质量差的看完没进步。</p><p><img data-ratio="0.7335870599429115" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/2_Svj0eVN5icFxEDh5HyDxsU7jvRBUNA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCs3mFUHtllqj8toKEU0KibK8XexxSvj0eVN5icFxEDh5HyDxsU7jvRBUNA/640?wx_fmt=png'" data-type="png" data-w="1051"  /></p><p><br  /></p><p>搜索PHP代码审计入门，有些是各种漏洞的介绍，但我相信近几年大家学某些漏洞肯定都是从代码层来学的。那这些介绍漏洞的代码审计入门文章对你的帮助其实不是很大了，因为你已经懂了漏洞的形成原理。且如果给你针对的注入上传的函数代码，那这真的太简单了。</p><p><img data-ratio="0.6692406692406693" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/3_ibiaQylCch5rA0I1QLNpicDIkphicg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsiaMEflDdgTX56jc4zHA3rSjuicGx0HibiaQylCch5rA0I1QLNpicDIkphicg/640?wx_fmt=png'" data-type="png" data-w="777"  /></p><p>而有些文章他们大体都说了代码审计的总体流程，其实你通过这些流程大致已经懂了代码审计中要做什么。可以全局看，可以针对流量去看什么的。</p><p><img data-ratio="0.7580321285140562" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/4_RJpAQmicRta5KtRIBib7Ru5OUEMiaA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsMW0icagcW3OIOcRtgB0lWeDdWtcoRJpAQmicRta5KtRIBib7Ru5OUEMiaA/640?wx_fmt=png'" data-type="png" data-w="996"  /></p><p><br  /></p><p><br  /></p><p>但你是否觉得自己这样零散的学缺了一个中心点呢？我称它为树干。</p><p>这个树干是什么呢？在我眼中他是代码开发能力，它决定了你的总体高度。为什么这么说呢，你想审计它你总得看得懂吧。当然我这里的看得懂，不是指读懂某些直观漏洞的代码，实际cms当中会出现各种各样得问题，一个人这么写，一个人那么写。你通过学漏洞的代码真的看得懂开发者得整体流程吗？简单得那些不用说了，稍微难一点点，用点对象，用点框架，你真的看得懂吗?看不懂就可以洗洗睡了，学习人。</p><p><img data-ratio="0.6645865834633385" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/5_ianZYJH1U7GOqYD2thkvzRlxjiaJrg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCschnWMlNnJrZqJ3kse4V2180AHHianZYJH1U7GOqYD2thkvzRlxjiaJrg/640?wx_fmt=png'" data-type="png" data-w="641"  /></p><p><br  /></p><p>除了树干之外，一棵树少不了树枝。那树枝是什么呢？树枝就是我上面所说的百度PHP代码审计的东西。</p><p><br  /></p><p>（1）有每种漏洞的利用套路。如我们最基础的漏洞，不同的注入方法，不同的上传绕过方法，不同的xss利用方法，不同的代码执行方式。</p><p><img data-ratio="0.6018099547511312" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/6_Db07Xhjx86lAdiahlAZOC0GDDPmocw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsflyibIkC7cU8mjwUh4fZibNQU1FDb07Xhjx86lAdiahlAZOC0GDDPmocw/640?wx_fmt=png'" data-type="png" data-w="884"  /></p><p>（2）有人家复现的整体流程。通过人家的文章去学习如何从头到尾审计一门cms，先看什么后看什么，哪些需要着重的看。</p><p><img data-ratio="0.4198019801980198" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/7_cibpcdFkFibHss1mBMADd96OuKQWeQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsc0JI9yCUqrlxZOXWegibbCY9ickDcibpcdFkFibHss1mBMADd96OuKQWeQ/640?wx_fmt=png'" data-type="png" data-w="1010"  /></p><p>（3）有针对每种漏洞的研究性文章。在这一模块我喜欢直接去做ctf，看各种不同漏洞的高难度研究文章。这一块可以锻炼你的极端环境解决能力，虽然这一块很难很复杂。但是你想走到人家达不到的高处，就得学人家学不会且使用的技能。</p><p><img data-ratio="0.6114965312190287" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/8_KRHKMs8KTj1XIKpia1cq8Dd81HveZQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsRg6qV8STDoYEPThmaDK5qoQBuKRHKMs8KTj1XIKpia1cq8Dd81HveZQ/640?wx_fmt=png'" data-type="png" data-w="1009"  /></p><p><br  /></p><p>这些在你代码足够OK的前提下吃透不是很难，只有当你树干足够强大了，树枝才能长得好。当然你说自己代码一般般，也能审计出漏洞这也是很正常的。</p><p>树干在你接触某一门语言时已经开始成长了，你也许在学习漏洞时提升了代码阅读能力，在打ctf时提升了代码阅读能力。让你感觉其实代码审计也挺简单的，这些都是路子。树枝吸收的营养最后还是会给到树干，但对于我这种打ctf脑子转不过来，看人家复现cms漏洞流程越看越懵逼的人，在学习审计时先把代码基础完善比较好。</p><p><img data-ratio="0.8896797153024911" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/9_XpcYfkvG4yLWevbx4EO4IxFE8PwkvQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsQ8XyGTwpP3V4ZhSlW4UQ939gXpcYfkvG4yLWevbx4EO4IxFE8PwkvQ/640?wx_fmt=png'" data-type="png" data-w="843"  /></p><p>条条大路通罗马，每条路都能走通的。做ctf的代码题，可以提升自己对某些知识点的研究。看人家总结审计漏洞的文章，可以让自己懂得开发者经常会犯的BUG！</p><p><br  /></p><p>如果这是LOL，那我会主点开发，副点CTF，再点思路。在这里就是我对自己审计的态度，学好开发，打好CTF。</p><p><br  /></p><p><strong>0x02 简单分析流程</strong></p><p><strong><br  /></strong></p><p>在这里简单把我之前某个二货十足的洞说一下，主要为了练习自己的代码阅读能力。从工具匹配到的漏洞我都去读了一遍。</p><p>在ucms1.5.0的/install/index.php中的$_POST[<strong>'mysql_dbname'</strong>]存在XSS漏洞。漏洞点在当前文件的226行</p><p><img data-ratio="0.10344827586206896" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/10_Kic2jrGmibpuEWt5p1W1KKyH52Us2A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsdNVcmiaDfjXDNERGyTrMsdiaWib1oKic2jrGmibpuEWt5p1W1KKyH52Us2A/640?wx_fmt=png'" data-type="png" data-w="870"  /></p><p>在这里存在着一个触发条件$ifin等于0，继续往上看。从210行开始对$ifin进行赋值处理</p><p><img data-ratio="0.23024054982817868" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/11_chrMDKgbePF40SrEKsyIKuJibF53sQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsS3VZ2c2QVSJPMpDVdEVIW37WDchrMDKgbePF40SrEKsyIKuJibF53sQ/640?wx_fmt=png'" data-type="png" data-w="1164"  /></p><p>在217行第一次给$ifin赋值0，然后进入218行的循环判断，判断$val['Database']是否和传入的'mysql_dbname'是否相等。如果相等那么$ifin为1，这样就不会执行我们的die()操作。在这里寻找'mysql_dbname'不等于$val['Database']的逻辑条件。</p><p><br  /></p><p>$val是$alldb数组的中的一个键，在这里看$alldb数组是如何产生的。回到216行，可以看到他是$db-&gt;all('SHOW DATABASES')后返回的数据。在这里可以看一下$db类的all()方法。</p><p><br  /></p><p>它将传入的$sql给如$this-&gt;query()函数</p><p><img data-ratio="0.2668463611859838" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/12_Zny5I8ZfvKb6266I3CVzCG0GjYfZNg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsCPnlELiaXpB1yEAeXQGw3FGibvZny5I8ZfvKb6266I3CVzCG0GjYfZNg/640?wx_fmt=png'" data-type="png" data-w="371" data-backw="371" data-backh="99" style="width: 100%;height: auto;"  /></p><p>在$this-&gt;query()中使用了原生的查询函数mysql_query() 对传入的$sql进行查询</p><p><img data-ratio="0.5573770491803278" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/13_k4bMRgEEo1dMaApqmIv3j4jDIabIQw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsS1QJNHHcKN81LoOD51U48tzTk4bMRgEEo1dMaApqmIv3j4jDIabIQw/640?wx_fmt=png'" data-type="png" data-w="549" data-backw="549" data-backh="306" style="width: 100%;height: auto;"  /></p><p>在这里回到216行，可以明确这里的作用是将后面的代码传入数据库执行。SQL语句的意思是查看所有数据库，那么配合219行之后的内容来说就是当数据库内不存在$_POST['mysql_dbname']的数据库名时$ifin=0。</p><p><img data-ratio="0.05066079295154185" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/14_DrT53xUP8W9egqCcffezKK558TQ46w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCssmHL398icBU7xIp040SP27Td2DrT53xUP8W9egqCcffezKK558TQ46w/640?wx_fmt=png'" data-type="png" data-w="454" data-backw="454" data-backh="23" style="width: 100%;height: auto;"  /></p><p><img data-ratio="0.16265060240963855" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/15_OaiaB4bCAqGJc2okibY2bfW9em2XFA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsvnicoHQPf0kuIYib1AKwu3aNSQWEOaiaB4bCAqGJc2okibY2bfW9em2XFA/640?wx_fmt=png'" data-type="png" data-w="498" data-backw="498" data-backh="81" style="width: 100%;height: auto;"  /></p><p>但是这里还有一个点在215行，这里会将$_POST['mysql_dbname']传入的值写入数据库。写入数据库后再show databases，那么正常逻辑来说这里是不会导致$ifin=0的。</p><p><img data-ratio="0.0436046511627907" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/16_EUeRFebS8taL3p1EXIxtDrwQUEs5Hg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsic058LumGxx2iaCyNo9TCgnMduEUeRFebS8taL3p1EXIxtDrwQUEs5Hg/640?wx_fmt=png'" data-type="png" data-w="688"  /></p><p>将传入的字符写入数据库再查询出来和传入的字符进行比较，如果不等则触发XSS。这里就存在着问题，如何才能让他们两不相等呢？真相就是sql注入的闭合注释！</p><p><br  /></p><p>但是这里存在着一个问题，就是闭合符号并不是单引号'，而是` 。在这里我们可以传入ucms1.5.0` -- |&lt;script&gt;alert("xss")&lt;/script&gt;。这样数据库内写入的就是ucms1.5.0数据库名，再次show databases查询出来和传入的ucms1.5.0` -- |&lt;script&gt;alert("xss")&lt;/script&gt;&nbsp;进行对比时就会不一样，从而触发XSS!</p><p><img data-ratio="0.5376661742983752" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/17_4alTkpj0NgjAHkY0OKM0vHOS03U3tA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsgOYeqvDLS0ic7wsVoR0RKKiarf4alTkpj0NgjAHkY0OKM0vHOS03U3tA/640?wx_fmt=png'" data-type="png" data-w="1354"  /></p><p>点击安装之后会触发step=2，并且触发XSS</p><p><img data-ratio="0.5360059391239792" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/18_WXfSPPbibsPDPsMPtoVHWXXR4UPXwQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsEZOOQ2zJ3Htdp2X2Qm2ZlyhwJWXfSPPbibsPDPsMPtoVHWXXR4UPXwQ/640?wx_fmt=png'" data-type="png" data-w="1347"  /></p><p><br  /></p><p>看完是不是觉得这二货写的啥，这洞有什么意思。我自己都有这种感觉，我在干嘛，我是谁。之所以想读还是因为想练习读代码的能力，就像其他师傅说的。读越多的代码，审越多的洞，以后的大洞都是这些小玩意儿积累起来的。</p><p><br  /></p><p><strong>0X03申请过程</strong></p><p><strong><br  /></strong></p><p>我那个cve也就一个上传命令执行，感觉就是基础漏洞。没有搬到文章里的必要，在这里就主要写一下我申请的流程。</p><p><br  /></p><p><img data-ratio="0.47130761994355597" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/19_oJfgibN6mRPQFdCf9bz2ahnRCWfVgg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsaZu07SUibpIf57EtK1sibKHvEvDoJfgibN6mRPQFdCf9bz2ahnRCWfVgg/640?wx_fmt=png'" data-type="png" data-w="1063"  /></p><p>在这里我参考了套哥的文章https://www.freebuf.com/168362.html，有兴趣的同学可以认证看一下。但是我比较懒，还是直接把必要流程写写好了。</p><p>直接访问https://cveform.mitre.org/申请，这个杂七杂八都要！</p><p><img data-ratio="0.4734594264795607" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/20_kcaGDBNFodJFrTO582YMW6MCEPIgkg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCseMnB6O2FDFpX4ibwLyFv2NawbkcaGDBNFodJFrTO582YMW6MCEPIgkg/640?wx_fmt=png'" data-type="png" data-w="1639"  /></p><p>这个看不懂就谷歌翻译，这里选一个申请cveid。</p><p><img data-ratio="0.4053724053724054" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/21_7HN06HKjgibhvCo7YaL87vXwjXJXmQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsibqh5yqvP0iakvuOibXN63n5ISRO7HN06HKjgibhvCo7YaL87vXwjXJXmQ/640?wx_fmt=png'" data-type="png" data-w="1638"  /></p><p>其他就按照翻译来填写</p><p><img data-ratio="0.42461122379986477" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/22_LdTsQ4VLqvjs6icwCQQAGh2gfWHOrA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCspauXpYFGKlcw82M3H8LGDFQ39LdTsQ4VLqvjs6icwCQQAGh2gfWHOrA/640?wx_fmt=png'" data-type="png" data-w="1479"  /></p><p><br  /></p><p>在这里主要就是参考资料模块，因为你可能写了整体的过程。这里框太小放不下，你就可以扔一个自己的github链接，把发现过程写在自己的github里。你放其他平台链接，人家可能不点。</p><p><img data-ratio="0.41878367975365666" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/23_Yups15nQxuz7QL6g6J3sbVLhAYOz7Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouic1RReUVeyNicOz3CtCFhSCsN8BicZn2CMWnm9icN1B0iccVj42Yups15nQxuz7QL6g6J3sbVLhAYOz7Q/640?wx_fmt=png'" data-type="png" data-w="1299"  /></p><p><br  /></p><p><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="shell"><code><span class="code-snippet_outer">文章的格式可以按照我这样的来写</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#</span> BLUECMS 1.6 Value parameter has SQL injection</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">#</span><span class="code-snippet__comment"># Vulnerability Type :</span></span></code><code><span class="code-snippet_outer">SQL Injection</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">#</span><span class="code-snippet__comment"># Vulnerability Version :</span></span></code><code><span class="code-snippet_outer">1.6</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">#</span><span class="code-snippet__comment"># Recurring environment:</span></span></code><code><span class="code-snippet_outer">* Windows 10</span></code><code><span class="code-snippet_outer">* PHP 5.4.5</span></code><code><span class="code-snippet_outer">* Apache 2.4.23</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">#</span><span class="code-snippet__comment"># Vulnerability Description AND recurrence:</span></span></code><code><span class="code-snippet_outer">这里就写自己的发现过程</span></code></pre></section><p><br  /></p><p>申请的内容全部翻译成英文，还有就是人家的审核时间可能不是其他人所说的3-5天。可能是几周，看运气了。</p><p><br  /></p><p><br  /></p><p><strong>0x03 结束寄语</strong></p><p><strong><br  /></strong></p><p>不管是半路出家的还是正规军，学自己学热爱的是一件庆幸的事情。每个人有不同的学习方法，有人适合我说的方法，有人不适合我说的方法。在这里我也只是分享自己学习代码审计的一个思路，低质量cve其实就是附带的。。当我们有了明确的目标之后，加上合理的学习方法。最后就只要堆时间莽就好了，事半功倍总那么让人感觉舒适。</p><p><br  /></p><p>在这里感谢贝塔安全实验室的Leafer师傅在我学习审计时给出的指导！</p><p>最后祝各位师傅能找到合适的工作，拿着高额的薪水抱着心爱的妹子！</p><p><br  /></p><p><img src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/24_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-ratio="0.109375" data-w="640"  /></p><p><br  /></p><p style="text-align: center;"><span style="color: rgb(255, 104, 39);"><strong>点赞 转发 在看</strong></span></p><p style="text-align: center;"><span style="color: rgb(255, 104, 39);"><strong><br  /></strong></span></p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2020-11-05_记一次代码审计到申请CVE到过程/25_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style=""  /></p>
                </div>
</div>
</body>
</html>