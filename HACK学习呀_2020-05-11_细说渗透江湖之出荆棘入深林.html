<html>
<head>
<title>细说渗透江湖之出荆棘入深林</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
细说渗透江湖之出荆棘入深林
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                            
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-05-11</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div>

                
                                
                
                

                
                                                                

                
                                    
                    <div class="original_area_primary" style="margin-bottom: 0;">
                                                                                                </div>

                    
                                            <div class="original_area_primary">
                            <p role="option" class="original_primary_card_tips">
                                                                    <span>以下文章来源于酒仙桥六号部队</span>
                                                                                                    <span>，作者队员编号004</span>
                                                            </p>
                            <a class="weui-flex original_primary_card appmsg_card_context appmsg_card_active" href="#" id="copyright_info">
                                <div class="weui-flex__hd">
                                    <span class="radius_avatar"> </span>
                                </div>
                                <div class="weui-flex__item" role="option">
                                    <strong class="original_primary_nickname">酒仙桥六号部队</strong>
                                                                            <span class="weui-hidden_abs">.</span>
                                        <p class="original_primary_desc">知其黑，守其白。 分享知识盛宴，闲聊大院趣事，备好酒肉等你！</p>
                                                                    </div>
                                <div class="weui-flex__ft"></div>
                            </a>
                        </div><div id="weixin_content"><p data-mpa-powered-by="yiban.io"><br  /></p><section style="display: none;" data-tools="新媒体管家" data-label="powered by xmt.cn"><br  /></section><section data-tools="135编辑器" data-id="92498" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="box-sizing: border-box;"><section style="box-sizing: border-box;"><section style="box-sizing: border-box;"><section data-tools="135编辑器" data-id="92498" style="box-sizing: border-box;"><section style="box-sizing: border-box;"><section style="box-sizing: border-box;"><section style="box-sizing: border-box;"><section data-brushtype="text" style="box-sizing: border-box;"><section data-tools="135编辑器" data-id="92498" style="box-sizing: border-box;"><section style="padding-top: 15px;padding-bottom: 15px;display: flex;justify-content: center;box-sizing: border-box;"><section style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s56RnQpURB5hlzxttTVZHk8kEImFwElKKTJ8QWUKKOH1HxNHzoy9ttqjQynb1lYGcyKZNNnESeuBNQ/640?wx_fmt=png&quot;);background-position: left top;background-repeat: no-repeat;background-size: 30px;box-sizing: border-box;"><section style="padding: 8px 12px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s56RnQpURB5hlzxttTVZHk8kBgMuN7zeZd8WGxAaPSIC88icL9SN7E3utSPAFwgd4VLON6xyMmQicLBA/640?wx_fmt=png&quot;);background-position: right bottom;background-size: 30px;background-repeat: no-repeat;box-sizing: border-box;"><section data-brushtype="text" style="padding-right: 20px;padding-left: 20px;line-height: 30px;background-color: rgb(114, 186, 180);color: rgb(255, 255, 255);box-sizing: border-box;"><p style="margin-right: 5px;margin-left: 5px;padding-right: 20px;padding-left: 20px;color: rgb(32, 88, 103);letter-spacing: 2.5px;line-height: 1.75em;"><span style="font-size:14px;line-height:34px;;color: rgb(0, 0, 0);font family: arial, helvetica, sans-serif;">这是&nbsp;</span><strong><span style="font-size:14px;line-height:34px;;color: rgb(0, 0, 0);font family: arial, helvetica, sans-serif;">酒仙桥六号部队&nbsp;</span></strong><span style="font-size:14px;line-height:34px;;color: rgb(0, 0, 0);font family: arial, helvetica, sans-serif;">的第 <strong>4</strong><strong>&nbsp;</strong>篇文章。</span></p><p style="margin-right: 5px;margin-left: 5px;padding-right: 20px;padding-left: 20px;color: rgb(32, 88, 103);letter-spacing: 2.5px;line-height: 1.75em;"><span style="font-size:14px;line-height:34px;;color: rgb(0, 0, 0);font family: arial, helvetica, sans-serif;">全文共计4133个字，预计阅读时长12分钟</span><span style="font-size:14px;line-height:34px;;font family: arial, helvetica, sans-serif;">。</span></p></section></section></section></section></section></section></section></section></section></section><section data-tools="135编辑器" data-id="92498" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="box-sizing: border-box;"><section style="box-sizing: border-box;"><section style="box-sizing: border-box;"><p><br  /></p></section></section></section></section><section data-tools="135编辑器" data-id="95387" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="box-sizing: border-box;"><section style="box-sizing: border-box;"><h1 cid="n18" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><section data-tools="135编辑器" data-id="95387" style="box-sizing: border-box;"><section style="margin: 10px auto;text-align: center;box-sizing: border-box;"><section style="padding-right: 20px;padding-left: 20px;display: inline-block;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;"><section data-brushtype="text" style="padding: 6px 20px 10px 30px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57qETeCiaA2QmwgWqG0EhWOmoHUXP04mk5cE2hCCQ8VDRvuGr3QGeficDIj49mEhrb8JYdgDaTfPyCw/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100% 100%;letter-spacing: 1.5px;box-sizing: border-box;"><p style="letter-spacing: 2.5px;line-height: 1.75em;margin-left: 5px;margin-right: 5px;"><strong><span style="font-size:20px;line-height:40px;;color: rgb(0, 0, 0);font family: 宋体, SimSun;">前言</span></strong></p></section></section></section></section><h1 cid="n18" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p style="margin: 0.8em 5px;box-sizing: border-box;orphans: 4;white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;"></span></p></section></section></section></section></section></section></section><p><br  /></p><p style="max-inline-size: 100%;margin-right: 5px;margin-bottom: 8px;margin-left: 5px;min-height: 1em;cursor: text;font-size:16px;line-height:36px;;caret-color: rgb(255, 0, 0);letter-spacing: 2.5px;line-height: 1.75em;box-sizing: border-box !important;outline: none 0px !important;"><span style="max-inline-size: 100%;box-sizing: border-box;cursor: text;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;outline: none 0px !important;">大家好，我是一名正义的使者，常常在黑夜来临的时候，徜徉在网络的海洋中，突破层层防御抵近核心区域，在“游戏规则”的限定内为了达到我的目的，我不断突破自己。不知道这样过了多少个黑夜。</span></p><p style="max-inline-size: 100%;margin-right: 5px;margin-bottom: 8px;margin-left: 5px;min-height: 1em;cursor: text;font-size:16px;line-height:36px;;caret-color: rgb(255, 0, 0);letter-spacing: 2.5px;line-height: 1.75em;box-sizing: border-box !important;outline: none 0px !important;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;font family: 宋体, SimSun;">当我第一次看见目标应用的时候，感觉它就跟以往测试的目标一样没什么区别。但是，这个起初看起来像是单个的SQL注入漏洞的网站，让我头发都多掉了好几根，北京的冬天太冷，我的脑袋有点凉。</span></p><p style="max-inline-size: 100%;margin-right: 5px;margin-bottom: 8px;margin-left: 5px;min-height: 1em;cursor: text;font-size:16px;line-height:36px;;caret-color: rgb(255, 0, 0);letter-spacing: 2.5px;line-height: 1.75em;box-sizing: border-box !important;outline: none 0px !important;"><span style="max-inline-size: 100%;box-sizing: border-box;cursor: text;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;outline: none 0px !important;">今天像往常一样，我对目标发起了攻击，以为是一次很普通的提权之路，没想到却是一次曲折的历程。&nbsp;<br style="max-inline-size: 100%;box-sizing: border-box !important;outline: none 0px !important;"  /></span></p><p style="max-inline-size: 100%;margin-right: 5px;margin-bottom: 8px;margin-left: 5px;min-height: 1em;cursor: text;font-size:16px;line-height:36px;;caret-color: rgb(255, 0, 0);letter-spacing: 2.5px;line-height: 1.75em;box-sizing: border-box !important;outline: none 0px !important;"><span style="max-inline-size: 100%;box-sizing: border-box;cursor: text;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;outline: none 0px !important;">思路开始的地方，才是漏洞利用的关键过程。具体利用图片细节我们会打码放出，重点分析此次实战精华思路。<br style="max-inline-size: 100%;box-sizing: border-box !important;outline: none 0px !important;"  /></span></p><p style="max-inline-size: 100%;margin-right: 5px;margin-bottom: 8px;margin-left: 5px;min-height: 1em;cursor: text;font-size:16px;line-height:36px;;caret-color: rgb(255, 0, 0);letter-spacing: 2.5px;line-height: 1.75em;box-sizing: border-box !important;outline: none 0px !important;"><span style="max-inline-size: 100%;box-sizing: border-box;cursor: text;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;outline: none 0px !important;">整个架构大概是这样的：</span></p><p><br  /></p><section data-tools="135编辑器" data-id="92498" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="box-sizing: border-box;"><section><p style="letter-spacing: 2.5px;line-height: 1.75em;margin-left: 5px;margin-right: 5px;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;"></span><br  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="338" data-backw="578" data-ratio="0.5851216022889842" data-s="300,640" data-type="gif" data-w="699" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/1_DtWkICQIvkiaRwQWvLvhvluGdJcfEw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cUy22UxyGbMN90F500RLNLWiajSDtWkICQIvkiaRwQWvLvhvluGdJcfEw/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><br  /></p></section></section></section><p><br  /></p><h1 cid="n18" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p><br  /></p><section data-tools="135编辑器" data-id="95387" style="box-sizing: border-box;"><section style="margin: 10px auto;text-align: center;box-sizing: border-box;"><section style="padding-right: 20px;padding-left: 20px;display: inline-block;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;"><section data-brushtype="text" style="padding: 6px 20px 10px 30px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57qETeCiaA2QmwgWqG0EhWOmoHUXP04mk5cE2hCCQ8VDRvuGr3QGeficDIj49mEhrb8JYdgDaTfPyCw/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100% 100%;font-size:16px;line-height:36px;;letter-spacing: 1.5px;box-sizing: border-box;"><p style="letter-spacing: 2.5px;line-height: 1.75em;margin-left: 5px;margin-right: 5px;"><strong><span style="font-size:20px;line-height:40px;;color: rgb(0, 0, 0);font family: 宋体, SimSun;">SQL inject</span></strong></p></section></section></section></section><p><br  /></p><h1 cid="n18" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p style="margin: 0.8em 5px;box-sizing: border-box;orphans: 4;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">起源是一个接口注入，数据库环境是mysql，服务器系统是windows，正常来说的话这种注入通过sqlmap去跑就行了，sqlmap会自动创建dll文件，通过os-shell返回一个交互式的shell回来一切顺利。</span></p><p style="margin: 0.8em 5px;box-sizing: border-box;orphans: 4;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">经历过腥风血雨的我对这么轻松就拿到shell的环境已经没什么成就感了，我面对着黑色界面返回来的os-shell界面习惯性的敲了一个“whoami”。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="54" data-backw="578" data-ratio="0.09428571428571429" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/2_iapJnrmjiagIesxd1x6No8ia0ZfDoA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6c63fSqRVaaxicEqxg6lchG6cxWtzniapJnrmjiagIesxd1x6No8ia0ZfDoA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">Ok，一切尽在掌握，当我尝试执行其它命令的时候，心中就有一万匹马奔腾而过了。</span><br  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="214" data-backw="578" data-ratio="0.37" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/3_BKOtyJLg4crvwKVW6JDgITttkFibtw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cwXxUPGic2awIOULZicu1FuWiahVjBKOtyJLg4crvwKVW6JDgITttkFibtw/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="345" data-backw="578" data-ratio="0.5971428571428572" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/4_d8DWT7BzSnyuvODxiaaK8TJZrfIH6w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cVbQtopyswbibgodKln8fAFsFoMd8DWT7BzSnyuvODxiaaK8TJZrfIH6w/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">一开始怀疑是sqlmap写入的dll文件有问题，遂想尝试通过sqlmap的os-pwn看能否直接弹回来一个msf的shell。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">执行：</span></p><p style="text-align: left;"><img class="rich_pages js_insertlocalimg" data-backh="166" data-backw="578" data-ratio="0.28714285714285714" data-s="300,640" data-type="png" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/5_bluuL2icTtHicnA6Wk0T5NQwgSR2ag.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6c8teZBzXfvictaAaxlLv1CWibPNXrbluuL2icTtHicnA6Wk0T5NQwgSR2ag/640?wx_fmt=png'" style="width: 100%;height: auto;"  /><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;text-align: justify;">一切都那么和谐。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="195" data-backw="578" data-ratio="0.33714285714285713" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/6_LzPNmjicRWBK9QPdQJNiaQvrHlsHMA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6crDAFDwuCq8wQwtfF5kG4PjLicCELzPNmjicRWBK9QPdQJNiaQvrHlsHMA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">失败！</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="356" data-backw="578" data-ratio="0.6157142857142858" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/7_ctLwe81zPLhr4xYXMdvZs6XKBJTvkA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6c5ziacFjhrNxJLL2xZK1K5VHRBictLwe81zPLhr4xYXMdvZs6XKBJTvkA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">执行sql-shell也没法执行交互式的sql语句，接下来就通过burp去手工调用了一下sqlmap传上去的dll文件中的“sys_eval”函数。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">Request：</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="384" data-backw="578" data-ratio="0.6642857142857143" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/8_otLr6YBlpuPwgHpK0yWTqUJyomRnqQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6ciaHalX4DxlBTo4XlkvXIO5DlRotLr6YBlpuPwgHpK0yWTqUJyomRnqQ/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">Response：</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="324" data-backw="578" data-ratio="0.56" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/9_LmY5QZdqg3teSicDLL8RDd9XrchZIA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6c1ib6mqWKzhZffwib37bWBgROic49LmY5QZdqg3teSicDLL8RDd9XrchZIA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">也是存在同样的问题只能执行whoami的命令，其它命令都是返回有问题的。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="328" data-backw="578" data-ratio="0.5671428571428572" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/10_0GySq1fHn8ALqCvy5o54E9nZ2B1ttQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cNLLT0mr1xiaVV985MDIQRG1ru0GySq1fHn8ALqCvy5o54E9nZ2B1ttQ/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">到这里，起码说明了我们的权限还是比较高的，“nt system”权限，之前尝试过通过empire生成一个powershell直接反弹shell回来，这里也是不行的，而且“sys_eval”函数内存在一些特殊字符也是不行的。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">从现在我们了解到的讯息来看无法确定是什么原因造成的，于是产生了两个假设：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">1、 命令没有传递过去也就没有执行。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">2、 该服务器所在环境不通外网。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">我们先去测试第二种假设，如果是第二种假设的话服务器去ping外网是不通的，我们尝试去ping一下dnslog，看是否有接收。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="138" data-backw="578" data-ratio="0.23857142857142857" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/11_rJvpSLeAjNfyryFOTVFgWiasYWV7DQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cPGoib9b3JnEtc3ic9LZxtc0FVDlrJvpSLeAjNfyryFOTVFgWiasYWV7DQ/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">执行之后一直没有接收到数据，于是我们一切的推断回归到了第一种假设上面去。第一种假设命令没有传递过去，当然了还有一种情况是数据执行成功了数据没有返回回来，当尝试了dnslog没有回显之后还不能完全判断该服务器不能通公网，因为还存在第一种假设的情况。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">此时已经夜已经深了，我看着窗外点起了一根烦恼丝，脑海中回想着各种可能性，对了我还喜欢柯南，喜欢整理线索从而去突破一道道屏障，同时我也不是一个轻言放弃的人，此时我做了一个决定。。。睡觉。。。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.9356321839080459" data-s="300,640" data-type="gif" data-w="435" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/12_5VsUIalicSib5pHlrLtaHicm87gpuQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cibaZMVFNB2ic3EQOic9AsdyiajQ27icI5VsUIalicSib5pHlrLtaHicm87gpuQ/640?wx_fmt=gif'" style="width: 435px;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">醒来已是第二天中午，在梦中仿佛某个绝世高人传授了我一招心法，我迫不及待打开电脑去尝试，当burp回显出结果的时候，我脑海中闪过一句名言“多读书，多看报，少吃零食，多睡觉”，前辈的积累还是有一定道理的，这让我瞬间发觉多睡觉还是有好处的。。。</span><br  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.704312114989733" data-s="300,640" data-type="gif" data-w="487" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/13_bxCXzrazmy5bGEEDJbj9N1P2XVSp8A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cwcWHEq9k7eUWpSHSXNeHazGZibxCXzrazmy5bGEEDJbj9N1P2XVSp8A/640?wx_fmt=gif'" style=""  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">Request：</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="367" data-backw="578" data-ratio="0.6357142857142857" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/14_UV1DlHWdtLPaLakiareXZVdLreMnRA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cdDhMjPmDRjWqEnWavxOP1lsQXUV1DlHWdtLPaLakiareXZVdLreMnRA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">Response：</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="375" data-backw="578" data-ratio="0.6485714285714286" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/15_YteHXdvNSV5Jj7n55efXumBbqIskXA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cMEW06ibyFVgCf2fl9THSEHDiauYteHXdvNSV5Jj7n55efXumBbqIskXA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">通过powershell做base64加密，传递到服务器之后执行，返回的结果也是base64加密的：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"></span></p><p><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="nginx"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">Powershell</span> <span class="code-snippet__string">"string="</span>ipconfig<span class="code-snippet__string">";[convert]::ToBase64String([Text.Encoding]::UTF8.GetBytes(string))"</span></span></code></pre></section><p><br  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"></span><br  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="117" data-backw="578" data-ratio="0.20285714285714285" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/16_j6bGiaFcoUaRTI9mibHgZenRZs0KLQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6c2oonibLH51NoD9bxukQNTSJywhFj6bGiaFcoUaRTI9mibHgZenRZs0KLQ/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">接下来就是一段非常枯燥的找目录了，由于手工注入的诸多不方便，只能通过一层一层查目录获得我们想要的绝对路径（也可通过写脚本去跑，但是我在大脑中带入了手工翻目录和写脚本跑的时间参数之后，得出来的结果是还是乖乖翻目录吧）。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-ratio="0.7923809523809524" data-s="300,640" data-type="gif" data-w="525" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/17_YlpibaUWm4qpEMgia50ichSnbNyuLw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6ccMSA47heHibOZqTYwVWMyUibggGdhYlpibaUWm4qpEMgia50ichSnbNyuLw/640?wx_fmt=gif'" style=""  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">此处说明一下，这个站开放了好几个端口，而且我们现在也能够顺利地执行命令了，就可以知道这个站的大致架构了。虽然目标公网ip开放了很多端口，但是这些站都是部署在不同的内网服务器上的，通过映射去映射到公网ip的，也就是说这个内网是不通外网的，只能先传一个webshell上去看一下情况然后再做http代理。</span></p><p cid="n17" mdtype="paragraph" style="margin-top: 0.8em;margin-bottom: 0.8em;font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;line-height: inherit;orphans: 4;white-space: pre-wrap;font family: Helvetica, Arial, sans-serif;"><br  /></p><h1 cid="n18" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p><br  /></p><section data-tools="135编辑器" data-id="95387" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="margin: 10px auto;text-align: center;box-sizing: border-box;"><section style="padding-right: 20px;padding-left: 20px;display: inline-block;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;"><section data-brushtype="text" style="padding: 6px 20px 10px 30px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57qETeCiaA2QmwgWqG0EhWOmoHUXP04mk5cE2hCCQ8VDRvuGr3QGeficDIj49mEhrb8JYdgDaTfPyCw/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100% 100%;letter-spacing: 1.5px;box-sizing: border-box;"><p style="letter-spacing: 2.5px;line-height: 1.75em;margin-left: 5px;margin-right: 5px;"><strong style="font-size: 1.25em;white-space: pre-wrap;letter-spacing: 1.5px;caret-color: red;font family: &#39;Open Sans&#39;, &#39;Clear Sans&#39;, &#39;Helvetica Neue&#39;, Helvetica, Arial, sans-serif;"><strong><span style="color: rgb(0, 0, 0);font family: 宋体, SimSun;">SSRF 另辟捷径</span></strong></strong><br  /></p></section></section></section></section><p><br  /></p><h1 cid="n18" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p style="margin: 0.8em 5px;font-size:16px;line-height:36px;;box-sizing: border-box;orphans: 4;white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">此刻，我又暗暗翻了一下我那本积满灰尘的武林秘籍，它总能在我迷茫的时候给我指明方向，虽然我久经沙场，深谙这个世界的诸多烦恼和不公，但是每当我拿起我那本秘籍，它总能让我看到光明。</span><br  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">我想很多朋友可能好奇我那本武林秘籍长什么样，为了满足大家的好奇心，这里分享给大家，它长这样。。。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="363" data-backw="532" data-ratio="0.6823308270676691" data-s="300,640" data-type="gif" data-w="532" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/18_H43LY7bgcglRPtomjBKg4GlK9EslBA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cUf98DkZbu0icdX8ItJtzah0atH43LY7bgcglRPtomjBKg4GlK9EslBA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这个时候又遇到了一个坑，当我尝试写webshell的时候遇到问题了。用ps进行转义的命令写进去之后也是以base64加密的方式进行了存储，而且当前网站写webshell的时候去访问存在了问题，我猜测就算webshell正常写入我也无法正常访问这个webshell。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">我得想办法解决这个问题，思考了一下逻辑之后我想到了前期挖到的SSRF，在脑海中思索了一会我能否先通过这个SSRF去探测一下内网里面的东西。也为我去想办法传webshell留有一部分时间，同时我又能提早知道一些内网的情况，毕竟就算拿到webshell也得去尝试做http隧道，这种情况日志数据是很大的。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">SSRF挖掘利用，通常大致步骤：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">1、寻找WEB应用功能、抓包分析链接请求敏感参数</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">2、是否有过滤，是否进行绕过尝试</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">3、验证是否可回显（是否能能够探测内网）</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">4、判断支持协议，是否能获取更多信息</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">5、攻击内网应用服务</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">在请求参数去请求dnslog，成功收获一枚SSRF漏洞：</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="201" data-backw="578" data-ratio="0.3485714285714286" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/19_3ibxNcJTib3BiaLZ5icJzniaaGxDfg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6ck8FWJqic6ibUx40cg03QicLybacffJgX3ibxNcJTib3BiaLZ5icJzniaaGxDfg/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="181" data-backw="578" data-ratio="0.31285714285714283" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/20_0SBviasegOqsiavwz1VicTg8HIMCJg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cos0icpRFMPqBjnYJUafD7HTqallR0SBviasegOqsiavwz1VicTg8HIMCJg/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">同时发现一处知识库系统可泄露内网应用系统，仿佛打开了通往春天的大门：</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="127" data-backw="578" data-ratio="0.22" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/21_4EaAxUn6XbAARE4n2icCrxF4dEAtkA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cmeccNa0aNGrDibw65Fy4bcysdx4EaAxUn6XbAARE4n2icCrxF4dEAtkA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">准备中英关键字如下几类，尝试批量提取问答暴露的敏感信息：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">• 内网重要应用系统：cas、oa、mail、login等；</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">• 常见服务框架账号密码：mysql、user、system等；</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">• 开发人员一些关键字：error、waring、debug、api等。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">通过正则大法提取有效信息进行FUZZ， 成功发现一处内网系统存在目录遍历漏洞，修改url参数为收集到的内网IP访问：</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="260" data-backw="578" data-ratio="0.45" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/22_hmTTuJhcaqbe1vS6LKq3HGtbeEKa2g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cdVHFOl9RzoJniaKwNUTCS1XuChmTTuJhcaqbe1vS6LKq3HGtbeEKa2g/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">其中存在config文件，dump回来。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这个时候我又去看了一下写webshell部分的问题，其实之前是存在两个问题的：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">1、webshell写入格式有问题（这个相对好解决，我的武林秘籍里边应该有提到解决方法）。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">2、网站根目录写入猜测可能是传shell有问题的。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">有了这两点猜测，我们去一一解决这两个问题，第一个问题通过变换ps语句内容将输出文件中的内容转义成正常格式就可以了。</span></p><p><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="nginx"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">powershell</span> <span class="code-snippet__string">"write-output ([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String(\"d2Vic2hlbGw=\"))) | out-file -filepath D:\xxxxx\xxxxxxx\aspnet_client\system_web\4_0_30319\last3time.aspx;"</span></span></code></pre></section><p><br  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"></span><br  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这时webshell已经正常写进去了，通过type去读也发现内容没什么问题，当去访问webshell的时候发现果然出问题了，连接不上（图未截取）。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这印证了我之前的第二点猜测-服务器所在环境不通外网</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这个服务器上有两个站，只能再翻目录去找第二个站的绝对路径，但愿不会再出问题了，我早已遍体鳞伤。尝试第二个站去写shell访问的时候发现可以连接了。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="318" data-backw="578" data-ratio="0.55" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/23_rRBdCDCAoib9gftyHzeLsiayicG5TA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cfgdgEia0n6GyRicEaqggtdz4TROh1rRBdCDCAoib9gftyHzeLsiayicG5TA/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">而且我们的注入点权限是“nt system”，执行高权限的操作直接通过注入点就可以了。读一下密码，由于注入点执行命令不能有特殊符号，特殊符号会导致命令执行失败，此处读密码我们通过上传一个powershell版的mimikatz加上一个执行命令的bat脚本就可以了。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="90" data-backw="578" data-ratio="0.15571428571428572" data-s="300,640" data-type="gif" data-w="700" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/24_D0vUKaqxjQIgiaJRX04UABmel8De9Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6c6H9Xx2ibulPlQibFut4mEN0bG1yD0vUKaqxjQIgiaJRX04UABmel8De9Q/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">成功读取到密码！</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="87" data-backw="425" data-ratio="0.20470588235294118" data-s="300,640" data-type="gif" data-w="425" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/25_bFAao4Vlk6cKaKGEZtV7M9k8XicC0w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cYs67Jdl9B2DkRCW4tn9LwhkcvibFAao4Vlk6cKaKGEZtV7M9k8XicC0w/640?wx_fmt=gif'" style="width: 100%;height: auto;"  /></p><p style="margin: 0.8em 5px;font-size:16px;line-height:36px;;box-sizing: border-box;orphans: 4;white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><br  /></p><h1 cid="n33" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p><br  /></p><section data-tools="135编辑器" data-id="95387" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="margin: 10px auto;text-align: center;box-sizing: border-box;"><section style="padding-right: 20px;padding-left: 20px;display: inline-block;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;"><section data-brushtype="text" style="padding: 6px 20px 10px 30px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57qETeCiaA2QmwgWqG0EhWOmoHUXP04mk5cE2hCCQ8VDRvuGr3QGeficDIj49mEhrb8JYdgDaTfPyCw/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100% 100%;letter-spacing: 1.5px;box-sizing: border-box;"><p style="letter-spacing: 2.5px;line-height: 1.75em;margin-left: 5px;margin-right: 5px;"><strong><span style="font-size:20px;line-height:40px;;color: rgb(0, 0, 0);font family: 宋体, SimSun;">内网漫游</span></strong></p></section></section></section></section><p><br  /></p><h1 cid="n33" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p style="margin: 0.8em 5px;font-size:16px;line-height:36px;;box-sizing: border-box;orphans: 4;white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">此刻，我回顾了一下之前的渗透过程，可以开始搞内网了，此刻距项目结束时间还有17个小时（加上睡觉的时间），此刻已然午夜12点，第二天17：</span><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">00项目就要结束了。</span><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">我决定还是先休息一下，等第二天再搞，内网一般没什么太大难度。</span><br  /></p><p style="white-space: normal;text-align: center;"><img data-ratio="1" data-type="jpeg" data-w="440" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/26_qLfWCmcRsxYBXYKNQnb2OekhTxiaaA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cJTcWey4HYVictibImvNbzicKb7GoqLfWCmcRsxYBXYKNQnb2OekhTxiaaA/640?wx_fmt=jpeg'"  />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">第二天9点起床继续看这个目标，今天的我信心满满，想到就要完美完成这个项目心中还是有一丝的欢愉。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">我首先想到的是之前dump下来的那个config文件，因为里边应该写了数据库的用户、密码等信息，我只需要去连接提权就可以了。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">我们的目标是敏感数据，而这个配置文件中数据库所在的网段我看了一下应该是在核心内网的，因为根据线报核心内网是一个A类的网段。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">当我打开那个config文件的时候发现密码是加密的，一段密码的加密字段还有一个公钥，这样如果拿不到私钥的话是无法解除数据库的密码明文的，于是我又返回去看了一下当时通过ssrf拖配置文件的网站，发现有一个网站源码的备份文件，于是下了下来。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">开始想去找私钥解密数据库中的密码，因为从配置文件中可以看到这个站是站库分离的，想搞定那个数据库的服务器需要将密码解出来看一下。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">一开始去翻源码中的文件时，着重去翻关于<span style="caret-color: rgb(255, 0, 0);">“privateKey”</span>相关的字段内容，找到了源码中私钥的值。但是拿去解密的时候发现不对，这个时候猜测可能是思路偏了，又去看源码发现在加解密处引用了一个包，这个包看了一下是提供数据库密码加解密的。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="125" data-backw="578" data-ratio="0.21640625" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/27_b4iahia29jyQ5ORnuNsGiayHeuTqlA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cSEKebIK8ntVo0VNCicM2YOgmPQEvb4iahia29jyQ5ORnuNsGiayHeuTqlA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">猜测应该是对加解密算法进行了重新定义或者修改所以正常的RSA解密是不行的，于是写一段通过这个库去解密密码的代码，成功对密码进行解密。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="138" data-backw="578" data-ratio="0.23828125" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/28_qbibB2UM04j3DbUueMjhcNyGjyMiaQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cdzjwz96GibjZdxytHpzb0vujhzAqbibB2UM04j3DbUueMjhcNyGjyMiaQ/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">获得了密码之后成功对目标服务器进行了提权，这里就不详细说明提权流程了，因为很顺利。。。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">提权之后看了一下这个数据库服务器是在域内的，想了一下，其实我们今天的主要目的不是域控，而是想获得一些有价值的数据（例如：工资数据）作为证明。但是我看了一下他们内网的工资系统之后没发现什么好的头绪，同口令、服务器的端口漏洞这些都试过了暂时没什么思路。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这时冒出来一个想法，直接去搞域控，拿到域控大几率就可拿下工资系统了。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这里我用到了CVE-2019-1040这个漏洞，此乃内网渗透大杀器。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">NTLM中继</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="252" data-backw="578" data-ratio="0.43671875" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/29_OIhKGic4Vd86KEoCRT6XLZpuK88wmQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cCgxukaaVNzhkniaVXpQw15Tr53OIhKGic4Vd86KEoCRT6XLZpuK88wmQ/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">触发print spooler服务漏洞</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><img class="rich_pages js_insertlocalimg" data-ratio="0.15546875" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/30_iaPz3ocib4ypYUSKFZ5sNnt8B4VtCQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cE9ACSkIkXUHQhEdfVibm6M9AfGOiaPz3ocib4ypYUSKFZ5sNnt8B4VtCQ/640?wx_fmt=png'" style="text-align: center;font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &#39;Helvetica Neue&#39;, &#39;PingFang SC&#39;, &#39;Hiragino Sans GB&#39;, &#39;Microsoft YaHei UI&#39;, &#39;Microsoft YaHei&#39;, Arial, sans-serif;font-size:17px;line-height:37px;;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">模拟administrator用户请求票据</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="79" data-backw="578" data-ratio="0.1375" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/31_92U2EiccdG2UxJbRmsE8xzlXnZIHQA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6chjJeEYYicibjAR4QXT0sicPRKxex92U2EiccdG2UxJbRmsE8xzlXnZIHQA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这里我只dump出了管理员的hash想先去域控看一下，拿去解密解出来了，这里dump其它用户的时候失败了，只能先去域控看看。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="264" data-backw="578" data-ratio="0.45703125" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/32_HuDwxDib9ADJLiaIXJjks3CluZQ4Sg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cYnUtbKVCicaWRhuyKzaHToU0CShHuDwxDib9ADJLiaIXJjks3CluZQ4Sg/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="180" data-backw="578" data-ratio="0.3109375" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/33_ZfTupnY7nI78zcFbjqiaoHSZiaYKOw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cVicztf6X4FCl2g983Xuibbrjq3EfZfTupnY7nI78zcFbjqiaoHSZiaYKOw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">进域控在域管机上建立快照，复制ntds.dit与system文件。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">首先需要建立快照，这里需要ntdsutil命令，然后以下列方式执行。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="195" data-backw="578" data-ratio="0.33671875" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/34_WfuC4oMmpe9ErVC6bywHE51GzBsAkA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cfZ53jsL1TN4Q0iaUw0QVREGAicWfuC4oMmpe9ErVC6bywHE51GzBsAkA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这里需要特别注意：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">1、在生成快照成功后，mount装载成功以后，我们就得到了文件位置需要另开一个cmd，对快照中的ntds.dit与system进行copy。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"></span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="266" data-backw="578" data-ratio="0.4609375" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/35_OWGTdI5nichJBKT7a1UHnwsLD98yJw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cSEmds6fzJO9y8OzaMoKpYRX1eOWGTdI5nichJBKT7a1UHnwsLD98yJw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">2、将ntds.dit与system打包复制回来就好。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">下面就是使用WPR破解hash就好了。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="329" data-backw="578" data-ratio="0.56875" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/36_4wdXrL4vdZod5ibO8dpt42TjsKibDg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cniay0QiaOReYIAt12C3C8VeqUhWT4wdXrL4vdZod5ibO8dpt42TjsKibDg/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="303" data-backw="578" data-ratio="0.52421875" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/37_0bvn45wJm9BYfQXTibKKwabu4GqAUQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cOpkKiaTzELtl6WReo707iaRXj0j0bvn45wJm9BYfQXTibKKwabu4GqAUQ/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="margin: 0.8em 5px;font-size:16px;line-height:36px;;box-sizing: border-box;orphans: 4;white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><br  /></p><h1 cid="n69" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p><br  /></p><section data-tools="135编辑器" data-id="95387" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="margin: 10px auto;text-align: center;box-sizing: border-box;"><section style="padding-right: 20px;padding-left: 20px;display: inline-block;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;"><section data-brushtype="text" style="padding: 6px 20px 10px 30px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57qETeCiaA2QmwgWqG0EhWOmoHUXP04mk5cE2hCCQ8VDRvuGr3QGeficDIj49mEhrb8JYdgDaTfPyCw/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100% 100%;letter-spacing: 1.5px;box-sizing: border-box;"><p style="letter-spacing: 2.5px;line-height: 1.75em;margin-left: 5px;margin-right: 5px;"><strong><span style="font-size:20px;line-height:40px;;color: rgb(0, 0, 0);font family: 宋体, SimSun;">迂回夺旗</span></strong></p></section></section></section></section><p><br  /></p><h1 cid="n69" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p style="margin: 0.8em 5px;font-size:16px;line-height:36px;;box-sizing: border-box;orphans: 4;white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">到这里我们拿到了域内主机的部分密码，我看了一下工资系统的系统账号密码也在内，于是登进去看了一下。</span><br  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="304" data-backw="578" data-ratio="0.5261904761904762" data-s="300,640" data-type="png" data-w="840" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/38_Yn4D1wDO0WElBcNTqibS2moAKbDa6Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6ctfTOHYQbmZOC0UaySIUAvLJ3KYn4D1wDO0WElBcNTqibS2moAKbDa6Q/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">找了一下工资系统管理员的密码，发现加密存储而且解不出来，我暂时把管理员的加密密码复制下来，暂时覆盖了一个加密密码登录系统查看了一下，截了几张图。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="189" data-backw="578" data-ratio="0.3261904761904762" data-s="300,640" data-type="png" data-w="840" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/39_7Ug95oLPBuuRuKYLfXuCDY9e8t9alw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6cC5cibY0COX3ic69axmbrIbcT4T7Ug95oLPBuuRuKYLfXuCDY9e8t9alw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">至此，这次渗透的目的达到了，此时已经下午3点半，距离结束时间还有一个半小时。。。</span></p><p style="margin: 0.8em 5px;font-size:16px;line-height:36px;;box-sizing: border-box;orphans: 4;white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><br  /></p><h1 cid="n110" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p><br  /></p><section data-tools="135编辑器" data-id="95387" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><section style="margin: 10px auto;text-align: center;box-sizing: border-box;"><section style="padding-right: 20px;padding-left: 20px;display: inline-block;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;"><section data-brushtype="text" style="padding: 6px 20px 10px 30px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57qETeCiaA2QmwgWqG0EhWOmoHUXP04mk5cE2hCCQ8VDRvuGr3QGeficDIj49mEhrb8JYdgDaTfPyCw/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100% 100%;letter-spacing: 1.5px;box-sizing: border-box;"><p style="letter-spacing: 2.5px;line-height: 1.75em;margin-left: 5px;margin-right: 5px;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><strong>结尾总结</strong></span></p></section></section></section></section><p><br  /></p><h1 cid="n110" mdtype="heading" style="margin: 1rem 5px;padding-bottom: 0.3em;font-weight: bold;font-size: 2.25em;background-color: rgb(255, 255, 255);box-sizing: border-box;break-after: avoid-page;break-inside: avoid;cursor: text;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"></h1><p style="margin: 0.8em 5px;font-size:16px;line-height:36px;;box-sizing: border-box;orphans: 4;white-space: pre-wrap;letter-spacing: 2.5px;line-height: 1.75em;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;">关于本次渗透的攻击利用链的思路图：</span><br  /></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="338" data-backw="578" data-ratio="0.58515625" data-s="300,640" data-type="png" data-w="1280" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/40_Etgk3DZoR8hXXicc5xyiaElm88d0FA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57o3PJw4dSXckpqeDBW9G6c5tstBoZicleWDvkVEjXCyT6B6PbEtgk3DZoR8hXXicc5xyiaElm88d0FA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">这个案例对我来说是一次比较有意思的经历，起码让我浪费了很多走弯路的时间。以后我会总结一下关于编码绕过的场景和常见的一些利用方式，关于SSRF的利用上，它确实在我攻击链暂时中断的情况下有了初步搜集内网信息的时间，在思路中断的情况下如何去缩小时间成本也是我们需要去考虑的问题。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;letter-spacing: 2.5px;line-height: 1.75em;font family: &quot;Open Sans&quot;, &quot;Clear Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">我依然是一名正义的使者，依然会在黑夜前行。最近我上网看了很多原创文章，发现大家的攻击过程太过顺利了，作为一名正义的使者我还是遇到过很多“坑”，渗透的过程绝不仅仅是技术的堆叠，思路永远是渗透的根本，接下来再跟大家分享我的故事的时候，我会跟大家逐步分享我的思路我的故事，毕竟我还是一个充满故事的正义使者。</span></p><p style="text-align: center;"><strong><span style="font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">抽奖结果</span></strong></p><p style="text-align: center;"><img class="rich_pages" data-ratio="1.4981481481481482" data-s="300,640" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/41_fs0NT5CH3ySVribv5vvAWicx8Las0Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibLkLg9rwlMqxMtO6IaSjoWgovABpM0YXIdkMRrzvmKic7YvBVfs0NT5CH3ySVribv5vvAWicx8Las0Q/640?wx_fmt=png'" data-type="png" data-w="1080" style=""  /></p><p style="text-align: center;"><span style="font-size:15px;line-height:35px;;">以上小伙伴可以联系微信：X175144341，领取JD卡以及SecIN激活码</span><br  /></p><p style="text-align: center;"><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p style="text-align: center;"><span style="font-size:15px;line-height:35px;;">感兴趣的可以点个关注！<br  /></span></p><p style="text-align: center;"><span style="font-size:15px;line-height:35px;;"><br  /></span></p><section data-role="paragraph" style="font-size:16px;line-height:36px;;background-color: rgb(255, 255, 255);box-sizing: border-box;"><p style="text-align: center;margin-right: 5px;margin-left: 5px;letter-spacing: 2.5px;line-height: 1.75em;"><img class="rich_pages js_insertlocalimg" data-backh="379" data-backw="578" data-croporisrc="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/42_SPpJ6gFFicHmG2CT5tM0RULyMpUJlg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s57qETeCiaA2QmwgWqG0EhWOmPps0TnE06RurgTWxqhFssqHHuSPpJ6gFFicHmG2CT5tM0RULyMpUJlg/640?wx_fmt=png'" data-cropx1="307.3943661971831" data-cropx2="595.774647887324" data-cropy1="266.19718309859155" data-cropy2="548.2394366197184" data-ratio="0.9791666666666666" data-s="300,640" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/43_4y1ohoGB1reUezl4uOfKwsftjBlgNw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibLkLg9rwlMqxMtO6IaSjoWnCFQz2EiaH7zgQwxM6wro427s4y1ohoGB1reUezl4uOfKwsftjBlgNw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="288" style="width: 182px;height: 178px;"  /></p><p style="text-align: center;margin-right: 5px;margin-left: 5px;letter-spacing: 2.5px;line-height: 1.75em;"><br  /></p></section><p style="text-align: center;"><img class="rich_pages" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2020-05-11_细说渗透江湖之出荆棘入深林/44_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style=""  /></p>
                </div>
</div>
</body>
</html>