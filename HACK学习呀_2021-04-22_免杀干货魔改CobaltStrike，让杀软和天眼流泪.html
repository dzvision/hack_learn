<html>
<head>
<title>免杀干货魔改CobaltStrike，让杀软和天眼流泪</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
免杀干货 | 魔改CobaltStrike，让杀软和天眼流泪
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                            
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-04-22</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div>

                
                                
                
                

                
                                                                

                
                                    
                    <div class="original_area_primary" style="margin-bottom: 0;">
                                                                                                </div>

                    
                                            <div class="original_area_primary">
                            <p role="option" class="original_primary_card_tips">
                                                                    <span>以下文章来源于moonsec</span>
                                                                                                    <span>，作者快乐鸡哥</span>
                                                            </p>
                            <a class="weui-flex original_primary_card appmsg_card_context appmsg_card_active" href="#" id="copyright_info">
                                <div class="weui-flex__hd">
                                    <span class="radius_avatar"> </span>
                                </div>
                                <div class="weui-flex__item" role="option">
                                    <strong class="original_primary_nickname">moonsec</strong>
                                                                            <span class="weui-hidden_abs">.</span>
                                        <p class="original_primary_desc">暗月博客</p>
                                                                    </div>
                                <div class="weui-flex__ft"></div>
                            </a>
                        </div><div id="weixin_content"><p data-mpa-powered-by="yiban.io"><br  /></p><section data-role="outer" label="Powered by 135editor.com"><section data-role="paragraph"><p><br  /></p></section><section data-role="paragraph"><section data-role="outer" label="Powered by 365editor" style=""><section data-tools-id="56269" style=""><section style="font family: 微软雅黑;font-size:16px;line-height:36px;;"><section style="margin:0;"><section style="display: flex;justify-content: center;align-items: center;"><section style="display: flex;justify-content: center;align-items: center;padding: 4px;border-top: 1px solid #f1322f;border-bottom: 1px solid #f1322f;box-sizing: border-box;"><section><img data-ratio="0.8260869565217391" data-type="gif" data-w="23" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/1_9acTIKgU65qUIm3iaCuaticGWvLg5w.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawicF2cr8LRBiaia2ibQJ3LFpMGBQl6l9acTIKgU65qUIm3iaCuaticGWvLg5w/640?wx_fmt=gif'" style="box-sizing:border-box;width:&#39;auto&#39;;display: block;height: auto;"  /></section><section style="padding: 0px 12px 0px 14px;box-sizing: border-box;"><p style="font-size:15px;line-height:35px;;margin:0;letter-spacing: 2.5px;color: #f43735;"><strong>如何魔改CobaltStrike</strong></p></section><section><img data-ratio="0.8636363636363636" data-type="gif" data-w="22" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/2_TuxSbLWlRia7KtcOjrz8Lqt6ZvXYTg.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawL3vTPm2NWFdWwLhCoehBzQZicETuxSbLWlRia7KtcOjrz8Lqt6ZvXYTg/640?wx_fmt=gif'" style="box-sizing:border-box;width:&#39;auto&#39;;display: block;height: auto;"  /></section></section></section></section></section><h2 style="font family: 微软雅黑;font-size:16px;line-height:36px;;line-height: 1.6em;font-weight: bold;"><span style="font family: 等线 Light;"></span><br  /></a></h2><section data-tools="135编辑器" data-id="88503" style="font family: 微软雅黑;font-size:16px;line-height:36px;;"><section style="margin: 10px auto;padding: 2px;box-sizing: border-box;"><section style="box-sizing: border-box;width: 56px;height: 40px;text-align: center;font-size: 2em;color: rgb(254, 254, 254);float: left;line-height: 40px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkRibiawOia1oleaXibzOjw4RmJfo7BqLQibUN0FQJcCQN2byCoGdc1CiarHk187AXDCRjQwx3438AN1cjJA/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100%;background-color: rgb(139, 183, 72);"><section data-original-title="" title="">1</section></section><section style="overflow-wrap: break-word;border-bottom: 2px dashed rgb(128, 177, 53);min-height: 36px;display: inline-block;line-height: 36px;margin-top: 0px;margin-left: 10px;box-sizing: border-box;"><span data-brushtype="text" style="color: #80b135;font-size:18px;line-height:38px;;margin-top: 0px;display: inline-block;">概述</span></section></section></section><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;text-indent: 0.29in;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">这次文章将较详细介绍下</span>Cobalt
Strike
4.1<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>agressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端登录</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端的通讯和</span>beacon<span style="font-size:15px;line-height:35px;;font family: 等线;">端与</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端通讯，包括元数据、心跳包、执行任务等数据传输。帖子写到一半</span>IDEA<span style="font-size:15px;line-height:35px;;font family: 等线;">授权就掉了，所以就拖到现在才写完，</span></span><span style="text-indent: 0.29in;font-size:15px;line-height:35px;;"><span style="font family: 等线;">附项目地址：</span></span><span style="text-indent: 0.29in;font-size:15px;line-height:35px;;">https://github.com/mai1zhi2/CobaltstrikeSource/</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;text-indent: 0.29in;margin-bottom: 0in;"><br  /></p><section data-tools="135编辑器" data-id="88503" style="font family: 微软雅黑;font-size:16px;line-height:36px;;"><section style="margin: 10px auto;padding: 2px;box-sizing: border-box;"><section style="box-sizing: border-box;width: 56px;height: 40px;text-align: center;font-size: 2em;color: rgb(254, 254, 254);float: left;line-height: 40px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkRibiawOia1oleaXibzOjw4RmJfo7BqLQibUN0FQJcCQN2byCoGdc1CiarHk187AXDCRjQwx3438AN1cjJA/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100%;background-color: rgb(139, 183, 72);"><section data-original-title="" title="" data-num="2">2</section></section><section style="overflow-wrap: break-word;border-bottom: 2px dashed rgb(128, 177, 53);min-height: 36px;display: inline-block;line-height: 36px;margin-top: 0px;margin-left: 10px;box-sizing: border-box;"><span data-brushtype="text" style="color: #80b135;font-size:18px;line-height:38px;;margin-top: 0px;display: inline-block;">aggressor端登录teamserver端的通讯分析</span></section></section></section><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><strong>2.1</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>、</strong></span><strong>agressor</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>客户端发送密码登录</strong></span><strong>teamserver</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>端进行验证：</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">运行</span>Teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端，首先会创建</span>SecureServerSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">对象，然后循环调用</span>acceptAndAuthenticate()<span style="font-size:15px;line-height:35px;;font family: 等线;">接受认证信息：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2552529182879377" data-type="png" data-w="1285" height="141" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/3_W5wCKJT9tQiaTfjEzhQQh6fY9xtcBQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawIgugM2LZjViaUCibhhJuAfgNcqSW5wCKJT9tQiaTfjEzhQQh6fY9xtcBQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">点击</span>connet<span style="font-size:15px;line-height:35px;;font family: 等线;">按钮后：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端首先在</span>dialogAction()<span style="font-size:15px;line-height:35px;;font family: 等线;">方法获得相应的登录信息：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.0939929328621908" data-type="png" data-w="1415" height="52" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/4_7ld7kn4ibj24bIOic2BKibJIyRIpwg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw0gibrv3ia5vzd9rwVkFdx7rluaJYV7ld7kn4ibj24bIOic2BKibJIyRIpwg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后传入</span>host<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>port<span style="font-size:15px;line-height:35px;;font family: 等线;">创建安全套接字：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.019536903039073805" data-type="png" data-w="1382" height="11" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/5_fhvgjLXItRXQoKiaYxlxs127fxkdqg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaws9C6UEbTXzyBh6ibYrK5613VhEfhvgjLXItRXQoKiaYxlxs127fxkdqg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">SecureSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">的构造方法中设置了相关的</span>socket<span style="font-size:15px;line-height:35px;;font family: 等线;">属性</span>,<span style="font-size:15px;line-height:35px;;font family: 等线;">调用</span>createSocket()<span style="font-size:15px;line-height:35px;;font family: 等线;">传入要连接的</span>ip<span style="font-size:15px;line-height:35px;;font family: 等线;">地址和</span>port:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.07" data-type="png" data-w="1600" height="39" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/6_Et4nhlG2R50EZBQQxlicfunUkhblRg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw4hEUEnYoiaknE89ANextyp5U1REt4nhlG2R50EZBQQxlicfunUkhblRg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">agressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端调用完</span>createSocket()<span style="font-size:15px;line-height:35px;;font family: 等线;">后，</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端</span>acceptAndAuthenticate()<span style="font-size:15px;line-height:35px;;font family: 等线;">会接受到信息，其中跟入</span>authenticate(Socket
var1, String var2, String var3)<span style="font-size:15px;line-height:35px;;font family: 等线;">方法负责处理接受到的信息：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.21026282853566958" data-type="png" data-w="1598" height="116" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/7_RPYx6KNbuZNvias9xPdZ9s9d5pxNUQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawPRtyntfhHl73GjJ2hdhxU1mjYRPYx6KNbuZNvias9xPdZ9s9d5pxNUQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">跟入该方法，当</span>var4<span style="font-size:15px;line-height:35px;;font family: 等线;">没读取到足够的字符就一直阻塞：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.23534201954397393" data-type="png" data-w="1228" height="130" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/8_lfbLo2icUsFsofu4ttf5nsBpDyFdbA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawrAAicH2wCccib1VKVjAPtMXaxLllfbLo2icUsFsofu4ttf5nsBpDyFdbA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端构建完</span>SecureSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">对象后，调用其</span>authenticate(string
var1)<span style="font-size:15px;line-height:35px;;font family: 等线;">方法，并传入登录的密码，该方法主要通过密码构造相应的数据包，其数据包先传入</span>48879<span style="font-size:15px;line-height:35px;;font family: 等线;">这个数值（标志），然后再传密码的长度，接着传入密码的内容，最后以</span>0x41<span style="font-size:15px;line-height:35px;;font family: 等线;">进行填充：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2768361581920904" data-type="png" data-w="1416" height="153" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/9_YkO6pFvPTlbrA8CA9yMXb0hhl2h2DQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawiawvzhkyGTymWqnTRFSK4ic5MBYkO6pFvPTlbrA8CA9yMXb0hhl2h2DQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">数据包</span>var3<span style="font-size:15px;line-height:35px;;font family: 等线;">内容：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.8160919540229885" data-type="png" data-w="435" height="284" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/10_b9dK2ywxo5g4J0jEiaRsqibtFibn1A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawtZMuSjNR5qr1XzzX7bhCAk2x2Xxb9dK2ywxo5g4J0jEiaRsqibtFibn1A/640?wx_fmt=png'" style="box-sizing: border-box;width: 100%;height: auto;" vspace="1" width="348" data-backw="348" data-backh="284"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">当</span>var3.flush()<span style="font-size:15px;line-height:35px;;font family: 等线;">调用向</span>server<span style="font-size:15px;line-height:35px;;font family: 等线;">端发送数据，</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>authenticate(Socket
var1, String var2, String var3)<span style="font-size:15px;line-height:35px;;font family: 等线;">方法就会停止阻塞，接受到相应的数据并对密码进行判断：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.21686746987951808" data-type="png" data-w="1577" height="120" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/11_aH5e2NdyhxfwAmpNEjtZlhyCQnvxHw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawFLdZQia4ndh80OxfH0pBkU63baH5e2NdyhxfwAmpNEjtZlhyCQnvxHw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">若<strong>密码相等</strong>则发送</span>51966<span style="font-size:15px;line-height:35px;;font family: 等线;">标志数给</span>aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.06159110350727117" data-type="png" data-w="1169" height="34" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/12_YV2Tm4FeJtpxqYwjFWJWoklG2LntfQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawZ13Y1ODia23ib77tIdS624gCPFYV2Tm4FeJtpxqYwjFWJWoklG2LntfQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后返回执行</span>PostAuthentication<span style="font-size:15px;line-height:35px;;font family: 等线;">对象实现的</span>clientAuthenticated():</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.03100263852242744" data-type="png" data-w="1516" height="17" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/13_bpIhwXSrCVQszFEibU7mnqHEDx6JSQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawuFpHuxlMxicJV0npng1BNwWl1iaibpIhwXSrCVQszFEibU7mnqHEDx6JSQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.12109375" data-type="png" data-w="1536" height="67" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/14_HPpGvYBGicAmYxWicpognH9ZoUPKBg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawG0FCZLiayLQjMIfmKD6Z4VPgolqHPpGvYBGicAmYxWicpognH9ZoUPKBg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">新建线程，等待后续接受</span>aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端所发送的信息：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.4774566473988439" data-type="png" data-w="865" height="264" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/15_jRBtYicJow0BUaR7Rzia0Fpia0ibjA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw6OEsQXcXkZAXMlmvHjynWia20CuxnjRBtYicJow0BUaR7Rzia0Fpia0ibjA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端接受到后进行判断：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.10433763188745604" data-type="png" data-w="853" height="58" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/16_ZfqnY4poYxxV2J0e2LmMHbkM7LD2kA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawgiaNI4CAiadlHBcBb90AY8XMgibZfqnY4poYxxV2J0e2LmMHbkM7LD2kA/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">至此</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端校验</span>aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端密码完毕。</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><strong>2.2</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>、</strong></span><strong>aggressor.authenticate</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>消息类型传输：</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">接着</span>Aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端再通过</span>SecureSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">对象构造出</span>TeamSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">对象：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.04691689008042895" data-type="png" data-w="746" height="26" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/17_LNIaPjYLjw7nMgI94icOwz0NfMgQtA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawOxVsCIjFtCxpq0p323iaibRic22PLNIaPjYLjw7nMgI94icOwz0NfMgQtA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09623430962343096" data-type="png" data-w="1195" height="53" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/18_7GkQeyYtp1J0xwYbrvA9lhHLWic1Vg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawB0CgE2MomuESm8r270ngq1dUC7GkQeyYtp1J0xwYbrvA9lhHLWic1Vg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">传入</span>TeamSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">对象来创建</span>TeamQueue<span style="font-size:15px;line-height:35px;;font family: 等线;">对象，其中</span>TeamReader<span style="font-size:15px;line-height:35px;;font family: 等线;">与</span>TeamWriter<span style="font-size:15px;line-height:35px;;font family: 等线;">均为</span>TeamQueue<span style="font-size:15px;line-height:35px;;font family: 等线;">的内部类，均实现</span>Runnable<span style="font-size:15px;line-height:35px;;font family: 等线;">接口负责与</span>TeamServer<span style="font-size:15px;line-height:35px;;font family: 等线;">通信：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.03532008830022075" data-type="png" data-w="453" height="20" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/19_l7hW66f9xXm5XraUwOsAN5kfE1EGrg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawUfh5C3GiantRTh0ic1rDicBfkwhl7hW66f9xXm5XraUwOsAN5kfE1EGrg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09713024282560706" data-type="png" data-w="453" height="54" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/20_YK3NJaqWof3Zz6mAJqwp9Tob6f08xA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaww8ic0GuK4mo4LgCQ8cucZSiaFwYK3NJaqWof3Zz6mAJqwp9Tob6f08xA/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后调用</span>TeamQueue<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>call()<span style="font-size:15px;line-height:35px;;font family: 等线;">方法，把消息类型</span>aggressor.authenticate<span style="font-size:15px;line-height:35px;;font family: 等线;">、用户名、密码、版本信息均传入，再把请求通过</span>TeamWriter<span style="font-size:15px;line-height:35px;;font family: 等线;">属性发送给</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.02207505518763797" data-type="png" data-w="453" height="12" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/21_XbeIjwfpt6oHL5AsWRshqoWHapxXSw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawPJbJ1wyHHLDichbiaGNgcHQZ6cXbeIjwfpt6oHL5AsWRshqoWHapxXSw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.19426048565121412" data-type="png" data-w="453" height="107" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/22_xGkibUXsy1kaYmd9yI3kuyr1hJe3XQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawmqDEmysRAJo8gescrT5Uop1BmxGkibUXsy1kaYmd9yI3kuyr1hJe3XQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.11258278145695365" data-type="png" data-w="453" height="62" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/23_Au66eUDPkT204AfxOdlFe1m8fGdIUA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaweSukRKSjpWzuug6iaeib9yKKgCAu66eUDPkT204AfxOdlFe1m8fGdIUA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.18101545253863136" data-type="png" data-w="453" height="100" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/24_2PLNCT2GibrsvWQibJfvDsjn146kNg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw93G3RVGgSnYtadBPykAhDeXfiaw2PLNCT2GibrsvWQibJfvDsjn146kNg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.34216335540838855" data-type="png" data-w="453" height="174" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/25_ReVRcq2Wt5ceNY6DNWkEKXobNAAVKw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawlFTGZtXwLrwZcJBn3k9CkPe0ReVRcq2Wt5ceNY6DNWkEKXobNAAVKw/640?wx_fmt=png'" style="box-sizing: border-box;width: 100%;height: auto;" vspace="1" width="510" data-backw="510" data-backh="174"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">TeamServer<span style="font-size:15px;line-height:35px;;font family: 等线;">端收到</span>aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>aggressor.authenticate<span style="font-size:15px;line-height:35px;;font family: 等线;">类型请求数据包：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.6247240618101545" data-type="png" data-w="453" height="346" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/26_kbLHNzMZnGEpWMF4GFTMFDQ3wCU49A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawgOyGvLUxgqfpD5zyGHKjFiaq0kbLHNzMZnGEpWMF4GFTMFDQ3wCU49A/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">跟入</span>process()<span style="font-size:15px;line-height:35px;;font family: 等线;">，先比较数据包的类型，再判断版本号，接着校验密码和是否重复登录，最后向</span>aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">回复</span>success:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.26269315673289184" data-type="png" data-w="453" height="145" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/27_0rKnkO4ustibnz3M6v5h7ghcmrBCdQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw4aYVWVCQ95Y82aeq1zctsicnpR0rKnkO4ustibnz3M6v5h7ghcmrBCdQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">最后新建名为</span>write
for nickname<span style="font-size:15px;line-height:35px;;font family: 等线;">的线程向各个客户端回复消息：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.33995584988962474" data-type="png" data-w="453" height="188" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/28_JAWdhc1OwcRuHRnibnxUwFvrdB7NvA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawN6tfFLvrvVyLysj2y0coaPBq7JAWdhc1OwcRuHRnibnxUwFvrdB7NvA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端收到</span>Success<span style="font-size:15px;line-height:35px;;font family: 等线;">回复：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.3841059602649007" data-type="png" data-w="453" height="213" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/29_xqib5fyTUMZtFN9DVXaXH3foctA0LQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawj8tgpPShHePiaU4fhV0IgZLlbSxqib5fyTUMZtFN9DVXaXH3foctA0LQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><strong>2.3</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>、</strong></span><strong>aggressor.
metadata</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>消息类型传输：</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端继续向</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端发送：</span>aggressor.metadata<span style="font-size:15px;line-height:35px;;font family: 等线;">类型请求</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.5055187637969095" data-type="png" data-w="453" height="280" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/30_ZVJnGgXq3SKBeZ5dTYYXQcxktUzQ7A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawvRcnXDzf9cL7TiafyFgTbd3oxZVJnGgXq3SKBeZ5dTYYXQcxktUzQ7A/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">TeamServer<span style="font-size:15px;line-height:35px;;font family: 等线;">端收到</span>aggressor.metadata<span style="font-size:15px;line-height:35px;;font family: 等线;">请求后，调用</span>process()<span style="font-size:15px;line-height:35px;;font family: 等线;">方法</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.152317880794702" data-type="png" data-w="453" height="84" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/31_B2ricIcyEuazsC1JqibjicRjG684eg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw1GdxlLZJhFwd1v8YuibYk7ic7FET6B2ricIcyEuazsC1JqibjicRjG684eg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">继续跟入</span>process()<span style="font-size:15px;line-height:35px;;font family: 等线;">，该函数主要用</span>hashmap<span style="font-size:15px;line-height:35px;;font family: 等线;">存放相关的数据，最后向</span>aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端返回了</span>aggressor.matedata<span style="font-size:15px;line-height:35px;;font family: 等线;">类型和</span>hashmap<span style="font-size:15px;line-height:35px;;font family: 等线;">数据</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.20088300220750552" data-type="png" data-w="453" height="111" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/32_pmic0cmoQR9Km2fuktSIvIQOham5gg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawTUEjkFNpwP0HSM9T903mLSOLfpmic0cmoQR9Km2fuktSIvIQOham5gg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.22958057395143489" data-type="png" data-w="453" height="127" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/33_4FVAJY4NCpLDSnFF7Y1kEEK1L654qQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawrhttddiahda5btPWed6wwGicPf4FVAJY4NCpLDSnFF7Y1kEEK1L654qQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">客户端接收</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端返回的</span>aggressor.matedata<span style="font-size:15px;line-height:35px;;font family: 等线;">类型和</span>hashmap<span style="font-size:15px;line-height:35px;;font family: 等线;">数据</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.18543046357615894" data-type="png" data-w="453" height="103" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/34_kaicC38icIKicrvibKp09fWn2iafCQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw9jLRuWAXzoCfL4Yd5eFL6MHIGAS1IkaicC38icIKicrvibKp09fWn2iafCQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">跟入</span>processread()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数，函数主要获取消息包中数据类型和数据</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.25386313465783666" data-type="png" data-w="453" height="140" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/35_RDUe4FtrtOia7Ul7Rt3rRFaSX82zUg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawwlUROqt8jauujByiczKKCe9BWJRDUe4FtrtOia7Ul7Rt3rRFaSX82zUg/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">再跟入</span>result()<span style="font-size:15px;line-height:35px;;font family: 等线;">，可见该函数负责处理从</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端返回的</span>aggressor.authenticate<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>aggressor.metadata<span style="font-size:15px;line-height:35px;;font family: 等线;">类型的信息</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.26269315673289184" data-type="png" data-w="453" height="145" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/36_SDpTPTXxwia5Abib7NtQlWzZwaicKw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawMHGxN5uWbAbpMuHsW6icUqDEqHwOSDpTPTXxwia5Abib7NtQlWzZwaicKw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">传入</span>metadata<span style="font-size:15px;line-height:35px;;font family: 等线;">数据</span>hashmap
var2<span style="font-size:15px;line-height:35px;;font family: 等线;">来构造</span>AggressorClient<span style="font-size:15px;line-height:35px;;font family: 等线;">对象，跟入该对象的构造方法：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09713024282560706" data-type="png" data-w="453" height="54" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/37_T0rLp4ZYQ7h8L2jTlRibVzsg9Zct1Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw06ibuoxEKtOFlfDPAU5OOicxVm6T0rLp4ZYQ7h8L2jTlRibVzsg9Zct1Q/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">继续跟入</span>setup()<span style="font-size:15px;line-height:35px;;font family: 等线;">方法，该方法主要是注册各类</span>Bridge<span style="font-size:15px;line-height:35px;;font family: 等线;">对象，储存</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端返回的</span>metadata<span style="font-size:15px;line-height:35px;;font family: 等线;">，加载插件框，以及发送</span>aggressor.ready<span style="font-size:15px;line-height:35px;;font family: 等线;">给</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">告知其准备完。</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.6512141280353201" data-type="png" data-w="453" height="360" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/38_c7JG7iblUKPCr9vjbJrKCe6tiaU8SQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawhPtNibc5m0dWU5FY65WrH7CDpicfc7JG7iblUKPCr9vjbJrKCe6tiaU8SQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">最后调用该对象的</span>showTime()<span style="font-size:15px;line-height:35px;;font family: 等线;">，至此显示出主界面，后续同步相关数据</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.26269315673289184" data-type="png" data-w="453" height="146" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/39_HxicWAN0U0qTX8JdNKhooSrLIicBuA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawGzFicqEPceHgJz6aqugxdGticGibhHxicWAN0U0qTX8JdNKhooSrLIicBuA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">下面图是</span>360<span style="font-size:15px;line-height:35px;;font family: 等线;">空间测绘的，顺手帮他们改了图中的小错误：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.5053191489361702" data-type="jpeg" data-w="376" height="190" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/40_ve3vICqobyr4MDRteYkGZq4AQ61KSw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawfNU1LmGNRvmw0fycCCl8pmV9ve3vICqobyr4MDRteYkGZq4AQ61KSw/640?wx_fmt=jpeg'" style="box-sizing: border-box;width: 100%;height: auto;" vspace="1" width="376" data-backw="376" data-backh="190"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">至此，我们知道了</span>cs<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>agressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端登录</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端通讯方式，所以可以进行相应简单的修改来规避</span>cs<span style="font-size:15px;line-height:35px;;font family: 等线;">登录爆破：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端避免使用默认的端口号</span>50050<span style="font-size:15px;line-height:35px;;font family: 等线;">。</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">如果修改</span>48879<span style="font-size:15px;line-height:35px;;font family: 等线;">这个标识数，需要修改的地方有三个，涉及到修改</span>aggressor<span style="font-size:15px;line-height:35px;;font family: 等线;">端：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">SecureSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>authenticate<span style="font-size:15px;line-height:35px;;font family: 等线;">方法：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.16556291390728478" data-type="png" data-w="453" height="92" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/41_UqQUfFTJgu13NqASJATLxgqSPsxUqw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawGXx8HOFLNlAadOUrL20sBiceVUqQUfFTJgu13NqASJATLxgqSPsxUqw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">	AsymmetricCrypto<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>decrypt()<span style="font-size:15px;line-height:35px;;font family: 等线;">方法：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;text-indent: 0.29in;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.30242825607064017" data-type="png" data-w="453" height="167" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/42_uYYlDOh9Wadp3GwNKe0piae4fma4dg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawRXXxUnErMxBVuNX1RMKkPaBqLuYYlDOh9Wadp3GwNKe0piae4fma4dg/640?wx_fmt=png'" style="box-sizing: border-box;width: 100%;height: auto;" vspace="1" width="554" data-backw="554" data-backh="167"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">	SecureServerSocket<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>authenticate<span style="font-size:15px;line-height:35px;;font family: 等线;">方法：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-left: 0.29in;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.1411764705882353" data-type="png" data-w="425" height="78" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/43_Ij21PtIvOsOAk46AFcUkibSibiaqGw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawY2j5JicbbtvTY7P1JttnJicqLeDNyIj21PtIvOsOAk46AFcUkibSibiaqGw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><section data-tools="135编辑器" data-id="88503" style="font family: 微软雅黑;font-size:16px;line-height:36px;;"><section style="margin: 10px auto;padding: 2px;box-sizing: border-box;"><section style="box-sizing: border-box;width: 56px;height: 40px;text-align: center;font-size: 2em;color: rgb(254, 254, 254);float: left;line-height: 40px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkRibiawOia1oleaXibzOjw4RmJfo7BqLQibUN0FQJcCQN2byCoGdc1CiarHk187AXDCRjQwx3438AN1cjJA/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100%;background-color: rgb(139, 183, 72);"><section data-original-title="" title="">3</section></section><section style="overflow-wrap: break-word;border-bottom: 2px dashed rgb(128, 177, 53);min-height: 36px;display: inline-block;line-height: 36px;margin-top: 0px;margin-left: 10px;box-sizing: border-box;"><span data-brushtype="text" style="color: #80b135;margin-top: 0px;display: inline-block;font-size:15px;line-height:35px;;">beacon端与teamserver端第一次数据包通信（元数据）</span></section></section></section><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">我们先生成不分段的后门</span>beacon.exe<span style="font-size:15px;line-height:35px;;font family: 等线;">，因为不分段的</span>beacon<span style="font-size:15px;line-height:35px;;font family: 等线;">更好调，其通信过程都一样的。</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">当启动</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">后，会把</span>cobaltstrike.beacon_keys<span style="font-size:15px;line-height:35px;;font family: 等线;">反序列化为</span>Keyparis<span style="font-size:15px;line-height:35px;;font family: 等线;">对象：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.10816777041942605" data-type="png" data-w="453" height="60" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/44_S3C0ApD1uWy0ebj4HnGU9wL7d8C0DA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw7dVibXAfgqibRbSnCJwwru6SyMS3C0ApD1uWy0ebj4HnGU9wL7d8C0DA/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后把该对象传入</span>AsymmetricCrypto<span style="font-size:15px;line-height:35px;;font family: 等线;">构造函数中，并把</span>publickey<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>privatekey<span style="font-size:15px;line-height:35px;;font family: 等线;">保存为</span>AsymmetricCrypto<span style="font-size:15px;line-height:35px;;font family: 等线;">对象中相应的属性：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.12141280353200883" data-type="png" data-w="453" height="67" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/45_iaclXz64oBdo233d1YpiatavFHxCVQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawCU3o3Ocgzib1Yb6u9P15CwcXGpWiaclXz64oBdo233d1YpiatavFHxCVQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;font family: 等线;">所反序列化出来的公私钥：</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.4326710816777042" data-type="png" data-w="453" height="239" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/46_SZB06DXLh7Aqm8EX4FJUkX06an2kAw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawN0YGBWZId2klOFRoEp9T58ClSZB06DXLh7Aqm8EX4FJUkX06an2kAw/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.20088300220750552" data-type="png" data-w="453" height="111" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/47_S7XU9UyJGnYcqF8gHsTZuRxot1UVnQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawHgHBRnicKmPyCovCYNtibrXxP7S7XU9UyJGnYcqF8gHsTZuRxot1UVnQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;font family: 等线;">公钥会在后门生成时放进去，但不是在上述的函数中，详见之前发的后门生成的帖子。而私钥则是为后续通信做加解密处理准备的。</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">下面我们继续操作：先直接上</span>x32dbg<span style="font-size:15px;line-height:35px;;font family: 等线;">，</span>createthread()<span style="font-size:15px;line-height:35px;;font family: 等线;">下断，查看线程调转的地方再相应下断，然后执行到反射</span>dll<span style="font-size:15px;line-height:35px;;font family: 等线;">，再等所导出的解析函数解析完</span>dll<span style="font-size:15px;line-height:35px;;font family: 等线;">后，再通过导入表搜相关的通信函数，因为这次文章主要是协议分析，相关中间的相关功能先省略掉，有必要再从栈回溯查看相关的函数调用，然后我们看到相关的通信函数：</span>winnet<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>HttpOpenRequestA<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>HttpSendRequestA<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>InternetCloseHandle<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>InternetopenA<span style="font-size:15px;line-height:35px;;font family: 等线;">等，还有</span>ws2_32<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>socket<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>send<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>recv<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>accept<span style="font-size:15px;line-height:35px;;font family: 等线;">等，通过观察</span>ws2_32<span style="font-size:15px;line-height:35px;;font family: 等线;">用的是</span>select<span style="font-size:15px;line-height:35px;;font family: 等线;">网络模型，则先排除掉：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.7328918322295805" data-type="png" data-w="453" height="406" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/48_UTBAo8g2BdkibDh83hyTDTucSoyWCg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawv05IottN9euM85Ik8KY2HvWlicUTBAo8g2BdkibDh83hyTDTucSoyWCg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">所以从</span>winnet<span style="font-size:15px;line-height:35px;;font family: 等线;">的相关</span>api<span style="font-size:15px;line-height:35px;;font family: 等线;">下断入手，</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.1346578366445916" data-type="png" data-w="453" height="75" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/49_74scx22AGOic8F9kqULfSzmibJjF4w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw0D4EWibXv2EZic2RUbO0c7L0YlJW74scx22AGOic8F9kqULfSzmibJjF4w/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">程序先在</span>InternetOpen()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数断下，传入相关的</span>agent<span style="font-size:15px;line-height:35px;;font family: 等线;">信息：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.18101545253863136" data-type="png" data-w="453" height="100" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/50_hre2GKoso6d4pADMCA9f3rlCbv10hw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw3iaMVfntxTv0gJMLNp0rxyxrJhre2GKoso6d4pADMCA9f3rlCbv10hw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">接着</span>InternetConnect()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数，传入相关的</span></span><span style="font-size:15px;line-height:35px;;">url:192.168.202.1<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>port:80</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.25165562913907286" data-type="png" data-w="453" height="139" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/51_NAT7EKgjt3iac7Nk5OzWXYlNkJDz0Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawUtM7zbbAibyG7aicicmfWJH5VKH0NAT7EKgjt3iac7Nk5OzWXYlNkJDz0Q/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">httpopenRequestA()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数，</span>get<span style="font-size:15px;line-height:35px;;font family: 等线;">请求，</span>uri<span style="font-size:15px;line-height:35px;;font family: 等线;">为</span>/pixel.gif</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2980132450331126" data-type="png" data-w="453" height="165" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/52_pdIB9Rz7melO9DVo4eAwBS8ib5DOGw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawtq9r5L732ZffAAtr0MZQucW04pdIB9Rz7melO9DVo4eAwBS8ib5DOGw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">httpSendRequest()<span style="font-size:15px;line-height:35px;;font family: 等线;">发送请求，注意</span>cookie<span style="font-size:15px;line-height:35px;;font family: 等线;">的值经过编码：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.27593818984547464" data-type="png" data-w="453" height="153" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/53_kPphzkjsiaKp5pghjPZVVpauiaubsg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawK6AtdBv9v1jggYYKAe6fWHtadakPphzkjsiaKp5pghjPZVVpauiaubsg/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Wireshark<span style="font-size:15px;line-height:35px;;font family: 等线;">所捕捉到的数据包：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.26269315673289184" data-type="png" data-w="453" height="146" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/54_iaNTcMbnP69fxeBiadAfkzBicDW36Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawQXBM9fRZVa1r5TI56LLr5IMSlLLiaNTcMbnP69fxeBiadAfkzBicDW36Q/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">可见</span>cookie<span style="font-size:15px;line-height:35px;;font family: 等线;">对应的数据经过编码或加密的，我们往上翻找到相应的函数</span>sub_1000783E()<span style="font-size:15px;line-height:35px;;font family: 等线;">，跟进该函数，可见函数有</span>16<span style="font-size:15px;line-height:35px;;font family: 等线;">个不同的</span>case<span style="font-size:15px;line-height:35px;;font family: 等线;">，当发送第一个数据包（元数据）时先后走</span>case7<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>case3<span style="font-size:15px;line-height:35px;;font family: 等线;">，</span>case7<span style="font-size:15px;line-height:35px;;font family: 等线;">只是复制操作：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2693156732891832" data-type="png" data-w="453" height="149" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/55_6A6MZpSTwXzicj9OvKu7VtX9aN2bJg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawc2ZydvPKdDMoLrkE7TrKwxfiaB6A6MZpSTwXzicj9OvKu7VtX9aN2bJg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Case3<span style="font-size:15px;line-height:35px;;font family: 等线;">是自实现的</span>base64<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2052980132450331" data-type="png" data-w="453" height="114" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/56_KQiafr6L1DKiadVHJ1HOsTMfA26mfQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawUXiaRc3wwjOAxHIUVs8hQlqwSosKQiafr6L1DKiadVHJ1HOsTMfA26mfQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.5231788079470199" data-type="png" data-w="453" height="290" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/57_3O34ictAou7ssGkctrRibYBbHviazg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawwPyLy7aLVQcHNm0uFYcW1VLeCnr3O34ictAou7ssGkctrRibYBbHviazg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">根据所编码的内容</span>&amp;unk_100398A8<span style="font-size:15px;line-height:35px;;font family: 等线;">继续找相应的赋值和加密操作</span>sub_1000671C()<span style="font-size:15px;line-height:35px;;font family: 等线;">，在该函数中，收集受害者主机的代码页、时间戳、程序</span>id<span style="font-size:15px;line-height:35px;;font family: 等线;">等信息并生成</span>hash<span style="font-size:15px;line-height:35px;;font family: 等线;">值：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.49448123620309054" data-type="png" data-w="453" height="274" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/58_ZX6IwrjRnzY0ucicUeyaGuljbVrNpg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw9KtLib5Chj6ewSzyicibseCNISkyZX6IwrjRnzY0ucicUeyaGuljbVrNpg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">生成</span>hash:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.16335540838852097" data-type="png" data-w="453" height="90" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/59_fE27cmtlAvoGbJiaok5Z5ib2Db8QMA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawTLmOfybUOWON7ib22oNtr9L9zaiafE27cmtlAvoGbJiaok5Z5ib2Db8QMA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">最后调用</span>sub_1000969e()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数，对收集的信息进行</span>rsa<span style="font-size:15px;line-height:35px;;font family: 等线;">加密：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2229580573951435" data-type="png" data-w="453" height="124" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/60_tSgqE2ictWicJ8CJTQZnbc7r31HMQg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawKTJkHdK2JztIibz64ukhc2u1icMetSgqE2ictWicJ8CJTQZnbc7r31HMQg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">用来加密的</span>RSA<span style="font-size:15px;line-height:35px;;font family: 等线;">公钥：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.40176600441501104" data-type="png" data-w="453" height="222" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/61_RE5hTJqjSWiarzpWibSVJILT26ibyw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawJsp1crPJaMsRAYcPpyKPUj24mh4RE5hTJqjSWiarzpWibSVJILT26ibyw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">RSA<span style="font-size:15px;line-height:35px;;font family: 等线;">加密前所收集的数据内容：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2958057395143488" data-type="png" data-w="453" height="164" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/62_RCx2bqXpEVtdWWAquaI3fkECY5Hayg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawkqjGEf3oKBNWBOmEjq0Ulb6IRCx2bqXpEVtdWWAquaI3fkECY5Hayg/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">被</span>RSA<span style="font-size:15px;line-height:35px;;font family: 等线;">加密后的数据内容：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2560706401766004" data-type="png" data-w="453" height="141" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/63_h0cLqaNGsA0t6picWeqJfptCM4uryw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawVfflHrrh70EeDdjELCz0dnVvOh0cLqaNGsA0t6picWeqJfptCM4uryw/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">至此，</span>beacon.exe<span style="font-size:15px;line-height:35px;;font family: 等线;">端第一次发包（元数据）分析完，流程总结为以下：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>收集数据</strong></span><strong>-&gt;RSA</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>加密</strong></span><strong>-&gt;base64</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>编码</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">下面开始分析</span>Teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端接受</span>beacon.exe<span style="font-size:15px;line-height:35px;;font family: 等线;">元数据的请求：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.04856512141280353" data-type="png" data-w="453" height="27" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/64_VGmVTvnibLCC6jEoHQ02SG7yiblk8g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawfNibR1U08tD4qf8519tkLep7UsNVGmVTvnibLCC6jEoHQ02SG7yiblk8g/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">跟入</span>_server()<span style="font-size:15px;line-height:35px;;font family: 等线;">，该函数经过</span>Useragent<span style="font-size:15px;line-height:35px;;font family: 等线;">等判断后，先把</span>url<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>method<span style="font-size:15px;line-height:35px;;font family: 等线;">等相关参数传入</span>webservice.serve()<span style="font-size:15px;line-height:35px;;font family: 等线;">进行构造相关响应头并返回，其中</span>MalleableHook<span style="font-size:15px;line-height:35px;;font family: 等线;">实现了相关的</span>webservice<span style="font-size:15px;line-height:35px;;font family: 等线;">接口，跟入</span>MalleableHook.serve()<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.15894039735099338" data-type="png" data-w="453" height="88" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/65_nZIWiaWvDogRtpkD3sJl0vKO54yYpA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawKQZqCic0uEdwflUrtAgyLoZMyianZIWiaWvDogRtpkD3sJl0vKO54yYpA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">在该方法中调用了</span>GetHandler.serve()<span style="font-size:15px;line-height:35px;;font family: 等线;">并把相应参数传入，继续跟入，该函数中先解析出相应的</span>URI<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>method<span style="font-size:15px;line-height:35px;;font family: 等线;">等：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.12141280353200883" data-type="png" data-w="453" height="67" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/66_hCAAKJibGDc0AybOkfIiblSic1dqEQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawwsGd4bvS8609ic2icIiaib5dAJANdc3hCAAKJibGDc0AybOkfIiblSic1dqEQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">我们先跟入</span>BeaconHTTP.this.c2profile.recover()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数，在该函数中先将</span>cookie<span style="font-size:15px;line-height:35px;;font family: 等线;">数据拿出来：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.0684326710816777" data-type="png" data-w="453" height="38" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/67_edBrvrBJcgZ12Ad5ZEh2BqMdic4LRQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawibwvDsN6aEmibOC1PAia5pqFnqeCedBrvrBJcgZ12Ad5ZEh2BqMdic4LRQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后再进行</span>base64<span style="font-size:15px;line-height:35px;;font family: 等线;">解码：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.12141280353200883" data-type="png" data-w="453" height="67" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/68_aUfB12aefwaQ07nwb7O91MtYQprqQg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawx2M6dzzWL9iciaz6oXpt3BxjZFiaUfB12aefwaQ07nwb7O91MtYQprqQg/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">解码完成后，会判断解码后数据的长度，接着传入被加密的数据到</span>process_beacon_metadata()<span style="font-size:15px;line-height:35px;;font family: 等线;">进行解析，继续跟入：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.04415011037527594" data-type="png" data-w="453" height="25" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/69_TL7dTXu3vfib7dDwtlv7xRV4tCaUyQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawu6B28YHia68D01oYXLrdgRLImfTL7dTXu3vfib7dDwtlv7xRV4tCaUyQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">跟入</span>decrypt()<span style="font-size:15px;line-height:35px;;font family: 等线;">，首先把反序列化处</span>RSA<span style="font-size:15px;line-height:35px;;font family: 等线;">私钥，然后对原数据解密，接着判断标志数是否为</span>48879<span style="font-size:15px;line-height:35px;;font family: 等线;">，如果不相等则解密失败，然后再判断数据长度，如果大于</span>117<span style="font-size:15px;line-height:35px;;font family: 等线;">则失败：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.4326710816777042" data-type="png" data-w="453" height="239" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/70_T5zIUNCweeGsseKWSKStDO5SLUIObw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawqISu9KxWdYVCqQ2vHqgEFHpmT5zIUNCweeGsseKWSKStDO5SLUIObw/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">回到</span>process_beacon_metadata()<span style="font-size:15px;line-height:35px;;font family: 等线;">，解密完后先读取前</span>16<span style="font-size:15px;line-height:35px;;font family: 等线;">字节备用，然后用</span>16-20<span style="font-size:15px;line-height:35px;;font family: 等线;">字节判断</span>windowscharts<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09492273730684327" data-type="png" data-w="453" height="52" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/71_1ZX4qibmRToKiamf6Voc0nvMlibibg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw5VicYHKcUdsWNPUjtG61zwibBmzNaN1ZX4qibmRToKiamf6Voc0nvMlibibg/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">把</span>ip<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>windowscharts<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>listen<span style="font-size:15px;line-height:35px;;font family: 等线;">地址、截取后的元数据传入到</span>BeaconEntry()<span style="font-size:15px;line-height:35px;;font family: 等线;">的构造方法进行解析：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.026490066225165563" data-type="png" data-w="453" height="15" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/72_EytfZVyr8391mtibgLsiag7Xw3L3KA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw0yAzr0rNIRtU5E6Q9NTDlRgmUibEytfZVyr8391mtibgLsiag7Xw3L3KA/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">跟入该方法，方法中先跳过前</span>20<span style="font-size:15px;line-height:35px;;font family: 等线;">字节，然后获取到</span>id<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>pid<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>port<span style="font-size:15px;line-height:35px;;font family: 等线;">、系统位数、受害者</span>ip<span style="font-size:15px;line-height:35px;;font family: 等线;">等信息：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.24724061810154527" data-type="png" data-w="453" height="137" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/73_5gA6rfuR8tCcPXRp8IUHzd237pX0kg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawDGBqPvUeRJiaibbP5PzTfo5n195gA6rfuR8tCcPXRp8IUHzd237pX0kg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09492273730684327" data-type="png" data-w="453" height="52" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/74_J1QQCI7bzdCk6TNGnDfldTiaHI6XEg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw17cM71N6UyNAfgZyxeUVFULzdJ1QQCI7bzdCk6TNGnDfldTiaHI6XEg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09271523178807947" data-type="png" data-w="453" height="51" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/75_20Um1XOAW142Cbs0KPEDS69OuhlDDQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawDbWjDul9QG2nicUiagn79QibA6320Um1XOAW142Cbs0KPEDS69OuhlDDQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">构造完后返回到</span>process_beacon_metadata()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数，再传入元数据中</span>hash<span style="font-size:15px;line-height:35px;;font family: 等线;">值给</span>registerkey()<span style="font-size:15px;line-height:35px;;font family: 等线;">该函数是注册</span>AESkey<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>HmacSHA256key<span style="font-size:15px;line-height:35px;;font family: 等线;">的，对传入的</span>hash<span style="font-size:15px;line-height:35px;;font family: 等线;">值进行一次</span>sha256<span style="font-size:15px;line-height:35px;;font family: 等线;">，然后前一半作为</span>AESkey<span style="font-size:15px;line-height:35px;;font family: 等线;">，后一半作为</span>hmacSHA256key<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.23399558498896247" data-type="png" data-w="453" height="129" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/76_dwo7SogSEGqp705LRiaO8EYzSkWLYg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawNdbcMdoeicuRgrSJUdqkW9UWP3dwo7SogSEGqp705LRiaO8EYzSkWLYg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">最后构造</span>response<span style="font-size:15px;line-height:35px;;font family: 等线;">数据包返回给</span>beacon.exe:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.04856512141280353" data-type="png" data-w="453" height="27" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/77_bl1Df0QUoQY3qicib9XaxLIeSHGpXg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw8Yeic5pEjrMp9Rp5PeN3aTS5j0ybl1Df0QUoQY3qicib9XaxLIeSHGpXg/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.18322295805739514" data-type="png" data-w="453" height="102" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/78_aALq2ArVqjaznNET0ogicyknEOGCDQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw1WNXqPFoqeU5B9icV6UrVibgOJKaALq2ArVqjaznNET0ogicyknEOGCDQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.423841059602649" data-type="png" data-w="453" height="235" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/79_t015Bej8CUnxhicK8TpeMtWzG1gyQA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawpbhvGr7klwSt1zsoCv4BicNrHnt015Bej8CUnxhicK8TpeMtWzG1gyQA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.30242825607064017" data-type="png" data-w="453" height="168" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/80_6MibCcY2rfJdaBv6g6k9ksEnIqk03g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawxQldoIrmichn9cVfrt6cSpnUF06MibCcY2rfJdaBv6g6k9ksEnIqk03g/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><section data-tools="135编辑器" data-id="88503" style="font family: 微软雅黑;font-size:16px;line-height:36px;;"><section style="margin: 10px auto;padding: 2px;box-sizing: border-box;"><section style="box-sizing: border-box;width: 56px;height: 40px;text-align: center;font-size: 2em;color: rgb(254, 254, 254);float: left;line-height: 40px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkRibiawOia1oleaXibzOjw4RmJfo7BqLQibUN0FQJcCQN2byCoGdc1CiarHk187AXDCRjQwx3438AN1cjJA/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100%;background-color: rgb(139, 183, 72);"><section data-original-title="" title="" data-num="2">4</section></section><section style="overflow-wrap: break-word;border-bottom: 2px dashed rgb(128, 177, 53);min-height: 36px;display: inline-block;line-height: 36px;margin-top: 0px;margin-left: 10px;box-sizing: border-box;"><span data-brushtype="text" style="color: #80b135;font-size:18px;line-height:38px;;margin-top: 0px;display: inline-block;">beacon端与teamserver端心跳包通信：</span></section></section></section><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">心跳包和发送元数据包的流程是相一致的，都是先复制加密后的数据再</span>base64<span style="font-size:15px;line-height:35px;;font family: 等线;">编码最后拼接</span>cookie<span style="font-size:15px;line-height:35px;;font family: 等线;">，只是没有再走</span>sub_1000671C()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数获取元数据了，只是走</span>sub_100024F4()<span style="font-size:15px;line-height:35px;;font family: 等线;">发送数据，数据的内容也是与元数据相一致的。</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.3509933774834437" data-type="png" data-w="453" height="194" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/81_jOyx9MBJicz39f4qGSsnAnMZJFeWWA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw4IoujMQVJfOLA4ibVWciaOI7lGWjOyx9MBJicz39f4qGSsnAnMZJFeWWA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><section data-tools="135编辑器" data-id="88503" style="font family: 微软雅黑;font-size:16px;line-height:36px;;"><section style="margin: 10px auto;padding: 2px;box-sizing: border-box;"><section style="box-sizing: border-box;width: 56px;height: 40px;text-align: center;font-size: 2em;color: rgb(254, 254, 254);float: left;line-height: 40px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkRibiawOia1oleaXibzOjw4RmJfo7BqLQibUN0FQJcCQN2byCoGdc1CiarHk187AXDCRjQwx3438AN1cjJA/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100%;background-color: rgb(139, 183, 72);"><section data-original-title="" title="" data-num="3">5</section></section><section style="overflow-wrap: break-word;border-bottom: 2px dashed rgb(128, 177, 53);min-height: 36px;display: inline-block;line-height: 36px;margin-top: 0px;margin-left: 10px;box-sizing: border-box;"><span data-brushtype="text" style="color: #80b135;font-size:18px;line-height:38px;;margin-top: 0px;display: inline-block;">beacon端与teamserver端执行所需任务的通信</span></section></section></section><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">下面介绍</span>Beacon.exe<span style="font-size:15px;line-height:35px;;font family: 等线;">接受</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端的任务数据传输：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><strong>5.1</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>、</strong></span><strong>teamserver</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>端怎么发送任务给</strong></span><strong>beacon</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>的？</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">当每次心跳结束后，</span>teamserver<span style="font-size:15px;line-height:35px;;font family: 等线;">端都会把相应的任务加入响应包中发送给</span>Beacon.exe</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.03090507726269316" data-type="png" data-w="453" height="17" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/82_CcNr1CmZKhGvsGQ2GkJXw9c8hyjb5Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw9UmY0oZ2uarXpkpwhtmscDsKCcNr1CmZKhGvsGQ2GkJXw9c8hyjb5Q/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">首先会根据</span>beaconEntry<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>id<span style="font-size:15px;line-height:35px;;font family: 等线;">号获取到任务队列中的</span>data<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>socks<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.141280353200883" data-type="png" data-w="453" height="78" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/83_fO022AwicgEu0qfHOlyc1sDq6VwVxg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawlwHLWkHUrfXWAsdvUeEzZwRDAfO022AwicgEu0qfHOlyc1sDq6VwVxg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09271523178807947" data-type="png" data-w="453" height="51" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/84_wukE98mXNwtsXjG0rzxDQAVU1a52Gg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawgMaYyLCpNxlvOCx9tRGT3J4bwukE98mXNwtsXjG0rzxDQAVU1a52Gg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后把</span>beaconEntry<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>id<span style="font-size:15px;line-height:35px;;font family: 等线;">号和</span>data<span style="font-size:15px;line-height:35px;;font family: 等线;">数据传入</span>encrypt()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数进行加密，跟入</span>encrypt()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数，函数中先通过</span>beaconEntry<span style="font-size:15px;line-height:35px;;font family: 等线;">的</span>id<span style="font-size:15px;line-height:35px;;font family: 等线;">号拿到</span>AESkey<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>hmackey<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.05518763796909492" data-type="png" data-w="453" height="31" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/85_2lORz0fhndSahcwQcfyu5ibAAxPGGQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawiaXyZuBFtaeicJkZcyWnC86fN152lORz0fhndSahcwQcfyu5ibAAxPGGQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">获取当前系统时间</span>/1000<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>data<span style="font-size:15px;line-height:35px;;font family: 等线;">长度、</span>data<span style="font-size:15px;line-height:35px;;font family: 等线;">数据并将其写入</span>var3<span style="font-size:15px;line-height:35px;;font family: 等线;">，然后进行</span>aes<span style="font-size:15px;line-height:35px;;font family: 等线;">加密，密钥为</span>beaconenrty<span style="font-size:15px;line-height:35px;;font family: 等线;">中保存好的</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.13024282560706402" data-type="png" data-w="453" height="72" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/86_thtIdyjpcPIJZ1IyOKxm9A63AdjHsg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw9czKWd2A1wj0g3QSB4eFFBFfthtIdyjpcPIJZ1IyOKxm9A63AdjHsg/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">对其加密后的数据进行</span>hmac<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.08830022075055188" data-type="png" data-w="453" height="49" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/87_PU8yUzxFtBnsPtIc4pQ6pApoQjc3rQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawkhEibGSCL9KfS06VL2TaiaJzO1PU8yUzxFtBnsPtIc4pQ6pApoQjc3rQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">将</span>hmac<span style="font-size:15px;line-height:35px;;font family: 等线;">前</span>16<span style="font-size:15px;line-height:35px;;font family: 等线;">字节拼到加密后的数据后，并返回：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.07505518763796909" data-type="png" data-w="453" height="41" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/88_VOYJ9y1dSmVnakxxF4xteaYM11SMWw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw4Bm2kMicYrBiaFV9T43ez9yq3TVOYJ9y1dSmVnakxxF4xteaYM11SMWw/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">最后发送给</span>beacon.exe<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.2737306843267108" data-type="png" data-w="453" height="152" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/89_picybLXP0iaTysMcqrK7tyQJTU0rZg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawzj9LkXIzibTicqBaFUQGmZckwjIEpicybLXP0iaTysMcqrK7tyQJTU0rZg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><strong>beacon</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>怎么处理</strong></span><strong>teamserver</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>端的响应包？</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">InternetReadFile()<span style="font-size:15px;line-height:35px;;font family: 等线;">读取到响应的内容</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.4370860927152318" data-type="png" data-w="453" height="242" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/90_IUSMdPbydCQYcAjl2hIlF4oqWSBdZQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw9G9UK5vj5AVwMB3woV5aVPJfIUSMdPbydCQYcAjl2hIlF4oqWSBdZQ/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后在</span>sub_1000c901<span style="font-size:15px;line-height:35px;;font family: 等线;">中进行相关的自己实现的</span>sha256<span style="font-size:15px;line-height:35px;;font family: 等线;">验证：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.05077262693156733" data-type="png" data-w="453" height="28" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/91_YLdP4Me3odOlrNBjWnrn2yR2exGs6w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawyF2TBFfqqI7egDe7hiafGOe2jYLdP4Me3odOlrNBjWnrn2yR2exGs6w/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">当验证通过后调用</span>sub_1000c5b1<span style="font-size:15px;line-height:35px;;font family: 等线;">进行解密，我们来看下解密的流程，显而易见这是一个</span>aes_cbc<span style="font-size:15px;line-height:35px;;font family: 等线;">解密的流程，先解密再异或，</span>v4<span style="font-size:15px;line-height:35px;;font family: 等线;">是加密的内容，</span>v18<span style="font-size:15px;line-height:35px;;font family: 等线;">是解密后存储空间，后面是</span>context<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.3509933774834437" data-type="png" data-w="453" height="194" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/92_0dxV91DwRgra73lrj7plyYdjf8Tiag.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw9TddcSYP06JVQibozhysBV7HVn0dxV91DwRgra73lrj7plyYdjf8Tiag/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.31567328918322296" data-type="png" data-w="453" height="175" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/93_mY0LSYtlTsGyoNAUQvJKib1wl5F6Zw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawg9VOGUHsYfw1FLPTVhJj6DZlymY0LSYtlTsGyoNAUQvJKib1wl5F6Zw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Context<span style="font-size:15px;line-height:35px;;font family: 等线;">内容：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.293598233995585" data-type="png" data-w="453" height="162" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/94_yh4Njibrf5XRFZic9ZOCHaBwjYEewA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawzZbia98xbLUutkoyDcNzZuiaPNc8yh4Njibrf5XRFZic9ZOCHaBwjYEewA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;font family: 等线;">解密后内容：</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.08388520971302428" data-type="png" data-w="453" height="46" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/95_8ibFatByuJr8Wxb9NIf3YiaVLl3CkQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawLQHPq8yj4k9v0zzG23fwn9VjUF8ibFatByuJr8Wxb9NIf3YiaVLl3CkQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;">Iv<span style="font-size:15px;line-height:35px;;font family: 等线;">为</span>abcdefghijklmnop<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.04856512141280353" data-type="png" data-w="453" height="27" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/96_8FOmzuhU8wiblichp1d0t72oW2Eb0A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawIrt3B6HmeLMic9t0tPqsFcV5UAf8FOmzuhU8wiblichp1d0t72oW2Eb0A/640?wx_fmt=png'" style="box-sizing:border-box;width:553px;height: auto;" vspace="1" width="553"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;font family: 等线;">解密后的内容：</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.15011037527593818" data-type="png" data-w="453" height="83" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/97_ZKT85RVozP1uzgGzKl7VwZeJedgSbg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawG804DlNGqpAbHwic6PbwAbYJ9ZKT85RVozP1uzgGzKl7VwZeJedgSbg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;font family: 等线;">后面解析解密后的数据，先获得时间戳，再获得数据长度，最后获得数据内容：</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.31567328918322296" data-type="png" data-w="453" height="175" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/98_2cxvq8hv8BIaX9PCPzLzRJvAQ4uA9Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawmUORPicvHtbw9ch2ic9Svc3tSD2cxvq8hv8BIaX9PCPzLzRJvAQ4uA9Q/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><strong>5.3</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>、</strong></span><strong>beacon</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>执行完任务怎么发送数据给</strong></span><strong>teamserver</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>端？</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">当</span>beacon<span style="font-size:15px;line-height:35px;;font family: 等线;">执行完相关任务后，调用</span>sub_10001345()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数把数据内容加密</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.4481236203090508" data-type="png" data-w="453" height="248" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/99_Pt826ct8HPY66mou8YOo1u8mUdZTkQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawkXSfu5KlWXgAHxgfIISNPum7Pt826ct8HPY66mou8YOo1u8mUdZTkQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后经过长度和数据类型等拼接后，调用</span>1000C170()<span style="font-size:15px;line-height:35px;;font family: 等线;">也是进行</span>AES_CBC<span style="font-size:15px;line-height:35px;;font family: 等线;">的加密：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.3620309050772627" data-type="png" data-w="453" height="201" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/100_36PSSLNIeCP1zIpwAbsenq3FOBQ7vQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawjF1F1sxW9284bjqruuDN62Mf36PSSLNIeCP1zIpwAbsenq3FOBQ7vQ/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">最后把加密完的数据调用</span>1000C901()<span style="font-size:15px;line-height:35px;;font family: 等线;">进行</span>sha256<span style="font-size:15px;line-height:35px;;font family: 等线;">的校验，校验值补在后面：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.40397350993377484" data-type="png" data-w="453" height="224" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/101_iaEPe77zh5x3yLaEbic1VkR2vk3CTA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawVWwRXCia75icpoibyymLAaH3dWDSdiaEPe77zh5x3yLaEbic1VkR2vk3CTA/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">发送数据</span>:</span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.3200883002207506" data-type="png" data-w="453" height="177" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/102_KHXjYUcbBVKx3BeuZS8j5yhCGU48kw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawib8EB2u7kZmqhphtYSZxmfVVRKHXjYUcbBVKx3BeuZS8j5yhCGU48kw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><strong>5.4</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>、</strong></span><strong>teamserver</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>端怎么处理</strong></span><strong>beacon</strong><span style="font-size:15px;line-height:35px;;font family: 等线;"><strong>端执行后返回的数据？</strong></span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">接收数据的方式与元数据一致的，先在</span>BeaconHTTP.server()<span style="font-size:15px;line-height:35px;;font family: 等线;">获得</span>beacon<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>id<span style="font-size:15px;line-height:35px;;font family: 等线;">和</span>post<span style="font-size:15px;line-height:35px;;font family: 等线;">数据：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.09271523178807947" data-type="png" data-w="453" height="51" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/103_ojAaeWRjosiaCF9OIs7VjHJZqvwx1Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawk5xX1LOjobAvic2dNdF7SCPAJSojAaeWRjosiaCF9OIs7VjHJZqvwx1Q/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">然后把</span>id<span style="font-size:15px;line-height:35px;;font family: 等线;">和数据传入</span>process_beacon_data()<span style="font-size:15px;line-height:35px;;font family: 等线;">处理，在该函数中调用</span>process_beacon_callback()<span style="font-size:15px;line-height:35px;;font family: 等线;">：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.06181015452538632" data-type="png" data-w="453" height="34" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/104_2l33NKESL385XZpFfsXibFA9ImNgWw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw0PECJZnib0WtbR6TictTibeibzLWm2l33NKESL385XZpFfsXibFA9ImNgWw/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">调用</span>Decrypt()<span style="font-size:15px;line-height:35px;;font family: 等线;">来解密数据，解密流程也是先对除了后面</span>16<span style="font-size:15px;line-height:35px;;font family: 等线;">的数据进行</span>sha256<span style="font-size:15px;line-height:35px;;font family: 等线;">验证，验证通过过再进行解密：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;font family: 等线;">再把<img align="left" border="0" data-ratio="0.3730684326710817" data-type="png" data-w="453" height="206" hspace="7" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/105_BdVgGVlNL9A9oBjqwn4tFuibYDOgzg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawkHjVulo5A4rpW9tiadGOpZzIBBBdVgGVlNL9A9oBjqwn4tFuibYDOgzg/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  />解密出来的数据传入</span><span style="font-size:15px;line-height:35px;;">process_beacon_callback_decrypted()<span style="font-size:15px;line-height:35px;;font family: 等线;">函数进行解析：</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.38852097130242824" data-type="png" data-w="453" height="215" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/106_MhvibQk9dc50NdyKibRm7Pr4Id7s4A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicawvnKt1gPjiacqWMRwSj4eqLHavBkMhvibQk9dc50NdyKibRm7Pr4Id7s4A/640?wx_fmt=png'" style="box-sizing:border-box;width:554px;height: auto;" vspace="1" width="554"  /></p><section data-tools="135编辑器" data-id="88503" style="font family: 微软雅黑;font-size:16px;line-height:36px;;"><section style="margin: 10px auto;padding: 2px;box-sizing: border-box;"><section style="box-sizing: border-box;width: 56px;height: 40px;text-align: center;font-size: 2em;color: rgb(254, 254, 254);float: left;line-height: 40px;background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkRibiawOia1oleaXibzOjw4RmJfo7BqLQibUN0FQJcCQN2byCoGdc1CiarHk187AXDCRjQwx3438AN1cjJA/640?wx_fmt=png&quot;);background-repeat: no-repeat;background-size: 100%;background-color: rgb(139, 183, 72);"><section data-original-title="" title="" data-num="4">6</section></section><section style="overflow-wrap: break-word;border-bottom: 2px dashed rgb(128, 177, 53);min-height: 36px;display: inline-block;line-height: 36px;margin-top: 0px;margin-left: 10px;box-sizing: border-box;"><span data-brushtype="text" style="color: #80b135;font-size:18px;line-height:38px;;margin-top: 0px;display: inline-block;">关于流量检测</span></section></section></section><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;text-indent: 0.29in;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">这次我们一起剖析了</span>CobalStrike<span style="font-size:15px;line-height:35px;;font family: 等线;">的通信协议，可见其通信协议是可靠的，</span>RSA<span style="font-size:15px;line-height:35px;;font family: 等线;">传输</span>AES<span style="font-size:15px;line-height:35px;;font family: 等线;">的密钥，</span>AES<span style="font-size:15px;line-height:35px;;font family: 等线;">的密钥加密后续通信，这也是</span>c2<span style="font-size:15px;line-height:35px;;font family: 等线;">的较常规通信手法了。如果在配置好</span>profile<span style="font-size:15px;line-height:35px;;font family: 等线;">和证书的情况下，还是被检测到流量通信，不妨一试删除默认的</span>.cobaltstrike.beacon_keys<span style="font-size:15px;line-height:35px;;font family: 等线;">，</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;text-indent: 0.29in;margin-bottom: 0in;"><img align="bottom" border="0" data-ratio="0.33774834437086093" data-type="png" data-w="453" height="187" hspace="1" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/107_QcumBxSeMs7un25LsCaOFp7oUHyicg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Jvbbfg0s6ABbpsT2aviabQvj0owCSRicaw9rtzEN7WXhohDic7qloo0ZNNuzQcumBxSeMs7un25LsCaOFp7oUHyicg/640?wx_fmt=png'" style="box-sizing: border-box;width: 100%;height: auto;" width="554" data-backw="554" data-backh="187"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;">这个文件是可以删掉的，删掉后会重新生成新的，但改文件保管着</span>RSA<span style="font-size:15px;line-height:35px;;font family: 等线;">的公私钥，所以要注意的是一旦删掉后原来的链接会丢失。也可以使用</span>ExternalC2<span style="font-size:15px;line-height:35px;;font family: 等线;">、</span>AWS
Lamdba CS Redirector<span style="font-size:15px;line-height:35px;;font family: 等线;">来规避。</span></span></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><span style="font-size:15px;line-height:35px;;"><span style="font-size:15px;line-height:35px;;font family: 等线;"><br  /></span></span></p><p style="margin-bottom: 0in;"><span style="color: rgb(255, 104, 39);"><strong><span style="font family:等线;"><span style="color: rgb(255, 104, 39);font-size:15px;line-height:35px;;">项目地址：<span style="color: rgb(255, 104, 39);font family: 微软雅黑;font-size:15px;line-height:35px;;text-indent: 27.84px;">https://github.com/mai1zhi2/CobaltstrikeSource/</span></span></span></strong></span></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;"><img data-type="png" data-ratio="0.109375" data-w="640" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/108_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" style="box-sizing: border-box !important;visibility: visible !important;width: 640px !important;"  /></span></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="font-size:19px;line-height:39px;;"><strong>推荐阅读：</strong></span></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__456" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(163, 163, 163)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: center;color: rgb(163, 163, 163) !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247495879&amp;idx=1&amp;sn=ab05215b31822bee4461255e9fac3237&amp;chksm=ec1ca5f8db6b2cee91b02eb6a70e5ed979c6e46ef40b548f8467affed9bc9de476854bc5a41a&amp;scene=21#wechat_redirect" textvalue="你已选中了添加链接的内容" data-itemshowtype="0" tab="innerlink" data-linktype="1" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;"><span class="js_jump_icon h5_image_link" data-positionback="static" style="line-height: 0;inset: auto;"><img class="rich_pages" data-ratio="0.4269788182831661" data-s="300,640" data-type="jpeg" data-w="897" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/109_7HBDmCVia2biaeZhwzMt8ITMbEnGIA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibVuhxbHrBQLfbnMFFe9SJT41vUS1XzgC0VZGHjuzp8zia9gbH7HBDmCVia2biaeZhwzMt8ITMbEnGIA/640?wx_fmt=jpeg'" style="border-width: 0px;border-style: initial;border-color: initial;border-radius: 45px;box-sizing: border-box !important;visibility: visible !important;width: 677px !important;"  /></span></a></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__457" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(163, 163, 163)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: center;color: rgb(163, 163, 163) !important;"><br data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(163, 163, 163)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__458" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(163, 163, 163)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: center;color: rgb(163, 163, 163) !important;"><span data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(255, 104, 39)" data-darkmode-original-color-16152068985875="#fff|rgb(255, 104, 39)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(255, 104, 39)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(255, 104, 39)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)" style="color: rgb(255, 104, 39);"><strong data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(255, 104, 39)" data-darkmode-original-color-16152068985875="#fff|rgb(255, 104, 39)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(255, 104, 39)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(255, 104, 39)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)">点赞 在看 转发</strong></span><br data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(163, 163, 163)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: right; color: rgb(163, 163, 163) !important;" class="js_darkmode__460" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-darkmode-color-16183090712209="rgb(163, 163, 163)" data-darkmode-original-color-16183090712209="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: right;color: rgb(163, 163, 163) !important;"><br  /></p><p data-darkmode-bgcolor-16183090712209="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16183090712209="#fff|rgb(255, 255, 255)" data-style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center;" class="js_darkmode__462" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages __bg_gif" data-ratio="0.5197505197505198" data-type="gif" data-w="962" src="图片/HACK学习呀_2021-04-22_免杀干货魔改CobaltStrike，让杀软和天眼流泪/110_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" style="box-sizing: border-box !important;visibility: visible !important;width: 677px !important;"  /></p><p style="font family: 微软雅黑;font-size:16px;line-height:36px;;margin-bottom: 0in;"><br  /></p></section></section></section></section>
                </div>
</div>
</body>
</html>