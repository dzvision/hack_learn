<html>
<head>
<title>逆向工程——汇编基础[二]</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
逆向工程——汇编基础[二]
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    HACK学习
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2019-07-29</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><h2 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.45em;border-bottom: 1px solid rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">堆栈</a></h2><h3 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.3em;border-bottom: 1px solid rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">基本概念</h3><ol style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 20px;">堆栈是一个先进后出（FILO）的线性表<br  /><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">FILO</code>是指：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">最后</code>放进表中的数据在<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">取出</code>时，<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">最先</code>出来，即 Fist in Last Out。<br  /><img class="" data-ratio="0.7984886649874056" src="图片/HACK学习呀_2019-07-29_逆向工程——汇编基础[二]/1_NTS1CDfItjcYK3bIdpicCiacPElj1g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9dmFTia0Vryia9a1zxUKzMhSax3oicSw1HWz2pcxGY9gicehxCe4NTS1CDfItjcYK3bIdpicCiacPElj1g/640?wx_fmt=png'" data-type="png" data-w="397" style="border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);display: block;margin-right: auto;margin-bottom: 25px;margin-left: auto;padding: 3px;"  /></p></li><li><p style="margin-bottom: 20px;">系统堆栈不仅仅是一段内存。<br  />由于CPU对它实施管理，因此你不需要考虑堆栈指针的修正问题。可以把寄存器内容，甚至一个立即数直接放入堆栈里，并在需要的时候将其取出。同时，系统并不要求取出的数据任然回到原来的位置。</p></li></ol><h3 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.3em;border-bottom: 1px solid rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">堆栈相关指令</h3><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">除了显示地操作堆栈（使用<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">push</code>和<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">pop</code>指令）之外，很多指令也需要使用堆栈，如<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">INT</code>、<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">CALL</code>、<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">LEAVE</code>、<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">RET</code>、<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">RETE</code>、<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">IRET</code>等等。配对使用上述指令并不会造成什么问题，然而，如果你打算使用LEAVE、RET、RETE、IRET这样的指令实现跳转（比JMP更为麻烦，然而有时，例如在加密软件中，或者需要修改调用者状态时这是必要的）的话，那么要搞清楚他们做的到底是什么，并且精确而了解自己要做什么。</p><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.2em;border-bottom: 1px dotted rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">push/pop指令</h4><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">push 寄存器</code>：将一个寄存器中的数据<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">压入</code>堆栈；<br  /><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">pop 寄存器</code>：将<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">栈顶</code>的数据<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">弹出</code>堆栈，并传入指定的寄存器。<br  /></p><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 424px;"><span class="line" style="height: 20px;">push ax		;将ax中的数据入栈</span><br  /><span class="line" style="height: 20px;">pop ax		;将堆栈栈顶的数据弹出并传送给ax</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">push 段寄存器</code>：将一个段寄存器中的数据压入堆栈；<br  /><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">pop 段寄存器</code>：将栈顶表示的数据弹出，并传入端寄存器。<br  /></p><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;" width="5"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;" width="1"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 74.4px;"><span class="line" style="height: 20px;">push ds</span><br  /><span class="line" style="height: 20px;">pop ds</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">push 内存单元</code>：将一个内存单元处的数据压入堆栈；<br  /><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">pop 内存单元</code>：将栈顶表示的数据弹出，并传入内存单元。<br  /></p><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 432.8px;"><span class="line" style="height: 20px;">push [0]	;将DS:[0]的数据压入堆栈</span><br  /><span class="line" style="height: 20px;">pop [0]		;将栈顶数据弹出，并传入DS:[0]</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">8086CPU的入栈和出栈都是以<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">字</code>为单元的。<br  /></p><h3 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.3em;border-bottom: 1px solid rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">简单实践</h3><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><p style="margin-bottom: 20px;">请各位同学自行下载<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;color: rgb(85, 85, 85);background: rgb(238, 238, 238);border-radius: 3px;">OllyDBG</code>，然后用OD随便打开一个程序，比如notepad.exe，然后鼠标滚动反汇编窗口，直到遇到空的地方。</p></blockquote><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.2em;border-bottom: 1px dotted rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">初始化</h4><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-ratio="0.6534391534391535" src="图片/HACK学习呀_2019-07-29_逆向工程——汇编基础[二]/2_icRxkm0JMHadfxEeibCgWyEnwXlpew.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9dmFTia0Vryia9a1zxUKzMhSB4h4TWY6IQ4Cf9nSv6IqT7StsricRxkm0JMHadfxEeibCgWyEnwXlpew/640?wx_fmt=png'" data-type="png" data-w="1512" style="border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);display: block;margin-right: auto;margin-bottom: 25px;margin-left: auto;padding: 3px;"  /><br  />Ollydbg 将是我们以后用到的主要软件之一。请各位同学自行下载， 并搜索资料熟悉一下。<br  />我们来认识下上图的信息：</p><ol style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 20px;">左上角的窗口中，我们可以编写汇编指令。右上角的窗口显示了各个寄存器的状态和值。左下角是二进制以及十六进制的数据。右下角是堆栈的情况。</p></li><li><p style="margin-bottom: 20px;">如果想让OD从你指定的位置开始执行，请<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">右击该行</code>，并选择<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">在此处新建EIP</code>。按<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">F7</code>键单步执行四次。</p></li><li><p style="margin-bottom: 20px;">执行完上述四条XOR指令之后，我们将EAX／EBX／ECX／EDX成功清零。</p></li><li><p style="margin-bottom: 20px;">EIP的值，为当前高亮的代码行，表示即将要执行的语句。</p></li><li><p style="margin-bottom: 20px;">通过堆栈窗口我们可以看到：</p></li><ol start="6" class=" list-paddingleft-2" style="list-style-type: lower-alpha;"><li><p>堆栈的结构是<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">从下往上减少</code>；</p></li><li><p>栈顶的位置是<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">0021f7bc</code>；</p></li><li><p>两个相邻的栈地址相差<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">4h</code>。</p></li></ol></ol><h4 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.2em;border-bottom: 1px dotted rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">POP／PUSH操作</h4><ul style="" class=" list-paddingleft-2"><li><p style="margin-bottom: 20px;"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">PUSH EAX</code>：<br  /><img class="" data-ratio="0.6486129458388376" src="图片/HACK学习呀_2019-07-29_逆向工程——汇编基础[二]/3_pbpf0S7b63k2jf662Wekupf01GdNvw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9dmFTia0Vryia9a1zxUKzMhSysmgpg2VVyyFEdqaAQTWibricJpbpf0S7b63k2jf662Wekupf01GdNvw/640?wx_fmt=png'" data-type="png" data-w="1514" style="border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);display: block;margin-right: auto;margin-bottom: 25px;margin-left: auto;padding: 3px;"  />在我们执行了push操作之后，栈顶变为了<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">0021f7b8</code>，而这个地址对应的数据为<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">00000000</code>(h)。</p></li><li><p style="margin-bottom: 20px;"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">MOV ECX,1234h</code>:<br  /><img class="" data-ratio="0.648074369189907" src="图片/HACK学习呀_2019-07-29_逆向工程——汇编基础[二]/4_bSiarg0lHqiavBOJ6sw9qnjkq9ibPw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9dmFTia0Vryia9a1zxUKzMhSHaCibmfJkd8VUO7ER2Iw8rv4kzPBbSiarg0lHqiavBOJ6sw9qnjkq9ibPw/640?wx_fmt=png'" data-type="png" data-w="1506" style="border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);display: block;margin-right: auto;margin-bottom: 25px;margin-left: auto;padding: 3px;"  /></p></li><li><p style="margin-bottom: 20px;"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">POP ECX</code>:<br  /><img class="" data-ratio="0.6476821192052981" src="图片/HACK学习呀_2019-07-29_逆向工程——汇编基础[二]/5_0T78LCJ2UwA8HCjoiaQ5Y5GribvRlw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9dmFTia0Vryia9a1zxUKzMhSWCqvUbQR53yicCicxJqp1wsmlP8u0T78LCJ2UwA8HCjoiaQ5Y5GribvRlw/640?wx_fmt=png'" data-type="png" data-w="1510" style="border-width: 1px;border-style: solid;border-color: rgb(221, 221, 221);display: block;margin-right: auto;margin-bottom: 25px;margin-left: auto;padding: 3px;"  />注意ECX值的变化。通过mov指令，我们给ECX传入了0x1234h，但是通过pop指令，我们将栈顶的EAX的值，弹出了堆栈，并且传递给了ECX，同时ESP栈顶<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">+4</code>变为了push eax之前的地址。</p></li></ul><h2 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.45em;border-bottom: 1px solid rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">子程序</h2><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">在汇编语言中，无门并不能像高级语言中那样，在不和程序其他部分起冲突的情况下，定义和其他主程序或子程序一样的变量名。<br  />汇编语言并不注重程序员的负担，它依赖程序员的良好设计，以期发挥CPU的最佳性能。<br  />汇编语言不是结构化的语言，它不提供直接的“局部变量”。如果需要，只能<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">通过堆或栈自行实现</code>。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">参数的传递是靠<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">寄存器</code>或<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">堆栈</code>来完成的。高级语言中，子程序（函数／过程，或者类似概念的东西）依赖于堆和栈来传递。</p><h3 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.3em;border-bottom: 1px solid rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">子程序的执行过程</h3><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">无论是C／C++／BASIC／Pascal，子程序的执行过程基本都是一致的。</p><ul style="" class=" list-paddingleft-2"><li><p>调用者将子程序执行完成时应返回的地址／参数压入堆栈。</p></li><li><p>子程序使用<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">BP指针+偏移量</code>对栈中的参数<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">寻址</code>，并取出，完成操作。</p></li><li><p>子程序使用<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">RET</code>或<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">RETF</code>指令返回。此时，CPU将<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">IP</code>置为堆栈中保存的地址，并继续予以执行。</p></li></ul><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">毋庸置疑，堆栈在整个过程中发挥着非常重要的作用。不过，本质上对子程序最重要的还是<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">返回地址</code>，如果子程序不知道这个地址，那么系统将会崩溃。<br  />调用子程序的指令是<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">CALL</code>，对应的返回指令是<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">RET</code>，另外还有<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">ENTER</code>和<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">LEAVE</code>，她们可以帮助进行堆栈的维护。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">CALL</code>指令的参数是<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">被调用子程序的地址</code>。使用宏汇编的时候，这通常是一个标号。CALL和RET，一级ENTER和LEAVE配对，以实现<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">对堆栈的自动操作</code>，而不需要程序员进行PUSH/POP，以及跳转的操作，从而提高了效率。</p><blockquote style="margin-top: 0px;margin-bottom: 0px;padding-top: 0px;padding-right: 15px;padding-left: 15px;color: rgb(102, 102, 102);border-left-width: 4px;border-left-color: rgb(221, 221, 221);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><p style="margin-bottom: 20px;">下面一段程序，是从作者文档中抄下来的，我搭建环境并且编译之后，并没有得到相同的汇编代码，所以大家不用拘泥于下面的细节，但是可以从原作者的分析中得到一些有用的知识。</p></blockquote><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">程序是这样的：<br  /></p><figure class="highlight c++" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /><span class="line" style="height: 20px;">9</span><br  /><span class="line" style="height: 20px;">10</span><br  /><span class="line" style="height: 20px;">11</span><br  /><span class="line" style="height: 20px;">12</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 266.4px;"><span class="line" style="height: 20px;"><span class="function" style="color: rgb(66, 113, 174);"><span class="keyword" style="color: rgb(137, 89, 168);">int</span> <span class="title" style="color: rgb(62, 153, 159);">myTransform</span><span class="params" style="color: rgb(245, 135, 31);">(<span class="keyword" style="color: rgb(137, 89, 168);">int</span> nInput)</span></span>{</span><br  /><span class="line" style="height: 20px;">  <span class="keyword" style="color: rgb(137, 89, 168);">return</span> (nInput*<span class="number" style="color: rgb(245, 135, 31);">2</span>+<span class="number" style="color: rgb(245, 135, 31);">3</span>) %<span class="number" style="color: rgb(245, 135, 31);">7</span>;</span><br  /><span class="line" style="height: 20px;">}</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;"><span class="function" style="color: rgb(66, 113, 174);"><span class="keyword" style="color: rgb(137, 89, 168);">int</span> <span class="title" style="color: rgb(62, 153, 159);">main</span><span class="params" style="color: rgb(245, 135, 31);">(<span class="keyword" style="color: rgb(137, 89, 168);">int</span> argc, <span class="keyword" style="color: rgb(137, 89, 168);">char</span>* argv[])</span></span></span><br  /><span class="line" style="height: 20px;">{</span><br  /><span class="line" style="height: 20px;">  <span class="keyword" style="color: rgb(137, 89, 168);">int</span> a[<span class="number" style="color: rgb(245, 135, 31);">3</span>];</span><br  /><span class="line" style="height: 20px;">  <span class="keyword" style="color: rgb(137, 89, 168);">for</span>(<span class="keyword" style="color: rgb(137, 89, 168);">register</span> <span class="keyword" style="color: rgb(137, 89, 168);">int</span> i=<span class="number" style="color: rgb(245, 135, 31);">0</span>;i&lt;<span class="number" style="color: rgb(245, 135, 31);">3</span>;i++){</span><br  /><span class="line" style="height: 20px;">    a[i] = myTransform(i);</span><br  /><span class="line" style="height: 20px;">  }</span><br  /><span class="line" style="height: 20px;">  <span class="keyword" style="color: rgb(137, 89, 168);">return</span> <span class="number" style="color: rgb(245, 135, 31);">0</span>;</span><br  /><span class="line" style="height: 20px;">}</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><br  /></p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">作者编译出来，并且合并了C++代码和汇编代码：<br  /></p><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN" style="width: 654px;"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /><span class="line" style="height: 20px;">3</span><br  /><span class="line" style="height: 20px;">4</span><br  /><span class="line" style="height: 20px;">5</span><br  /><span class="line" style="height: 20px;">6</span><br  /><span class="line" style="height: 20px;">7</span><br  /><span class="line" style="height: 20px;">8</span><br  /><span class="line" style="height: 20px;">9</span><br  /><span class="line" style="height: 20px;">10</span><br  /><span class="line" style="height: 20px;">11</span><br  /><span class="line" style="height: 20px;">12</span><br  /><span class="line" style="height: 20px;">13</span><br  /><span class="line" style="height: 20px;">14</span><br  /><span class="line" style="height: 20px;">15</span><br  /><span class="line" style="height: 20px;">16</span><br  /><span class="line" style="height: 20px;">17</span><br  /><span class="line" style="height: 20px;">18</span><br  /><span class="line" style="height: 20px;">19</span><br  /><span class="line" style="height: 20px;">20</span><br  /><span class="line" style="height: 20px;">21</span><br  /><span class="line" style="height: 20px;">22</span><br  /><span class="line" style="height: 20px;">23</span><br  /><span class="line" style="height: 20px;">24</span><br  /><span class="line" style="height: 20px;">25</span><br  /><span class="line" style="height: 20px;">26</span><br  /><span class="line" style="height: 20px;">27</span><br  /><span class="line" style="height: 20px;">28</span><br  /><span class="line" style="height: 20px;">29</span><br  /><span class="line" style="height: 20px;">30</span><br  /><span class="line" style="height: 20px;">31</span><br  /><span class="line" style="height: 20px;">32</span><br  /><span class="line" style="height: 20px;">33</span><br  /><span class="line" style="height: 20px;">34</span><br  /><span class="line" style="height: 20px;">35</span><br  /><span class="line" style="height: 20px;">36</span><br  /><span class="line" style="height: 20px;">37</span><br  /><span class="line" style="height: 20px;">38</span><br  /><span class="line" style="height: 20px;">39</span><br  /><span class="line" style="height: 20px;">40</span><br  /><span class="line" style="height: 20px;">41</span><br  /><span class="line" style="height: 20px;">42</span><br  /><span class="line" style="height: 20px;">43</span><br  /><span class="line" style="height: 20px;">44</span><br  /><span class="line" style="height: 20px;">45</span><br  /><span class="line" style="height: 20px;">46</span><br  /><span class="line" style="height: 20px;">47</span><br  /><span class="line" style="height: 20px;">48</span><br  /><span class="line" style="height: 20px;">49</span><br  /><span class="line" style="height: 20px;">50</span><br  /><span class="line" style="height: 20px;">51</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 724.8px;"><span class="line" style="height: 20px;">int myTransform(int nInput){</span><br  /><span class="line" style="height: 20px;">//00401000 push ebp		;保护现场原先的EBP指针</span><br  /><span class="line" style="height: 20px;">//00401001 mov ebp,esp</span><br  /><span class="line" style="height: 20px;">return (nInput*2+3)%7;</span><br  /><span class="line" style="height: 20px;">//00401003 mov eax,dword ptr [nInput]		;取参数</span><br  /><span class="line" style="height: 20px;">//00401006 lea eax,[eax+eax+3]		;LEA比ADD加法更快</span><br  /><span class="line" style="height: 20px;">//0040100A cdq		;DWORD -&gt; QWORD（扩展字长）</span><br  /><span class="line" style="height: 20px;">//0040100B mov ecx,7		;除数</span><br  /><span class="line" style="height: 20px;">//00401010 idiv eax,ecx		;除</span><br  /><span class="line" style="height: 20px;">//00401012 mov eax,edx		;商-&gt;eax（eax中保存返回值）</span><br  /><span class="line" style="height: 20px;">}</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;">//00401014 pop ebp		;恢复现场的EBP指针</span><br  /><span class="line" style="height: 20px;">//00401005 ret		;返回</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;">//; 此处删除10条int 3指令，不会影响程序行为</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;">int main(int argc, char* argv[])</span><br  /><span class="line" style="height: 20px;">{</span><br  /><span class="line" style="height: 20px;">//00401020 push ebp		;保护现场原先的EBP指针</span><br  /><span class="line" style="height: 20px;">//00401021 mov ebp,esp</span><br  /><span class="line" style="height: 20px;">//00401023 sub esp,10h		;为取argc/argv修正堆栈指针</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;">int a[3];</span><br  /><span class="line" style="height: 20px;">for(register int i=0;i&lt;3;i++){</span><br  /><span class="line" style="height: 20px;">	//00401026 mov dword ptr [i],0		;0-&gt;i</span><br  /><span class="line" style="height: 20px;">	//0040102D jmp main+18h(00401038)		;判断循环条件</span><br  /><span class="line" style="height: 20px;">	//0040102F mov eax,dword ptr [i]		;i-&gt;eax</span><br  /><span class="line" style="height: 20px;">	//00401032 add eax,1		;EAX++</span><br  /><span class="line" style="height: 20px;">	//00401035 mov dword ptr [i],eax		;eax -&gt; i</span><br  /><span class="line" style="height: 20px;">	//00401038 cmp dword ptr [i],3; 循环条件：i与3比较</span><br  /><span class="line" style="height: 20px;">	//0040103C jge main+33h(00401053)		;如果不符合条件，则应结束循环</span><br  /><span class="line" style="height: 20px;">	a[i] = myTransform[i];</span><br  /><span class="line" style="height: 20px;">	//0040103E mov ecx,dword ptr [i]		;i-&gt;ECX</span><br  /><span class="line" style="height: 20px;">	//00401041 push ecx		;ecx(i) -&gt; 堆栈</span><br  /><span class="line" style="height: 20px;">	//00401042 call myTransform(00401000)		;调用myTransform</span><br  /><span class="line" style="height: 20px;">	//00401047 add esp,4		;ESP+4:在堆中的新单元</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;">	//;准备存放返回结果</span><br  /><span class="line" style="height: 20px;">	//0040104A mov edx,dword ptr [i]		;i-&gt;EDX</span><br  /><span class="line" style="height: 20px;">	//0040104D mov dword ptr [edx*4],eax		;将EAX(即myTransform的返回值)放回a[i]</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;">}</span><br  /><span class="line" style="height: 20px;">//00401051 jmp main+0Fh(0040102F)		;计算出i++，并继续循环</span><br  /><span class="line" style="height: 20px;">return 0;</span><br  /><span class="line" style="height: 20px;">//00401053 xor eax,eax		;返回值应该是0</span><br  /><span class="line" style="height: 20px;"></span><br  /><span class="line" style="height: 20px;">}</span><br  /><span class="line" style="height: 20px;">//00401055 mov esp,ebp		;恢复堆栈指针</span><br  /><span class="line" style="height: 20px;">//00401057 pop ebp		;恢复BP</span><br  /><span class="line" style="height: 20px;">//00401058 ret		;返回调用者(C++运行环境)</span><br  /></pre></td></tr></tbody></table></figure><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 439.2px;"><span class="line" style="height: 20px;">00401003 mov eax,dword ptr [nInput]	;取参数</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">这句话在另外一个反汇编器得到的结果是：<br  /></p><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 439.2px;"><span class="line" style="height: 20px;">00401003 mov eax,dword ptr [ebp+8]	;取参数</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">剖析上面的程序只是说明了前面所提到的子程序的一部分用法。对于汇编语言来说，完全没有必要拘泥于结构化程序设计的框架。<br  /></p><h2 style="margin-top: 20px;margin-bottom: 15px;padding-top: 10px;font-weight: bold;line-height: 1.5;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size: 1.45em;border-bottom: 1px solid rgb(238, 238, 238);color: rgb(85, 85, 85);white-space: normal;background-color: rgb(255, 255, 255);">中断</h2><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">中断应该说是一个陈旧的话题。这新的系统中，它的作用正在逐渐被削弱，而变成操作系统专用的东西。并不是所有的计算机系统都提供中断，然而这x86系统中，它的作用是不可替代的。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">中断实际上是一类特殊的子程序。它通常<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">由系统调用</code>，以响应突发事件。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">例如，进行磁盘操作时，为了提高性能，可能会使用DMA方式进行操作。CPU向DMA控制器发出指令，要求外设和内存直接交换数据，而不通过CPU。然后，CPU转去进行其他的操作；当数据交换结束时，CPU可能需要进行一些后续操作，但此时它如何才能知道DMA已经完成了操作呢？</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">很显然不是依靠CPU去查询状态——这样DMA的优势就不明显了。为了尽可能地利用DMA的优势，这完成DMA操作的时候，DMA会告诉CPU“这事儿我办完了”，然后CPU会根据需要进行处理。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">这种处理可能很复杂，需要若干条指令来完成。子程序是一个不错的主意，不过，CALL指令需要指定地址，让外设强迫CPU执行一条CALL指令也违背了CPU作为核心控制单元的设计初衷。考虑到这些，这x86系统中引入了<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">中断向量</code>的概念。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);"><code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">中断向量表</code>是保存在系统数据区（实模式下，是0:0开始的一段区域）的一组指针。这组指针指向每个中断服务程序的地址。整个中断向量表的结构是一个线性表。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">每个中断服务都有自己的唯一编号，我们通常称之为<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">中断号</code>。每一个中断号对应中断向量表中的一项，也就是一个中断的向量。外设向驼背发出中断请求，而CPU自己将根据当前的程序状态决定是否中断当前程序并调用相应的中断服务。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">不难根据造成中断的原因将中断分为两类：<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">硬件中断</code>和<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">软件中断</code>。硬件中断有很多分类方法，如根据是否可以屏蔽分类、根据优先级高低分类，等等。考虑到这些分类并不一定科学，并且对于我们介绍中断的使用没有太大的帮助，因此我们并不打算太详细地介绍它。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">在设计操作系统时，中断向量的概念曾经带来过很大的便利。操作系统随时可能升级，这样，通过CALL来调用操作系统的服务（如果说每个程序都包含对于文件系统、进程表这些应该由操作系统管理的数据的直接操作的话，不仅会造成程序的臃肿，而且不利于系统的安全）就显得不太合适了——没人知道以后的操作系统的服务程序入口点会不会是那。软件中断的存在为解决这个问题提供了方便。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">对于一台包含了BIOS的计算机来说，启动的时候系统已经提供了一部分服务，例如显示服务。无论你的BIOS、显卡有多么的“个性”，只要他们和IBM PC 兼容，那么此时你肯定可以通过调用<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">16(10h)号</code>中断来使用显示服务。调用中断的指令是：<br  /></p><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 92.8px;"><span class="line" style="height: 20px;">int 中断号</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">这将引发CPU去调用一个中断。CPU将保存当前的程序状态字，清除Trap和Interrupt两个标志，将即将执行的指令地上压入堆栈，并调用中断服务（根据中断向量表）。<br  /></p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">编写中断服务程序不是一件容易的事情。很多时候，中断服务程序必须写成<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">可重入代码</code>（或纯代码，pure code）。所谓可重入代码是指，程序的运行过程中可以被打断，并由开始处再次执行，并且执行结果不受影响。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">由于在多线程环境中等其他一些地方进行程序设计时也需要考虑这个因素，因此这里着重说一个可重入代码的编写。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">可重入代码<code style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;font-size:14px;line-height:34px;;padding: 2px 4px;background: rgb(238, 238, 238);border-radius: 3px;">最主要的要求</code>就是，程序不应使用某个指定的内存地址的内存（对于高级语言来说，这通常是全局变量，或对象的成员）。如果可能的话，应使用寄存器，或其他方式来解决。如果不能做到这一点，则必须在开始、结束的时候分别禁止和启用中断，并且，运行时间不能太长。</p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">调用软件中断时，通常都是通过寄存器传进、传出参数。这意味着你的int指令周围也许会存在一些“帮手”，比如下面的代码：<br  /></p><figure class="highlight plain" style="overflow: auto;margin-top: 20px;margin-bottom: 20px;font-size:14px;line-height:34px;;color: rgb(77, 77, 76);background: rgb(247, 247, 247);line-height: 1.6;border-radius: 1px;font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;white-space: normal;"><table width="NaN"><tbody><tr style="background-color: rgb(249, 249, 249);"><td class="gutter" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;user-select: none;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;color: rgb(134, 145, 148);background: rgb(239, 242, 243);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;text-align: right;"><span class="line" style="height: 20px;">1</span><br  /><span class="line" style="height: 20px;">2</span><br  /></pre></td><td class="code" style="padding: 0px;text-align: left;vertical-align: middle;border-width: initial;border-style: none;border-color: initial;"><pre style="font family: consolas, Menlo, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, monospace;overflow: auto;padding: 10px;background: rgb(247, 247, 247);line-height: 1.6;border-width: initial;border-style: none;border-color: initial;width: 112.8px;"><span class="line" style="height: 20px;">mov ax,4c00h</span><br  /><span class="line" style="height: 20px;">int 21h</span><br  /></pre></td></tr></tbody></table></figure><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">就是通过调用DOS中断服务返回父进程，并带回错误找反馈码0。其中，ax中的数据4c00h就是传递给DOS中断服务的参数。<br  /></p><p style="margin-bottom: 20px;color: rgb(85, 85, 85);font family: Lato, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, sans-serif;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);">到此，x86汇编语言的基础部分就讲完了。</p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><span style="font-size:16px;line-height:36px;;"><img data-type="png" class="" data-ratio="0.109375" data-w="640" data-backw="556" data-backh="61" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png" src="图片/HACK学习呀_2019-07-29_逆向工程——汇编基础[二]/6_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" style="letter-spacing: 0.544px;font-size:10px;line-height:30px;;color: rgb(36, 41, 46);visibility: visible !important;width: 677px !important;"  /></span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><span style="font-size:10px;line-height:30px;;">参考文档来源：</span><span style="color: rgb(34, 34, 34);font family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace;text-align: left;white-space: pre-wrap;font-size:10px;line-height:30px;;">简明 x86 汇编语言教程</span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: right;"><span style="font-size:10px;line-height:30px;;"><span style="color: rgb(34, 34, 34);font family: Consolas, &quot;Lucida Console&quot;, &quot;Courier New&quot;, monospace;font-size:12px;line-height:32px;;text-align: left;white-space: pre-wrap;">如有侵权，请联系删除<br  /></span></span></p><p style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: left;"><img class="rich_pages __bg_gif " data-copyright="0" data-ratio="0.5197505197505198" data-type="gif" data-w="962" src="图片/HACK学习呀_2019-07-29_逆向工程——汇编基础[二]/7_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" style="visibility: visible !important;width: 677px !important;"  /></p><p><br  /></p>
                </div>
</div>
</body>
</html>