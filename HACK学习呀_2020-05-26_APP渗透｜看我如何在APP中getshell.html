<html>
<head>
<title>APP渗透｜看我如何在APP中getshell</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
APP渗透｜看我如何在APP中getshell
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                                                                            
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-05-26</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div>

                
                                
                
                

                
                                                                

                
                                    
                    <div class="original_area_primary" style="margin-bottom: 0;">
                                                                                                </div>

                    
                                            <div class="original_area_primary">
                            <p role="option" class="original_primary_card_tips">
                                                                    <span>以下文章来源于酒仙桥六号部队</span>
                                                                                                    <span>，作者队员编号001</span>
                                                            </p>
                            <a class="weui-flex original_primary_card appmsg_card_context appmsg_card_active" href="#" id="copyright_info">
                                <div class="weui-flex__hd">
                                    <span class="radius_avatar"> </span>
                                </div>
                                <div class="weui-flex__item" role="option">
                                    <strong class="original_primary_nickname">酒仙桥六号部队</strong>
                                                                            <span class="weui-hidden_abs">.</span>
                                        <p class="original_primary_desc">知其黑，守其白。 分享知识盛宴，闲聊大院趣事，备好酒肉等你！</p>
                                                                    </div>
                                <div class="weui-flex__ft"></div>
                            </a>
                        </div><div id="weixin_content"><p data-mpa-powered-by="yiban.io"><br  /></p><section style="display: none;" data-tools="新媒体管家" data-label="powered by xmt.cn"><br  /></section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="29514"><section data-tools="135编辑器" data-id="92498"><section style="display: flex;justify-content: center;padding-top: 15px;padding-bottom: 15px;box-sizing: border-box;"><section style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkQXVPLhWQdgHWL8y6RepLIPGNFnzEHc7x13lysibUpIZnmjqSfAlgPiclK9KlIfOuUf3nUibcenu68Uw/640?wx_fmt=png&quot;);background-position: left top;background-repeat: no-repeat;background-size: 30px;"><section style="background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/fgnkxfGnnkQXVPLhWQdgHWL8y6RepLIP3qrOYUbkicxbgnhiaS5zZNUWvNtiaMl52kZGzQjXiabTbPsjW4cWYiaNKhw/640?wx_fmt=png&quot;);background-position: right bottom;background-size: 30px;background-repeat: no-repeat;padding: 8px 12px;box-sizing: border-box;"><section style="padding-right: 20px;padding-left: 20px;line-height: 30px;background-color: rgb(221, 237, 235);font-size:16px;line-height:36px;;color: rgb(88, 88, 88);box-sizing: border-box;" data-brushtype="text"><p style="text-align: justify;margin-right: 5px;margin-left: 5px;padding-right: 20px;padding-left: 20px;max-width: 100%;min-height: 1em;color: rgb(32, 88, 103);visibility: visible;line-height: 1.75em;letter-spacing: 2.5px;font family: -apple-system-font, BlinkMacSystemFont, Arial, sans-serif;box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong data-brushtype="text" style="font-size:20px;line-height:40px;;color: rgb(234, 249, 253);text-align: center;font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">前言</strong><br  /></p></section></section></section></section></section><h2 cid="n4" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.75em;margin: 1rem 5px;font-weight: bold;cursor: text;padding-bottom: 0.3em;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"></a></h2><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">说起APP上的渗透测试，很多朋友在拿到一个APP的时候，往往会将客户端的检测与服务端的检测分得很开，越来越多的测试人员客户端检测仅仅局限于静态工具扫描，不注重客户端审计与服务端渗透的结合，以至于APP的安全审计报告中服务端的漏洞占比较少。</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;box-sizing: border-box;font family: 宋体, SimSun;">我们接下来会通过一次网安渗透测试项目，来跟大家聊聊怎么样通过APP与服务端的结合，getshell。希望通过这个案例，能给大家在app渗透测试过程中起到一个抛砖引玉的作用，见招拆招，百步穿扬。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;box-sizing: border-box;font family: 宋体, SimSun;">由于客户给了我们明确的测试范围，且重点要求获取服务网权限，所以我们前期做了各种信息收集。其中有一点较为重要，就是发现了内部员工使用的一个邮件类的app，我们也希望以此为突破口，最终拿到服务器的权限。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><br  /></p><h2 cid="n6" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.75em;margin: 1rem 5px;font-weight: bold;cursor: text;padding-bottom: 0.3em;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"></h2><section data-tools="135编辑器" data-id="97835"><section style="text-align: left;margin: 10px auto;"><section style="display: inline-block;"><section style="background-color: rgb(221, 237, 235);border-top-right-radius: 20px;border-bottom-right-radius: 20px;padding: 6px 1.5em;box-sizing: border-box;"><section style="text-align: center;letter-spacing: 3px;font-size:16px;line-height:36px;;color: rgb(234, 249, 253);text-shadow: rgb(1, 115, 99) 1px 1px, rgb(1, 115, 99) 1px -1px, rgb(1, 115, 99) 1px -1px, rgb(1, 115, 99) -1px 1px, rgb(1, 115, 99) -1px -1px, rgb(1, 115, 99) 0px 1.4px, rgb(1, 115, 99) 0px -1.4px, rgb(1, 115, 99) -1.4px 0px, rgb(1, 115, 99) 1.4px 0px, 2px 0px, rgb(195, 217, 223) 0px 3px, rgb(195, 217, 223) 0px 3px, rgb(195, 217, 223) 0px 2px, rgb(195, 217, 223) 0px 2px;box-sizing: border-box;"><p style="margin-left: 5px;margin-right: 5px;line-height: 1.75em;letter-spacing: 2.5px;"><span style="font-size:20px;line-height:40px;;"><strong data-brushtype="text">流程分析</strong></span></p></section></section></section></section></section><h2 cid="n6" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.75em;margin: 1rem 5px;font-weight: bold;cursor: text;padding-bottom: 0.3em;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"></h2><section data-tools="135编辑器" data-id="29514"><section style="margin-top: 0.5em;max-width: 100%;box-sizing: border-box;min-width: 0px;color: rgb(62, 62, 62);font-size:15px;line-height:35px;;line-height: 24px;border-width: initial;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section><section style="max-width: 100%;box-sizing: border-box;display: inline-block;vertical-align: top;height: 1.8em;width: 1.8em;border-radius: 50%;border-width: 3px;border-style: solid;border-color: rgb(221, 237, 235);font-size: 1.6em;font-weight: inherit;text-align: center;text-decoration: inherit;color: rgb(221, 237, 235);background: rgb(1, 115, 99);font family: inherit;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;line-height: 1.6em;overflow-wrap: break-word !important;" data-original-title="" title=""><p style="margin-left: 5px;margin-right: 5px;line-height: 1.75em;letter-spacing: 2.5px;">1</p></section></section></section><section style="margin-top: -1.56em;margin-bottom: 1em;margin-left: 0.5em;float: left;border-radius: 1em;font-size: 1.2em;font-weight: inherit;text-decoration: inherit;color: rgb(1, 115, 99);border-color: rgb(221, 237, 235);background-color: rgb(221, 237, 235);z-index: -1;font family: inherit;box-sizing: border-box;overflow-wrap: break-word !important;"><p style="margin-left: 5px;margin-right: 5px;line-height: 1.75em;letter-spacing: 2.5px;"><span style="box-sizing: border-box;display: inline-block;float: left;line-height: 1.6em;margin-right: 5px;margin-left: 5px;max-width: 100%;padding-right: 10px;padding-left: 2em;vertical-align: top;font family: arial, helvetica, sans-serif;overflow-wrap: break-word !important;">绕过SSL Pinning抓包</span></p></section><section style="clear: both;width: 0px;height: 0px;overflow: hidden;"><br  /></section></section></section><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">拿到这个APP后，我们首先做出了一个大胆的假设：其内部使用的客户端在安全防护上是否较弱呢？</span> <span md-inline="plain" style="box-sizing: border-box;"> &nbsp;</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">于是我们当机立断，打算直接使用Burp抓包，找到利用点后攻击服务端，利用相关漏洞一步到位，Get Shell。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">然而，经过尝试发现，客户端对证书进行了校验，burp竟然没法抓包。起步就遇到了阻碍，所以，我们先得解决抓包问题。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">证书验证主要有两种方式，分别为双向校验、单向校验。而双向校验一般存在于银行、金融等app中，所以为了提高攻击效率，我们假定其为单向校验，并尝试绕过。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">该案例我们借助了JustTrustMe，非常幸运的是通过该插件，我们绕过了证书校验。但是在这里又遇到一个问题：我们抓到的包都是加密的。如下：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="210" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/1_L7PlFxSWo9tNiatdvpzmvh1ysyaSgg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9l9usvVn3I9UX3Ghb9Od0f7MTvL7PlFxSWo9tNiatdvpzmvh1ysyaSgg/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">由于请求和响应数据包都进行了加密，并且使用同样的数据进行请求的时候，每次密文都不一样，很显然，数据加密密钥是动态变化的。此处的阻碍让我有点方了。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;text-align: center;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/2_J6BPvQiapBLqxaaQFKcVhBich6iatg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9G2cFmTJdicaib52nnfeNnfBAZ67u4J6BPvQiapBLqxaaQFKcVhBich6iatg/640?wx_fmt=png'" style="width:auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="280" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/3_RYVRBAiahtXmHXSajBRiccicOgPyyA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9Rd6jybrhNE9t3rO4q1UzfzlNgwicRYVRBAiahtXmHXSajBRiccicOgPyyA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="285" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/4_G7oUyNregC5GfViadvTKa6QV2EviaQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9qiamCGhU8wuatpaqNff23wUsPdEG7oUyNregC5GfViadvTKa6QV2EviaQ/640?wx_fmt=png'" style="width: 100%;height: auto;"  /> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">如果客户端实现了OTP加密原理的话，客户端是需要存有非对称算法如RSA</span> <span md-inline="plain" style="box-sizing: border-box;">的公钥的。服务端存有非对称算法的私钥，客户端采用自身生成的对称加密密钥如AES来加密信息内容，然后将此对称密钥用服务端的公开密钥来加密之后，将它和加密后的信息一起发送给服务端。</span></span><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);caret-color: red;font family: 宋体, SimSun;">服务端先用相应的私有密钥打开数字信封，得到对称密钥，然后使用对称密钥解开加密信息。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">但是，抓包过程中发现，它首先有一个从服务端获取密钥的过程。发现每次请求前，客户端都要向服务端发送请求，获取Key。从加密数据本身看，貌似是RSA。由此推测它的一次一密不是数字信封的方式。那么接下来，破解它的加密逻辑就迫在眉睫了。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">以上步骤是绕过证书校验进行数据抓包。我们可是站在正义的角度看看客户端客户端证书校验威胁噢。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="418" data-backw="508" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/5_3FU3ibJWI6wXfibXicj8Xv9IE2nsxw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9s4iczZ14OxSg4kbkus4AhQtN1S4l3FU3ibJWI6wXfibXicj8Xv9IE2nsxw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><h4 cid="n11" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.25em;margin: 1rem 5px;font-weight: bold;cursor: text;white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><p style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><br  /></p></h4><h4 cid="n11" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.25em;margin: 1rem 5px;font-weight: bold;cursor: text;white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">Tips：</span></h4><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">如果客户端在与服务端通信的过程中没有对传输的数据进行保护与完整性校验，并且未做任何的证书校验，这将直接导致中间人攻击，可重复发送截取到的请求报文，并观察和分析服务端的反应，实现进一步的攻击。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">常用的工具有Wireshark、Burpsuite、Fiddler和Charles等。</span></p><p style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><br  /></p><section data-tools="135编辑器" data-id="29514"><section style="margin-top: 0.5em;max-width: 100%;box-sizing: border-box;min-width: 0px;color: rgb(62, 62, 62);font-size:15px;line-height:35px;;line-height: 24px;border-width: initial;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section><section style="max-width: 100%;box-sizing: border-box;display: inline-block;vertical-align: top;height: 1.8em;width: 1.8em;border-radius: 50%;border-width: 3px;border-style: solid;border-color: rgb(221, 237, 235);font-size: 1.6em;font-weight: inherit;text-align: center;text-decoration: inherit;color: rgb(221, 237, 235);background: rgb(1, 115, 99);font family: inherit;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;line-height: 1.6em;overflow-wrap: break-word !important;" data-original-title="" title="" data-num="2">2</section></section></section><section style="margin-top: -1.56em;margin-bottom: 1em;margin-left: 0.5em;float: left;border-radius: 1em;font-size: 1.2em;font-weight: inherit;text-decoration: inherit;color: rgb(1, 115, 99);border-color: rgb(221, 237, 235);background-color: rgb(221, 237, 235);z-index: -1;font family: inherit;box-sizing: border-box;overflow-wrap: break-word !important;"><span style="box-sizing: border-box;display: inline-block;float: left;line-height: 1.6em;margin-right: 5px;margin-left: 5px;max-width: 100%;padding-right: 10px;padding-left: 2em;vertical-align: top;font family: arial, helvetica, sans-serif;overflow-wrap: break-word !important;">反编译分析加密逻辑</span></section><section style="clear: both;width: 0px;height: 0px;overflow: hidden;"><br  /></section></section></section><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">我们通过反编译APK文件，尝试去定位加密函数，看能否破解上述网络请求中的加解密逻辑。</span> <span md-inline="plain" style="box-sizing: border-box;">但是我们反编译后发现APK被加了壳。</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="269" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/6_gZAgNqB07WDpQQqKroGllYsxBolkJA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9GRtpX6axnEiaUWPNKiaZDM8VFQgZAgNqB07WDpQQqKroGllYsxBolkJA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">那么我们见招拆招，使用FRIDA-DEXDump进行脱壳，且成功的拿到dex文件。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="340" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/7_1nLq3Q1ZdjvEzCwJw9PSCmvxhmplGA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9LMdI5Bcggp1M7b1h6QxHDpIS1nLq3Q1ZdjvEzCwJw9PSCmvxhmplGA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">通过对脱壳拿到的dex文件进行反编译，定位getkey请求进行分析对应的加密逻辑。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">分析定位加密到函数如下：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="65" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/8_AsQw80jibCqvMMKYPYgsgDtKAub14w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9Gx8hsl4BZuq4YeD19gHID8KW4AsQw80jibCqvMMKYPYgsgDtKAub14w/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="82" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/9_2PXFibaolNfWIOFQudqjbialvcib4A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9tsXnRpMFTePAx2q821iaTDsQxWcc2PXFibaolNfWIOFQudqjbialvcib4A/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="90" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/10_IBQqWVJiapyymUbnwaic7I1I2g2tdw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9LmB7CUw82kg1ibycrV9Qj1XjdNUIBQqWVJiapyymUbnwaic7I1I2g2tdw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="319" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/11_QRib2Xd6NZicsIF3CBEoxCa5Qict2g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9b8wn5Q8QibGwR1FhMF8ccdvmNFznQRib2Xd6NZicsIF3CBEoxCa5Qict2g/640?wx_fmt=png'" style="width: 100%;height: auto;"  /> &nbsp; &nbsp;</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">经过缜密分析，发现这个APK加密逻辑是这样的：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">客户端先发送请求获取对称算法AES密钥，但是AES密钥使用服务端的RSA私钥进行加密了，客户端通过RSA公钥解密后得到AES密钥。对交互数据进行加密。并且，从解密包数据看，没有签名如sign字段，传输没有进行签名校验，这让人觉得有些欣喜。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">通过上述代码，我们找到了RSA加密使用的公钥，发现有公钥解密的函数，这个时候，我们可以通过尝试调用公钥解密函数，编写对应的解密脚本。得到AES密钥与向量。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="251" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/12_br3MHGpEMS93cqpvZYYxbYs7Ebcktw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9PicIiababqRbJ3bUGFHMAX1GDSbr3MHGpEMS93cqpvZYYxbYs7Ebcktw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">我们通过脱壳、反编译，拿到了java core代码，成功破解了数据包加解密逻辑。接下来可以进行漏洞挖掘。但是在客户端安全方面，上述过程还可能会遇到反调试、反HOOK、完整性校验、重签名检测等威胁。</span></p><h4 cid="n20" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.25em;margin: 1rem 5px;font-weight: bold;cursor: text;white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">Tips:</span></h4><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(0, 122, 170);"><strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">应用通信数据加密加签：</span></strong><span style="font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">为了防止数据被篡改，客户端和服务端一般对交互数据进行加密。常见的加密方式为，非对称加密、如使用RSA。对称加密如，DES、AES等等。</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;color: rgb(0, 122, 170);">但是单纯的对称和非对称都存在一定的安全风险，所以在对加密算法的运用中，一般采用对称加密结合非对称加密结合的方式，也就是数字信封进行数据传递。保证了数据传输的安全。并且在传递过程中，对数据使用非对称算法进行签名验签，避免数据在传输过程中被篡改。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(0, 122, 170);"><strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">应用调试：</span></strong><span style="font-size:15px;line-height:35px;;caret-color: red;font family: 宋体, SimSun;">在应用逆向分析的过程中是静态分析与动态调试相结合的，其中静态分析就是上面所说的代码反编译。应用调试就是动态分析的一种重要的方式，这里主要是基于无源码进行调试，这里分为SO调试与smali调试，其中SO调试主要使用的是GDB、LLDB、IDA pro等工具，调试smali使用的是IDEA、AndroidStudio等配合Smalidea插件进行调试。</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(0, 122, 170);"><strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">HOOK：</span></strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">主要是基于动态分析与静态分析后，找到应用的关键代码位置，通过HOOK插件拦截关键代码调用，获取参数信息或篡改函数调用等。hook的工具主要有Xposed、Cydia、Frida等，其中自己编写native hook代码，配合注入的方式进行实现。</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(0, 122, 170);"><strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">代码反编译：</span></strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">代码反编译就是将APK中包含的各个文件，根据其固定的格式，从二进制反编译成可查看的代码，与正向开发是相反的操作，反编译的主要工具有apktool、Androidkiller、jeb、jadx、smali/baksmali、IDA pro等等。</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(0, 122, 170);"><strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">二次打包：</span></strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">每一个Android应用程序都会有一个数字签名信息，在Android系统安装应用的时候会对数字签名信息进行校验，如果应用没有对其签名进行校验，那么就存在二次打包的问题，造成应用被篡改，植入木马等。签名工具主要有jarsigner、apksigner 等。</span></span></p><p style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><br  /></p><section data-tools="135编辑器" data-id="29514"><section style="margin-top: 0.5em;max-width: 100%;box-sizing: border-box;min-width: 0px;color: rgb(62, 62, 62);font-size:15px;line-height:35px;;line-height: 24px;border-width: initial;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section><section style="max-width: 100%;box-sizing: border-box;display: inline-block;vertical-align: top;height: 1.8em;width: 1.8em;border-radius: 50%;border-width: 3px;border-style: solid;border-color: rgb(221, 237, 235);font-size: 1.6em;font-weight: inherit;text-align: center;text-decoration: inherit;color: rgb(221, 237, 235);background: rgb(1, 115, 99);font family: inherit;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;line-height: 1.6em;overflow-wrap: break-word !important;" data-original-title="" title="" data-num="3">3</section></section></section><section style="margin-top: -1.56em;margin-bottom: 1em;margin-left: 0.5em;float: left;border-radius: 1em;font-size: 1.2em;font-weight: inherit;text-decoration: inherit;color: rgb(1, 115, 99);border-color: rgb(221, 237, 235);background-color: rgb(221, 237, 235);z-index: -1;font family: inherit;box-sizing: border-box;overflow-wrap: break-word !important;"><span style="box-sizing: border-box;display: inline-block;float: left;line-height: 1.6em;margin-right: 5px;margin-left: 5px;max-width: 100%;padding-right: 10px;padding-left: 2em;vertical-align: top;font family: arial, helvetica, sans-serif;overflow-wrap: break-word !important;">发现注入点</span></section><section style="clear: both;width: 0px;height: 0px;overflow: hidden;"><br  /></section></section></section><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">由于该客户端是内部人员使用，尝试注册账户，没有注册成功，发现需要管理员审核通过才能登陆。爆破无果，经过抓包解密，修改数据包进一步测试，再次解密返回数据包，发现登录处存在SQL注入漏洞，而且是报错型注入。</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">经过手工注入，Payload如下：</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">Request：</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">获取密钥：</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="228" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/13_ZKFKPSRibJ0ItFq5vtPnRKLRV2scVw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9sHBtZ8sXiatj5ruxEMVh1XwPZFZKFKPSRibJ0ItFq5vtPnRKLRV2scVw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">解密密钥：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="284" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/14_jxU33RicicANnJI53OzxBjf3iadHtw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9zicGglS3AlxmbIf7Vkp4Mpib7qGgxjxU33RicicANnJI53OzxBjf3iadHtw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">登录请求包：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="304" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/15_2ulicU5A7oLic7H7ib7C8S1tDDkV7g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9hib9YjZEvI5Ml1WEVkOInQiaFiaH7J2ulicU5A7oLic7H7ib7C8S1tDDkV7g/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">登录响应包：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="221" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/16_icllEm2oewYed6HfwcOicOmibVHVWw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9lhU09LEK0rmeSqA0MwDcibnIYibpAicllEm2oewYed6HfwcOicOmibVHVWw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">Response：</span> <span md-inline="plain" style="box-sizing: border-box;">解密登录响应包：</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="208" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/17_8xNu3M9EMa1QeoBPz1fCEVrLxniajg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9cglR9XHLjibXeLQMA2RZJKSeia48xNu3M9EMa1QeoBPz1fCEVrLxniajg/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><h4 cid="n32" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.25em;margin: 1rem 5px;font-weight: bold;cursor: text;white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">Tips:</span></h4><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(0, 122, 170);"><strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">中间人攻击：</span></strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">数据传输方面主要是在应用与服务端进行数据交互时产生的安全隐患，可能存在信息泄露、传输数据篡改、请求重放攻击等。</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">如果应用在与服务端交互传输数据的过程中，未对数据进行加签、完整性校验，传输数据就容易被篡改，在结合OWASP Mobile TOP10中的漏洞就可以对服务端进行攻击。例如通过文件上传漏洞，sql注入漏洞等获取服务端的数据，甚至于拿到服务端的shell。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">后面的实例就是通过篡改传输数据，结合安全漏洞获取的shell。</span></p><p style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><br  /></p><section data-tools="135编辑器" data-id="29514"><section style="margin-top: 0.5em;max-width: 100%;box-sizing: border-box;min-width: 0px;color: rgb(62, 62, 62);font-size:15px;line-height:35px;;line-height: 24px;border-width: initial;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section><section style="max-width: 100%;box-sizing: border-box;display: inline-block;vertical-align: top;height: 1.8em;width: 1.8em;border-radius: 50%;border-width: 3px;border-style: solid;border-color: rgb(221, 237, 235);font-size: 1.6em;font-weight: inherit;text-align: center;text-decoration: inherit;color: rgb(221, 237, 235);background: rgb(1, 115, 99);font family: inherit;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;line-height: 1.6em;overflow-wrap: break-word !important;" data-original-title="" title="" data-num="4">4</section></section></section><section style="margin-top: -1.56em;margin-bottom: 1em;margin-left: 0.5em;float: left;border-radius: 1em;font-size: 1.2em;font-weight: inherit;text-decoration: inherit;color: rgb(1, 115, 99);border-color: rgb(221, 237, 235);background-color: rgb(221, 237, 235);z-index: -1;font family: inherit;box-sizing: border-box;overflow-wrap: break-word !important;"><span style="box-sizing: border-box;display: inline-block;float: left;line-height: 1.6em;margin-right: 5px;margin-left: 5px;max-width: 100%;padding-right: 10px;padding-left: 2em;vertical-align: top;font family: arial, helvetica, sans-serif;overflow-wrap: break-word !important;">dump用户数据</span></section><section style="clear: both;width: 0px;height: 0px;overflow: hidden;"><br  /></section></section></section><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">经过手工注入，多次构造sql语句，获取部分用户的账户和密码：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">Request</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">请求:</span></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="281" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/18_F23o8WAYyw8WmQHVyEmcKDmQmb8bdA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9tOHLGqU3kF67RUicRxW6xLOetF23o8WAYyw8WmQHVyEmcKDmQmb8bdA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">响应包解密：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="274" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/19_kPeDG1Lib0URsWdGj2Z93uoFyOOibQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9w2rNNK8a43L04VPmd3CCnJtQazkPeDG1Lib0URsWdGj2Z93uoFyOOibQ/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">解密：</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><img data-backh="187" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/20_cjz7gAowuuU6WBDTIfKBG84G6u2qng.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9JS3VTFA6ibfZZhFNCYPYjN1gYicjz7gAowuuU6WBDTIfKBG84G6u2qng/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><pre spellcheck="false" cid="n39" mdtype="fences"><p><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">用注入出来的数据成功登录APP。</span></p><p><br  /></p></pre><section data-tools="135编辑器" data-id="29514"><section style="margin-top: 0.5em;max-width: 100%;box-sizing: border-box;min-width: 0px;color: rgb(62, 62, 62);font-size:15px;line-height:35px;;line-height: 24px;border-width: initial;border-style: none;border-color: initial;overflow-wrap: break-word !important;"><section><section style="max-width: 100%;box-sizing: border-box;display: inline-block;vertical-align: top;height: 1.8em;width: 1.8em;border-radius: 50%;border-width: 3px;border-style: solid;border-color: rgb(221, 237, 235);font-size: 1.6em;font-weight: inherit;text-align: center;text-decoration: inherit;color: rgb(221, 237, 235);background: rgb(1, 115, 99);font family: inherit;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box;line-height: 1.6em;overflow-wrap: break-word !important;" data-original-title="" title="" data-num="5">5</section></section></section><section style="margin-top: -1.56em;margin-bottom: 1em;margin-left: 0.5em;float: left;border-radius: 1em;font-size: 1.2em;font-weight: inherit;text-decoration: inherit;color: rgb(1, 115, 99);border-color: rgb(221, 237, 235);background-color: rgb(221, 237, 235);z-index: -1;font family: inherit;box-sizing: border-box;overflow-wrap: break-word !important;"><span style="box-sizing: border-box;display: inline-block;float: left;line-height: 1.6em;margin-right: 5px;margin-left: 5px;max-width: 100%;padding-right: 10px;padding-left: 2em;vertical-align: top;font family: arial, helvetica, sans-serif;overflow-wrap: break-word !important;">上传Get Shell</span></section><section style="clear: both;width: 0px;height: 0px;overflow: hidden;"><br  /></section></section></section><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">获取到用户数据后，我使用了其中某员工的账号密码，直接登陆app。发现该app功能包括通讯录查询、数据同步、excle文件上传、头像上传、文件下载以及查询功能，且发现上传下载均未进行黑白名单过滤。可利用的点较多。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">虽然此处有N种方式可以利用。但是我们在不破坏委托方正常业务的的情况下，选择了头像上传，直接上传jsp拿到shell。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">后端没有校验直接上传文件成功。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;"><img data-backh="486" data-backw="568" data-ratio="1" data-type="png" data-w="1" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/21_INRzPic9ngftSibyKmOdeGgicvwUxA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9vt6IxIP1he6hz5JFRg8MzypK09wINRzPic9ngftSibyKmOdeGgicvwUxA/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">成功响应加密包。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="283" data-backw="578" data-ratio="0.4899135446685879" data-s="300,640" data-type="png" data-w="694" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/22_S3JbfzI4rH31Zx2dJuoic8RSictiaw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v97esAnYswTt5oX2Jtu35hCE5hB1LS3JbfzI4rH31Zx2dJuoic8RSictiaw/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">解密响应包。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="257" data-backw="578" data-ratio="0.44471153846153844" data-s="300,640" data-type="png" data-w="832" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/23_5koNH5mh1SpHNksUQ5mib8ereGr3dg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9ByD7t9WwdwnKSffOY8l7ibhx1O5koNH5mh1SpHNksUQ5mib8ereGr3dg/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">Shell执行成功。</span></p><p style="text-align: center;"><img class="rich_pages js_insertlocalimg" data-backh="400" data-backw="578" data-ratio="0.6923076923076923" data-s="300,640" data-type="png" data-w="832" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/24_Itn2AiaAic7Ve6Qicianw1lDRMs92g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/WTOrX1w0s55PkSaZnBboIzwrwZa7a0v9ms7EdLfLyLeAgAfF7U9Z2qiapCkFIItn2AiaAic7Ve6Qicianw1lDRMs92g/640?wx_fmt=png'" style="width: 100%;height: auto;"  /></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">至此，Get Shell。我们此次测试的目标以及达成。</span></p><h4 cid="n47" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.25em;margin: 1rem 5px;font-weight: bold;cursor: text;white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;color: rgb(0, 122, 170);">Tips:</span></h4><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(0, 122, 170);"><strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">SQL注入：</span></strong><span style="box-sizing: border-box;font-size:15px;line-height:35px;;font family: 宋体, SimSun;">在应用运行期间避免不了在服务端实现数据持久化，这可能就会操作到数据库，而在操作数据库的过程中未对参数进行校验，导致数据库存在注入问题，造成数据信息泄露，严重的可写shell，获取服务器权限。</span></span></p><h2 cid="n49" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.75em;margin: 1rem 5px;font-weight: bold;cursor: text;padding-bottom: 0.3em;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><br  /></h2><section data-tools="135编辑器" data-id="97835"><section style="text-align: left;margin: 10px auto;"><section style="display: inline-block;"><section style="background-color: rgb(221, 237, 235);border-top-right-radius: 20px;border-bottom-right-radius: 20px;padding: 6px 1.5em;box-sizing: border-box;"><section style="text-align: center;letter-spacing: 3px;font-size:16px;line-height:36px;;color: rgb(234, 249, 253);text-shadow: rgb(1, 115, 99) 1px 1px, rgb(1, 115, 99) 1px -1px, rgb(1, 115, 99) 1px -1px, rgb(1, 115, 99) -1px 1px, rgb(1, 115, 99) -1px -1px, rgb(1, 115, 99) 0px 1.4px, rgb(1, 115, 99) 0px -1.4px, rgb(1, 115, 99) -1.4px 0px, rgb(1, 115, 99) 1.4px 0px, 2px 0px, rgb(195, 217, 223) 0px 3px, rgb(195, 217, 223) 0px 3px, rgb(195, 217, 223) 0px 2px, rgb(195, 217, 223) 0px 2px;box-sizing: border-box;"><span style="font-size:20px;line-height:40px;;"><strong data-brushtype="text">总结</strong></span></section></section></section></section></section><h2 cid="n49" mdtype="heading" style="box-sizing: border-box;break-after: avoid-page;break-inside: avoid;font-size: 1.75em;margin: 1rem 5px;font-weight: bold;cursor: text;padding-bottom: 0.3em;border-bottom: 1px solid rgb(238, 238, 238);white-space: pre-wrap;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"></h2><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">一些APP在运行期间都会存在上传图片的操作，但是由于未对文件进行校验，导致可以上传非图片格式文件。如果上传的是一个包含了木马程序的文件，可能导致服务器数据泄露，严重可获取shell。</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">此外，服务端还有很多的风险是不可忽略的，攻击者有非常多的手段，利用单个漏洞或者组合漏洞对服务端进行攻击。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">实际上在APP应用安全方面还有很多的风险点，它们会对应用整体的安全造成严重的威胁。一个安全的应用也不仅仅是通过使用某一技术来实现的，而是建立在一个完善的安全架构、安全开发过程、安全测试、安全运维、安全管理的整个流程的基础上的，缺一不可。</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">我们所做的安全对抗，正如同没有硝烟的战争。战争的结果除了输赢之分，还有正义与非正义之别。</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;"><span md-inline="plain" style="box-sizing: border-box;">我们在平时对于APP的渗透中，时常扮演一个攻击者的角色，而我们在攻击的过程中，会使用一切灵活应变的手段，唯一的区别就是我们要时刻站在正义的视角，探索了其漏洞原理，却不因此对其造成损害。</span> </span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;box-sizing: border-box;">以上。</span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;font family: 宋体, SimSun;box-sizing: border-box;"></span></p><p style="box-sizing: border-box;orphans: 4;margin: 0.8em 5px;white-space: pre-wrap;font-size:16px;line-height:36px;;line-height: 1.75em;letter-spacing: 2.5px;font family: Helvetica, Arial, sans-serif;"><span style="color: rgb(88, 88, 88);font-size:15px;line-height:35px;;font family: 宋体, SimSun;box-sizing: border-box;">附：本文中用到的环境如下，供君参考：</span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:14px;line-height:34px;;"><span style="font-size:15px;line-height:35px;;orphans: 4;white-space: pre-wrap;">JustTrustMe:</span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:14px;line-height:34px;;"></span><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:14px;line-height:34px;;"><span style="orphans: 4;white-space: pre-wrap;caret-color: red;font-size:15px;line-height:35px;;">https://github.com/Fuzion24/JustTrustMe</span><span style="font family: Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;orphans: 4;white-space: pre-wrap;caret-color: red;color: rgb(0, 0, 0);"> </span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><br  /></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;">Burp:</span></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;">https://portswigger.net/burp</span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><br  /></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;">Charles:</span></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;">https://www.charlesproxy.com/</span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><br  /></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;">Idea:</span>：</span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><span style="letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">https://www.jetbrains.com/</span><span style="color: rgb(0, 0, 0);font family: Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;"> </span></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><br  /></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;">jadx:</span></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><span style="letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;box-sizing: border-box;font-size:15px;line-height:35px;;color: rgb(88, 88, 88);font family: 宋体, SimSun;">https://github.com/skylot/jadx</span><span style="color: rgb(0, 0, 0);font family: Helvetica, Arial, sans-serif;font-size:16px;line-height:36px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;"> </span></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><br  /></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;"><span style="color: rgb(88, 88, 88);font family: 宋体, SimSun;font-size:15px;line-height:35px;;letter-spacing: 2.5px;orphans: 4;white-space: pre-wrap;">Xposed:</span></span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><span style="color: rgb(88, 88, 88);"><span style="font-size:14px;line-height:34px;;font family: 宋体, SimSun;">https://github.com/rovo89/Xposed</span></span></p><p style="margin-right: 5px;margin-left: 5px;white-space: normal;letter-spacing: 2.5px;line-height: 1.75em;"><br  /></p><p style="text-align: center;"><img src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/25_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-ratio="0.109375" data-w="640"  /></p><p style="text-align: right;"><span style="font-size:15px;line-height:35px;;">参考来源：酒仙桥六号部队</span></p><p style="text-align: center;"><img class="rich_pages" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2020-05-26_APP渗透｜看我如何在APP中getshell/26_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style=""  /></p></section></section>
                </div>
</div>
</body>
</html>